[
  {
    "name": "Grain Client Reporting Dashboard v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-fd1ijpmos",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1"
              }
            ]
          }
        },
        "id": "weekly-report",
        "name": "Weekly Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          400
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {},
        "id": "webhook-report",
        "name": "Manual Report",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          600
        ],
        "webhookId": "generate-report"
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Clients"
          },
          "options": {}
        },
        "id": "get-clients",
        "name": "Get Clients",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          400,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://www.googleapis.com/analytics/v4/reports:batchGet",
          "authentication": "oAuth2",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"reportRequests\": [{\n    \"viewId\": \"{{ $json.ga4_property_id }}\",\n    \"dateRanges\": [{ \"startDate\": \"7daysAgo\", \"endDate\": \"today\" }],\n    \"metrics\": [\n      { \"expression\": \"ga:sessions\" },\n      { \"expression\": \"ga:users\" },\n      { \"expression\": \"ga:pageviews\" },\n      { \"expression\": \"ga:bounceRate\" }\n    ]\n  }]\n}"
        },
        "id": "get-ga4-data",
        "name": "Get GA4 Data",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          600,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://graph.facebook.com/v18.0/act_{{ $json.fb_ad_account_id }}/insights",
          "authentication": "oAuth2",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "date_preset",
                "value": "last_7d"
              },
              {
                "name": "fields",
                "value": "spend,impressions,clicks,cpc,ctr,conversions"
              }
            ]
          }
        },
        "id": "get-meta-ads",
        "name": "Get Meta Ads",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          600,
          600
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "const client = $input.item.json;\nconst ga4 = $('Get GA4 Data').first()?.json?.reports?.[0]?.data?.totals?.[0]?.values || [];\nconst metaAds = $('Get Meta Ads').first()?.json?.data?.[0] || {};\n\nreturn {\n  json: {\n    client_name: client.name,\n    client_email: client.email,\n    period: 'Last 7 Days',\n    analytics: {\n      sessions: parseInt(ga4[0]) || 0,\n      users: parseInt(ga4[1]) || 0,\n      pageviews: parseInt(ga4[2]) || 0,\n      bounce_rate: parseFloat(ga4[3]) || 0\n    },\n    advertising: {\n      spend: parseFloat(metaAds.spend) || 0,\n      impressions: parseInt(metaAds.impressions) || 0,\n      clicks: parseInt(metaAds.clicks) || 0,\n      cpc: parseFloat(metaAds.cpc) || 0,\n      ctr: parseFloat(metaAds.ctr) || 0\n    }\n  }\n};"
        },
        "id": "merge-data",
        "name": "Merge Data",
        "type": "n8n-nodes-base.code",
        "position": [
          800,
          500
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Dijital pazarlama uzmanÄ±sÄ±n. MÃ¼ÅŸteri performans verisini analiz et ve kÄ±sa Ã¶zet yaz. Ä°yi, kÃ¶tÃ¼ ve geliÅŸtirme Ã¶nerisi iÃ§ersin. Max 200 kelime."
              },
              {
                "role": "user",
                "content": "=Client: {{ $json.client_name }}\nPeriod: {{ $json.period }}\n\nAnalytics:\n- Sessions: {{ $json.analytics.sessions }}\n- Users: {{ $json.analytics.users }}\n- Bounce: {{ $json.analytics.bounce_rate }}%\n\nAds:\n- Spend: ${{ $json.advertising.spend }}\n- Clicks: {{ $json.advertising.clicks }}\n- CTR: {{ $json.advertising.ctr }}%"
              }
            ]
          }
        },
        "id": "ai-insights",
        "name": "AI Insights",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1000,
          500
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "sendTo": "={{ $json.client_email }}",
          "subject": "=HaftalÄ±k Performans Raporu - {{ $json.client_name }}",
          "message": "=Merhaba,\n\n{{ $json.period }} dÃ¶nemi performans Ã¶zetiniz:\n\nðŸ“Š *Web Sitesi*\nâ€¢ Oturum: {{ $json.analytics.sessions }}\nâ€¢ KullanÄ±cÄ±: {{ $json.analytics.users }}\nâ€¢ Sayfa GÃ¶rÃ¼ntÃ¼leme: {{ $json.analytics.pageviews }}\n\nðŸ’° *Reklamlar*\nâ€¢ Harcama: ${{ $json.advertising.spend }}\nâ€¢ TÄ±klama: {{ $json.advertising.clicks }}\nâ€¢ CTR: {{ $json.advertising.ctr }}%\n\nðŸ’¡ *AI DeÄŸerlendirmesi*\n{{ $('AI Insights').first().json.message.content }}\n\nSorularÄ±nÄ±z iÃ§in bize ulaÅŸÄ±n.\n\nSaygÄ±larÄ±mÄ±zla",
          "options": {}
        },
        "id": "send-report",
        "name": "Send Report",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1200,
          500
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "channel": "#client-reports",
          "text": "=ðŸ“Š *Rapor GÃ¶nderildi*\n\nClient: {{ $json.client_name }}\nPeriod: {{ $json.period }}\n\nKey Metrics:\nâ€¢ Sessions: {{ $json.analytics.sessions }}\nâ€¢ Ad Spend: ${{ $json.advertising.spend }}\nâ€¢ CTR: {{ $json.advertising.ctr }}%",
          "otherOptions": {}
        },
        "id": "notify-team",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "position": [
          1200,
          700
        ],
        "typeVersion": 2.1
      }
    ],
    "connections": {
      "Weekly Report": {
        "main": [
          [
            {
              "node": "Get Clients",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Report": {
        "main": [
          [
            {
              "node": "Get Clients",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Clients": {
        "main": [
          [
            {
              "node": "Get GA4 Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Meta Ads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get GA4 Data": {
        "main": [
          [
            {
              "node": "Merge Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Meta Ads": {
        "main": [
          [
            {
              "node": "Merge Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Data": {
        "main": [
          [
            {
              "node": "AI Insights",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Insights": {
        "main": [
          [
            {
              "node": "Send Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Report": {
        "main": [
          [
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "agency"
      },
      {
        "name": "reporting"
      },
      {
        "name": "analytics"
      }
    ]
  },
  {
    "name": "Grain Lead Conversion Funnel v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-237j4v2o4",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "new-lead",
          "options": {}
        },
        "id": "webhook-lead",
        "name": "New Lead Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "grain-lead-funnel"
      },
      {
        "parameters": {
          "jsCode": "const lead = $input.item.json;\n// Mock Enrichment (Normally use Clearbit/Apollo API here)\nreturn {\n  json: {\n    ...lead,\n    enrichment: {\n      company_size: \"50-200\",\n      industry: \"SaaS\",\n      tech_stack: [\"HubSpot\", \"Slack\", \"AWS\"],\n      linkedin_url: `https://linkedin.com/in/${lead.email.split('@')[0]}`\n    }\n  }\n};"
        },
        "id": "enrich-lead",
        "name": "Enrich Lead Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Sales Qualification AI. Score this lead (0-100) and segment them (HOT/WARM/COLD) based on their profile.\n\nCriteria:\n- Match Industry: SaaS, Agency (High Score)\n- Tech Stack overlaps (High Score)\n- Size Match\n\nOutput JSON:\n{\n  \"score\": 85,\n  \"segment\": \"HOT\",\n  \"personalization_points\": [\"Uses HubSpot\", \"Scaling phase\"]\n}"
              },
              {
                "role": "user",
                "content": "Lead Profile: {{ JSON.stringify($json) }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-lead-score",
        "name": "AI Score Lead",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.segment }}",
          "rules": {
            "rules": [
              {
                "value2": "HOT",
                "output": 0
              },
              {
                "value2": "WARM",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "segment-router",
        "name": "Segment Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          900,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Write a personalized cold email for a HOT lead. Keep it under 150 words. Focus on pain points related to {{ $json.enrichment.industry }}. Use a friendly, professional tone."
              },
              {
                "role": "user",
                "content": "Lead Data: {{ JSON.stringify($json) }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "gen-email-hot",
        "name": "Analyze & Write (Hot)",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1150,
          150
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "Question about your automation stack",
          "message": "={{ $json.message.content }}",
          "options": {}
        },
        "id": "gmail-send",
        "name": "Send Email (Draft)",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1400,
          150
        ]
      },
      {
        "parameters": {
          "channel": "crm-updates",
          "text": "=ðŸ§Š **Cold Lead Archived**\nLead: {{ $json.email }}\nScore: {{ $json.score }}",
          "otherOptions": {}
        },
        "id": "slack-notify-cold",
        "name": "Notify Archive",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1150,
          500
        ]
      }
    ],
    "connections": {
      "New Lead Trigger": {
        "main": [
          [
            {
              "node": "Enrich Lead Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Enrich Lead Data": {
        "main": [
          [
            {
              "node": "AI Score Lead",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Score Lead": {
        "main": [
          [
            {
              "node": "Segment Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Segment Router": {
        "main": [
          [
            {
              "node": "Analyze & Write (Hot)",
              "type": "main",
              "index": 0
            }
          ],
          [],
          [
            {
              "node": "Notify Archive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze & Write (Hot)": {
        "main": [
          [
            {
              "node": "Send Email (Draft)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Meeting Intelligence Hub v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-yz1mpbvz0",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "meeting-complete",
          "options": {}
        },
        "id": "webhook-meeting",
        "name": "Meeting Completed",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "meeting-intelligence"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Extract from meeting transcript:\n1. Summary (3 sentences)\n2. Action Items (list)\n3. Key Decisions\n4. Follow-up Required (yes/no)\n5. Sentiment (positive/neutral/negative)\n\nOutput JSON."
              },
              {
                "role": "user",
                "content": "Transcript: {{ $json.transcript }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-extract",
        "name": "AI Extract Insights",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Meeting_Notes"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "date": "={{ $now.toFormat('yyyy-MM-dd') }}",
              "summary": "={{ $json.summary }}",
              "action_items": "={{ JSON.stringify($json.action_items) }}",
              "sentiment": "={{ $json.sentiment }}"
            }
          }
        },
        "id": "save-notes",
        "name": "Save Meeting Notes",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Write a professional follow-up email based on meeting summary and action items. Keep it concise."
              },
              {
                "role": "user",
                "content": "Summary: {{ $json.summary }}\nAction Items: {{ JSON.stringify($json.action_items) }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-followup",
        "name": "Generate Follow-up",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1000,
          300
        ]
      },
      {
        "parameters": {
          "channel": "sales-meetings",
          "text": "=ðŸ“ **Meeting Summary**\n\n{{ $json.summary }}\n\nðŸ“‹ Action Items:\n{{ $json.action_items.map(a => 'â€¢ ' + a).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "slack-summary",
        "name": "Post to Slack",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          500
        ]
      }
    ],
    "connections": {
      "Meeting Completed": {
        "main": [
          [
            {
              "node": "AI Extract Insights",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Extract Insights": {
        "main": [
          [
            {
              "node": "Save Meeting Notes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Meeting Notes": {
        "main": [
          [
            {
              "node": "Generate Follow-up",
              "type": "main",
              "index": 0
            },
            {
              "node": "Post to Slack",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Proposal Contract Generator v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-egilytudg",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "generate-proposal",
          "options": {}
        },
        "id": "webhook-proposal",
        "name": "Proposal Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "proposal-generator"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Generate a professional business proposal with sections:\n1. Executive Summary\n2. Scope of Work\n3. Deliverables\n4. Timeline\n5. Pricing\n6. Terms & Conditions\n\nOutput in Markdown format."
              },
              {
                "role": "user",
                "content": "Client: {{ $json.client_name }}\nProject: {{ $json.project_description }}\nBudget: {{ $json.budget }}\nTimeline: {{ $json.timeline }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-proposal",
        "name": "AI Generate Proposal",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Proposals"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "client": "={{ $json.client_name }}",
              "project": "={{ $json.project_description }}",
              "status": "draft",
              "created_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-proposal",
        "name": "Save Proposal",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={ \"proposal_markdown\": \"{{ $json.message.content }}\", \"status\": \"generated\" }",
          "options": {}
        },
        "id": "return-proposal",
        "name": "Return Proposal",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1000,
          300
        ]
      }
    ],
    "connections": {
      "Proposal Request": {
        "main": [
          [
            {
              "node": "AI Generate Proposal",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Proposal": {
        "main": [
          [
            {
              "node": "Save Proposal",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Proposal": {
        "main": [
          [
            {
              "node": "Return Proposal",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain RevOps Hub v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ycxqck6wd",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 4
              }
            ]
          }
        },
        "id": "schedule-revops",
        "name": "Every 4 Hours",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "content": "## Mock CRM Data Fetch\nIn production, replace this with a HubSpot/Salesforce 'Get All Deals' node.",
          "height": 100,
          "width": 300
        },
        "id": "crm-note",
        "name": "CRM Stickey Note",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          450,
          200
        ]
      },
      {
        "parameters": {
          "jsCode": "return [\n  { json: { deal_id: \"D-101\", stage: \"negotiation\", amount: 5000, last_activity: \"2025-01-01\", owner: \"John\" } },\n  { json: { deal_id: \"D-102\", stage: \"qualified\", amount: 12000, last_activity: \"2024-12-15\", owner: \"Sarah\" } },\n  { json: { deal_id: \"D-103\", stage: \"proposal\", amount: 3500, last_activity: \"2025-01-05\", owner: \"Mike\" } }\n];"
        },
        "id": "fetch-deals",
        "name": "Fetch CRM Deals",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Revenue Operations Intelligence AI. Analyze the deal health based on amount, stage, and last activity date (Current Date: {{ $now.toFormat('yyyy-MM-dd') }}).\n\nOutput JSON:\n{\n  \"health_score\": 0-100,\n  \"risk_level\": \"low/medium/high\",\n  \"prediction\": \"close/lost/stalled\",\n  \"reasoning\": \"brief explanation\",\n  \"action_item\": \"suggested next step\"\n}"
              },
              {
                "role": "user",
                "content": "Deal Data: {{ JSON.stringify($json) }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-deal-analysis",
        "name": "AI Analyze Pipeline",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.risk_level }}",
          "rules": {
            "rules": [
              {
                "value2": "high",
                "output": 0
              },
              {
                "value2": "medium",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "risk-router",
        "name": "Risk Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          900,
          300
        ]
      },
      {
        "parameters": {
          "channel": "sales-alerts",
          "text": "=ðŸš¨ **High Risk Deal Alert**\n\nDeal: {{ $json.deal_id }} ($ {{ $json.amount }})\nOwner: {{ $json.owner }}\nRisk Level: {{ $json.risk_level }}\nReason: {{ $json.reasoning }}\n\nðŸ‘‰ Action: {{ $json.action_item }}",
          "otherOptions": {}
        },
        "id": "slack-alert-high",
        "name": "Alert High Risk",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1150,
          150
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Weekly_Forecast"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "deal_id": "={{ $json.deal_id }}",
              "forecast_score": "={{ $json.health_score }}",
              "predicted_close": "={{ $json.prediction }}",
              "last_updated": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "update-forecast",
        "name": "Update Forecast Sheet",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1150,
          400
        ]
      }
    ],
    "connections": {
      "Every 4 Hours": {
        "main": [
          [
            {
              "node": "Fetch CRM Deals",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch CRM Deals": {
        "main": [
          [
            {
              "node": "AI Analyze Pipeline",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Analyze Pipeline": {
        "main": [
          [
            {
              "node": "Risk Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Risk Router": {
        "main": [
          [
            {
              "node": "Alert High Risk",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Update Forecast Sheet",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Update Forecast Sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Agentic AI Orchestrator v1",
    "nodes": [
      {
        "parameters": {},
        "id": "webhook-orchestrator",
        "name": "Orchestrator Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "ai-orchestrator-trigger"
      },
      {
        "parameters": {
          "options": {
            "title": "Grain AI Assistant",
            "subtitle": "Agentic Orchestration Engine"
          }
        },
        "id": "chat-ui-trigger",
        "name": "Chat UI",
        "type": "n8n-nodes-base.chatTrigger",
        "typeVersion": 1,
        "position": [
          200,
          200
        ]
      },
      {
        "parameters": {
          "sessionIdKey": "={{ $json.sessionId || 'default' }}"
        },
        "id": "chat-memory",
        "name": "Window Chat Memory",
        "type": "n8n-nodes-base.windowChatInMemory",
        "typeVersion": 1,
        "position": [
          400,
          100
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "*/30 * * * *"
              }
            ]
          }
        },
        "id": "scheduled-orchestration",
        "name": "Scheduled Task Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "// Task Router & Context Builder\n// Determines which AI agents to invoke based on task type\n\nconst input = $input.first().json;\n\n// Define available agents and their capabilities\nconst agentRegistry = {\n  lead_enrichment: {\n    name: 'Lead Enrichment Agent',\n    capabilities: ['company_research', 'contact_lookup', 'social_profiles', 'technographics'],\n    priority: 1,\n    timeout: 30000,\n    requiresApproval: false\n  },\n  content_generator: {\n    name: 'Content Generation Agent',\n    capabilities: ['email_copy', 'social_posts', 'ad_copy', 'blog_outlines'],\n    priority: 2,\n    timeout: 60000,\n    requiresApproval: true\n  },\n  sentiment_analyzer: {\n    name: 'Sentiment Analysis Agent',\n    capabilities: ['social_listening', 'review_analysis', 'brand_monitoring'],\n    priority: 2,\n    timeout: 20000,\n    requiresApproval: false\n  },\n  outreach_personalizer: {\n    name: 'Outreach Personalization Agent',\n    capabilities: ['email_personalization', 'message_customization', 'timing_optimization'],\n    priority: 3,\n    timeout: 45000,\n    requiresApproval: true\n  },\n  data_analyst: {\n    name: 'Data Analysis Agent',\n    capabilities: ['trend_analysis', 'forecasting', 'anomaly_detection', 'reporting'],\n    priority: 1,\n    timeout: 90000,\n    requiresApproval: false\n  },\n  crm_updater: {\n    name: 'CRM Update Agent',\n    capabilities: ['contact_update', 'deal_creation', 'activity_logging', 'task_creation'],\n    priority: 4,\n    timeout: 15000,\n    requiresApproval: false\n  }\n};\n\n// Handle Chat Input vs Webhook Input\nconst chatMessage = input.chatInput || input.message || \"\";\nconst taskType = input.task_type || input.type || (chatMessage ? 'new_lead' : 'general');\nconst taskData = chatMessage ? { goal: chatMessage } : (input.data || input);\nconst urgency = input.urgency || 'normal';\n\n// Build execution plan based on task type\nlet executionPlan = [];\n\nswitch (taskType) {\n  case 'new_lead':\n    executionPlan = [\n      { agent: 'lead_enrichment', input: taskData, parallel: true },\n      { agent: 'sentiment_analyzer', input: { query: taskData.company }, parallel: true },\n      { agent: 'outreach_personalizer', input: taskData, parallel: false, dependsOn: ['lead_enrichment', 'sentiment_analyzer'] },\n      { agent: 'content_generator', input: { type: 'email', context: taskData }, parallel: false, dependsOn: ['outreach_personalizer'] },\n      { agent: 'crm_updater', input: taskData, parallel: false, dependsOn: ['content_generator'] }\n    ];\n    break;\n    \n  case 'content_campaign':\n    executionPlan = [\n      { agent: 'data_analyst', input: { type: 'audience_analysis', data: taskData }, parallel: false },\n      { agent: 'content_generator', input: taskData, parallel: false, dependsOn: ['data_analyst'] },\n      { agent: 'outreach_personalizer', input: taskData, parallel: false, dependsOn: ['content_generator'] }\n    ];\n    break;\n    \n  case 'churn_prevention':\n    executionPlan = [\n      { agent: 'sentiment_analyzer', input: taskData, parallel: true },\n      { agent: 'data_analyst', input: { type: 'churn_analysis', customer: taskData }, parallel: true },\n      { agent: 'content_generator', input: { type: 'win_back', context: taskData }, parallel: false, dependsOn: ['sentiment_analyzer', 'data_analyst'] },\n      { agent: 'crm_updater', input: { action: 'log_intervention', data: taskData }, parallel: false, dependsOn: ['content_generator'] }\n    ];\n    break;\n    \n  case 'analytics_report':\n    executionPlan = [\n      { agent: 'data_analyst', input: taskData, parallel: false }\n    ];\n    break;\n    \n  default:\n    // General task - try to infer required agents\n    executionPlan = [\n      { agent: 'data_analyst', input: taskData, parallel: false }\n    ];\n}\n\n// Build context graph for agent coordination\nconst contextGraph = {\n  taskId: `task-${Date.now()}`,\n  taskType,\n  urgency,\n  createdAt: new Date().toISOString(),\n  executionPlan,\n  agentRegistry,\n  originalInput: input,\n  requiresHumanApproval: executionPlan.some(step => \n    agentRegistry[step.agent]?.requiresApproval\n  )\n};\n\nreturn [{ json: contextGraph }];"
        },
        "id": "task-router",
        "name": "Task Router & Context Builder",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are the Lead Enrichment Agent. Your job is to gather comprehensive information about leads and companies.\n\nGiven a lead, research and return:\n- Company information (size, industry, revenue, funding, tech stack)\n- Contact details and social profiles\n- Recent news and announcements\n- Key decision makers\n- Potential pain points based on industry\n\nReturn JSON:\n{\n  \"company\": {\n    \"name\": \"\",\n    \"industry\": \"\",\n    \"size\": \"\",\n    \"revenue\": \"\",\n    \"funding\": \"\",\n    \"techStack\": [],\n    \"headquarters\": \"\"\n  },\n  \"contact\": {\n    \"fullName\": \"\",\n    \"title\": \"\",\n    \"linkedin\": \"\",\n    \"twitter\": \"\"\n  },\n  \"insights\": {\n    \"recentNews\": [],\n    \"painPoints\": [],\n    \"opportunities\": []\n  },\n  \"decisionMakers\": [],\n  \"enrichedAt\": \"\"\n}"
              },
              {
                "role": "user",
                "content": "=Enrich this lead:\n{{ JSON.stringify($json.originalInput.data || $json.originalInput, null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.3
          }
        },
        "id": "agent-lead-enrichment",
        "name": "Lead Enrichment Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are the Sentiment Analysis Agent. Analyze text, social media, and reviews to determine sentiment and brand perception.\n\nAnalyze the input and return:\n- Overall sentiment score (-1 to 1)\n- Sentiment breakdown by topic\n- Key themes and topics mentioned\n- Emotional indicators\n- Recommended response strategy\n\nReturn JSON:\n{\n  \"overallSentiment\": {\n    \"score\": 0.0,\n    \"label\": \"positive|neutral|negative\",\n    \"confidence\": 0.0\n  },\n  \"topicSentiments\": [\n    {\"topic\": \"\", \"sentiment\": 0.0, \"mentions\": 0}\n  ],\n  \"keyThemes\": [],\n  \"emotionalIndicators\": {\n    \"joy\": 0.0,\n    \"trust\": 0.0,\n    \"anticipation\": 0.0,\n    \"surprise\": 0.0,\n    \"sadness\": 0.0,\n    \"disgust\": 0.0,\n    \"anger\": 0.0,\n    \"fear\": 0.0\n  },\n  \"responseStrategy\": \"\",\n  \"analyzedAt\": \"\"\n}"
              },
              {
                "role": "user",
                "content": "=Analyze sentiment for:\n{{ JSON.stringify($json.originalInput.data || $json.originalInput, null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.2
          }
        },
        "id": "agent-sentiment",
        "name": "Sentiment Analysis Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          700,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are the Content Generation Agent. Create compelling, personalized content for various marketing channels.\n\nBased on the context and requirements, generate:\n- Subject lines (3 variations)\n- Email body content\n- Social media posts\n- Ad copy variations\n- Call-to-action suggestions\n\nReturn JSON:\n{\n  \"contentType\": \"\",\n  \"subject_lines\": [\n    {\"text\": \"\", \"style\": \"curiosity|benefit|urgency\"}\n  ],\n  \"emailContent\": {\n    \"greeting\": \"\",\n    \"body\": \"\",\n    \"closing\": \"\",\n    \"ps\": \"\"\n  },\n  \"socialPosts\": [\n    {\"platform\": \"linkedin|twitter|facebook\", \"content\": \"\", \"hashtags\": []}\n  ],\n  \"adCopy\": [\n    {\"headline\": \"\", \"description\": \"\", \"cta\": \"\"}\n  ],\n  \"ctas\": [],\n  \"generatedAt\": \"\"\n}"
              },
              {
                "role": "user",
                "content": "=Generate content based on:\n\nTask Type: {{ $json.taskType }}\nContext: {{ JSON.stringify($json.originalInput, null, 2) }}\n\nLead Enrichment Data (if available):\n{{ JSON.stringify($('Lead Enrichment Agent').first()?.json || {}, null, 2) }}\n\nSentiment Analysis (if available):\n{{ JSON.stringify($('Sentiment Analysis Agent').first()?.json || {}, null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.7
          }
        },
        "id": "agent-content",
        "name": "Content Generation Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          950,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are the Outreach Personalization Agent. Customize messaging for individual recipients based on their profile and context.\n\nPersonalize the outreach by:\n- Tailoring tone to recipient's industry and role\n- Incorporating relevant company news or achievements\n- Adding personal touches based on social profiles\n- Optimizing send timing\n- Suggesting follow-up cadence\n\nReturn JSON:\n{\n  \"personalizedMessage\": {\n    \"subject\": \"\",\n    \"body\": \"\",\n    \"personalTouches\": []\n  },\n  \"timing\": {\n    \"optimalSendDay\": \"\",\n    \"optimalSendTime\": \"\",\n    \"timezone\": \"\"\n  },\n  \"followUpCadence\": [\n    {\"day\": 0, \"action\": \"\", \"channel\": \"\"}\n  ],\n  \"personalizationScore\": 0,\n  \"alternativeApproaches\": [],\n  \"personalizedAt\": \"\"\n}"
              },
              {
                "role": "user",
                "content": "=Personalize outreach for:\n\nRecipient: {{ JSON.stringify($json.originalInput.data || $json.originalInput, null, 2) }}\n\nEnrichment Data:\n{{ JSON.stringify($('Lead Enrichment Agent').first()?.json || {}, null, 2) }}\n\nContent Templates:\n{{ JSON.stringify($('Content Generation Agent').first()?.json || {}, null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.5
          }
        },
        "id": "agent-personalization",
        "name": "Outreach Personalization Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          950,
          600
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are the Data Analysis Agent. Analyze data patterns, generate insights, and create forecasts.\n\nBased on the data provided:\n- Identify key trends and patterns\n- Detect anomalies or outliers\n- Generate actionable insights\n- Create forecasts where applicable\n- Suggest optimization opportunities\n\nReturn JSON:\n{\n  \"summary\": \"\",\n  \"keyMetrics\": [\n    {\"name\": \"\", \"value\": 0, \"trend\": \"up|down|stable\", \"significance\": \"\"}\n  ],\n  \"trends\": [\n    {\"pattern\": \"\", \"timeframe\": \"\", \"impact\": \"\"}\n  ],\n  \"anomalies\": [\n    {\"description\": \"\", \"severity\": \"low|medium|high\", \"recommendation\": \"\"}\n  ],\n  \"insights\": [],\n  \"forecasts\": [\n    {\"metric\": \"\", \"prediction\": \"\", \"confidence\": 0, \"timeframe\": \"\"}\n  ],\n  \"recommendations\": [],\n  \"analyzedAt\": \"\"\n}"
              },
              {
                "role": "user",
                "content": "=Analyze this data:\n{{ JSON.stringify($json.originalInput, null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.2
          }
        },
        "id": "agent-analyst",
        "name": "Data Analysis Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          700,
          700
        ]
      },
      {
        "parameters": {
          "jsCode": "// Agent Result Aggregator & Decision Engine\n// Combines outputs from all agents and determines next actions\n\nconst contextGraph = $('Task Router & Context Builder').first().json;\nconst leadEnrichment = $('Lead Enrichment Agent').first()?.json || null;\nconst sentiment = $('Sentiment Analysis Agent').first()?.json || null;\nconst content = $('Content Generation Agent').first()?.json || null;\nconst personalization = $('Outreach Personalization Agent').first()?.json || null;\nconst analysis = $('Data Analysis Agent').first()?.json || null;\n\n// Aggregate all agent outputs\nconst aggregatedResults = {\n  taskId: contextGraph.taskId,\n  taskType: contextGraph.taskType,\n  executedAt: new Date().toISOString(),\n  agents: {\n    leadEnrichment: leadEnrichment ? { success: true, data: leadEnrichment } : null,\n    sentiment: sentiment ? { success: true, data: sentiment } : null,\n    content: content ? { success: true, data: content } : null,\n    personalization: personalization ? { success: true, data: personalization } : null,\n    analysis: analysis ? { success: true, data: analysis } : null\n  }\n};\n\n// Calculate confidence score\nconst agentCount = Object.values(aggregatedResults.agents).filter(a => a?.success).length;\nconst confidenceScore = (agentCount / 5) * 100;\n\n// Generate recommended actions based on results\nconst recommendedActions = [];\n\nif (leadEnrichment && personalization) {\n  recommendedActions.push({\n    type: 'send_email',\n    priority: 'high',\n    data: {\n      to: contextGraph.originalInput.data?.email || contextGraph.originalInput.email,\n      subject: personalization.personalizedMessage?.subject || content?.subject_lines?.[0]?.text,\n      body: personalization.personalizedMessage?.body || content?.emailContent?.body,\n      scheduledFor: `${personalization.timing?.optimalSendDay} ${personalization.timing?.optimalSendTime}`\n    }\n  });\n}\n\nif (sentiment?.overallSentiment?.label === 'negative') {\n  recommendedActions.push({\n    type: 'alert_team',\n    priority: 'urgent',\n    data: {\n      message: `Negative sentiment detected: ${sentiment.overallSentiment.score}`,\n      responseStrategy: sentiment.responseStrategy\n    }\n  });\n}\n\nif (analysis?.anomalies?.some(a => a.severity === 'high')) {\n  recommendedActions.push({\n    type: 'investigate_anomaly',\n    priority: 'high',\n    data: analysis.anomalies.filter(a => a.severity === 'high')\n  });\n}\n\n// Determine if human approval is needed\nconst needsApproval = contextGraph.requiresHumanApproval || \n  recommendedActions.some(a => a.priority === 'urgent') ||\n  confidenceScore < 70;\n\nreturn [{\n  json: {\n    ...aggregatedResults,\n    confidenceScore,\n    recommendedActions,\n    needsApproval,\n    approvalReason: needsApproval ? \n      (confidenceScore < 70 ? 'Low confidence score' : 'Contains urgent or sensitive actions') : \n      null,\n    nextSteps: needsApproval ? 'Awaiting human approval' : 'Ready for automated execution'\n  }\n}];"
        },
        "id": "result-aggregator",
        "name": "Result Aggregator & Decision Engine",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1200,
          500
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "needs-approval",
                "leftValue": "={{ $json.needsApproval }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "approval-check",
        "name": "Needs Human Approval?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          1450,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#ai-orchestrator-approvals",
          "text": "=ðŸ¤– *AI Orchestrator - Approval Required*\n\n*Task ID:* {{ $json.taskId }}\n*Task Type:* {{ $json.taskType }}\n*Confidence Score:* {{ $json.confidenceScore }}%\n*Approval Reason:* {{ $json.approvalReason }}\n\n*Recommended Actions:*\n{{ $json.recommendedActions.map((a, i) => `${i+1}. [${a.priority.toUpperCase()}] ${a.type}`).join('\\n') }}\n\n*Agent Results Summary:*\nâ€¢ Lead Enrichment: {{ $json.agents.leadEnrichment ? 'âœ…' : 'â­ï¸' }}\nâ€¢ Sentiment Analysis: {{ $json.agents.sentiment ? 'âœ…' : 'â­ï¸' }}\nâ€¢ Content Generation: {{ $json.agents.content ? 'âœ…' : 'â­ï¸' }}\nâ€¢ Personalization: {{ $json.agents.personalization ? 'âœ…' : 'â­ï¸' }}\nâ€¢ Data Analysis: {{ $json.agents.analysis ? 'âœ…' : 'â­ï¸' }}\n\n_React with âœ… to approve or âŒ to reject_",
          "otherOptions": {}
        },
        "id": "slack-approval-request",
        "name": "Request Human Approval",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1700,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "// Execute Approved Actions\n// Process and execute the recommended actions\n\nconst aggregatedResults = $input.first().json;\nconst executionResults = [];\n\nfor (const action of aggregatedResults.recommendedActions) {\n  const result = {\n    actionType: action.type,\n    priority: action.priority,\n    status: 'pending',\n    executedAt: null\n  };\n  \n  // Mark for execution (actual execution happens in downstream nodes)\n  result.status = 'queued';\n  result.executedAt = new Date().toISOString();\n  executionResults.push(result);\n}\n\nreturn [{\n  json: {\n    taskId: aggregatedResults.taskId,\n    taskType: aggregatedResults.taskType,\n    executionResults,\n    originalRecommendations: aggregatedResults.recommendedActions,\n    agentData: aggregatedResults.agents,\n    processedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "execute-actions",
        "name": "Execute Actions",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1700,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.hubspot.com/crm/v3/objects/contacts",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "hubSpotApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"properties\": {\n    \"email\": \"{{ $json.agentData.leadEnrichment?.data?.contact?.email || $json.originalRecommendations[0]?.data?.to }}\",\n    \"firstname\": \"{{ $json.agentData.leadEnrichment?.data?.contact?.firstName || '' }}\",\n    \"lastname\": \"{{ $json.agentData.leadEnrichment?.data?.contact?.lastName || '' }}\",\n    \"company\": \"{{ $json.agentData.leadEnrichment?.data?.company?.name || '' }}\",\n    \"jobtitle\": \"{{ $json.agentData.leadEnrichment?.data?.contact?.title || '' }}\",\n    \"ai_enriched\": \"true\",\n    \"ai_confidence_score\": \"{{ $json.confidenceScore || 0 }}\",\n    \"ai_task_id\": \"{{ $json.taskId }}\"\n  }\n}",
          "options": {}
        },
        "id": "crm-update",
        "name": "Update CRM",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1950,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.resend.com/emails",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.RESEND_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"from\": \"AI Orchestrator <ai@yourdomain.com>\",\n  \"to\": [\"{{ $json.originalRecommendations[0]?.data?.to || '' }}\"],\n  \"subject\": \"{{ $json.agentData.personalization?.data?.personalizedMessage?.subject || $json.agentData.content?.data?.subject_lines?.[0]?.text || 'Hello' }}\",\n  \"html\": \"{{ $json.agentData.personalization?.data?.personalizedMessage?.body || $json.agentData.content?.data?.emailContent?.body || '' }}\",\n  \"tags\": [\n    { \"name\": \"ai_generated\", \"value\": \"true\" },\n    { \"name\": \"task_id\", \"value\": \"{{ $json.taskId }}\" }\n  ]\n}",
          "options": {}
        },
        "id": "send-email-action",
        "name": "Send Email Action",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1950,
          700
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.ORCHESTRATOR_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Execution Log",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ $json.processedAt }}",
              "task_id": "={{ $json.taskId }}",
              "task_type": "={{ $json.taskType }}",
              "actions_executed": "={{ $json.executionResults.length }}",
              "status": "={{ $json.executionResults.every(r => r.status === 'queued') ? 'success' : 'partial' }}"
            }
          }
        },
        "id": "log-execution",
        "name": "Log Execution",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          2200,
          600
        ]
      },
      {
        "parameters": {
          "channel": "#ai-orchestrator",
          "text": "=âœ… *AI Orchestrator - Execution Complete*\n\n*Task ID:* {{ $json.taskId }}\n*Task Type:* {{ $json.taskType }}\n*Actions Executed:* {{ $json.executionResults.length }}\n\n*Results:*\n{{ $json.executionResults.map((r, i) => `${i+1}. ${r.actionType}: ${r.status}`).join('\\n') }}\n\n*Processed at:* {{ $json.processedAt }}",
          "otherOptions": {}
        },
        "id": "slack-completion",
        "name": "Slack Completion Notice",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          2200,
          400
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"status\": \"success\",\n  \"taskId\": \"{{ $json.taskId }}\",\n  \"taskType\": \"{{ $json.taskType }}\",\n  \"confidenceScore\": {{ $('Result Aggregator & Decision Engine').first().json.confidenceScore }},\n  \"actionsExecuted\": {{ $json.executionResults.length }},\n  \"needsApproval\": {{ $('Result Aggregator & Decision Engine').first().json.needsApproval }},\n  \"processedAt\": \"{{ $json.processedAt }}\"\n}"
        },
        "id": "webhook-response",
        "name": "Webhook Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          2200,
          800
        ]
      }
    ],
    "connections": {
      "Chat UI": {
        "main": [
          [
            {
              "node": "Task Router & Context Builder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Orchestrator Trigger": {
        "main": [
          [
            {
              "node": "Task Router & Context Builder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Scheduled Task Check": {
        "main": [
          [
            {
              "node": "Task Router & Context Builder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Task Router & Context Builder": {
        "main": [
          [
            {
              "node": "Lead Enrichment Agent",
              "type": "main",
              "index": 0
            },
            {
              "node": "Sentiment Analysis Agent",
              "type": "main",
              "index": 0
            },
            {
              "node": "Data Analysis Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Lead Enrichment Agent": {
        "main": [
          [
            {
              "node": "Content Generation Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sentiment Analysis Agent": {
        "main": [
          [
            {
              "node": "Content Generation Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Content Generation Agent": {
        "main": [
          [
            {
              "node": "Outreach Personalization Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Outreach Personalization Agent": {
        "main": [
          [
            {
              "node": "Result Aggregator & Decision Engine",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Data Analysis Agent": {
        "main": [
          [
            {
              "node": "Result Aggregator & Decision Engine",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Result Aggregator & Decision Engine": {
        "main": [
          [
            {
              "node": "Needs Human Approval?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Needs Human Approval?": {
        "main": [
          [
            {
              "node": "Request Human Approval",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Execute Actions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute Actions": {
        "main": [
          [
            {
              "node": "Update CRM",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send Email Action",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update CRM": {
        "main": [
          [
            {
              "node": "Log Execution",
              "type": "main",
              "index": 0
            },
            {
              "node": "Slack Completion Notice",
              "type": "main",
              "index": 0
            },
            {
              "node": "Webhook Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-saas-agentic-ai"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 2,
    "tags": [
      {
        "name": "Agentic AI",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Multi-Agent",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Orchestration",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "HITL",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain AI Visual Content Generator v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ju8rbwcdi",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "generate-visual",
          "options": {}
        },
        "id": "webhook-visual",
        "name": "Visual Gen Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "visual-gen-webhook"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Analyze the prompt and select the BEST AI provider.\n\nProviders:\n- FLUX (Image, Fast)\n- KLING (Video, Motion)\n- RUNWAY (Video, Cinematic)\n- PIKA (Video, Animation)\n- LUMA (Video, 3D)\n- HIGGSFIELD (Video, Human)\n- VEO (Video, High Quality)\n\nOutput JSON:\n{ \"provider\": \"KLING\", \"optimized_prompt\": \"...\" }"
              },
              {
                "role": "user",
                "content": "Request: {{ $json.body.prompt }}\nType: {{ $json.body.type }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-selector",
        "name": "AI Select Provider",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.provider }}",
          "rules": {
            "rules": [
              {
                "value2": "FLUX",
                "output": 0
              },
              {
                "value2": "KLING",
                "output": 1
              },
              {
                "value2": "RUNWAY",
                "output": 2
              }
            ]
          },
          "fallbackOutput": 3
        },
        "id": "provider-router",
        "name": "Provider Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.piapi.ai/v1/flux/generate",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "x-api-key",
                "value": "={{ $env.PIAPI_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"prompt\": \"{{ $json.optimized_prompt }}\" }"
        },
        "id": "gen-flux",
        "name": "Generate FLUX",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.klingai.com/v1/videos",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.KLING_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"model\": \"kling-v1\", \"prompt\": \"{{ $json.optimized_prompt }}\" }"
        },
        "id": "gen-kling",
        "name": "Generate KLING",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.runwayml.com/v1/deploy/generate",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.RUNWAY_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"prompt\": \"{{ $json.optimized_prompt }}\" }"
        },
        "id": "gen-runway",
        "name": "Generate RUNWAY",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {},
        "id": "merge-outputs",
        "name": "Merge Outputs",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1300,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={ \"status\": \"started\", \"task_id\": \"{{ $json.id }}\", \"provider\": \"{{ $json.provider }}\" }",
          "options": {}
        },
        "id": "respond-api",
        "name": "Respond to API",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1500,
          300
        ]
      }
    ],
    "connections": {
      "Visual Gen Request": {
        "main": [
          [
            {
              "node": "AI Select Provider",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Select Provider": {
        "main": [
          [
            {
              "node": "Provider Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Provider Router": {
        "main": [
          [
            {
              "node": "Generate FLUX",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Generate KLING",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Generate RUNWAY",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate FLUX": {
        "main": [
          [
            {
              "node": "Merge Outputs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate KLING": {
        "main": [
          [
            {
              "node": "Merge Outputs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate RUNWAY": {
        "main": [
          [
            {
              "node": "Merge Outputs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Outputs": {
        "main": [
          [
            {
              "node": "Respond to API",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain_Autonomous_Decision_Engine_v1",
    "nodes": [
      {
        "parameters": {
          "content": "## ðŸ¤– Autonomous Decision Engine\nRules-based AI decision maker with Human-in-the-Loop approval.",
          "height": 100,
          "width": 450,
          "color": 5
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/grain-autonomous-decision-engine-v1"
              },
              {
                "name": "max_discount_percent",
                "value": "20"
              },
              {
                "name": "auto_escalate_threshold",
                "value": "8"
              },
              {
                "name": "require_human_approval_above",
                "value": "1000"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          180,
          350
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "systemMessage": "You are a customer service decision support system.\n\nRULES:\n1. If customer churn score > {{ $json.auto_escalate_threshold }}, escalate automatically.\n2. Can offer max {{ $json.max_discount_percent }}% discount.\n3. Require approval if value > {{ $json.require_human_approval_above }} currency units.\n\nDECISION FORMAT:\n{\n  \"action\": \"apply_discount|escalate|request_approval|auto_resolve\",\n  \"discount_percent\": number,\n  \"reason\": \"string\",\n  \"confidence\": number\n}",
          "tools": {}
        },
        "id": "ai-decision-maker",
        "name": "AI Decision Maker",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1,
        "position": [
          450,
          350
        ]
      },
      {
        "parameters": {
          "conditions": {
            "boolean": [
              {
                "value1": "={{ $json.action === 'request_approval' }}",
                "value2": true
              }
            ]
          }
        },
        "id": "human-check",
        "name": "Human In Loop Check",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          800,
          350
        ]
      },
      {
        "parameters": {
          "channel": "#approvals",
          "text": "ðŸ”” *Approval Needed*\nAction: {{ $json.action }}\nReason: {{ $json.reason }}\nConfidence: {{ $json.confidence }}%",
          "attachments": []
        },
        "id": "slack-approval",
        "name": "Request Human Approval",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1050,
          250
        ]
      },
      {
        "parameters": {
          "jsCode": "// Auto execute action logic here..."
        },
        "id": "auto-execute",
        "name": "Auto Execute",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1050,
          450
        ]
      },
      {
        "parameters": {
          "mode": "workflow"
        },
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          180,
          550
        ],
        "id": "error-trigger",
        "name": "Error Trigger"
      },
      {
        "parameters": {
          "workflowId": "Grain_Sub_Error_Handler"
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1,
        "position": [
          400,
          550
        ],
        "id": "error-handler",
        "name": "Error Handler"
      }
    ],
    "connections": {
      "GRAIN_CONFIG": {
        "main": [
          [
            {
              "node": "AI Decision Maker",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Decision Maker": {
        "main": [
          [
            {
              "node": "Human In Loop Check",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Human In Loop Check": {
        "main": [
          [
            {
              "node": "Request Human Approval",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Auto Execute",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Handler",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "meta": {
      "templateId": "Grain_Autonomous_Decision_Engine_v1",
      "category": "ai-automation",
      "tier": "critical"
    }
  },
  {
    "name": "Grain Knowledge Base AI Search v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-8rq9dan6a",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ“š Knowledge Base AI Search\nRAG-powered semantic search across your documentation with AI-generated answers.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "kb-search",
          "options": {}
        },
        "id": "webhook-search",
        "name": "Search Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "kb-search"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/embeddings",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.OPENAI_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"model\": \"text-embedding-3-small\", \"input\": \"{{ $json.query }}\" }"
        },
        "id": "embed-query",
        "name": "Embed Query",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.PINECONE_URL }}/query",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Api-Key",
                "value": "={{ $env.PINECONE_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"vector\": {{ JSON.stringify($json.data[0].embedding) }},\n  \"topK\": 5,\n  \"includeMetadata\": true\n}"
        },
        "id": "vector-search",
        "name": "Vector Search",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const matches = $input.item.json.matches || [];\nconst context = matches.map(m => m.metadata?.text || '').join('\\n\\n---\\n\\n');\nconst sources = matches.map(m => ({\n  title: m.metadata?.title,\n  url: m.metadata?.url,\n  score: m.score\n}));\n\nreturn {\n  json: {\n    query: $('Search Request').first().json.query,\n    context: context,\n    sources: sources,\n    has_results: matches.length > 0\n  }\n};"
        },
        "id": "prepare-context",
        "name": "Prepare Context",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a helpful assistant that answers questions based on the provided knowledge base context. If the answer is not in the context, say so. Be concise and cite sources when possible."
              },
              {
                "role": "user",
                "content": "Question: {{ $json.query }}\n\nKnowledge Base Context:\n{{ $json.context }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-answer",
        "name": "AI Generate Answer",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"answer\": \"{{ $json.message.content }}\",\n  \"sources\": {{ JSON.stringify($('Prepare Context').first().json.sources) }},\n  \"query\": \"{{ $('Search Request').first().json.query }}\"\n}",
          "options": {}
        },
        "id": "respond",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1500,
          400
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "kb-index",
          "options": {}
        },
        "id": "webhook-index",
        "name": "Index Document",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          650
        ],
        "webhookId": "kb-index"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/embeddings",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.OPENAI_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"model\": \"text-embedding-3-small\", \"input\": \"{{ $json.text }}\" }"
        },
        "id": "embed-doc",
        "name": "Embed Document",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          650
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.PINECONE_URL }}/vectors/upsert",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Api-Key",
                "value": "={{ $env.PINECONE_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"vectors\": [{\n    \"id\": \"{{ $('Index Document').first().json.doc_id }}\",\n    \"values\": {{ JSON.stringify($json.data[0].embedding) }},\n    \"metadata\": {\n      \"title\": \"{{ $('Index Document').first().json.title }}\",\n      \"text\": \"{{ $('Index Document').first().json.text.substring(0, 1000) }}\",\n      \"url\": \"{{ $('Index Document').first().json.url }}\"\n    }\n  }]\n}"
        },
        "id": "upsert-vector",
        "name": "Upsert to Pinecone",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          850
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ KB Search Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          850
        ]
      }
    ],
    "connections": {
      "Search Request": {
        "main": [
          [
            {
              "node": "Embed Query",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Embed Query": {
        "main": [
          [
            {
              "node": "Vector Search",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Vector Search": {
        "main": [
          [
            {
              "node": "Prepare Context",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Context": {
        "main": [
          [
            {
              "node": "AI Generate Answer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Answer": {
        "main": [
          [
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Index Document": {
        "main": [
          [
            {
              "node": "Embed Document",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Embed Document": {
        "main": [
          [
            {
              "node": "Upsert to Pinecone",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain_Knowledge_RAG_v1",
    "nodes": [
      {
        "parameters": {
          "content": "## ðŸ“š Knowledge RAG System\nRetrieval-Augmented Generation using Vector Store (Qdrant).",
          "height": 100,
          "width": 450,
          "color": 5
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/grain-knowledge-rag-v1"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          180,
          350
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "collection": "grain_knowledge_base",
          "topK": 5
        },
        "id": "vector-store",
        "name": "Query Vectorstore",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
        "typeVersion": 1,
        "position": [
          450,
          350
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "prompt": "Answer the question using the context below.\nQuestion: {{ $json.query }}\nContext: {{ $json.context }}\n\nRules: Source citation required."
        },
        "id": "augmented-gen",
        "name": "Augmented Generation",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          700,
          350
        ]
      },
      {
        "parameters": {
          "mode": "workflow"
        },
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          180,
          550
        ],
        "id": "error-trigger",
        "name": "Error Trigger"
      },
      {
        "parameters": {
          "workflowId": "Grain_Sub_Error_Handler"
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1,
        "position": [
          400,
          550
        ],
        "id": "error-handler",
        "name": "Error Handler"
      }
    ],
    "connections": {
      "GRAIN_CONFIG": {
        "main": [
          [
            {
              "node": "Query Vectorstore",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Query Vectorstore": {
        "main": [
          [
            {
              "node": "Augmented Generation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Handler",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "meta": {
      "templateId": "Grain_Knowledge_RAG_v1",
      "category": "ai-automation",
      "tier": "high"
    }
  },
  {
    "name": "Grain_Predictive_Analytics_Engine_v1",
    "nodes": [
      {
        "parameters": {
          "content": "## ðŸ”® Predictive Analytics Engine\nAI-powered forecasting for Churn, Lead Scoring, and Revenue.",
          "height": 100,
          "width": 450,
          "color": 5
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/grain-predictive-analytics-engine-v1"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          180,
          350
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rules": {
            "rules": [
              {
                "value2": "churn_prediction",
                "output": 0
              },
              {
                "value2": "lead_scoring",
                "output": 1
              },
              {
                "value2": "revenue_forecast",
                "output": 2
              }
            ]
          }
        },
        "id": "prediction-type-switch",
        "name": "Prediction Type Switch",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          450,
          350
        ]
      },
      {
        "parameters": {
          "jsCode": "const data = $input.all();\nconst aggregated = {\n  total_records: data.length,\n  avg_engagement: data.reduce((a, b) => a + (b.json.engagement || 0), 0) / (data.length || 1),\n  trend: 'stable' // Simplified trend logic\n};\nreturn [{ json: aggregated, prediction_type: 'churn_prediction' }];"
        },
        "id": "aggregator-code",
        "name": "Data Aggregator",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          700,
          200
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "prompt": "Analyze the following data and provide a prediction.\nData: {{ JSON.stringify($json) }}\nType: {{ $json.prediction_type }}\n\nReturn JSON: { \"prediction\": number, \"confidence\": number, \"reasoning\": string[] }"
        },
        "id": "ai-prediction",
        "name": "AI Prediction",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          950,
          350
        ]
      },
      {
        "parameters": {
          "operation": "insert",
          "table": "grain_predictions",
          "columns": "prediction_type,prediction_value,confidence,reasoning,created_at"
        },
        "id": "save-prediction",
        "name": "Save Prediction",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.4,
        "position": [
          1200,
          350
        ]
      },
      {
        "parameters": {
          "mode": "workflow"
        },
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          180,
          550
        ],
        "id": "error-trigger",
        "name": "Error Trigger"
      },
      {
        "parameters": {
          "workflowId": "Grain_Sub_Error_Handler"
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1,
        "position": [
          400,
          550
        ],
        "id": "error-handler",
        "name": "Error Handler"
      }
    ],
    "connections": {
      "GRAIN_CONFIG": {
        "main": [
          [
            {
              "node": "Prediction Type Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prediction Type Switch": {
        "main": [
          [
            {
              "node": "Data Aggregator",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Prediction",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Prediction",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Data Aggregator": {
        "main": [
          [
            {
              "node": "AI Prediction",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Prediction": {
        "main": [
          [
            {
              "node": "Save Prediction",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Handler",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "meta": {
      "templateId": "Grain_Predictive_Analytics_Engine_v1",
      "category": "ai-automation",
      "tier": "critical"
    }
  },
  {
    "name": "Grain Prompt Engineering Studio v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-b8g4l9aou",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "prompt-studio",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Prompt Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "prompt-studio"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\n\nreturn {\n  json: {\n    request_id: input.request_id || `PRM-${Date.now()}`,\n    raw_prompt: input.prompt || input.raw_prompt,\n    task_type: input.task_type || 'general',\n    target_platform: input.target_platform || 'any',\n    tone: input.tone || 'professional',\n    use_chain_of_thought: input.use_chain_of_thought !== false,\n    generate_variants: input.generate_variants || 3\n  }\n};"
        },
        "id": "normalize-input",
        "name": "Normalize Request",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a world-class Prompt Engineer. Analyze the user's prompt and evaluate it on:\n1. Clarity (1-10)\n2. Completeness (1-10)\n3. Risk (Hallucination/Bias)\n\nReturn JSON output."
              },
              {
                "role": "user",
                "content": "Prompt: {{ $json.raw_prompt }}\nContext: {{ $json.task_type }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "analyze-prompt",
        "name": "Analyze Prompt",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Now OPTIMIZE the prompt. Apply best practices:\n- Add Chain-of-Thought instructions if requested.\n- Add Few-Shot examples.\n- Define clear constraints.\n- Output format specification.\n\nGenerate {{ $json.generate_variants }} variants."
              },
              {
                "role": "user",
                "content": "Original: {{ $json.raw_prompt }}\nAnalysis: {{ $json.analysis_result }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "optimize-prompt",
        "name": "Optimize Prompt",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          850,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"original_prompt\": \"{{ $json.raw_prompt }}\",\n  \"analysis\": {{ $json.analysis_result }},\n  \"optimized_variants\": {{ $json.optimized_result }}\n}",
          "options": {}
        },
        "id": "response",
        "name": "Send Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1100,
          300
        ]
      }
    ],
    "connections": {
      "Prompt Request": {
        "main": [
          [
            {
              "node": "Normalize Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize Request": {
        "main": [
          [
            {
              "node": "Analyze Prompt",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Prompt": {
        "main": [
          [
            {
              "node": "Optimize Prompt",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Optimize Prompt": {
        "main": [
          [
            {
              "node": "Send Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain_Root_Cause_Analyzer_v1",
    "nodes": [
      {
        "parameters": {
          "content": "## ðŸ•µï¸ Root Cause Analyzer\nAutomated deep-dive analysis into metrics changes.",
          "height": 100,
          "width": 450,
          "color": 5
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/grain-root-cause-analyzer-v1"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          180,
          350
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "mode": "multiplex"
        },
        "id": "merge-data",
        "name": "Collect Multi Source Data",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          450,
          350
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "prompt": "Analyze root cause for the following metrics change.\nData: {{ JSON.stringify($input.all()) }}\n\nOutput JSON with root_causes[], correlations[], and recommendations[]. "
        },
        "id": "ai-analysis",
        "name": "AI Root Cause Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          700,
          350
        ]
      },
      {
        "parameters": {
          "resource": "page",
          "title": "Root Cause Analysis - {{ $now.toFormat('yyyy-MM-dd') }}",
          "content": "={{ $json.response }}"
        },
        "id": "notion-report",
        "name": "Generate Notion Report",
        "type": "n8n-nodes-base.notion",
        "typeVersion": 2,
        "position": [
          950,
          350
        ]
      },
      {
        "parameters": {
          "mode": "workflow"
        },
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          180,
          550
        ],
        "id": "error-trigger",
        "name": "Error Trigger"
      },
      {
        "parameters": {
          "workflowId": "Grain_Sub_Error_Handler"
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1,
        "position": [
          400,
          550
        ],
        "id": "error-handler",
        "name": "Error Handler"
      }
    ],
    "connections": {
      "GRAIN_CONFIG": {
        "main": [
          [
            {
              "node": "Merge Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Data": {
        "main": [
          [
            {
              "node": "AI Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Analysis": {
        "main": [
          [
            {
              "node": "Generate Notion Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Handler",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "meta": {
      "templateId": "Grain_Root_Cause_Analyzer_v1",
      "category": "ai-automation",
      "tier": "high"
    }
  },
  {
    "name": "Grain Voice AI Assistant v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-y0ii092ms",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "voice-input",
          "options": {}
        },
        "id": "webhook-voice",
        "name": "Voice Input",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "voice-assistant"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/audio/transcriptions",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.OPENAI_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "file",
                "value": "={{ $json.audio_file }}"
              },
              {
                "name": "model",
                "value": "whisper-1"
              }
            ]
          }
        },
        "id": "whisper-transcribe",
        "name": "Whisper Transcribe",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a helpful voice assistant. Respond conversationally to the user's spoken request. Keep responses under 50 words for TTS."
              },
              {
                "role": "user",
                "content": "{{ $json.text }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-respond",
        "name": "AI Generate Response",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/audio/speech",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.OPENAI_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"model\": \"tts-1\", \"input\": \"{{ $json.message.content }}\", \"voice\": \"nova\" }"
        },
        "id": "tts-generate",
        "name": "Generate Speech (TTS)",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "binary",
          "options": {}
        },
        "id": "return-audio",
        "name": "Return Audio",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1250,
          300
        ]
      }
    ],
    "connections": {
      "Voice Input": {
        "main": [
          [
            {
              "node": "Whisper Transcribe",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Whisper Transcribe": {
        "main": [
          [
            {
              "node": "AI Generate Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Response": {
        "main": [
          [
            {
              "node": "Generate Speech (TTS)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Speech (TTS)": {
        "main": [
          [
            {
              "node": "Return Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Content Pro - Viral Video & Ad Factory",
    "nodes": [
      {
        "parameters": {
          "operation": "summarize"
        },
        "id": "yt-summarizer",
        "name": "YouTube Summarizer",
        "type": "n8n-nodes-base.youtube",
        "typeVersion": 1,
        "position": [
          400,
          300
        ]
      }
    ],
    "connections": {}
  },
  {
    "name": "Grain A/B Testing Engine v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-llazfu2yn",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "ab-test/create",
          "options": {}
        },
        "id": "webhook-create",
        "name": "Create Test",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "ab-create"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Conversion Rate Optimization expert. Generate 2 variants (B and C) for the provided Control (A) content. \nFocus on: {{ $json.body.goal }}\nOutput JSON: { \"variants\": [ { \"id\": \"B\", \"content\": \"...\" }, { \"id\": \"C\", \"content\": \"...\" } ] }"
              },
              {
                "role": "user",
                "content": "Control Content: {{ $json.body.content }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-variants",
        "name": "Generate Variants",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Active_Tests"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "test_id": "={{ $json.body.test_name }}",
              "variant_b": "={{ $json.variants[0].content }}",
              "variant_c": "={{ $json.variants[1].content }}",
              "status": "active",
              "start_date": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-test",
        "name": "Save to DB",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "ab-test/track",
          "options": {}
        },
        "id": "webhook-track",
        "name": "Track Conversion",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          500
        ],
        "webhookId": "ab-track"
      },
      {
        "parameters": {
          "jsCode": "// Simple Z-Score Calculation Mock\nconst visitors = $json.body.visitors;\nconst conversions = $json.body.conversions;\n// ... complex math ...\nreturn { json: { winner: \"B\", confidence: 96 } };"
        },
        "id": "calc-stats",
        "name": "Calc Significance",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "sig-check",
                "leftValue": "={{ $json.confidence }}",
                "rightValue": 95,
                "operator": {
                  "type": "number",
                  "operation": "gte"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "check-winner",
        "name": "Check Winner",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          650,
          500
        ]
      },
      {
        "parameters": {
          "channel": "cro-wins",
          "text": "=ðŸ† **A/B Test Winner Found!**\n\nTest: {{ $json.body.test_id }}\nWinner: Variant {{ $json.winner }}\nConfidence: {{ $json.confidence }}%\n\nAuto-deploying winner...",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Winner",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          850,
          500
        ]
      }
    ],
    "connections": {
      "Create Test": {
        "main": [
          [
            {
              "node": "Generate Variants",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Variants": {
        "main": [
          [
            {
              "node": "Save to DB",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Track Conversion": {
        "main": [
          [
            {
              "node": "Calc Significance",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calc Significance": {
        "main": [
          [
            {
              "node": "Check Winner",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Winner": {
        "main": [
          [
            {
              "node": "Notify Winner",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Churn Prediction & Prevention v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-u6za7vkf2",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 6 * * *"
              }
            ]
          }
        },
        "id": "daily-churn-check",
        "name": "Daily Churn Analysis",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          400
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {},
        "id": "webhook-manual",
        "name": "Manual Churn Check",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          600
        ],
        "webhookId": "churn-manual-check"
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customer_Data"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-customer-data",
        "name": "Get Customer Data",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $env.ANALYTICS_API_URL }}/users/engagement",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "date_from",
                "value": "={{ $now.minus({days: 30}).format('YYYY-MM-DD') }}"
              },
              {
                "name": "date_to",
                "value": "={{ $now.format('YYYY-MM-DD') }}"
              }
            ]
          }
        },
        "id": "get-usage-data",
        "name": "Get Usage Analytics",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          450,
          600
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $env.STRIPE_API_URL }}/v1/customers",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "limit",
                "value": "100"
              }
            ]
          }
        },
        "id": "get-payment-data",
        "name": "Get Payment History",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          450,
          800
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $env.SUPPORT_API_URL }}/tickets",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "created_since",
                "value": "={{ $now.minus({days: 90}).format('YYYY-MM-DD') }}"
              }
            ]
          }
        },
        "id": "get-support-tickets",
        "name": "Get Support Tickets",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          450,
          1000
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "// Merge and normalize all customer data\nconst customerData = $('Get Customer Data').all().map(c => c.json);\nconst usageData = $('Get Usage Analytics').first()?.json?.users || [];\nconst paymentData = $('Get Payment History').first()?.json?.data || [];\nconst supportData = $('Get Support Tickets').first()?.json?.tickets || [];\n\n// Create unified customer profiles\nconst profiles = customerData.map(customer => {\n  const customerId = customer.customer_id || customer.id;\n  \n  // Find related usage data\n  const usage = usageData.find(u => u.customer_id === customerId) || {};\n  \n  // Find related payment data\n  const payments = paymentData.find(p => p.id === customerId || p.email === customer.email) || {};\n  \n  // Count support tickets\n  const tickets = supportData.filter(t => t.customer_id === customerId || t.email === customer.email);\n  const openTickets = tickets.filter(t => t.status === 'open' || t.status === 'pending');\n  const escalatedTickets = tickets.filter(t => t.priority === 'high' || t.priority === 'urgent');\n  \n  return {\n    customer_id: customerId,\n    email: customer.email,\n    name: customer.name || customer.company_name,\n    plan: customer.plan || 'unknown',\n    mrr: parseFloat(customer.mrr || 0),\n    signup_date: customer.signup_date || customer.created_at,\n    last_login: usage.last_activity || customer.last_login,\n    \n    // Engagement metrics\n    logins_last_30d: usage.login_count || 0,\n    features_used: usage.features_used || 0,\n    active_days: usage.active_days || 0,\n    session_duration_avg: usage.avg_session_minutes || 0,\n    \n    // Payment health\n    payment_failures: payments.invoice_settings?.default_payment_method ? 0 : 1,\n    days_past_due: payments.delinquent ? 30 : 0,\n    discount_applied: payments.discount ? true : false,\n    \n    // Support metrics\n    total_tickets_90d: tickets.length,\n    open_tickets: openTickets.length,\n    escalated_tickets: escalatedTickets.length,\n    avg_response_satisfaction: tickets.reduce((sum, t) => sum + (t.satisfaction || 3), 0) / Math.max(tickets.length, 1),\n    \n    // Derived metrics\n    days_since_signup: Math.floor((new Date() - new Date(customer.signup_date || customer.created_at)) / (1000 * 60 * 60 * 24)),\n    days_since_login: usage.last_activity ? Math.floor((new Date() - new Date(usage.last_activity)) / (1000 * 60 * 60 * 24)) : 999\n  };\n});\n\nreturn profiles.map(p => ({ json: p }));"
        },
        "id": "merge-customer-data",
        "name": "Merge All Data Sources",
        "type": "n8n-nodes-base.code",
        "position": [
          700,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "// Calculate Health Score (0-100) for each customer\nconst customer = $input.item.json;\n\n// Scoring weights\nconst weights = {\n  engagement: 0.35,\n  payment: 0.25,\n  support: 0.20,\n  tenure: 0.10,\n  growth: 0.10\n};\n\n// Engagement Score (0-100)\nlet engagementScore = 0;\nif (customer.days_since_login <= 3) engagementScore += 40;\nelse if (customer.days_since_login <= 7) engagementScore += 30;\nelse if (customer.days_since_login <= 14) engagementScore += 15;\nelse if (customer.days_since_login <= 30) engagementScore += 5;\n\nengagementScore += Math.min(customer.logins_last_30d * 2, 30);\nengagementScore += Math.min(customer.features_used * 3, 30);\n\n// Payment Score (0-100)\nlet paymentScore = 100;\npaymentScore -= customer.payment_failures * 30;\npaymentScore -= customer.days_past_due;\nif (customer.discount_applied) paymentScore -= 10;\npaymentScore = Math.max(0, paymentScore);\n\n// Support Score (0-100) - fewer issues = higher score\nlet supportScore = 100;\nsupportScore -= customer.open_tickets * 15;\nsupportScore -= customer.escalated_tickets * 20;\nsupportScore -= Math.min(customer.total_tickets_90d * 2, 30);\nif (customer.avg_response_satisfaction < 3) supportScore -= 20;\nsupportScore = Math.max(0, supportScore);\n\n// Tenure Score (0-100) - longer tenure = higher score\nlet tenureScore = Math.min(customer.days_since_signup / 3, 100);\n\n// Growth Score (0-100) - based on plan and engagement trend\nlet growthScore = 50;\nif (customer.plan === 'enterprise') growthScore = 90;\nelse if (customer.plan === 'pro') growthScore = 70;\nelse if (customer.plan === 'basic') growthScore = 40;\n\n// Calculate weighted health score\nconst healthScore = Math.round(\n  engagementScore * weights.engagement +\n  paymentScore * weights.payment +\n  supportScore * weights.support +\n  tenureScore * weights.tenure +\n  growthScore * weights.growth\n);\n\n// Determine risk level\nlet riskLevel, riskCategory;\nif (healthScore >= 80) {\n  riskLevel = 'LOW';\n  riskCategory = 'healthy';\n} else if (healthScore >= 60) {\n  riskLevel = 'MEDIUM';\n  riskCategory = 'at_risk';\n} else if (healthScore >= 40) {\n  riskLevel = 'HIGH';\n  riskCategory = 'high_risk';\n} else {\n  riskLevel = 'CRITICAL';\n  riskCategory = 'churning';\n}\n\n// Identify primary churn signals\nconst signals = [];\nif (customer.days_since_login > 14) signals.push('Inactive for ' + customer.days_since_login + ' days');\nif (customer.payment_failures > 0) signals.push('Payment issues detected');\nif (customer.open_tickets > 2) signals.push('Multiple open support tickets');\nif (customer.escalated_tickets > 0) signals.push('Has escalated tickets');\nif (customer.logins_last_30d < 5) signals.push('Low login frequency');\nif (customer.features_used < 3) signals.push('Low feature adoption');\n\nreturn {\n  json: {\n    ...customer,\n    health_score: healthScore,\n    scores: {\n      engagement: Math.round(engagementScore),\n      payment: Math.round(paymentScore),\n      support: Math.round(supportScore),\n      tenure: Math.round(tenureScore),\n      growth: Math.round(growthScore)\n    },\n    risk_level: riskLevel,\n    risk_category: riskCategory,\n    churn_signals: signals,\n    signal_count: signals.length,\n    needs_intervention: healthScore < 60,\n    analyzed_at: new Date().toISOString()\n  }\n};"
        },
        "id": "calculate-health-score",
        "name": "Calculate Health Score",
        "type": "n8n-nodes-base.code",
        "position": [
          900,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "needs-intervention",
                "leftValue": "={{ $json.needs_intervention }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-at-risk",
        "name": "Filter At-Risk Customers",
        "type": "n8n-nodes-base.filter",
        "position": [
          1100,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a customer success AI that creates personalized intervention strategies for at-risk customers. Based on the customer's health metrics and churn signals, recommend specific actions.\n\nFor each customer, provide:\n1. PRIMARY_REASON: The main driver of churn risk\n2. INTERVENTION_TYPE: One of [personal_outreach, discount_offer, feature_training, support_escalation, executive_call, win_back_campaign]\n3. MESSAGE_TEMPLATE: A personalized outreach message (2-3 sentences)\n4. URGENCY: 1-5 scale (5 = immediate action needed)\n5. RECOMMENDED_ACTIONS: List of 2-3 specific next steps\n\nRespond in JSON format."
              },
              {
                "role": "user",
                "content": "=Analyze this at-risk customer and recommend intervention:\n\nCustomer: {{ $json.name }} ({{ $json.email }})\nPlan: {{ $json.plan }}\nMRR: ${{ $json.mrr }}\nHealth Score: {{ $json.health_score }}/100\nRisk Level: {{ $json.risk_level }}\n\nHealth Breakdown:\n- Engagement: {{ $json.scores.engagement }}/100\n- Payment: {{ $json.scores.payment }}/100\n- Support: {{ $json.scores.support }}/100\n\nChurn Signals:\n{{ $json.churn_signals.join('\\n- ') }}\n\nDays Since Last Login: {{ $json.days_since_login }}\nOpen Support Tickets: {{ $json.open_tickets }}\nLogins Last 30 Days: {{ $json.logins_last_30d }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-intervention-strategy",
        "name": "AI Intervention Strategy",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1300,
          600
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "jsCode": "const customer = $input.item.json;\nconst aiResponse = $('AI Intervention Strategy').first()?.json?.message?.content;\n\nlet strategy;\ntry {\n  strategy = JSON.parse(aiResponse);\n} catch (e) {\n  strategy = {\n    PRIMARY_REASON: 'Low engagement',\n    INTERVENTION_TYPE: 'personal_outreach',\n    MESSAGE_TEMPLATE: `Hi ${customer.name}, we noticed you haven't logged in recently. Is there anything we can help with?`,\n    URGENCY: 3,\n    RECOMMENDED_ACTIONS: ['Send check-in email', 'Schedule call', 'Review support tickets']\n  };\n}\n\nreturn {\n  json: {\n    ...customer,\n    intervention: strategy,\n    intervention_scheduled: false,\n    intervention_created_at: new Date().toISOString()\n  }\n};"
        },
        "id": "parse-strategy",
        "name": "Parse Intervention Strategy",
        "type": "n8n-nodes-base.code",
        "position": [
          1500,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.intervention.INTERVENTION_TYPE }}",
                      "rightValue": "personal_outreach",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "personal_outreach"
              },
              {
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.intervention.INTERVENTION_TYPE }}",
                      "rightValue": "discount_offer",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "discount_offer"
              },
              {
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.intervention.INTERVENTION_TYPE }}",
                      "rightValue": "feature_training",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "feature_training"
              },
              {
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.intervention.INTERVENTION_TYPE }}",
                      "rightValue": "support_escalation",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "support_escalation"
              },
              {
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.intervention.INTERVENTION_TYPE }}",
                      "rightValue": "executive_call",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "executive_call"
              }
            ],
            "fallbackOutput": {
              "renameOutput": true,
              "outputKey": "default"
            }
          }
        },
        "id": "route-intervention",
        "name": "Route by Intervention Type",
        "type": "n8n-nodes-base.switch",
        "position": [
          1700,
          600
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "=We miss you, {{ $json.name }}!",
          "message": "={{ $json.intervention.MESSAGE_TEMPLATE }}\n\nIf you have any questions or need assistance, please don't hesitate to reach out.\n\nBest regards,\nCustomer Success Team",
          "options": {}
        },
        "id": "send-personal-email",
        "name": "Send Personal Outreach",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1900,
          300
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.STRIPE_API_URL }}/v1/coupons",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "percent_off",
                "value": "20"
              },
              {
                "name": "duration",
                "value": "once"
              },
              {
                "name": "metadata[customer_id]",
                "value": "={{ $json.customer_id }}"
              },
              {
                "name": "metadata[reason]",
                "value": "churn_prevention"
              }
            ]
          }
        },
        "id": "create-discount",
        "name": "Create Discount Coupon",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1900,
          500
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "resource": "event",
          "calendarId": "={{ $env.CS_CALENDAR_ID }}",
          "start": "={{ $now.plus({days: 1}).set({hour: 10, minute: 0}).toISO() }}",
          "end": "={{ $now.plus({days: 1}).set({hour: 10, minute: 30}).toISO() }}",
          "additionalFields": {
            "summary": "=Feature Training: {{ $json.name }}",
            "description": "=Churn prevention training session.\nHealth Score: {{ $json.health_score }}\nRisk: {{ $json.risk_level }}\n\nFocus areas:\n{{ $json.churn_signals.join('\\n- ') }}",
            "attendees": [
              "={{ $json.email }}"
            ]
          }
        },
        "id": "schedule-training",
        "name": "Schedule Training Session",
        "type": "n8n-nodes-base.googleCalendar",
        "position": [
          1900,
          700
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "channel": "#support-escalation",
          "text": "=ðŸš¨ *Support Escalation Required*\n\nCustomer: {{ $json.name }} ({{ $json.email }})\nPlan: {{ $json.plan }} | MRR: ${{ $json.mrr }}\nHealth Score: {{ $json.health_score }}/100 | Risk: {{ $json.risk_level }}\n\n*Open Tickets:* {{ $json.open_tickets }}\n*Escalated Tickets:* {{ $json.escalated_tickets }}\n\n*Churn Signals:*\n{{ $json.churn_signals.map(s => 'â€¢ ' + s).join('\\n') }}\n\n*Recommended Actions:*\n{{ $json.intervention.RECOMMENDED_ACTIONS.map((a, i) => (i+1) + '. ' + a).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "escalate-support",
        "name": "Escalate to Support Team",
        "type": "n8n-nodes-base.slack",
        "position": [
          1900,
          900
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "channel": "#customer-success",
          "text": "=ðŸ”´ *Executive Call Required*\n\nHigh-value customer at risk of churning!\n\nCustomer: {{ $json.name }} ({{ $json.email }})\nPlan: {{ $json.plan }} | MRR: ${{ $json.mrr }}\nHealth Score: {{ $json.health_score }}/100\n\n*Primary Churn Reason:* {{ $json.intervention.PRIMARY_REASON }}\n*Urgency:* {{ $json.intervention.URGENCY }}/5\n\n*Signals:*\n{{ $json.churn_signals.map(s => 'â€¢ ' + s).join('\\n') }}\n\nPlease schedule executive outreach immediately.",
          "otherOptions": {}
        },
        "id": "executive-alert",
        "name": "Executive Call Alert",
        "type": "n8n-nodes-base.slack",
        "position": [
          1900,
          1100
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Churn_Interventions"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "customer_id": "={{ $json.customer_id }}",
              "customer_name": "={{ $json.name }}",
              "email": "={{ $json.email }}",
              "plan": "={{ $json.plan }}",
              "mrr": "={{ $json.mrr }}",
              "health_score": "={{ $json.health_score }}",
              "risk_level": "={{ $json.risk_level }}",
              "intervention_type": "={{ $json.intervention.INTERVENTION_TYPE }}",
              "primary_reason": "={{ $json.intervention.PRIMARY_REASON }}",
              "urgency": "={{ $json.intervention.URGENCY }}",
              "churn_signals": "={{ $json.churn_signals.join('; ') }}",
              "analyzed_at": "={{ $json.analyzed_at }}",
              "status": "intervention_sent"
            }
          }
        },
        "id": "log-intervention",
        "name": "Log Intervention",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2100,
          600
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "channel": "#churn-alerts",
          "text": "=ðŸ“Š *Daily Churn Risk Report*\n\n*Total Customers Analyzed:* {{ $('Get Customer Data').all().length }}\n*At-Risk Customers:* {{ $('Filter At-Risk Customers').all().length }}\n\n*Risk Breakdown:*\nðŸ”´ CRITICAL: {{ $('Filter At-Risk Customers').all().filter(c => c.json.risk_level === 'CRITICAL').length }}\nðŸŸ  HIGH: {{ $('Filter At-Risk Customers').all().filter(c => c.json.risk_level === 'HIGH').length }}\nðŸŸ¡ MEDIUM: {{ $('Filter At-Risk Customers').all().filter(c => c.json.risk_level === 'MEDIUM').length }}\n\n*Interventions Triggered:* {{ $('Log Intervention').all().length }}\n\n_Full report in Churn_Interventions sheet_",
          "otherOptions": {}
        },
        "id": "daily-summary",
        "name": "Daily Summary Report",
        "type": "n8n-nodes-base.slack",
        "position": [
          2300,
          600
        ],
        "typeVersion": 2.1
      }
    ],
    "connections": {
      "Daily Churn Analysis": {
        "main": [
          [
            {
              "node": "Get Customer Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Churn Check": {
        "main": [
          [
            {
              "node": "Get Customer Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Customer Data": {
        "main": [
          [
            {
              "node": "Get Usage Analytics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Usage Analytics": {
        "main": [
          [
            {
              "node": "Get Payment History",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Payment History": {
        "main": [
          [
            {
              "node": "Get Support Tickets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Support Tickets": {
        "main": [
          [
            {
              "node": "Merge All Data Sources",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge All Data Sources": {
        "main": [
          [
            {
              "node": "Calculate Health Score",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Health Score": {
        "main": [
          [
            {
              "node": "Filter At-Risk Customers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter At-Risk Customers": {
        "main": [
          [
            {
              "node": "AI Intervention Strategy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Intervention Strategy": {
        "main": [
          [
            {
              "node": "Parse Intervention Strategy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Intervention Strategy": {
        "main": [
          [
            {
              "node": "Route by Intervention Type",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Intervention Type": {
        "personal_outreach": [
          [
            {
              "node": "Send Personal Outreach",
              "type": "main",
              "index": 0
            }
          ]
        ],
        "discount_offer": [
          [
            {
              "node": "Create Discount Coupon",
              "type": "main",
              "index": 0
            }
          ]
        ],
        "feature_training": [
          [
            {
              "node": "Schedule Training Session",
              "type": "main",
              "index": 0
            }
          ]
        ],
        "support_escalation": [
          [
            {
              "node": "Escalate to Support Team",
              "type": "main",
              "index": 0
            }
          ]
        ],
        "executive_call": [
          [
            {
              "node": "Executive Call Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Personal Outreach": {
        "main": [
          [
            {
              "node": "Log Intervention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Discount Coupon": {
        "main": [
          [
            {
              "node": "Log Intervention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Training Session": {
        "main": [
          [
            {
              "node": "Log Intervention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Escalate to Support Team": {
        "main": [
          [
            {
              "node": "Log Intervention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Executive Call Alert": {
        "main": [
          [
            {
              "node": "Log Intervention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Intervention": {
        "main": [
          [
            {
              "node": "Daily Summary Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "name": "churn"
      },
      {
        "name": "retention"
      },
      {
        "name": "customer-success"
      }
    ]
  },
  {
    "name": "Grain Competitor Monitoring Hub v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-670g9elpu",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ” Competitor Monitoring Hub\nTracks competitor pricing, features, content, and market positioning.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1"
              }
            ]
          }
        },
        "id": "weekly-check",
        "name": "Weekly Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Competitors"
          }
        },
        "id": "get-competitors",
        "name": "Get Competitors",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"q\": \"{{ $json.competitor_name }} pricing features news\", \"gl\": \"tr\", \"num\": 10 }"
        },
        "id": "search-competitor",
        "name": "Search Competitor",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Analyze competitor search results and extract:\n\n1. Recent news/announcements\n2. Pricing changes detected\n3. New features mentioned\n4. Market positioning shifts\n5. Sentiment (positive/negative/neutral)\n\nReturn JSON:\n{\n  \"competitor\": \"...\",\n  \"news\": [],\n  \"pricing_changes\": [],\n  \"new_features\": [],\n  \"sentiment\": \"...\",\n  \"threat_level\": \"low/medium/high\",\n  \"recommended_actions\": []\n}"
              },
              {
                "role": "user",
                "content": "Competitor: {{ $json.competitor_name }}\n\nSearch Results:\n{{ JSON.stringify($json.organic?.slice(0, 5)) }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-analyze",
        "name": "AI Analyze",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.threat_level }}",
                "rightValue": "high",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ]
          }
        },
        "id": "is-high-threat",
        "name": "High Threat?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#competitive-intel",
          "text": "=ðŸš¨ **High Threat Competitor Alert**\n\nðŸ¢ Competitor: {{ $json.competitor }}\nâš ï¸ Threat Level: HIGH\n\nðŸ“° News:\n{{ $json.news.slice(0, 3).map(n => 'â€¢ ' + n).join('\\n') }}\n\nðŸ†• New Features:\n{{ $json.new_features.map(f => 'â€¢ ' + f).join('\\n') }}\n\nðŸ’¡ Recommended Actions:\n{{ $json.recommended_actions.map(a => 'â€¢ ' + a).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "alert-high-threat",
        "name": "Alert High Threat",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Competitor_Intel"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "competitor": "={{ $json.competitor }}",
              "threat_level": "={{ $json.threat_level }}",
              "sentiment": "={{ $json.sentiment }}",
              "news_summary": "={{ $json.news.slice(0, 3).join('; ') }}",
              "new_features": "={{ $json.new_features.join('; ') }}",
              "checked_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-intel",
        "name": "Save Intel",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "add-competitor",
          "options": {}
        },
        "id": "webhook-add",
        "name": "Add Competitor",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          650
        ],
        "webhookId": "add-competitor"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Competitors"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "competitor_name": "={{ $json.competitor_name }}",
              "website": "={{ $json.website }}",
              "category": "={{ $json.category }}",
              "added_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-competitor",
        "name": "Save Competitor",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          650
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Competitor Monitoring Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          800
        ]
      }
    ],
    "connections": {
      "Weekly Check": {
        "main": [
          [
            {
              "node": "Get Competitors",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Competitors": {
        "main": [
          [
            {
              "node": "Search Competitor",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Search Competitor": {
        "main": [
          [
            {
              "node": "AI Analyze",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Analyze": {
        "main": [
          [
            {
              "node": "High Threat?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "High Threat?": {
        "main": [
          [
            {
              "node": "Alert High Threat",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Intel",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save Intel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Competitor": {
        "main": [
          [
            {
              "node": "Save Competitor",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Customer Onboarding Automation v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-g6xqlpyka",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-new-customer",
        "name": "New Customer Signup",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "customer-signup"
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $env.STRIPE_API_URL }}/v1/subscriptions/{{ $json.subscription_id }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "id": "get-subscription",
        "name": "Get Subscription Details",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          400,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nconst subscription = $('Get Subscription Details').first()?.json || {};\n\nconst customer = {\n  customer_id: input.customer_id || input.id,\n  email: input.email,\n  name: input.name || input.company_name,\n  company: input.company_name || input.name,\n  plan: subscription.plan?.nickname || input.plan || 'basic',\n  industry: input.industry || 'general',\n  team_size: input.team_size || '1-10',\n  role: input.role || 'user',\n  signup_date: new Date().toISOString(),\n  mrr: (subscription.plan?.amount || 0) / 100,\n  onboarding_stage: 'welcome',\n  onboarding_progress: 0,\n  milestones: {\n    welcome_email: false,\n    account_setup: false,\n    first_login: false,\n    first_action: false,\n    team_invited: false,\n    integration_connected: false,\n    first_workflow_created: false\n  }\n};\n\n// Determine onboarding path based on plan and industry\nlet onboardingPath = 'standard';\nif (customer.plan === 'enterprise') onboardingPath = 'enterprise';\nelse if (customer.industry === 'agency') onboardingPath = 'agency';\nelse if (customer.industry === 'ecommerce') onboardingPath = 'ecommerce';\nelse if (customer.industry === 'hospitality') onboardingPath = 'hospitality';\n\ncustomer.onboarding_path = onboardingPath;\n\nreturn { json: customer };"
        },
        "id": "create-customer-profile",
        "name": "Create Customer Profile",
        "type": "n8n-nodes-base.code",
        "position": [
          600,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customer_Onboarding"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "customer_id": "={{ $json.customer_id }}",
              "email": "={{ $json.email }}",
              "name": "={{ $json.name }}",
              "company": "={{ $json.company }}",
              "plan": "={{ $json.plan }}",
              "industry": "={{ $json.industry }}",
              "onboarding_path": "={{ $json.onboarding_path }}",
              "onboarding_stage": "={{ $json.onboarding_stage }}",
              "onboarding_progress": "={{ $json.onboarding_progress }}",
              "signup_date": "={{ $json.signup_date }}",
              "mrr": "={{ $json.mrr }}"
            }
          }
        },
        "id": "save-to-sheet",
        "name": "Save to Onboarding Sheet",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          800,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a customer success specialist creating personalized welcome messages. Generate a warm, engaging welcome email that:\n1. Addresses the customer by name\n2. References their industry/use case\n3. Highlights 3 key features relevant to them\n4. Provides clear next steps\n5. Sets expectations for the onboarding journey\n\nReturn JSON with:\n- subject: Email subject line\n- greeting: Personalized greeting\n- intro: 2-3 sentences welcoming them\n- features: Array of 3 relevant features with descriptions\n- next_steps: Array of 3 action items\n- closing: Warm closing with support info"
              },
              {
                "role": "user",
                "content": "=Create a welcome email for:\nName: {{ $json.name }}\nCompany: {{ $json.company }}\nPlan: {{ $json.plan }}\nIndustry: {{ $json.industry }}\nTeam Size: {{ $json.team_size }}\nRole: {{ $json.role }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-welcome-email",
        "name": "AI Generate Welcome Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1000,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "jsCode": "const customer = $('Create Customer Profile').first().json;\nconst aiResponse = $input.item.json.message?.content;\n\nlet emailContent;\ntry {\n  emailContent = JSON.parse(aiResponse);\n} catch (e) {\n  emailContent = {\n    subject: `Welcome to Grain, ${customer.name}! ðŸŽ‰`,\n    greeting: `Hi ${customer.name},`,\n    intro: `Welcome to Grain! We're thrilled to have ${customer.company} on board. Your journey to automation excellence starts now.`,\n    features: [\n      { title: 'Multi-Platform Publishing', description: 'Publish content across 9+ platforms simultaneously' },\n      { title: 'AI Content Generation', description: 'Create stunning visuals and copy with AI' },\n      { title: 'Analytics Dashboard', description: 'Track performance across all channels' }\n    ],\n    next_steps: [\n      'Complete your profile setup',\n      'Connect your first social account',\n      'Create your first automated workflow'\n    ],\n    closing: 'Need help? Reply to this email or chat with us anytime.'\n  };\n}\n\nreturn {\n  json: {\n    ...customer,\n    email_content: emailContent\n  }\n};"
        },
        "id": "parse-email",
        "name": "Parse Email Content",
        "type": "n8n-nodes-base.code",
        "position": [
          1200,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "={{ $json.email_content.subject }}",
          "message": "={{ $json.email_content.greeting }}\n\n{{ $json.email_content.intro }}\n\nðŸš€ Key Features for You:\n\n{{ $json.email_content.features.map((f, i) => 'â€¢ ' + f.title + ': ' + f.description).join('\\n') }}\n\nðŸ“‹ Your Next Steps:\n\n{{ $json.email_content.next_steps.map((s, i) => (i+1) + '. ' + s).join('\\n') }}\n\n{{ $json.email_content.closing }}\n\nBest,\nThe Grain Team",
          "options": {}
        },
        "id": "send-welcome-email",
        "name": "Send Welcome Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1400,
          400
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "resource": "contact",
          "operation": "upsert",
          "email": "={{ $json.email }}",
          "additionalFields": {
            "firstName": "={{ $json.name.split(' ')[0] }}",
            "lastName": "={{ $json.name.split(' ').slice(1).join(' ') }}",
            "company": "={{ $json.company }}",
            "jobTitle": "={{ $json.role }}",
            "lifecycleStage": "customer"
          },
          "options": {}
        },
        "id": "hubspot-create",
        "name": "Create HubSpot Contact",
        "type": "n8n-nodes-base.hubspot",
        "position": [
          1600,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#new-customers",
          "text": "=ðŸŽ‰ *New Customer Signed Up!*\n\nðŸ‘¤ *Name:* {{ $json.name }}\nðŸ¢ *Company:* {{ $json.company }}\nðŸ’¼ *Plan:* {{ $json.plan }}\nðŸ­ *Industry:* {{ $json.industry }}\nðŸ’° *MRR:* ${{ $json.mrr }}\n\nðŸ“ *Onboarding Path:* {{ $json.onboarding_path }}\n\n_Welcome email sent. Onboarding sequence started._",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "position": [
          1600,
          500
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "days",
                "daysInterval": 1
              }
            ]
          }
        },
        "id": "daily-check",
        "name": "Daily Progress Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          700
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customer_Onboarding"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-onboarding",
        "name": "Get Onboarding Customers",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          400,
          700
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true
            },
            "conditions": [
              {
                "leftValue": "={{ $json.onboarding_progress }}",
                "rightValue": 100,
                "operator": {
                  "type": "number",
                  "operation": "lt"
                }
              }
            ]
          }
        },
        "id": "filter-incomplete",
        "name": "Filter Incomplete Onboarding",
        "type": "n8n-nodes-base.filter",
        "position": [
          600,
          700
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "const customer = $input.item.json;\nconst signupDate = new Date(customer.signup_date);\nconst now = new Date();\nconst daysSinceSignup = Math.floor((now - signupDate) / (1000 * 60 * 60 * 24));\n\n// Determine which email to send based on progress and days\nlet emailType = null;\nlet shouldSend = false;\n\nif (daysSinceSignup === 1 && customer.onboarding_progress < 20) {\n  emailType = 'day1_reminder';\n  shouldSend = true;\n} else if (daysSinceSignup === 3 && customer.onboarding_progress < 40) {\n  emailType = 'day3_tips';\n  shouldSend = true;\n} else if (daysSinceSignup === 5 && customer.onboarding_progress < 60) {\n  emailType = 'day5_help';\n  shouldSend = true;\n} else if (daysSinceSignup === 7 && customer.onboarding_progress < 80) {\n  emailType = 'day7_checkin';\n  shouldSend = true;\n} else if (daysSinceSignup === 14 && customer.onboarding_progress < 100) {\n  emailType = 'day14_final';\n  shouldSend = true;\n}\n\nreturn {\n  json: {\n    ...customer,\n    days_since_signup: daysSinceSignup,\n    email_type: emailType,\n    should_send: shouldSend\n  }\n};"
        },
        "id": "determine-sequence",
        "name": "Determine Sequence Step",
        "type": "n8n-nodes-base.code",
        "position": [
          800,
          700
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.should_send }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "if-should-send",
        "name": "Should Send Email?",
        "type": "n8n-nodes-base.if",
        "position": [
          1000,
          700
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Generate a follow-up onboarding email based on the email type:\n\n- day1_reminder: Friendly reminder to complete setup, offer quick tip\n- day3_tips: Share 3 power user tips, highlight a feature\n- day5_help: Offer personal assistance, share success story\n- day7_checkin: Check in, ask for feedback, offer call\n- day14_final: Final nudge, show what they're missing, offer discount on upgrade\n\nReturn JSON: {subject, body, cta_text, cta_link}"
              },
              {
                "role": "user",
                "content": "=Email Type: {{ $json.email_type }}\nName: {{ $json.name }}\nCompany: {{ $json.company }}\nProgress: {{ $json.onboarding_progress }}%\nPlan: {{ $json.plan }}\nDays Since Signup: {{ $json.days_since_signup }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-sequence-email",
        "name": "AI Generate Sequence Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1200,
          700
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "jsCode": "const customer = $input.item.json;\nconst aiResponse = $('AI Generate Sequence Email').first()?.json?.message?.content;\n\nlet emailContent;\ntry {\n  emailContent = JSON.parse(aiResponse);\n} catch (e) {\n  const templates = {\n    day1_reminder: {\n      subject: `${customer.name}, ready to get started?`,\n      body: `Hi ${customer.name},\\n\\nWe noticed you haven't completed your setup yet. It only takes 5 minutes!\\n\\nQuick tip: Start by connecting your first social account to unlock all features.`,\n      cta_text: 'Complete Setup',\n      cta_link: 'https://app.grain.com/onboarding'\n    },\n    day3_tips: {\n      subject: '3 tips to supercharge your workflow',\n      body: `Hey ${customer.name},\\n\\nHere are 3 tips our power users swear by:\\n\\n1. Use AI to generate captions in bulk\\n2. Schedule posts for optimal engagement times\\n3. Track competitors to stay ahead\\n\\nTry them today!`,\n      cta_text: 'Try Now',\n      cta_link: 'https://app.grain.com/dashboard'\n    },\n    day5_help: {\n      subject: 'Need a hand?',\n      body: `Hi ${customer.name},\\n\\nWe're here to help! Many customers like ${customer.company} have seen amazing results.\\n\\nWant to schedule a quick 15-min call to get you up and running?`,\n      cta_text: 'Schedule Call',\n      cta_link: 'https://calendly.com/grain-success'\n    },\n    day7_checkin: {\n      subject: `How's it going, ${customer.name}?`,\n      body: `Hey ${customer.name},\\n\\nIt's been a week! How's everything going?\\n\\nWe'd love to hear your feedback or answer any questions.`,\n      cta_text: 'Share Feedback',\n      cta_link: 'https://grain.com/feedback'\n    },\n    day14_final: {\n      subject: 'You're missing out on these features',\n      body: `Hi ${customer.name},\\n\\nYour ${customer.plan} plan includes powerful features you haven't tried yet.\\n\\nLet us show you what you're missing - and here's 20% off your next month to explore!`,\n      cta_text: 'Unlock Features',\n      cta_link: 'https://app.grain.com/upgrade'\n    }\n  };\n  emailContent = templates[customer.email_type] || templates.day1_reminder;\n}\n\nreturn {\n  json: {\n    ...customer,\n    sequence_email: emailContent\n  }\n};"
        },
        "id": "parse-sequence-email",
        "name": "Parse Sequence Email",
        "type": "n8n-nodes-base.code",
        "position": [
          1400,
          700
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "={{ $json.sequence_email.subject }}",
          "message": "={{ $json.sequence_email.body }}\n\n[{{ $json.sequence_email.cta_text }}]({{ $json.sequence_email.cta_link }})\n\nBest,\nThe Grain Team",
          "options": {}
        },
        "id": "send-sequence-email",
        "name": "Send Sequence Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1600,
          700
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {},
        "id": "webhook-milestone",
        "name": "Milestone Completed",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          1000
        ],
        "webhookId": "onboarding-milestone"
      },
      {
        "parameters": {
          "jsCode": "const event = $input.item.json;\n\nconst milestonePoints = {\n  account_setup: 15,\n  first_login: 10,\n  first_action: 20,\n  team_invited: 15,\n  integration_connected: 20,\n  first_workflow_created: 20\n};\n\nconst milestone = event.milestone;\nconst points = milestonePoints[milestone] || 0;\n\nreturn {\n  json: {\n    customer_id: event.customer_id,\n    email: event.email,\n    milestone: milestone,\n    points_earned: points,\n    completed_at: new Date().toISOString()\n  }\n};"
        },
        "id": "process-milestone",
        "name": "Process Milestone",
        "type": "n8n-nodes-base.code",
        "position": [
          400,
          1000
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customer_Onboarding"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "onboarding_progress": "={{ $json.points_earned }}",
              "last_milestone": "={{ $json.milestone }}",
              "last_milestone_at": "={{ $json.completed_at }}"
            }
          },
          "options": {
            "cellFormat": "USER_ENTERED"
          }
        },
        "id": "update-progress",
        "name": "Update Progress",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          600,
          1000
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.milestone }}",
                "rightValue": "first_workflow_created",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ]
          }
        },
        "id": "if-completed",
        "name": "Onboarding Complete?",
        "type": "n8n-nodes-base.if",
        "position": [
          800,
          1000
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "ðŸŽ‰ Congratulations! You're all set up!",
          "message": "You did it!\n\nYou've completed all onboarding milestones. You're now a certified Grain power user!\n\nðŸ† Achievement Unlocked: Onboarding Champion\n\nHere's what you can do next:\nâ€¢ Explore advanced features\nâ€¢ Join our community\nâ€¢ Check out success stories\n\nWe're excited to see what you'll create!\n\nBest,\nThe Grain Team",
          "options": {}
        },
        "id": "send-completion-email",
        "name": "Send Completion Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1000,
          900
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "channel": "#customer-success",
          "text": "=ðŸ† *Onboarding Complete!*\n\n{{ $json.email }} has completed all milestones!\n\n_Time to celebrate another successful onboarding!_",
          "otherOptions": {}
        },
        "id": "slack-completion",
        "name": "Celebrate Completion",
        "type": "n8n-nodes-base.slack",
        "position": [
          1000,
          1100
        ],
        "typeVersion": 2.1
      }
    ],
    "connections": {
      "New Customer Signup": {
        "main": [
          [
            {
              "node": "Get Subscription Details",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Subscription Details": {
        "main": [
          [
            {
              "node": "Create Customer Profile",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Customer Profile": {
        "main": [
          [
            {
              "node": "Save to Onboarding Sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save to Onboarding Sheet": {
        "main": [
          [
            {
              "node": "AI Generate Welcome Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Welcome Email": {
        "main": [
          [
            {
              "node": "Parse Email Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Email Content": {
        "main": [
          [
            {
              "node": "Send Welcome Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Welcome Email": {
        "main": [
          [
            {
              "node": "Create HubSpot Contact",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Progress Check": {
        "main": [
          [
            {
              "node": "Get Onboarding Customers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Onboarding Customers": {
        "main": [
          [
            {
              "node": "Filter Incomplete Onboarding",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Incomplete Onboarding": {
        "main": [
          [
            {
              "node": "Determine Sequence Step",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Determine Sequence Step": {
        "main": [
          [
            {
              "node": "Should Send Email?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Should Send Email?": {
        "main": [
          [
            {
              "node": "AI Generate Sequence Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Sequence Email": {
        "main": [
          [
            {
              "node": "Parse Sequence Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Sequence Email": {
        "main": [
          [
            {
              "node": "Send Sequence Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Milestone Completed": {
        "main": [
          [
            {
              "node": "Process Milestone",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Milestone": {
        "main": [
          [
            {
              "node": "Update Progress",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Progress": {
        "main": [
          [
            {
              "node": "Onboarding Complete?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Onboarding Complete?": {
        "main": [
          [
            {
              "node": "Send Completion Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Celebrate Completion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "name": "onboarding"
      },
      {
        "name": "customer-success"
      },
      {
        "name": "activation"
      }
    ]
  },
  {
    "name": "Grain Ecommerce Orchestrator v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ji992qcwm",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ›’ E-commerce Orchestrator\nManages inventory sync across channels and recovers abandoned carts with AI personalized offers.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "order-created",
          "options": {}
        },
        "id": "webhook-order",
        "name": "Order Created",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "order-created"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "cart-abandoned",
          "options": {}
        },
        "id": "webhook-cart",
        "name": "Cart Abandoned",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          600
        ],
        "webhookId": "cart-abandoned"
      },
      {
        "parameters": {
          "jsCode": "const order = $input.item.json;\nreturn {\n  json: {\n    items: order.line_items.map(item => ({\n      sku: item.sku,\n      quantity: item.quantity,\n      new_stock: item.current_stock - item.quantity\n    }))\n  }\n};"
        },
        "id": "calc-stock",
        "name": "Calculate New Stock",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "baseId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "table": {
            "__rl": true,
            "mode": "list",
            "value": "Inventory"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Stock": "={{ $json.new_stock }}"
            }
          }
        },
        "id": "update-airtable",
        "name": "Update Inventory DB",
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a sales assistant. Generate a personalized abandoned cart email.\n\nContext:\n- Customer: {{ $json.customer_name }}\n- Items Left: {{ $json.line_items.map(i => i.title).join(', ') }}\n- Total Value: {{ $json.total_price }}\n\nGoal: Recover the sale. Offer a 10% discount code (COMEBACK10) if value > $100."
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-recover",
        "name": "AI Draft Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          500,
          600
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "Wait! You left something behind... ðŸ‘€",
          "message": "={{ $json.email_content }}",
          "options": {}
        },
        "id": "send-recovery",
        "name": "Send Recovery Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          750,
          600
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          500,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#ecommerce-alerts",
          "text": "=ðŸš¨ E-commerce Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          800
        ]
      }
    ],
    "connections": {
      "Order Created": {
        "main": [
          [
            {
              "node": "Calculate New Stock",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate New Stock": {
        "main": [
          [
            {
              "node": "Update Inventory DB",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cart Abandoned": {
        "main": [
          [
            {
              "node": "AI Draft Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Draft Email": {
        "main": [
          [
            {
              "node": "Send Recovery Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Intelligent CDP v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-7z3otehwf",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "cdp-ingest",
          "options": {}
        },
        "id": "webhook-ingest",
        "name": "Data Ingestion Hook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "cdp-ingestion"
      },
      {
        "parameters": {
          "jsCode": "// Identity Resolution Mock\nconst event = $input.item.json;\nconst userId = event.userId || event.email;\n\n// Simulate fetching existing profile from database\nconst profile = {\n  id: userId,\n  ltv: 1200,\n  status: \"active\",\n  last_seen: new Date().toISOString(),\n  tags: [\"pro_user\", \"early_adopter\"]\n};\n\nreturn {\n  json: {\n    event: event,\n    merged_profile: profile\n  }\n};"
        },
        "id": "identity-res",
        "name": "Identity Resolution",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Analyze user behavior event. Determine if this indicates a CHURN RISK or UPSELL OPPORTUNITY.\nOutput JSON: { \"signal\": \"CHURN_RISK\" | \"UPSELL\" | \"NEUTRAL\", \"confidence\": 0-100 }"
              },
              {
                "role": "user",
                "content": "Event: {{ JSON.stringify($json.event) }}\nProfile: {{ JSON.stringify($json.merged_profile) }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-behavior",
        "name": "AI Behavioral Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.signal }}",
          "rules": {
            "rules": [
              {
                "value2": "CHURN_RISK",
                "output": 0
              },
              {
                "value2": "UPSELL",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "signal-router",
        "name": "Signal Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          900,
          300
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customer_Profiles"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "user_id": "={{ $json.merged_profile.id }}",
              "last_signal": "={{ $json.signal }}",
              "last_updated": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "update-profile",
        "name": "Update Profile DB",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1200,
          300
        ]
      },
      {
        "parameters": {
          "channel": "customer-alerts",
          "text": "=ðŸš¨ **Churn Risk Detected**\nUser: {{ $json.merged_profile.id }}\nConfidence: {{ $json.confidence }}%",
          "otherOptions": {}
        },
        "id": "slack-churn",
        "name": "Notify CS Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1200,
          100
        ]
      }
    ],
    "connections": {
      "Data Ingestion Hook": {
        "main": [
          [
            {
              "node": "Identity Resolution",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Identity Resolution": {
        "main": [
          [
            {
              "node": "AI Behavioral Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Behavioral Analysis": {
        "main": [
          [
            {
              "node": "Signal Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Signal Router": {
        "main": [
          [
            {
              "node": "Notify CS Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Profile DB",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Update Profile DB",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Update Profile DB",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Invoice Billing Automation v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-hjfj55171",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-invoice",
        "name": "Create Invoice",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "create-invoice"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 * * *"
              }
            ]
          }
        },
        "id": "daily-dunning",
        "name": "Daily Dunning Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          600
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "resource": "invoice",
          "operation": "create",
          "customer": "={{ $json.stripe_customer_id }}",
          "currency": "={{ $json.currency || 'usd' }}",
          "invoiceItems": {
            "values": [
              {
                "amount": "={{ $json.amount * 100 }}",
                "description": "={{ $json.description }}"
              }
            ]
          }
        },
        "id": "stripe-invoice",
        "name": "Create Stripe Invoice",
        "type": "n8n-nodes-base.stripe",
        "position": [
          450,
          400
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "resource": "invoice",
          "operation": "get",
          "invoiceId": "={{ $json.invoice_id }}"
        },
        "id": "get-invoice-status",
        "name": "Get Invoice Status",
        "type": "n8n-nodes-base.stripe",
        "position": [
          450,
          600
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "jsCode": "const invoice = $input.item.json;\nconst dueDate = new Date(invoice.due_date * 1000);\nconst now = new Date();\nconst daysOverdue = Math.floor((now - dueDate) / (1000 * 60 * 60 * 24));\n\nlet dunningLevel = null;\nif (invoice.status === 'open' && daysOverdue > 0) {\n  if (daysOverdue === 3) dunningLevel = 'gentle';\n  else if (daysOverdue === 7) dunningLevel = 'reminder';\n  else if (daysOverdue === 14) dunningLevel = 'urgent';\n  else if (daysOverdue === 21) dunningLevel = 'final';\n}\n\nreturn {\n  json: {\n    ...invoice,\n    days_overdue: daysOverdue,\n    dunning_level: dunningLevel,\n    should_send: dunningLevel !== null\n  }\n};"
        },
        "id": "calc-dunning",
        "name": "Calculate Dunning",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.should_send }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "should-send",
        "name": "Should Send?",
        "type": "n8n-nodes-base.if",
        "position": [
          850,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Tahsilat e-postasÄ± yaz. Dunning level'a gÃ¶re ton ayarla:\n- gentle: Nazik hatÄ±rlatma\n- reminder: Net hatÄ±rlatma\n- urgent: Acil Ã¶deme talebi\n- final: Son uyarÄ±, hizmet askÄ±ya alÄ±nacak\n\nJSON: {\"subject\": \"\", \"body\": \"\"}"
              },
              {
                "role": "user",
                "content": "=Customer: {{ $json.customer_name }}\nAmount: {{ $json.amount_due / 100 }} {{ $json.currency }}\nDays Overdue: {{ $json.days_overdue }}\nLevel: {{ $json.dunning_level }}"
              }
            ]
          }
        },
        "id": "ai-dunning-email",
        "name": "AI Dunning Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1050,
          600
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "sendTo": "={{ $json.customer_email }}",
          "subject": "={{ $('AI Dunning Email').first().json.message.subject }}",
          "message": "={{ $('AI Dunning Email').first().json.message.body }}",
          "options": {}
        },
        "id": "send-dunning",
        "name": "Send Dunning Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1250,
          600
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "sendTo": "={{ $json.customer_email }}",
          "subject": "=Fatura #{{ $json.number }}",
          "message": "=Merhaba,\n\nEkte {{ $json.amount_due / 100 }} {{ $json.currency }} tutarÄ±nda faturanÄ±z yer almaktadÄ±r.\n\nÃ–deme linki: {{ $json.hosted_invoice_url }}\n\nSon Ã¶deme tarihi: {{ new Date($json.due_date * 1000).toLocaleDateString('tr-TR') }}\n\nTeÅŸekkÃ¼rler.",
          "options": {}
        },
        "id": "send-invoice-email",
        "name": "Send Invoice Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          650,
          400
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Invoices"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "invoice_id": "={{ $json.id }}",
              "customer": "={{ $json.customer_name }}",
              "amount": "={{ $json.amount_due / 100 }}",
              "status": "={{ $json.status }}",
              "created_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "log-invoice",
        "name": "Log Invoice",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          850,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "content": "## ðŸ’° Invoice & Billing\nStripe-integrated invoicing with AI-powered dunning emails (gentle â†’ reminder â†’ urgent â†’ final).",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          450,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#billing-alerts",
          "text": "=ðŸš¨ Billing Automation Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          650,
          800
        ]
      }
    ],
    "connections": {
      "Create Invoice": {
        "main": [
          [
            {
              "node": "Create Stripe Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Stripe Invoice": {
        "main": [
          [
            {
              "node": "Send Invoice Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Invoice Email": {
        "main": [
          [
            {
              "node": "Log Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Dunning Check": {
        "main": [
          [
            {
              "node": "Get Invoice Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Invoice Status": {
        "main": [
          [
            {
              "node": "Calculate Dunning",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Dunning": {
        "main": [
          [
            {
              "node": "Should Send?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Should Send?": {
        "main": [
          [
            {
              "node": "AI Dunning Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Dunning Email": {
        "main": [
          [
            {
              "node": "Send Dunning Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "billing"
      },
      {
        "name": "finance"
      },
      {
        "name": "dunning"
      }
    ]
  },
  {
    "name": "Grain Master Orchestrator v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-o3vrzul9m",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸŽ›ï¸ Master Orchestrator\nCentral hub that triggers workflow chains. Routes events to the correct pipeline.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "orchestrator",
          "options": {}
        },
        "id": "webhook-main",
        "name": "Orchestrator Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "orchestrator"
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.chain }}",
          "rules": {
            "rules": [
              {
                "value2": "customer_lifecycle",
                "output": 0
              },
              {
                "value2": "lead_to_revenue",
                "output": 1
              },
              {
                "value2": "hr_pipeline",
                "output": 2
              },
              {
                "value2": "ecommerce_funnel",
                "output": 3
              }
            ]
          },
          "fallbackOutput": 4
        },
        "id": "route-chain",
        "name": "Route to Chain",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/nps-response",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.payload) }}"
        },
        "id": "trigger-customer-lifecycle",
        "name": "Start: Customer Lifecycle",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          200
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/lead-capture",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.payload) }}"
        },
        "id": "trigger-lead-revenue",
        "name": "Start: Lead to Revenue",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          350
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/submit-application",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.payload) }}"
        },
        "id": "trigger-hr-pipeline",
        "name": "Start: HR Pipeline",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/cart-abandoned",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.payload) }}"
        },
        "id": "trigger-ecommerce",
        "name": "Start: E-commerce Funnel",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={ \"status\": \"chain_initiated\", \"chain\": \"{{ $json.chain }}\", \"timestamp\": \"{{ $now.toISO() }}\" }",
          "options": {}
        },
        "id": "respond-success",
        "name": "Respond Success",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          500,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#orchestrator-alerts",
          "text": "=ðŸš¨ Orchestrator Error\n\nChain: {{ $json.chain }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          800
        ]
      }
    ],
    "connections": {
      "Orchestrator Webhook": {
        "main": [
          [
            {
              "node": "Route to Chain",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route to Chain": {
        "main": [
          [
            {
              "node": "Start: Customer Lifecycle",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Start: Lead to Revenue",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Start: HR Pipeline",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Start: E-commerce Funnel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Start: Customer Lifecycle": {
        "main": [
          [
            {
              "node": "Respond Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Start: Lead to Revenue": {
        "main": [
          [
            {
              "node": "Respond Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Start: HR Pipeline": {
        "main": [
          [
            {
              "node": "Respond Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Start: E-commerce Funnel": {
        "main": [
          [
            {
              "node": "Respond Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain MCP Client Connector v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-rikpkg5zx",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ”Œ MCP Client Connector\nConnects to Anthropic Model Context Protocol servers for advanced AI agent capabilities.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "mcp-request",
          "options": {}
        },
        "id": "webhook-mcp",
        "name": "MCP Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "mcp-connector"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.MCP_SERVER_URL }}/jsonrpc",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.MCP_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"jsonrpc\": \"2.0\",\n  \"id\": \"{{ $json.request_id || Date.now() }}\",\n  \"method\": \"{{ $json.method }}\",\n  \"params\": {{ JSON.stringify($json.params || {}) }}\n}"
        },
        "id": "mcp-call",
        "name": "Call MCP Server",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const response = $input.item.json;\n\nif (response.error) {\n  throw new Error(`MCP Error: ${response.error.message}`);\n}\n\nreturn {\n  json: {\n    success: true,\n    result: response.result,\n    method_called: $('MCP Request').first().json.method,\n    timestamp: new Date().toISOString()\n  }\n};"
        },
        "id": "parse-response",
        "name": "Parse Response",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ $json }}",
          "options": {}
        },
        "id": "respond",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 5
              }
            ]
          }
        },
        "id": "health-check",
        "name": "Health Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.MCP_SERVER_URL }}/jsonrpc",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "{ \"jsonrpc\": \"2.0\", \"id\": \"health\", \"method\": \"system/health\" }"
        },
        "id": "ping-server",
        "name": "Ping MCP Server",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          500,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#mcp-alerts",
          "text": "=ðŸš¨ MCP Connector Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          800
        ]
      }
    ],
    "connections": {
      "MCP Request": {
        "main": [
          [
            {
              "node": "Call MCP Server",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call MCP Server": {
        "main": [
          [
            {
              "node": "Parse Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Response": {
        "main": [
          [
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Health Check": {
        "main": [
          [
            {
              "node": "Ping MCP Server",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain NPS Feedback Collection v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-45mr7o84w",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ“Š NPS & Feedback Collection\nAutomated Net Promoter Score surveys with AI-powered sentiment analysis.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 10 * * 1"
              }
            ]
          }
        },
        "id": "weekly-trigger",
        "name": "Weekly NPS Send",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customers"
          }
        },
        "id": "get-customers",
        "name": "Get Customers",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.last_nps_sent }}",
                "rightValue": "={{ $now.minus({days: 90}).toISO() }}",
                "operator": {
                  "type": "string",
                  "operation": "lt"
                }
              }
            ]
          }
        },
        "id": "filter-eligible",
        "name": "Filter Eligible",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "Sizin iÃ§in ne kadar Ã¶nemliyiz? (1 dakikalÄ±k anket)",
          "message": "=Merhaba {{ $json.name }},\n\nBizi 0-10 arasÄ±nda puanlayÄ±n:\n\nðŸ”— Anket Linki: {{ $env.NPS_SURVEY_URL }}?customer_id={{ $json.customer_id }}\n\nTeÅŸekkÃ¼rler!",
          "options": {}
        },
        "id": "send-survey",
        "name": "Send NPS Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "nps-response",
          "options": {}
        },
        "id": "webhook-response",
        "name": "NPS Response",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          650
        ],
        "webhookId": "nps-response"
      },
      {
        "parameters": {
          "jsCode": "const score = parseInt($input.item.json.nps_score);\nlet category = 'Passive';\nif (score >= 9) category = 'Promoter';\nelse if (score <= 6) category = 'Detractor';\n\nreturn {\n  json: {\n    ...$input.item.json,\n    nps_score: score,\n    category: category,\n    is_detractor: score <= 6\n  }\n};"
        },
        "id": "calc-category",
        "name": "Calculate Category",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          650
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Analyze NPS feedback. Return JSON:\n{ \"sentiment\": \"positive/neutral/negative\", \"themes\": [], \"action_required\": true/false, \"suggested_action\": \"...\" }"
              },
              {
                "role": "user",
                "content": "Score: {{ $json.nps_score }}\nFeedback: {{ $json.feedback }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-analyze",
        "name": "AI Analyze Feedback",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.is_detractor }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "is-detractor",
        "name": "Is Detractor?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#customer-success",
          "text": "=ðŸš¨ **Detractor Alert**\n\nCustomer: {{ $json.customer_id }}\nNPS Score: {{ $json.nps_score }}/10\nFeedback: {{ $json.feedback }}\n\nðŸ‘‰ Action: {{ $json.suggested_action }}",
          "otherOptions": {}
        },
        "id": "alert-cs",
        "name": "Alert CS Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1250,
          550
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/churn-check",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"customer_id\": \"{{ $json.customer_id }}\", \"nps_score\": {{ $json.nps_score }}, \"trigger_source\": \"nps_detractor\" }"
        },
        "id": "trigger-churn",
        "name": "â†’ Trigger Churn Check",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          550
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "NPS_Responses"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "customer_id": "={{ $json.customer_id }}",
              "score": "={{ $json.nps_score }}",
              "category": "={{ $json.category }}",
              "feedback": "={{ $json.feedback }}",
              "sentiment": "={{ $json.sentiment }}",
              "submitted_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-response",
        "name": "Save Response",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1250,
          750
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          500,
          900
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ NPS Collection Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          900
        ]
      }
    ],
    "connections": {
      "Weekly NPS Send": {
        "main": [
          [
            {
              "node": "Get Customers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Customers": {
        "main": [
          [
            {
              "node": "Filter Eligible",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Eligible": {
        "main": [
          [
            {
              "node": "Send NPS Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "NPS Response": {
        "main": [
          [
            {
              "node": "Calculate Category",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Category": {
        "main": [
          [
            {
              "node": "AI Analyze Feedback",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Analyze Feedback": {
        "main": [
          [
            {
              "node": "Is Detractor?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Detractor?": {
        "main": [
          [
            {
              "node": "Alert CS Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Response",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Referral Affiliate Program v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-y24ehpwzw",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "referral-signup",
          "options": {}
        },
        "id": "webhook-referral",
        "name": "Referral Signup",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "referral-program"
      },
      {
        "parameters": {
          "jsCode": "const ref = $input.item.json;\nconst code = `REF-${ref.user_id.slice(0,4).toUpperCase()}-${Date.now().toString(36).toUpperCase()}`;\nreturn { json: { ...ref, referral_code: code, commission_rate: 0.2 } };"
        },
        "id": "gen-code",
        "name": "Generate Referral Code",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Affiliates"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "user_id": "={{ $json.user_id }}",
              "email": "={{ $json.email }}",
              "referral_code": "={{ $json.referral_code }}",
              "commission_rate": "={{ $json.commission_rate }}",
              "total_earnings": "0"
            }
          }
        },
        "id": "save-affiliate",
        "name": "Save Affiliate",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "referral-conversion",
          "options": {}
        },
        "id": "webhook-conversion",
        "name": "Conversion Event",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          550
        ],
        "webhookId": "referral-conversion"
      },
      {
        "parameters": {
          "jsCode": "const conv = $input.item.json;\nconst commission = conv.order_value * 0.2;\nreturn { json: { ...conv, commission_earned: commission } };"
        },
        "id": "calc-commission",
        "name": "Calculate Commission",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          550
        ]
      },
      {
        "parameters": {
          "channel": "affiliate-wins",
          "text": "=ðŸ’° **Referral Conversion!**\n\nAffiliate: {{ $json.referrer_email }}\nOrder Value: ${{ $json.order_value }}\nCommission: ${{ $json.commission_earned }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Conversion",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          550
        ]
      }
    ],
    "connections": {
      "Referral Signup": {
        "main": [
          [
            {
              "node": "Generate Referral Code",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Referral Code": {
        "main": [
          [
            {
              "node": "Save Affiliate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Conversion Event": {
        "main": [
          [
            {
              "node": "Calculate Commission",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Commission": {
        "main": [
          [
            {
              "node": "Notify Conversion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Self-Healing Data Pipeline v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ssua09zgx",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ¥ Self-Healing Data Pipeline\nAutonomous infrastructure that detects failures, attempts self-correction, and optimizes retry strategies.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 10
              }
            ]
          }
        },
        "id": "monitor-trigger",
        "name": "Health Monitor",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "url": "={{ $env.CORE_API_URL }}/health",
          "options": {
            "allowUnauthorizedCerts": true
          }
        },
        "id": "check-api",
        "name": "Check Core API",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.status }}",
                "rightValue": "200",
                "operator": {
                  "type": "number",
                  "operation": "neq"
                }
              }
            ]
          }
        },
        "id": "is-failed",
        "name": "Is Failed?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const attempt = $json.retry_count || 0;\nconst maxRetries = 3;\n\nif (attempt < maxRetries) {\n  return { json: { action: 'retry', next_attempt: attempt + 1, wait_time: Math.pow(2, attempt) * 1000 } };\n} else {\n  return { json: { action: 'escalate' } };\n}"
        },
        "id": "healing-strategy",
        "name": "Determine Strategy",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.action }}",
          "rules": {
            "rules": [
              {
                "value2": "retry",
                "output": 0
              },
              {
                "value2": "escalate",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "execute-strategy",
        "name": "Execute Strategy",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "amount": "={{ $json.wait_time }}",
          "unit": "milliseconds"
        },
        "id": "wait-node",
        "name": "Dynamic Backoff",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.CORE_API_URL }}/restart-service",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.ADMIN_KEY }}"
              }
            ]
          }
        },
        "id": "restart-service",
        "name": "Self-Heal: Restart",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1750,
          300
        ]
      },
      {
        "parameters": {
          "channel": "#devops-critical",
          "text": "=ðŸš¨ **Self-Healing Failed**\n\nService: Core API\nRetries: 3\nAction: Manual Intervention Required",
          "otherOptions": {}
        },
        "id": "escalate-alert",
        "name": "Escalate to Human",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#system-logs",
          "text": "=âœ… **Self-Healing Action Taken**\n\nStrategy: Restart Service\nAttempt: {{ $json.next_attempt }}",
          "otherOptions": {}
        },
        "id": "log-healing",
        "name": "Log Healing",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          2000,
          300
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          1000,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Self-Healing Loop Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1250,
          650
        ]
      }
    ],
    "connections": {
      "Health Monitor": {
        "main": [
          [
            {
              "node": "Check Core API",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Core API": {
        "main": [
          [
            {
              "node": "Is Failed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Failed?": {
        "main": [
          [
            {
              "node": "Determine Strategy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Determine Strategy": {
        "main": [
          [
            {
              "node": "Execute Strategy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute Strategy": {
        "main": [
          [
            {
              "node": "Dynamic Backoff",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Escalate to Human",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Dynamic Backoff": {
        "main": [
          [
            {
              "node": "Self-Heal: Restart",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Self-Heal: Restart": {
        "main": [
          [
            {
              "node": "Log Healing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Social Inbox Manager v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-nwblobgou",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 15
              }
            ]
          }
        },
        "id": "schedule-check",
        "name": "Check Every 15 Min",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "url": "https://graph.facebook.com/v19.0/{{ $env.FB_PAGE_ID }}/conversations",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "access_token",
                "value": "={{ $env.FB_ACCESS_TOKEN }}"
              }
            ]
          }
        },
        "id": "fetch-fb-messages",
        "name": "Fetch FB Messages",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          200
        ]
      },
      {
        "parameters": {
          "url": "https://graph.facebook.com/v19.0/{{ $env.IG_USER_ID }}/conversations",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "access_token",
                "value": "={{ $env.IG_ACCESS_TOKEN }}"
              }
            ]
          }
        },
        "id": "fetch-ig-messages",
        "name": "Fetch IG Messages",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {},
        "id": "merge-messages",
        "name": "Merge All",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Classify message intent: SUPPORT, INQUIRY, FEEDBACK, SPAM. Suggest a brief reply if not SPAM. Output JSON: { \"intent\": \"...\", \"suggested_reply\": \"...\" }"
              },
              {
                "role": "user",
                "content": "Message: {{ $json.message }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-classify",
        "name": "AI Classify",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1000,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Social_Inbox"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "platform": "={{ $json.platform }}",
              "message": "={{ $json.message }}",
              "intent": "={{ $json.intent }}",
              "suggested_reply": "={{ $json.suggested_reply }}",
              "timestamp": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "log-inbox",
        "name": "Log to Inbox",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1250,
          300
        ]
      }
    ],
    "connections": {
      "Check Every 15 Min": {
        "main": [
          [
            {
              "node": "Fetch FB Messages",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch IG Messages",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch FB Messages": {
        "main": [
          [
            {
              "node": "Merge All",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch IG Messages": {
        "main": [
          [
            {
              "node": "Merge All",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge All": {
        "main": [
          [
            {
              "node": "AI Classify",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Classify": {
        "main": [
          [
            {
              "node": "Log to Inbox",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Subscription Lifecycle Manager v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-lr59jolwy",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ”„ Subscription Lifecycle Manager\nManages SaaS subscription states: trial â†’ active â†’ renewal â†’ churn prevention.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 6
              }
            ]
          }
        },
        "id": "check-subscriptions",
        "name": "Check Subscriptions",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Subscriptions"
          }
        },
        "id": "get-subs",
        "name": "Get Subscriptions",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const sub = $input.item.json;\nconst now = new Date();\nconst endDate = new Date(sub.end_date);\nconst trialEnd = sub.trial_end ? new Date(sub.trial_end) : null;\nconst daysUntilEnd = Math.floor((endDate - now) / (1000 * 60 * 60 * 24));\nconst daysUntilTrialEnd = trialEnd ? Math.floor((trialEnd - now) / (1000 * 60 * 60 * 24)) : null;\n\nlet lifecycle_stage = sub.status;\nlet action_needed = null;\n\nif (sub.status === 'trial' && daysUntilTrialEnd !== null) {\n  if (daysUntilTrialEnd === 3) action_needed = 'trial_ending_soon';\n  else if (daysUntilTrialEnd === 0) action_needed = 'trial_expired';\n} else if (sub.status === 'active') {\n  if (daysUntilEnd === 30) action_needed = 'renewal_reminder_30d';\n  else if (daysUntilEnd === 7) action_needed = 'renewal_reminder_7d';\n  else if (daysUntilEnd === 1) action_needed = 'renewal_urgent';\n  else if (daysUntilEnd <= 0) action_needed = 'expired';\n}\n\nreturn {\n  json: {\n    ...sub,\n    days_until_end: daysUntilEnd,\n    days_until_trial_end: daysUntilTrialEnd,\n    lifecycle_stage: lifecycle_stage,\n    action_needed: action_needed,\n    needs_action: action_needed !== null\n  }\n};"
        },
        "id": "calc-lifecycle",
        "name": "Calculate Lifecycle",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.needs_action }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "filter-action",
        "name": "Needs Action?",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.action_needed }}",
          "rules": {
            "rules": [
              {
                "value2": "trial_ending_soon",
                "output": 0
              },
              {
                "value2": "trial_expired",
                "output": 1
              },
              {
                "value2": "renewal_reminder_30d",
                "output": 2
              },
              {
                "value2": "renewal_reminder_7d",
                "output": 2
              },
              {
                "value2": "renewal_urgent",
                "output": 3
              },
              {
                "value2": "expired",
                "output": 4
              }
            ]
          },
          "fallbackOutput": 5
        },
        "id": "route-action",
        "name": "Route Action",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "Deneme sÃ¼reniz bitiyor - {{ $json.days_until_trial_end }} gÃ¼n kaldÄ±!",
          "message": "=Merhaba {{ $json.customer_name }},\n\nDeneme sÃ¼renizin bitmesine {{ $json.days_until_trial_end }} gÃ¼n kaldÄ±.\n\nÅžimdi planÄ±nÄ±zÄ± yÃ¼kseltin ve tÃ¼m Ã¶zelliklere eriÅŸin:\n{{ $env.UPGRADE_URL }}",
          "options": {}
        },
        "id": "email-trial-ending",
        "name": "Trial Ending Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1500,
          200
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "Deneme sÃ¼reniz doldu - Ã–zel teklif!",
          "message": "=Merhaba {{ $json.customer_name }},\n\nDeneme sÃ¼reniz sona erdi. Sizi kaybetmek istemiyoruz!\n\nðŸŽ Ã–zel Teklif: Ä°lk ay %50 indirim\n{{ $env.SPECIAL_OFFER_URL }}",
          "options": {}
        },
        "id": "email-trial-expired",
        "name": "Trial Expired Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1500,
          350
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "AboneliÄŸiniz yenileniyor - {{ $json.days_until_end }} gÃ¼n",
          "message": "=Merhaba {{ $json.customer_name }},\n\nAboneliÄŸiniz {{ $json.days_until_end }} gÃ¼n iÃ§inde yenilenecek.\n\nPlan: {{ $json.plan }}\nTutar: {{ $json.amount }} {{ $json.currency }}",
          "options": {}
        },
        "id": "email-renewal",
        "name": "Renewal Reminder",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#sales-urgent",
          "text": "=ðŸš¨ **Urgent Renewal**\n\nCustomer: {{ $json.customer_name }}\nPlan: {{ $json.plan }}\nExpires: Tomorrow!\n\nðŸ‘‰ Immediate outreach required",
          "otherOptions": {}
        },
        "id": "slack-urgent",
        "name": "Urgent Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#churn-alerts",
          "text": "=âŒ **Subscription Expired**\n\nCustomer: {{ $json.customer_name }}\nPlan: {{ $json.plan }}\nMRR Lost: {{ $json.amount }} {{ $json.currency }}",
          "otherOptions": {}
        },
        "id": "slack-expired",
        "name": "Churn Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          800
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Subscription Lifecycle Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          650
        ]
      }
    ],
    "connections": {
      "Check Subscriptions": {
        "main": [
          [
            {
              "node": "Get Subscriptions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Subscriptions": {
        "main": [
          [
            {
              "node": "Calculate Lifecycle",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Lifecycle": {
        "main": [
          [
            {
              "node": "Needs Action?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Needs Action?": {
        "main": [
          [
            {
              "node": "Route Action",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route Action": {
        "main": [
          [
            {
              "node": "Trial Ending Email",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Trial Expired Email",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Renewal Reminder",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Urgent Alert",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Churn Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Unified Analytics Dashboard v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-lc4cb94b7",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1-5"
              }
            ]
          }
        },
        "id": "schedule-dash",
        "name": "Daily Morning Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "// Mock Data Aggregation\nreturn {\n  json: {\n    revenue: { daily: 1500, mrr: 45000, growth: 5 },\n    marketing: { leads: 12, cpl: 25, visitors: 1200 },\n    support: { tickets: 5, avg_response: \"2h\" },\n    product: { active_users: 850, churn_rate: 1.2 }\n  }\n};"
        },
        "id": "agg-metrics",
        "name": "Aggregate Metrics",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Chief Data Officer. Analyze these daily metrics. Identify 1 key trend and 1 area of concern. Write a concise executive summary for Slack (max 5 lines, use emojis)."
              },
              {
                "role": "user",
                "content": "Metrics: {{ JSON.stringify($json) }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-insights",
        "name": "Generate AI Insights",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "channel": "executive-briefing",
          "text": "=ðŸ“Š **Daily Executive Briefing**\n{{ $json.message.content }}\n\nðŸ’¸ **Revenue:** ${{ $json.revenue.daily }} (MRR: ${{ $json.revenue.mrr }})\nðŸ‘¥ **Growth:** {{ $json.marketing.leads }} New Leads\nðŸ“‰ **Churn:** {{ $json.product.churn_rate }}%",
          "otherOptions": {}
        },
        "id": "slack-report",
        "name": "Send Slack Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          900,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Daily_Stats"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "date": "={{ $now.toFormat('yyyy-MM-dd') }}",
              "revenue": "={{ $json.revenue.daily }}",
              "mrr": "={{ $json.revenue.mrr }}",
              "active_users": "={{ $json.product.active_users }}"
            }
          }
        },
        "id": "archive-stats",
        "name": "Archive to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          900,
          500
        ]
      }
    ],
    "connections": {
      "Daily Morning Report": {
        "main": [
          [
            {
              "node": "Aggregate Metrics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Metrics": {
        "main": [
          [
            {
              "node": "Generate AI Insights",
              "type": "main",
              "index": 0
            },
            {
              "node": "Archive to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate AI Insights": {
        "main": [
          [
            {
              "node": "Send Slack Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Booking Channel Sync v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-25canjs0u",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 10
              }
            ]
          }
        },
        "id": "schedule-sync",
        "name": "Sync Every 10 Min",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "url": "https://api.channex.io/api/v1/properties/{{ $env.PROPERTY_ID }}/availability",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.CHANNEX_API_KEY }}"
              }
            ]
          }
        },
        "id": "fetch-channex",
        "name": "Fetch Channex Availability",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Room_Inventory"
          }
        },
        "id": "fetch-local",
        "name": "Fetch Local Inventory",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "const channex = $input.all()[0].json;\nconst local = $input.all()[1].json;\n\n// Compare and find discrepancies\nconst discrepancies = [];\n// ... comparison logic ...\n\nreturn { json: { sync_needed: discrepancies.length > 0, discrepancies } };"
        },
        "id": "compare-inventory",
        "name": "Compare Inventory",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "sync-check",
                "leftValue": "={{ $json.sync_needed }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "check-sync",
        "name": "Sync Needed?",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "method": "PUT",
          "url": "https://api.channex.io/api/v1/properties/{{ $env.PROPERTY_ID }}/availability",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.CHANNEX_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.discrepancies) }}"
        },
        "id": "push-update",
        "name": "Push Updates to OTAs",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "hotel-ops",
          "text": "=âœ… **Channel Sync Complete**\n\nUpdated {{ $json.discrepancies.length }} rooms across OTAs.",
          "otherOptions": {}
        },
        "id": "notify-sync",
        "name": "Notify Sync Complete",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          400
        ]
      }
    ],
    "connections": {
      "Sync Every 10 Min": {
        "main": [
          [
            {
              "node": "Fetch Channex Availability",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Local Inventory",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Channex Availability": {
        "main": [
          [
            {
              "node": "Compare Inventory",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Local Inventory": {
        "main": [
          [
            {
              "node": "Compare Inventory",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Compare Inventory": {
        "main": [
          [
            {
              "node": "Sync Needed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sync Needed?": {
        "main": [
          [
            {
              "node": "Push Updates to OTAs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Push Updates to OTAs": {
        "main": [
          [
            {
              "node": "Notify Sync Complete",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Guest Communication Journey v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-0uq9uc9xa",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-booking",
        "name": "New Booking",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "guest-booking"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 * * *"
              }
            ]
          }
        },
        "id": "daily-check",
        "name": "Daily Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          600
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "jsCode": "const booking = $input.item.json;\nconst checkin = new Date(booking.checkin_date);\nconst checkout = new Date(booking.checkout_date);\nconst now = new Date();\nconst daysUntilArrival = Math.ceil((checkin - now) / (1000 * 60 * 60 * 24));\nconst daysUntilCheckout = Math.ceil((checkout - now) / (1000 * 60 * 60 * 24));\n\nlet messageType = null;\nif (daysUntilArrival === 7) messageType = 'pre_arrival_7d';\nelse if (daysUntilArrival === 1) messageType = 'pre_arrival_1d';\nelse if (daysUntilArrival === 0) messageType = 'arrival_day';\nelse if (daysUntilCheckout === 0) messageType = 'checkout_day';\nelse if (daysUntilCheckout === -1) messageType = 'post_checkout';\nelse if (daysUntilCheckout === -3) messageType = 'review_request';\n\nreturn {\n  json: {\n    ...booking,\n    message_type: messageType,\n    days_until_arrival: daysUntilArrival,\n    should_message: messageType !== null\n  }\n};"
        },
        "id": "calc-timing",
        "name": "Calculate Timing",
        "type": "n8n-nodes-base.code",
        "position": [
          450,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.should_message }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "should-msg",
        "name": "Should Message?",
        "type": "n8n-nodes-base.if",
        "position": [
          650,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Otel misafir iletiÅŸimi uzmanÄ±sÄ±n. Mesaj tÃ¼rÃ¼ne gÃ¶re kiÅŸiselleÅŸtirilmiÅŸ mesaj yaz:\n\n- pre_arrival_7d: Heyecan verici, upsell fÄ±rsatÄ± (spa, transfer)\n- pre_arrival_1d: Check-in detaylarÄ±, saat bilgisi\n- arrival_day: HoÅŸgeldin, oda hazÄ±r bilgisi\n- checkout_day: TeÅŸekkÃ¼r, feedback linki\n- post_checkout: Ã–zledik mesajÄ±\n- review_request: Google/Tripadvisor yorum ricasÄ±\n\nJSON dÃ¶ndÃ¼r: {\"subject\": \"\", \"message\": \"\", \"upsell_offer\": null}"
              },
              {
                "role": "user",
                "content": "=Guest: {{ $json.guest_name }}\nType: {{ $json.message_type }}\nRoom: {{ $json.room_type }}\nNights: {{ $json.nights }}"
              }
            ]
          }
        },
        "id": "ai-message",
        "name": "AI Generate Message",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          850,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://graph.facebook.com/v18.0/{{ $env.WHATSAPP_PHONE_ID }}/messages",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.guest_phone }}\",\n  \"type\": \"text\",\n  \"text\": { \"body\": \"{{ $json.ai_message }}\" }\n}"
        },
        "id": "send-whatsapp",
        "name": "Send WhatsApp",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1050,
          300
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "sendTo": "={{ $json.guest_email }}",
          "subject": "={{ $json.subject }}",
          "message": "={{ $json.message }}",
          "options": {}
        },
        "id": "send-email",
        "name": "Send Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1050,
          500
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Guest_Communications"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "booking_id": "={{ $json.booking_id }}",
              "guest_name": "={{ $json.guest_name }}",
              "message_type": "={{ $json.message_type }}",
              "sent_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "log-msg",
        "name": "Log Communication",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1250,
          400
        ],
        "typeVersion": 4.2
      }
    ],
    "connections": {
      "New Booking": {
        "main": [
          [
            {
              "node": "Calculate Timing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Check": {
        "main": [
          [
            {
              "node": "Calculate Timing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Timing": {
        "main": [
          [
            {
              "node": "Should Message?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Should Message?": {
        "main": [
          [
            {
              "node": "AI Generate Message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Message": {
        "main": [
          [
            {
              "node": "Send WhatsApp",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send WhatsApp": {
        "main": [
          [
            {
              "node": "Log Communication",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Email": {
        "main": [
          [
            {
              "node": "Log Communication",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "hospitality"
      },
      {
        "name": "guest-communication"
      }
    ]
  },
  {
    "name": "Grain Restaurant Reservation v2 (Optimized)",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-o2zt8jtmg",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸŸ¢ Trigger & Schedule\nReceives new reservations via Webhook and checks daily for reminders.",
          "height": 160,
          "width": 240,
          "color": 4
        },
        "id": "note-trigger",
        "name": "Note: Trigger",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "reservation",
          "options": {}
        },
        "id": "webhook-reservation",
        "name": "New Reservation",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          220,
          400
        ],
        "webhookId": "restaurant-reservation"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 10 * * *"
              }
            ]
          }
        },
        "id": "daily-reminder",
        "name": "Daily Reminders",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          220,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "const res = $input.item.json;\nconst resDate = new Date(res.reservation_date + 'T' + res.reservation_time);\nconst now = new Date();\nconst hoursUntil = (resDate - now) / (1000 * 60 * 60);\n\nreturn {\n  json: {\n    ...res,\n    reservation_datetime: resDate.toISOString(),\n    hours_until: Math.round(hoursUntil),\n    should_confirm: hoursUntil > 20 && hoursUntil < 28,\n    should_remind: hoursUntil > 1 && hoursUntil < 4\n  }\n};"
        },
        "id": "calc-timing",
        "name": "Calculate Timing",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "content": "## ðŸ§  Logic Core\nCalculates time difference to determine if a Confirmation or Reminder message is needed.",
          "height": 160,
          "width": 240,
          "color": 5
        },
        "id": "note-logic",
        "name": "Note: Logic",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          460,
          200
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://graph.facebook.com/v18.0/{{ $env.WHATSAPP_PHONE_ID }}/messages",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.WHATSAPP_TOKEN }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.phone }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"button\",\n    \"body\": { \"text\": \"{{ $json.guest_name }} Bey/HanÄ±m, yarÄ±n saat {{ $json.reservation_time }} iÃ§in rezervasyonunuzu onaylÄ±yor musunuz?\" },\n    \"action\": {\n      \"buttons\": [\n        { \"type\": \"reply\", \"reply\": { \"id\": \"confirm_yes\", \"title\": \"âœ… Evet\" } },\n        { \"type\": \"reply\", \"reply\": { \"id\": \"confirm_no\", \"title\": \"âŒ Ä°ptal\" } }\n      ]\n    }\n  }\n}"
        },
        "id": "send-confirmation",
        "name": "Send Confirmation (WA)",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          800,
          300
        ]
      },
      {
        "parameters": {
          "resource": "event",
          "calendarId": {
            "__rl": true,
            "mode": "list",
            "value": "={{ $env.CALENDAR_ID }}"
          },
          "start": "={{ $json.reservation_datetime }}",
          "end": "={{ new Date(new Date($json.reservation_datetime).getTime() + 7200000).toISOString() }}",
          "additionalFields": {
            "summary": "=Rezervasyon: {{ $json.guest_name }}",
            "description": "=Tel: {{ $json.phone }}"
          }
        },
        "id": "google-calendar",
        "name": "Add to Calendar",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 3,
        "position": [
          1050,
          400
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Reservations"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "name": "={{ $json.guest_name }}",
              "time": "={{ $json.reservation_datetime }}",
              "status": "Confirmed"
            }
          }
        },
        "id": "google-sheets",
        "name": "Save to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "reservations",
          "text": "=ðŸŽ‰ **New Booking**\nGuest: {{ $json.guest_name }}\nTime: {{ $json.reservation_time }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1450,
          400
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          800,
          800
        ]
      },
      {
        "parameters": {
          "channel": "system-alerts",
          "text": "=ðŸš¨ **Workflow Error**\nWorkflow: Restaurant Reservation\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-alert",
        "name": "Alert Dev Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          800
        ]
      },
      {
        "parameters": {
          "content": "## ðŸ”´ Error Handling\nAny failure in the workflow triggers this section to notify the dev team immediately.",
          "height": 160,
          "width": 240,
          "color": 7
        },
        "id": "note-error",
        "name": "Note: Error",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          760,
          700
        ]
      }
    ],
    "connections": {
      "New Reservation": {
        "main": [
          [
            {
              "node": "Calculate Timing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Reminders": {
        "main": [
          [
            {
              "node": "Calculate Timing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Timing": {
        "main": [
          [
            {
              "node": "Send Confirmation (WA)",
              "type": "main",
              "index": 0
            },
            {
              "node": "Add to Calendar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add to Calendar": {
        "main": [
          [
            {
              "node": "Save to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save to Sheets": {
        "main": [
          [
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Alert Dev Team",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Review Management v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-c666onq1x",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 */4 * * *"
              }
            ]
          }
        },
        "id": "check-reviews",
        "name": "Check Reviews",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          400
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://mybusiness.googleapis.com/v4/accounts/{{ $env.GBP_ACCOUNT_ID }}/locations/{{ $env.GBP_LOCATION_ID }}/reviews",
          "authentication": "oAuth2",
          "options": {}
        },
        "id": "get-google-reviews",
        "name": "Get Google Reviews",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          400,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "const reviews = $input.item.json.reviews || [];\nconst oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\nconst newReviews = reviews.filter(r => {\n  const reviewDate = new Date(r.createTime);\n  return reviewDate > oneDayAgo && !r.reviewReply;\n}).map(r => ({\n  review_id: r.reviewId,\n  reviewer_name: r.reviewer?.displayName || 'Misafir',\n  rating: r.starRating === 'FIVE' ? 5 : r.starRating === 'FOUR' ? 4 : r.starRating === 'THREE' ? 3 : r.starRating === 'TWO' ? 2 : 1,\n  comment: r.comment || '',\n  create_time: r.createTime,\n  is_negative: r.starRating === 'ONE' || r.starRating === 'TWO'\n}));\n\nreturn newReviews.map(r => ({ json: r }));"
        },
        "id": "filter-new",
        "name": "Filter New Reviews",
        "type": "n8n-nodes-base.code",
        "position": [
          600,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Ä°ÅŸletme sahibi olarak yorumlara profesyonel ve samimi yanÄ±tlar yaz.\n\nPozitif (4-5 yÄ±ldÄ±z): TeÅŸekkÃ¼r et, tekrar bekle\nNegatif (1-2 yÄ±ldÄ±z): Ã–zÃ¼r dile, sorunu Ã§Ã¶zmek iÃ§in iletiÅŸim iste\nOrta (3 yÄ±ldÄ±z): Geri bildirim iÃ§in teÅŸekkÃ¼r, iyileÅŸtirme sÃ¶zÃ¼ ver\n\nMax 150 kelime. Ä°ÅŸletme adÄ±nÄ± kullanma, genel tut."
              },
              {
                "role": "user",
                "content": "=Reviewer: {{ $json.reviewer_name }}\nRating: {{ $json.rating }}/5\nComment: {{ $json.comment }}"
              }
            ]
          }
        },
        "id": "ai-response",
        "name": "AI Generate Response",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          800,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.is_negative }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "is-negative",
        "name": "Is Negative?",
        "type": "n8n-nodes-base.if",
        "position": [
          1000,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#urgent-reviews",
          "text": "=ðŸš¨ *Negatif Yorum AlÄ±ndÄ±!*\n\nâ­ Rating: {{ $json.rating }}/5\nðŸ‘¤ From: {{ $json.reviewer_name }}\n\nðŸ’¬ Yorum:\n{{ $json.comment }}\n\nâœï¸ Ã–nerilen YanÄ±t:\n{{ $('AI Generate Response').first().json.message.content }}\n\n_LÃ¼tfen 2 saat iÃ§inde yanÄ±tlayÄ±n!_",
          "otherOptions": {}
        },
        "id": "alert-negative",
        "name": "Alert Negative",
        "type": "n8n-nodes-base.slack",
        "position": [
          1200,
          300
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Review_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "review_id": "={{ $json.review_id }}",
              "reviewer": "={{ $json.reviewer_name }}",
              "rating": "={{ $json.rating }}",
              "comment": "={{ $json.comment }}",
              "suggested_reply": "={{ $('AI Generate Response').first().json.message.content }}",
              "status": "pending_approval",
              "created_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "log-review",
        "name": "Log Review",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1200,
          500
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "content": "## ðŸ”„ Workflow Overview\nChecks Google reviews every 4 hours, generates AI responses, and alerts on negative reviews.",
          "height": 100,
          "width": 300,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          600,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Review Management Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          800,
          650
        ]
      }
    ],
    "connections": {
      "Check Reviews": {
        "main": [
          [
            {
              "node": "Get Google Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Google Reviews": {
        "main": [
          [
            {
              "node": "Filter New Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter New Reviews": {
        "main": [
          [
            {
              "node": "AI Generate Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Response": {
        "main": [
          [
            {
              "node": "Is Negative?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Negative?": {
        "main": [
          [
            {
              "node": "Alert Negative",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Review",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Alert Negative": {
        "main": [
          [
            {
              "node": "Log Review",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "hospitality"
      },
      {
        "name": "reviews"
      },
      {
        "name": "reputation"
      }
    ]
  },
  {
    "name": "0 - MARKETING TEAM",
    "nodes": [
      {
        "parameters": {
          "name": "createImage",
          "description": "Call this tool to create an image. ",
          "workflowId": {
            "__rl": true,
            "value": "oB70PUuPofiV1wnJ",
            "mode": "list",
            "cachedResultName": "Create Image"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "chatID": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
              "imagePrompt": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('imagePrompt', `The image requested by the user`, 'string') }}",
              "imageTitle": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('imageTitle', `The title of the image. Should be no more than 4 words.`, 'string') }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "imageTitle",
                "displayName": "imageTitle",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "imagePrompt",
                "displayName": "imagePrompt",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "chatID",
                "displayName": "chatID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.1,
        "position": [
          1584,
          512
        ],
        "id": "65a23a13-2f02-4a7c-9595-f45149a827a5",
        "name": "Create Image"
      },
      {
        "parameters": {
          "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
          "text": "={{ $json.output }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          2000,
          160
        ],
        "id": "000e0581-37b2-4c0e-a862-a74eaec7d3c0",
        "name": "Telegram",
        "webhookId": "fbdb3bd7-490b-4d3e-961e-e2d398294649",
        "credentials": {
          "telegramApi": {
            "id": "uXHAFQk49G65Euci",
            "name": "marketing_team"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          912,
          512
        ],
        "id": "6a3ab587-183f-48b5-993f-f68692ffec5e",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "name": "editImage",
          "description": "Call this tool to edit an image.",
          "workflowId": {
            "__rl": true,
            "value": "DiMxRX341M6KdK1E",
            "mode": "list",
            "cachedResultName": "Edit Image"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "image": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('image', `The title of the image the user wants to edit`, 'string') }}",
              "chatID": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
              "request": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('request', `The edit the user wants to make to the image`, 'string') }}",
              "pictureID": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('pictureID', `The ID of the image to edit`, 'string') }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "image",
                "displayName": "image",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "request",
                "displayName": "request",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "chatID",
                "displayName": "chatID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "pictureID",
                "displayName": "pictureID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.1,
        "position": [
          1744,
          512
        ],
        "id": "71f107c3-0425-4fac-aa2d-c8d9084cf510",
        "name": "Edit Image"
      },
      {
        "parameters": {
          "name": "searchImages",
          "description": "Call this tool to search the image database.",
          "workflowId": {
            "__rl": true,
            "value": "T2ZS0cpCbPYYCcv6",
            "mode": "list",
            "cachedResultName": "Search Images"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "intent": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('intent', `The intent of the user. This can either be \"Get\" or \"Edit\"`, 'string') }}",
              "image": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('image', `The image title`, 'string') }}",
              "chatID": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "intent",
                "displayName": "intent",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "image",
                "displayName": "image",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "chatID",
                "displayName": "chatID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.1,
        "position": [
          1984,
          512
        ],
        "id": "3c8cff69-f5c6-438c-b8d8-8668112668fd",
        "name": "Search Images"
      },
      {
        "parameters": {
          "name": "blogPost",
          "description": "Call this tool to create a blog post using a topic and a target audience.",
          "workflowId": {
            "__rl": true,
            "value": "Y9jXhEhwKUJLTRLt",
            "mode": "list",
            "cachedResultName": "Blog Post"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "blogTopic": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('blogTopic', `The topic of the blog.`, 'string') }}",
              "targetAudience": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('targetAudience', `The target audience for the blog.`, 'string') }}",
              "chatID": "={{ $('Telegram Trigger').first().json.message.chat.id }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "blogTopic",
                "displayName": "blogTopic",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "targetAudience",
                "displayName": "targetAudience",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "chatID",
                "displayName": "chatID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.1,
        "position": [
          1408,
          512
        ],
        "id": "b590b933-b8f8-4c26-b3e8-736a3b8ad9a3",
        "name": "Blog Post"
      },
      {
        "parameters": {
          "content": "# Pazarlama beyni",
          "height": 400,
          "width": 460
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1408,
          0
        ],
        "id": "cedb95a4-40e6-43cf-a219-c6a43c6429c6",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "fe7ecc99-e1e8-4a5e-bdd6-6fce9757b234",
                "name": "text",
                "value": "={{ $json.message.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "bfb5b8ac-7be2-4f17-9125-11a99d14d66c",
        "name": "Set 'Text'",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1120,
          240
        ]
      },
      {
        "parameters": {
          "resource": "file",
          "fileId": "={{ $json.message.voice.file_id }}",
          "additionalFields": {}
        },
        "id": "c3e0ed46-f2b0-40b8-96a3-77d6eaa42efb",
        "name": "Download Voice File",
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          1040,
          80
        ],
        "webhookId": "c0b376b1-7b63-41b6-8063-0b3096b8333d",
        "credentials": {
          "telegramApi": {
            "id": "uXHAFQk49G65Euci",
            "name": "marketing_team"
          }
        }
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {}
        },
        "id": "63c7b682-2139-4216-8cf7-c00fef885e97",
        "name": "Transcribe Audio",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          1200,
          80
        ],
        "credentials": {
          "openAiApi": {
            "id": "yULUzfG7RC6WaY9a",
            "name": "Burhan API"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.message.voice.file_id }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Voice"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "8c844924-b2ed-48b0-935c-c66a8fd0c778",
                      "leftValue": "={{ $json.message.text }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Text"
              }
            ]
          },
          "options": {}
        },
        "id": "e5aead14-9dad-4699-8363-de85f428a527",
        "name": "Switch",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          784,
          160
        ]
      },
      {
        "parameters": {
          "updates": [
            "message"
          ],
          "additionalFields": {}
        },
        "id": "2b3218d3-93a0-42f8-9b2d-990c5d1dfa20",
        "name": "Telegram Trigger",
        "type": "n8n-nodes-base.telegramTrigger",
        "typeVersion": 1.1,
        "position": [
          640,
          160
        ],
        "webhookId": "99eab1a0-569d-4f0f-a49e-578a02abfe63",
        "credentials": {
          "telegramApi": {
            "id": "uXHAFQk49G65Euci",
            "name": "marketing_team"
          }
        }
      },
      {
        "parameters": {
          "content": "# Trigger\n",
          "height": 400,
          "width": 360,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          592,
          0
        ],
        "id": "8dac2f1d-f3ea-4e72-829e-7be532ee6a16",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "content": "# Gorsel olusturma",
          "height": 220,
          "width": 320,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1552,
          432
        ],
        "id": "e9c0b496-9631-474d-8477-b1540ffe2ffe",
        "name": "Sticky Note3"
      },
      {
        "parameters": {
          "content": "# Gorsel database",
          "height": 220,
          "width": 300,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1888,
          432
        ],
        "id": "28cf941b-d57e-40a4-a64b-193fa2f91a77",
        "name": "Sticky Note4"
      },
      {
        "parameters": {
          "content": "# Sonuc\n\n",
          "height": 400,
          "width": 300,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1888,
          0
        ],
        "id": "131ad68b-6fa8-4f1b-8bc5-ca0b8476e859",
        "name": "Sticky Note5"
      },
      {
        "parameters": {
          "content": "# Beyin\n\n",
          "height": 220,
          "width": 440,
          "color": 2
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          592,
          432
        ],
        "id": "c1dbba93-f5f9-4da3-922d-3113322a64a5",
        "name": "Sticky Note6"
      },
      {
        "parameters": {
          "content": "# Ses veya yazi",
          "height": 400,
          "width": 420,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          960,
          0
        ],
        "id": "0e6ea11b-9c71-4a7b-a2c5-4561ebdfb3a7",
        "name": "Sticky Note7"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.text }}",
          "options": {
            "systemMessage": "=# Overview\nYou are a marketing team AI agent. Your job is to help the user create and edit images based on the request, or create content.\n\n## Tools\ncreateImage - Use this to create an image. Send the requested image prompt to this tool.\neditImage - Use this to edit an image. The user might also say \"make\" rather than \"edit\".\nImage Database - Use this to search the image database. \nblogPost - Use this to create a blog post.\nUGC Video without background - Use this to create an UGC video with removed background. Ask to user for workspace_id, script and ugc actor gender and age (gender_age)\nUGC Video - Use this to create an UGC video. Ask to user for workspace_id, script and ugc actor gender and age (gender_age)\nThink - Use this if you need help making a decision.\n\n## Instructions\n- If the user asks to 'edit that image' or 'make that...', this indicates they want to edit the last image in the database, the most recent one.\n- If the user requests a blog post or LinkedIn post, use the \"blogPost\" or \"linkedinPost\" tool and output: \"Here's that post you requested. Hope you enjoy it.\"\n\n## Output\n- Make sure to return the image link as a clickable link\n\n"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.9,
        "position": [
          1504,
          160
        ],
        "id": "fea35afa-49a7-4317-a2a2-a28337f808bd",
        "name": "Marketing Team Agent"
      },
      {
        "parameters": {},
        "type": "@n8n/n8n-nodes-langchain.toolThink",
        "typeVersion": 1,
        "position": [
          768,
          512
        ],
        "id": "2ea3d7aa-2c55-4cba-b653-76f864c93aa0",
        "name": "Think"
      },
      {
        "parameters": {
          "content": "# Content olusturma",
          "height": 220,
          "width": 480,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1056,
          432
        ],
        "id": "8ffc8113-756a-43f8-b83d-673069734a91",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          640,
          512
        ],
        "id": "64085b5a-a054-4fc0-9843-31073abf975d",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "yULUzfG7RC6WaY9a",
            "name": "Burhan API"
          }
        }
      },
      {
        "parameters": {
          "description": "Call this tool to generate UGC video without background.",
          "workflowId": {
            "__rl": true,
            "value": "Ec9GfB59HcLys2lO",
            "mode": "list",
            "cachedResultName": "Arcads Tool - Remove BG"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "workspace_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('workspace_id', `arcads'taki workspace id'si.`, 'string') }}",
              "gender_age": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('gender_age', `Ugc aktÃ¶rÃ¼nÃ¼n yaÅŸÄ± ve cinsiyeti. Normal metin olarak yazÄ±labilir. Ã–rneÄŸin: \"25 yaÅŸÄ±nda kadÄ±n\"`, 'string') }}",
              "script": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('script', `UGC Videosunda sÃ¶ylenecek metin.`, 'string') }}",
              "telegram_id": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "workspace_id",
                "displayName": "workspace_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "gender_age",
                "displayName": "gender_age",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "script",
                "displayName": "script",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "telegram_id",
                "displayName": "telegram_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.2,
        "position": [
          1248,
          512
        ],
        "id": "b952fd3c-eaa4-496a-9185-4cb701b1b202",
        "name": "UGC Video without background"
      },
      {
        "parameters": {
          "description": "Call this tool to generate UGC video.",
          "workflowId": {
            "__rl": true,
            "value": "ylEqhRhAd9V0Bghk",
            "mode": "list",
            "cachedResultName": "Arcads Tool"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "workspace_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('workspace_id', `arcads'taki workspace id'si.`, 'string') }}",
              "gender_age": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('gender_age', `Ugc aktÃ¶rÃ¼nÃ¼n yaÅŸÄ± ve cinsiyeti. Normal metin olarak yazÄ±labilir. Ã–rneÄŸin: \"25 yaÅŸÄ±nda kadÄ±n\"`, 'string') }}",
              "script": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('script', `UGC Videosunda sÃ¶ylenecek metin.`, 'string') }}",
              "telegram_id": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "workspace_id",
                "displayName": "workspace_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "gender_age",
                "displayName": "gender_age",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "script",
                "displayName": "script",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "telegram_id",
                "displayName": "telegram_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.2,
        "position": [
          1088,
          512
        ],
        "id": "0f4987dd-d6a5-4bf9-9107-a990bddbf6b5",
        "name": "UGC Video"
      },
      {
        "parameters": {
          "content": "## Pazarlama ekibi\n",
          "height": 96,
          "width": 1600,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          592,
          -112
        ],
        "id": "e6ea1097-61ad-467e-8feb-f79f02213225",
        "name": "Sticky Note8"
      }
    ],
    "pinData": {},
    "connections": {
      "Create Image": {
        "ai_tool": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Edit Image": {
        "ai_tool": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Search Images": {
        "ai_tool": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Blog Post": {
        "ai_tool": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Download Voice File": {
        "main": [
          [
            {
              "node": "Transcribe Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Download Voice File",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set 'Text'",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transcribe Audio": {
        "main": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set 'Text'": {
        "main": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Telegram Trigger": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Marketing Team Agent": {
        "main": [
          [
            {
              "node": "Telegram",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Think": {
        "ai_tool": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "UGC Video without background": {
        "ai_tool": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "UGC Video": {
        "ai_tool": [
          [
            {
              "node": "Marketing Team Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "d5945540-f77c-4b11-b94b-ba41a077fb13",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "MVuZEgaNRhrLOVyb",
    "tags": []
  },
  {
    "name": "AI-Powered Short-Form Video Generator with OpenAI, Flux, Kling, and ElevenLabs and upload to all social networks",
    "nodes": [
      {
        "parameters": {
          "url": "=https://api.piapi.ai/api/v1/task/{{ $json.data.task_id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-Key",
                "value": "={{ $('Set API Keys').item.json['PiAPI Key'] }}"
              }
            ]
          },
          "options": {}
        },
        "id": "17b8ecb5-df89-45b8-ab06-8dd9e3a6b81c",
        "name": "Get image",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          896,
          192
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.piapi.ai/api/v1/task",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-Key",
                "value": "={{ $('Set API Keys').item.json['PiAPI Key'] }}"
              }
            ]
          },
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "application/json",
          "body": "={\n  \"model\": \"Qubico/flux1-dev\",\n  \"task_type\": \"txt2img\",\n  \"input\": {\n    \"prompt\": \"{{ $('Generate Image Prompts').item.json.choices[0].message.content }} realistic and casual as if taken by an iphone camera by a TikTok influencer\",\n    \"negative_prompt\": \"taking a photo of a room, recording a video of a room, photos app, video recorder, illegible text, blurry text, low quality text, DSLR, unnatural\",\n    \"width\": 540,\n    \"height\": 960\n  }\n}",
          "options": {}
        },
        "id": "96472038-fcc2-4560-bc96-4eb8ba44fc91",
        "name": "Generate Image",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          624,
          192
        ],
        "retryOnFail": false,
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.piapi.ai/api/v1/task",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-Key",
                "value": "={{ $('Set API Keys').item.json['PiAPI Key'] }}"
              }
            ]
          },
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "application/json",
          "body": "={\n  \"model\": \"kling\",\n  \"task_type\": \"video_generation\",\n  \"input\": {\n    \"prompt\": \"{{ $json.data.input.prompt }}\",\n    \"negative_prompt\": \"blurry motion, distorted faces, unnatural lighting, over produced, bad quality\",\n    \"cfg_scale\": 0.5,\n    \"duration\": 5,\n    \"mode\": \"pro\",\n    \"image_url\": \"{{ $json.data.output.image_url }}\",\n    \"version\": \"1.6\",\n    \"camera_control\": {\n      \"type\": \"simple\",\n      \"config\": {\n        \"horizontal\": 0,\n        \"vertical\": 0,\n        \"pan\": 0,\n        \"tilt\": 0,\n        \"roll\": 0,\n        \"zoom\": 5\n      }\n    }\n  },\n  \"config\": {}\n}",
          "options": {}
        },
        "id": "44c77b9d-dd1f-418d-ae74-7b532a174896",
        "name": "Image-to-Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          256,
          720
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "url": "=https://api.piapi.ai/api/v1/task/{{ $json.data.task_id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-Key",
                "value": "={{ $('Set API Keys').item.json['PiAPI Key'] }}"
              }
            ]
          },
          "options": {}
        },
        "id": "0532de1e-14b1-47e2-aca9-d0b4cb1f8075",
        "name": "Get Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          512,
          720
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "return [\n  {\n    scene_titles: items.map(item => item.json.response.text),\n    video_urls: items.map(item => item.json.data.output.video_url),\n    input_tokens: $('Calculate Token Usage').first().json.total_prompt_tokens,\n    output_tokens: $('Calculate Token Usage').first().json.total_completion_tokens,\n    model: $('Generate Image Prompts').first().json.model\n  }\n];"
        },
        "id": "a281b354-3d8d-4a48-acf5-91665a2ea3f9",
        "name": "List Elements",
        "type": "n8n-nodes-base.code",
        "position": [
          1136,
          752
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "amount": 10,
          "unit": "minutes"
        },
        "id": "aa457f0b-7e8a-490e-b60a-865a59cf20a8",
        "name": "Wait 10min",
        "type": "n8n-nodes-base.wait",
        "position": [
          400,
          720
        ],
        "webhookId": "1f9d716f-6544-4e4e-94ec-408ac3ea6e82",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "amount": 3,
          "unit": "minutes"
        },
        "id": "cfc7eb79-8bd6-4dea-87d4-886e8cae4adb",
        "name": "Wait 3min",
        "type": "n8n-nodes-base.wait",
        "position": [
          752,
          192
        ],
        "webhookId": "77cdee73-5e99-456a-b5e7-410b4d257669",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "unit": "minutes"
        },
        "id": "33719d74-e61f-4b8a-8ee5-07204273324d",
        "name": "Wait 5min",
        "type": "n8n-nodes-base.wait",
        "position": [
          1216,
          112
        ],
        "webhookId": "31d5b1a2-dbb5-4849-ae25-cb491539c16e",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.elevenlabs.io/v1/text-to-speech/onwK4e9ZLuTAKqWW03F9",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "xi-api-key",
                "value": "={{ $('Set API Keys').item.json['ElevenLabs API Key'] }}"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "text",
                "value": "={{ $json.choices[0].message.content }}"
              }
            ]
          },
          "options": {}
        },
        "id": "01991280-445b-4b8f-bf30-9c7c6a7f5977",
        "name": "Generate voice",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          624,
          1184
        ],
        "retryOnFail": false,
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "return [\n  {\n    sound_urls: items.map(item => $('Upload Voice Audio').first().json.webContentLink)\n  }\n];"
        },
        "id": "8f344594-1959-44b1-9992-6c52dc5557e8",
        "name": "List Elements1",
        "type": "n8n-nodes-base.code",
        "position": [
          1136,
          976
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "a920eb54-fc23-4b68-8f56-2eee907a5481",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.data.status }}",
                "rightValue": "failed"
              }
            ]
          },
          "options": {}
        },
        "id": "6dd9ee14-7cdc-4f81-9a68-76edc7e4250c",
        "name": "Fail check",
        "type": "n8n-nodes-base.if",
        "position": [
          656,
          720
        ],
        "typeVersion": 2.2
      },
      {
        "parameters": {
          "unit": "minutes"
        },
        "id": "02561b56-65a8-4007-98f6-32a4cb391ef8",
        "name": "Wait to retry",
        "type": "n8n-nodes-base.wait",
        "position": [
          800,
          672
        ],
        "webhookId": "3b0fae8f-4419-45cd-8380-8f72eca05ff8",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "o3-mini",
            "cachedResultName": "O3-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "=You are an advanced, unhinged, hilariously entertaining prompt-generation AI specializing in expanding short POV image prompt ideas into detailed, hyper-realistic prompts optimized for Qubico/flux1-dev. Your task is to take a brief input tied to job seeking, job hunting, or resume building and morph it into a cinematic, immersive prompt locked in a first-person perspective, making the viewer feel theyâ€™re living the scene.\n\nNEVER include quotation marks or emojis in your responseâ€”flux API will choke on them, and thatâ€™s a hard no.\n\nThe topic of this narrative is: {{ $('Load Google Sheet').item.json.idea }}\n\nThe short prompt idea to expand for this image generation is: {{ $json.response.text }}\n\nONLY GENERATE ONE PROMPT PER IDEAâ€”NO COMBINING. In at least one scene, weave in this environment descriptor: {{ $('Load Google Sheet').first().json.environment_prompt }}, but go wild with unhinged, edgy, funny twists elsewhere (skip the cringe or cheesy garbage). Most job hunting happens on laptops or desktops, so prioritize those over phones. If a phone sneaks in, itâ€™s only showing job-related content like email, LinkedIn, a resume, or a job postingâ€”never a photo or video app.\n\nEvery prompt has two parts:\n\nForeground: Kick off with First person view POV GoPro shot of... and show the viewerâ€™s hands, limbs, or feet locked in a job-related action.\n\nBackground: Start with In the background,... and paint the scenery, blending the environment descriptor when required, plus sensory zingers.\n\nTop Rules:\n\nNO quotation marks or emojisâ€”EVER. This is life or death for flux.\nStick to first-person POVâ€”the viewerâ€™s in the driverâ€™s seat, not watching from the sidelines.\nShow a limb (hands, feet) doing something job-focusedâ€”typing, holding a resume, adjusting a tie.\nKeep it dynamic, like a GoPro clip, with motion and depth mimicking human vision.\nIf techâ€™s involved (phone, computer), itâ€™s displaying job-hunting goldâ€”email, job boards, resumesâ€”not random trash.\nNo off-topic actions like recording videos or snapping picsâ€”job hunting only, fam.\nExtra Vibes:\n\nFull-body awareness: Drop hints of physical feelsâ€”cramping fingers, racing pulse, slumping shoulders.\nSensory overload: Hit sight, touch, sound, smell, temperature for max realism (coffee whiffs, keyboard clacks).\nWorld grip: Limbs interact with the sceneâ€”tapping keys, handing over papers, stepping up.\nKeep it under 1000 characters, one slick sentence, no fluff or formatting.\nMake it entertaining, relatable, with an Andrew Tate viral edge for the down-and-out job hustlers.\nExamples:\n\nInput: Updating a LinkedIn profile after a long day\n\nEnvironment_prompt: Tired, cluttered apartment, laptop glow\n\nOutput: First person view POV GoPro shot of my hands hammering a laptop, cheeto-dusted fingers aching from the grind, the screen flashing my LinkedIn profile with a fresh connection ping; in the background, a trashed apartment lit by the laptopâ€™s ghostly glow, pizza boxes toppling, traffic humming outside, stale takeout stench hitting my nose as my back screams from the hustle.\n\nInput: Handing over a resume at a job fair\n\nEnvironment_prompt: Hopeful, busy convention hall, suits everywhere\n\nOutput: First person view POV GoPro shot of my hand thrusting out a crisp resume, fingers twitching with nerves as it brushes another palm; in the background, a buzzing convention hall packed with suits, coffee fumes and shoe polish in the air, chatter drowning my pounding heart as I lock eyes with the recruiter.\n\nNO QUOTATION MARKS. NO EMOJIS. EVER."
              }
            ]
          },
          "simplify": false,
          "options": {}
        },
        "id": "ac12710c-0aec-4ee2-a648-b3a84d6eec7a",
        "name": "Generate Image Prompts",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          144,
          272
        ],
        "typeVersion": 1.8
      },
      {
        "parameters": {
          "jsCode": "// Get all input items (the 5 LLM responses)\nconst items = $input.all();\n\n// Calculate total prompt tokens and total completion tokens\nconst totalPromptTokens = items.reduce((sum, item) => sum + item.json.usage.prompt_tokens, 0);\nconst totalCompletionTokens = items.reduce((sum, item) => sum + item.json.usage.completion_tokens, 0);\n\n// Create new items with original data plus the totals\nconst outputItems = items.map(item => ({\n  json: {\n    ...item.json,                   // Spread the original item data\n    total_prompt_tokens: totalPromptTokens,     // Add total prompt tokens\n    total_completion_tokens: totalCompletionTokens // Add total completion tokens\n  }\n}));\n\n// Return the modified items\nreturn outputItems;"
        },
        "id": "78c64cc9-baa1-41d2-902b-ea32b16b8c58",
        "name": "Calculate Token Usage",
        "type": "n8n-nodes-base.code",
        "position": [
          432,
          272
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "567d1fc9-0638-4a44-b5f5-30a9a6683794",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.data.status }}",
                "rightValue": "failed"
              }
            ]
          },
          "options": {}
        },
        "id": "5e72a18d-e8f6-4498-8bc7-615a21252c5e",
        "name": "Check for failures",
        "type": "n8n-nodes-base.if",
        "position": [
          1040,
          192
        ],
        "typeVersion": 2.2
      },
      {
        "parameters": {
          "content": "## 2. ðŸ–¼ï¸Generate images with Flux using [PiAPI](https://piapi.ai/?via=n8n) \n### (total cost: $0.0948 approx. as of 3/9/25)\n1. OpenAI is used to generate 5 Flux image prompts based on the 5 captions generated. Edit this node to see/edit the prompt instructions. \n2. Next we use some custom javascript to total up how many tokens were used for each 5 generations so we can track our costs later.\n3. Then we generate an image with Flux using the [PiAPI service](https://piapi.ai/?via=n8n), waiting to check for failures and retrying if there are any.\n\nYou can change the image model used by editing the Generate Image node API call.\nFlux models available (as of 3/9/25):\n- Qubico/flux1-dev ($0.015) - Currently set\n- Qubico/flux1-schnell ($0.0015)\n- Qubico/flux1-advanced ($0.02)\n\nFor full list of API settings, see the [Flux API Documentation](https://piapi.ai/docs/flux-api/text-to-image?via=n8n)\n",
          "height": 460,
          "width": 1260,
          "color": 5
        },
        "id": "349306c7-4b91-4771-aab0-ab8594e208a7",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          112,
          -48
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## 3. ðŸŽ¬Generate videos with Kling using [PiAPI](https://piapi.ai/?via=n8n)\n### (total cost: $2.30 approx. as of 3/9/25)\n1. We use image-to-video with Kling using [PiAPI](https://piapi.ai/?via=n8n) to generate a video from each image.\n2. Then we wait to check for failures, and repeat the generations the failed if there are any.\n\nYou can edit the video model used in the Image-to-Video node. For testing, I'd recommend switching from pro to std for lower quality and cheaper price.\nKling models available (as of 3/9/25):\n- std (Standard) $0.26 per 5 second video\n- pro (Professional) $0.46 per 5 second video - Currently set\n\nFor full list of API settings, see the [Kling API Documentation](https://piapi.ai/docs/kling-api/create-task?via=n8n)\n",
          "height": 500,
          "width": 1040,
          "color": 6
        },
        "id": "8af7d7fc-6b7b-42e0-9e6f-321ca38513b3",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          224,
          432
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "DO NOT include any quotation marks in your response. Do not put a quote at the beginning or the end of your response.\n\nYou are a prompt-generation AI specializing in crafting unhinged, entertaining TikTok captions for a \"day in the life\" POV story about job hunting or resume writing. Generate five concise, action-driven captions (5-10 words each) that follow a Problem > Action > Reward structure. The first caption should be a shocking or funny hook, and the last should conclude with a satisfying reward. Use emojis sparinglyâ€”only one per caption at most, and only when they add impact; skip them if they donâ€™t enhance the message.\n\nGuidelines:\n\nPerspective: Always first-person POV, immersing the viewer in the story.\nTone: Channel Andrew Tate mixed with Charlie Sheenâ€”cursing and sexual innuendos are fair game.\nContent: Focus on job seeking, hunting, or resume building, spotlighting AI as the game-changer.\nNarrative: Start with the grind of unemployment or a shitty job, pivot to using AI for resumes and cover letters, and end with scoring the dream gig.\nScenes: Highlight raw, emotional momentsâ€”skip the boring stuff.\nYour captions should be wild and entertaining, not polished or professional. The first caption is the hookâ€”make it shocking, hilarious, or ballsy, something Andrew Tate would growl. Use emojis sparinglyâ€”max one per caption, only if it hits harder with it.\n\nYour response should be a list of 5 items separated by \"\\n\" (for example: \"item1\\nitem2\\nitem3\\nitem4\\nitem5\")",
                "role": "system"
              },
              {
                "content": "={{ $json.idea }}"
              }
            ]
          },
          "simplify": false,
          "options": {}
        },
        "id": "9f1a5c42-f0d6-4861-a3e6-3dbd14940643",
        "name": "Generate Video Captions",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          -304,
          944
        ],
        "typeVersion": 1.8
      },
      {
        "parameters": {
          "content": "## 4. ðŸ”‰Generate voice overs with [Eleven Labs](https://try.elevenlabs.io/n8n)\n1. OpenAI API is used to generate a funny script that relates to the captions. Open this node to see/edit the prompt instructions. \n2. Then we use the [Eleven Labs API](https://try.elevenlabs.io/n8n) to generate the voiceover and upload it to our Google Drive so it can be accessed in the next step.\n\nTo replace the voice, find the voice ID of the voice you want to use in [Eleven Labs](https://try.elevenlabs.io/n8n), then change the URL in the Generate Voice node to: https://api.elevenlabs.io/v1/text-to-speech/{voice ID here}\n\nFor full list of API settings, see the [Eleven Labs API Documentation](https://elevenlabs.io/docs/api-reference/text-to-speech/convert)\n",
          "height": 400,
          "width": 1040,
          "color": 4
        },
        "id": "f1c0b3e1-6b4d-4239-8b30-bbba559a9231",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          224,
          960
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineByPosition",
          "options": {}
        },
        "id": "802dc8af-579e-4aa0-9288-67f2e23bedf6",
        "name": "Match captions with videos",
        "type": "n8n-nodes-base.merge",
        "position": [
          976,
          752
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "=You are an unhinged and hilarious TikTok influencer who's like a mix of Andrew Tate and Charlie Sheen. The user is going to provide you with a topic, and then 5 different parts of a story. Your task is to narrate the story as this hilarious character, who isn't afraid to be edgy or curse or use sexual innuendos. However keep each of the 5 talking points brief, as you only have about 5 seconds to speak during each. The entire length of your narration should be around 15 seconds.\n\nEach line item of the users message represents 1 5 second clip, so your response needs to be able to quickly and easily be spoken in those time constraints. Don't say extra things you don't need to. Just quickly tell the story, in order, and make it unhinged, funny, entertaining, and potentially controversially viral. Don't worry about offendeding anyone. Andrew Tate style it.\n\nDo not include any emojis, as your response will be converted from text to speech, so anything but text and punctuation isn't neccesary. Also, don't make your jokes overly corny, speak in a witty, edgy, funny way, but no corny dad jokes or anything cringe.",
                "role": "system"
              },
              {
                "content": "={{ $('Generate Video Captions').item.json.choices[0].message.content }}"
              }
            ]
          },
          "simplify": false,
          "options": {}
        },
        "id": "8927a130-1c88-435b-a5d3-62f487557640",
        "name": "Generate Script",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          256,
          1184
        ],
        "executeOnce": true,
        "typeVersion": 1.8
      },
      {
        "parameters": {
          "name": "={{ $('Load Google Sheet').item.json.id }}-voiceover.mp3",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "1w1EQ8xyth6w7AbX2wpDI3vInfYeRy8vH",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1w1EQ8xyth6w7AbX2wpDI3vInfYeRy8vH",
            "cachedResultName": "Resume Studio"
          },
          "options": {}
        },
        "id": "86d5c8c3-2628-4c1b-b000-458d39677c3d",
        "name": "Upload Voice Audio",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          816,
          1184
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "operation": "share",
          "fileId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json.id }}"
          },
          "permissionsUi": {
            "permissionsValues": {
              "role": "writer",
              "type": "anyone",
              "allowFileDiscovery": true
            }
          },
          "options": {}
        },
        "id": "5590726e-e15f-48b6-bad9-baa2c4f403f4",
        "name": "Set Access Permissions",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          992,
          1184
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineByPosition",
          "options": {}
        },
        "id": "b9eadf98-dbac-4fab-bfd8-1ce2d0121a70",
        "name": "Pair Videos with Audio",
        "type": "n8n-nodes-base.merge",
        "position": [
          1360,
          864
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.creatomate.com/v1/renders",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('Set API Keys').item.json['Creatomate API Key'] }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "application/json",
          "body": "={\n  \"template_id\": \"{{ $('Set API Keys').item.json['Creatomate Template ID'] }}\",\n  \"modifications\": {\n    \n    \"Video-1.source\": \"{{ $json.video_urls[0] }}\",\n    \"Video-2.source\": \"{{ $json.video_urls[1] }}\",\n    \"Video-3.source\": \"{{ $json.video_urls[2] }}\",\n    \"Video-4.source\": \"{{ $json.video_urls[3] }}\",\n    \"Video-5.source\": \"{{ $json.video_urls[4] }}\",\n\n    \"Audio-1.source\": \"{{ $json.sound_urls[0] }}\",\n\n    \"Text-1.text\": \"{{ $json.scene_titles[0] }}\",\n    \"Text-2.text\": \"{{ $json.scene_titles[1] }}\",\n    \"Text-3.text\": \"{{ $json.scene_titles[2] }}\",\n    \"Text-4.text\": \"{{ $json.scene_titles[3] }}\",\n    \"Text-5.text\": \"{{ $json.scene_titles[4] }}\"\n  }\n}",
          "options": {}
        },
        "id": "e4950e77-eb24-439c-98de-3c53cc1826a6",
        "name": "Render Final Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1536,
          864
        ],
        "executeOnce": true,
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "authentication": "webhook",
          "content": "=A new Resume Studio POV video has been created: {{ $json.final_output }}",
          "options": {}
        },
        "id": "45aa2cf7-993c-4631-b50b-0ed39b7643f0",
        "name": "Notify me on Discord",
        "type": "n8n-nodes-base.discord",
        "position": [
          2512,
          864
        ],
        "webhookId": "1541bc50-06e4-48e8-8c76-23850ee4edf6",
        "typeVersion": 2
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 7
              }
            ]
          }
        },
        "id": "7470c9a6-e408-469f-8793-eb60f43532d5",
        "name": "Once Per Day",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          -864,
          944
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1cjd8p_yx-M-3gWLEd5TargtoB35cW-3y66AOTNMQrrM",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cjd8p_yx-M-3gWLEd5TargtoB35cW-3y66AOTNMQrrM/edit?usp=drivesdk",
            "cachedResultName": "Sheet Template"
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cjd8p_yx-M-3gWLEd5TargtoB35cW-3y66AOTNMQrrM/edit#gid=0",
            "cachedResultName": "Sheet1"
          },
          "filtersUI": {
            "values": [
              {
                "lookupColumn": "production",
                "lookupValue": "for production"
              }
            ]
          },
          "options": {
            "returnFirstMatch": true
          }
        },
        "id": "9d7e9942-89b4-4924-a8d1-20408cafedcc",
        "name": "Load Google Sheet",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -448,
          944
        ],
        "typeVersion": 4.5,
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "jsCode": "// Get the text directly from the OpenAI response\nconst text = $input.first().json.choices[0].message.content;\n\n// Split the text on literal '\\\\n', trim, and filter empty lines\nconst lines = text.split('\\\\n').map(line => line.trim()).filter(line => line !== '');\n\n// Create an array of items for n8n\nconst items = lines.map(line => ({\n  json: {\n    response: { text: line }\n  }\n}));\n\n// Return the array of items\nreturn items;"
        },
        "id": "cdb6a607-094d-4520-977c-a061b9e729bf",
        "name": "Create List",
        "type": "n8n-nodes-base.code",
        "position": [
          16,
          864
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "content": "## 5. ðŸ“¥Complete video with [Creatomate](https://creatomate.com/)\n### (total cost: $0.38 approx. with the Essential plan credits | Free trial credits available)\n1. First, the list of videos/captions is combined with the generated voice over into a single item containing all 3 elements.\n2. Those are then passed over to the Creatomate Template ID you specified, replacing the template captions/video/audio with your generated ones.\n3. When the video is finished rendering, it's then uploaded to Google Drive and the permissions set so it can be accessed with a link.\n4. Then we update the original Google Sheet template with the information from our generation, including tokens to calculate cost, then mark this idea as completed.\n5. Finally, we send a notification to via [webhook to the Discord server](https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks) when the video is ready to be downloaded and used!\n\n",
          "height": 380,
          "width": 1360,
          "color": 3
        },
        "id": "17c09a87-e368-46fd-8fba-f5bfd2ce4589",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1296,
          640
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "# ðŸ¤– AI-Powered Short-Form Video Generator with OpenAI, Flux, Kling, and ElevenLabs\n\n## ðŸ“ƒBefore you get started, you'll need:\n- [n8n installation](https://n8n.partnerlinks.io/n8nTTVideoGenTemplate) (tested on version 1.81.4)\n- [OpenAI API Key](https://platform.openai.com/api-keys) (free trial credits available)\n- [PiAPI](https://piapi.ai/?via=n8n) (free trial credits available)\n- [Eleven Labs](https://try.elevenlabs.io/n8n) (free account)\n- [Creatomate API Key](https://creatomate.com/) (free trial credits available)\n- Google Sheets API enabled in [Google Cloud Console](https://console.cloud.google.com/apis/api/sheets.googleapis.com/overview)\n- Google Drive API enabled in [Google Cloud Console](https://console.cloud.google.com/apis/api/drive.googleapis.com/overview)\n- OAuth 2.0 Client ID and Client Secret from your [Google Cloud Console Credentials](https://console.cloud.google.com/apis/credentials)\n",
          "height": 420,
          "width": 620
        },
        "id": "c9c22a49-7d37-43a9-94ab-155467938d94",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -592,
          -16
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## 1. ðŸ—¨ï¸Generate video captions from ideas in a Google Sheet\n\n1. Setup your API keys for [PiAPI](https://piapi.ai/?via=n8n), [Eleven Labs](https://try.elevenlabs.io/n8n), and [Creatomate](https://creatomate.com/).\n- Once logged in to your Creatomate account, create a new video template and click \"source code\" in the top right. [Paste this JSON code](https://pastebin.com/c7aMTeLK). This will be your example template for this workflow.\n- In your Creatomate template, click the \"Use Template\" button in the top right and then click \"API Integration\" and you'll see your template_id. Set this value as your Creatomate Template ID in the Set API Keys node\n\n2. The next node will load a Google Sheet, you can copy the [Google Sheet Template](https://docs.google.com/spreadsheets/d/1cjd8p_yx-M-3gWLEd5TargtoB35cW-3y66AOTNMQrrM/edit?usp=sharing), simply choose File > Make a copy. Then in the Google Sheets node, connect to your copied sheet template.\n\n3. Next, we generate 5 captions for our video idea with OpenAI. You can edit this node to see the prompt and change it to your needs.\n\n4. In the final two nodes, we use custom javascript code to turn the OpenAI response into a list. Then, it validates to make sure the list was formed correctly (incase of an OpenAI failure to follow instructions)\n",
          "height": 700,
          "width": 920,
          "color": 7
        },
        "id": "88987251-77a3-4a0f-b9e9-dbb9438bacd2",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -752,
          496
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "amount": 3,
          "unit": "minutes"
        },
        "id": "be15c534-0cbc-4005-bf22-c6c353ea8a10",
        "name": "Wait1",
        "type": "n8n-nodes-base.wait",
        "position": [
          1664,
          864
        ],
        "webhookId": "206d0cdf-b71f-44a7-909f-97df885c471a",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "url": "=https://api.creatomate.com/v1/renders/{{ $('Render Final Video').item.json.id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('Set API Keys').item.json['Creatomate API Key'] }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "options": {}
        },
        "id": "451c2b00-a649-4f7e-b1c9-70190d8ff156",
        "name": "Get Final Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1776,
          864
        ],
        "executeOnce": true,
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "name": "=POV-{{ $('Render Final Video').item.json.id }}.mp4",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "folderId": {
            "__rl": true,
            "mode": "list",
            "value": "1w1EQ8xyth6w7AbX2wpDI3vInfYeRy8vH",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1w1EQ8xyth6w7AbX2wpDI3vInfYeRy8vH",
            "cachedResultName": "Resume Studio"
          },
          "options": {}
        },
        "id": "2621d852-dba1-4672-b180-d852a4bf78c2",
        "name": "Upload Final Video",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          2032,
          864
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "url": "={{ $json.url }}",
          "options": {
            "response": {
              "response": {
                "responseFormat": "file"
              }
            }
          }
        },
        "id": "72e5e5c2-15cb-4844-9d18-2a80b61ad393",
        "name": "Get Raw File",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1904,
          864
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "operation": "share",
          "fileId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $json.id }}"
          },
          "permissionsUi": {
            "permissionsValues": {
              "role": "writer",
              "type": "anyone",
              "allowFileDiscovery": true
            }
          },
          "options": {}
        },
        "id": "6ecff18c-d94e-4ebc-879d-77b0b6ea27f9",
        "name": "Set Permissions",
        "type": "n8n-nodes-base.googleDrive",
        "position": [
          2176,
          864
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": "1cjd8p_yx-M-3gWLEd5TargtoB35cW-3y66AOTNMQrrM",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cjd8p_yx-M-3gWLEd5TargtoB35cW-3y66AOTNMQrrM/edit?usp=drivesdk",
            "cachedResultName": "Sheet Template"
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "gid=0",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1cjd8p_yx-M-3gWLEd5TargtoB35cW-3y66AOTNMQrrM/edit#gid=0",
            "cachedResultName": "Sheet1"
          },
          "columns": {
            "value": {
              "id": "={{ $('Load Google Sheet').first().json.id }}",
              "width": "={{ $('Get Raw File').item.json.width }}",
              "height": "={{ $('Get Raw File').item.json.height }}",
              "model1": "={{ $('Generate Video Captions').item.json.model }}",
              "model2": "={{ $('Pair Videos with Audio').item.json.model }}",
              "model3": "={{ $('Generate Script').item.json.model }}",
              "duration": "={{ $('Get Raw File').item.json.duration }}",
              "fluxCost": "0.075",
              "frameRate": "={{ $('Get Raw File').item.json.frame_rate }}",
              "klingCost": "2.3",
              "production": "done",
              "publishing": "for publishing",
              "final_output": "={{ $('Upload Final Video').item.json.webContentLink }}",
              "prompt1 input tokens": "={{ $('Generate Video Captions').item.json.usage.prompt_tokens }}",
              "prompt2 input tokens": "={{ $('Pair Videos with Audio').item.json.input_tokens }}",
              "prompt3 input tokens": "={{ $('Generate Script').item.json.usage.prompt_tokens }}",
              "prompt1 output tokens": "={{ $('Generate Video Captions').item.json.usage.completion_tokens }}",
              "prompt2 output tokens": "={{ $('Pair Videos with Audio').item.json.output_tokens }}",
              "prompt3 output tokens": "={{ $('Generate Script').item.json.usage.completion_tokens }}"
            },
            "schema": [
              {
                "id": "id",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "id",
                "defaultMatch": true,
                "canBeUsedToMatch": true
              },
              {
                "id": "idea",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "idea",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "caption",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "caption",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "production",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "production",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "environment_prompt",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "environment_prompt",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "publishing",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "publishing",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "final_output",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "final_output",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "width",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "width",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "height",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "height",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "duration",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "duration",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "frameRate",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "frameRate",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "model1",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "model1",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "prompt1 input tokens",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "prompt1 input tokens",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "prompt1 output tokens",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "prompt1 output tokens",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "model1 cost",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "model1 cost",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "model2",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "model2",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "prompt2 input tokens",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "prompt2 input tokens",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "prompt2 output tokens",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "prompt2 output tokens",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "model2 cost",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "model2 cost",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "model3",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "model3",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "prompt3 input tokens",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "prompt3 input tokens",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "prompt3 output tokens",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "prompt3 output tokens",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "model3 cost",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "model3 cost",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "cmCost",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "cmCost",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "upgradeCmCost",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "upgradeCmCost",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "fluxCost",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "fluxCost",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "klingCost",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "klingCost",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "totalCost",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "totalCost",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "datePosted",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "datePosted",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "row_number",
                "type": "string",
                "display": true,
                "removed": true,
                "readOnly": true,
                "required": false,
                "displayName": "row_number",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "id"
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "id": "88994d33-9e59-46f9-a406-40992be59736",
        "name": "Update Google Sheet",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2336,
          864
        ],
        "typeVersion": 4.5
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "35659353-d8e2-4677-876b-401b549605a0",
                "name": "PiAPI Key",
                "type": "string",
                "value": ""
              },
              {
                "id": "c4927dd6-c597-48fe-b7c1-bbffcf5ff02f",
                "name": "ElevenLabs API Key",
                "type": "string",
                "value": ""
              },
              {
                "id": "f5e90c05-dd24-4918-9005-4c87a4fb344d",
                "name": "Creatomate API Key",
                "type": "string",
                "value": ""
              },
              {
                "id": "d0ebba50-5a99-4090-adcb-d18aa0b21be2",
                "name": "Creatomate Template ID",
                "type": "string",
                "value": ""
              }
            ]
          },
          "options": {}
        },
        "id": "8b8bdc70-103e-42d8-b585-d141d8d3ef70",
        "name": "Set API Keys",
        "type": "n8n-nodes-base.set",
        "position": [
          -656,
          944
        ],
        "notesInFlow": true,
        "typeVersion": 3.4,
        "notes": "SET BEFORE STARTING"
      },
      {
        "parameters": {
          "content": "## DO THIS FIRST\n",
          "height": 220,
          "width": 220,
          "color": 3
        },
        "id": "fb11e382-7549-4b18-859f-918d21626106",
        "name": "Sticky Note6",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -704,
          880
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "2681c0e9-aa45-4f0f-8933-6e6de324c7aa",
                "operator": {
                  "type": "array",
                  "operation": "lengthGt",
                  "rightType": "number"
                },
                "leftValue": "={{$input.all()}}",
                "rightValue": 1
              }
            ]
          },
          "options": {}
        },
        "id": "b2a8abd6-e5d5-4f51-aaeb-d9f28775d810",
        "name": "Validate list formatting",
        "type": "n8n-nodes-base.if",
        "position": [
          16,
          992
        ],
        "typeVersion": 2.2
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {}
        },
        "id": "0381da0f-3902-4bf5-a4e7-254b4a39e698",
        "name": "Get Audio from Video",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          3552,
          1072
        ],
        "notesInFlow": true,
        "retryOnFail": true,
        "typeVersion": 1,
        "waitBetweenTries": 5000,
        "notes": "Extract the audio from video for generate the description"
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are an expert assistant in creating engaging social media video titles.",
                "role": "system"
              },
              {
                "content": "=I'm going to upload a video to social media. Here are some examples of descriptions that have worked well on Instagram:\n\nFollow and save for later. Discover InfluencersDe, the AI tool that automates TikTok creation and publishing to drive traffic to your website. Perfect for entrepreneurs and brands.\n#digitalmarketing #ugc #tiktok #ai #influencersde #contentcreation\n\nDiscover the video marketing revolution with InfluencersDe!\n.\n.\n.\n#socialmedia #videomarketing #ai #tiktok #influencersde #growthhacking\n\nDon't miss InfluencersDe, the tool that transforms your marketing strategy with just one click!\n.\n.\n.\n#ugc #ai #tiktok #digitalmarketing #influencersde #branding\n\nCan you create another title for the Instagram post based on this recognized audio from the video?\n\nAudio: {{ $('Get Audio from Video').item.json.text }}\n\nIMPORTANT: Reply only with the description, don't add anything else."
              }
            ]
          },
          "options": {}
        },
        "id": "af2bb069-6aa4-4807-bff5-40a6809eaded",
        "name": "Generate Description for Videos  in Tiktok and Instagram",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          3792,
          1072
        ],
        "notesInFlow": true,
        "retryOnFail": true,
        "typeVersion": 1.4,
        "waitBetweenTries": 5000,
        "notes": "Request to OpenAi for generate description with the audio extracted from the video"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.upload-post.com/api/upload",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $('Generate Description for Videos  in Tiktok and Instagram').item.json.message.content.replaceAll(\"\\\"\", \"\") }}"
              },
              {
                "name": "platform[]",
                "value": "tiktok"
              },
              {
                "parameterType": "formBinaryData",
                "name": "video",
                "inputDataFieldName": "data"
              },
              {
                "name": "user",
                "value": "Add user generated in upload-post"
              }
            ]
          },
          "options": {}
        },
        "id": "35fd46d6-6f24-48d7-aae5-ffa5e22f6efb",
        "name": "Upload Video and Description to Tiktok",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          4624,
          656
        ],
        "notesInFlow": true,
        "typeVersion": 4.2,
        "notes": "Generate in upload-post.com the token and add to the credentials in the header-> Authorization: Apikey (token here)"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.upload-post.com/api/upload",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $('Generate Description for Videos  in Tiktok and Instagram').item.json.message.content.replaceAll(\"\\\"\", \"\") }}"
              },
              {
                "name": "platform[]",
                "value": "instagram"
              },
              {
                "parameterType": "formBinaryData",
                "name": "video",
                "inputDataFieldName": "data"
              },
              {
                "name": "user",
                "value": "Add user generated in upload-post"
              }
            ]
          },
          "options": {}
        },
        "id": "515b2d58-2edd-424e-b25f-eaf726d7a9c0",
        "name": "Upload Video and Description to Instagram",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          4624,
          864
        ],
        "notesInFlow": true,
        "typeVersion": 4.2,
        "notes": "Generate in upload-post.com the token and add to the credentials in the header-> Authorization: Apikey (token here)"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.upload-post.com/api/upload",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $('Generate Description for Videos  in Tiktok and Instagram').item.json.message.content.replaceAll(\"\\\"\", \"\").substring(0, 70) }}\n"
              },
              {
                "name": "platform[]",
                "value": "youtube"
              },
              {
                "parameterType": "formBinaryData",
                "name": "video",
                "inputDataFieldName": "data"
              },
              {
                "name": "user",
                "value": "Add user generated in upload-post"
              }
            ]
          },
          "options": {}
        },
        "id": "8493472f-28a4-49cd-85e6-24595d1fc125",
        "name": "Upload Video and Description to Youtube",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          4624,
          1072
        ],
        "notesInFlow": true,
        "typeVersion": 4.2,
        "notes": "Generate in upload-post.com the token and add to the credentials in the header-> Authorization: Apikey (token here)"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.upload-post.com/api/upload",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $('Generate Description for Videos  in Tiktok and Instagram').item.json.message.content.replaceAll(\"\\\"\", \"\") }}"
              },
              {
                "name": "platform[]",
                "value": "facebook"
              },
              {
                "parameterType": "formBinaryData",
                "name": "video",
                "inputDataFieldName": "data"
              },
              {
                "name": "user",
                "value": "Add user generated in upload-post"
              },
              {
                "name": "facebook_page_id",
                "value": "61556896550301"
              }
            ]
          },
          "options": {}
        },
        "id": "744cdad7-795e-43c1-bf2f-a94a30c959b1",
        "name": "Upload Video and Description to Facebook",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          4624,
          1312
        ],
        "notesInFlow": true,
        "typeVersion": 4.2,
        "notes": "Generate in upload-post.com the token and add to the credentials in the header-> Authorization: Apikey (token here)"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.upload-post.com/api/upload",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $('Generate Description for Videos  in Tiktok and Instagram').item.json.message.content.replaceAll(\"\\\"\", \"\") }}"
              },
              {
                "name": "platform[]",
                "value": "linkedin"
              },
              {
                "parameterType": "formBinaryData",
                "name": "video",
                "inputDataFieldName": "data"
              },
              {
                "name": "user",
                "value": "Add user generated in upload-post"
              }
            ]
          },
          "options": {}
        },
        "id": "6578885d-25a9-4cc2-9d79-9e0e30c60caa",
        "name": "Upload Video and Description to Linkedin",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          4624,
          1552
        ],
        "notesInFlow": true,
        "typeVersion": 4.2,
        "notes": "Generate in upload-post.com the token and add to the credentials in the header-> Authorization: Apikey (token here)"
      },
      {
        "parameters": {
          "content": "## 6. Upload to all social networks with upload-post.com\n### (premium plan 15$ | Free trial credits available)\n\n\n\nThis automation will automatically create descriptions from videos and upload it to Instagram, TikTok, Youtube, Facebook and Linkedin.\n\n## How to Use\n1. Generate an API token at upload-post.com and add to Upload to Tiktok and Upload to Instagram nodes etc\n2. Customize the OpenAI prompt for your specific use case\n3. Optional: Configure Telegram for error notifications\n\n## Requirements\n- upload-post.com account\n- OpenAI API key\n",
          "height": 1160,
          "width": 2480
        },
        "id": "8f43eeda-0cd9-4caa-809a-f4586dc74d08",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2672,
          640
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "filePath": "={{ $('Write video').item.json.originalFilename.replaceAll(\" \", \"_\") }}",
          "dataPropertyName": "datavideo"
        },
        "id": "1303b3c1-eb89-4baa-86db-59d6605af811",
        "name": "Read Video from Google Drive",
        "type": "n8n-nodes-base.readBinaryFile",
        "position": [
          4160,
          1072
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "fileName": "={{ $json.originalFilename.replaceAll(\" \", \"_\") }}",
          "options": {}
        },
        "id": "89a13053-774a-4e53-8c2f-e8aa3f105e6f",
        "name": "Write video",
        "type": "n8n-nodes-base.writeBinaryFile",
        "position": [
          3184,
          1072
        ],
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Wait1": {
        "main": [
          [
            {
              "node": "Get Final Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Video": {
        "main": [
          [
            {
              "node": "Fail check",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get image": {
        "main": [
          [
            {
              "node": "Check for failures",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 3min": {
        "main": [
          [
            {
              "node": "Get image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 5min": {
        "main": [
          [
            {
              "node": "Generate Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fail check": {
        "main": [
          [
            {
              "node": "Wait to retry",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Match captions with videos",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Wait 10min": {
        "main": [
          [
            {
              "node": "Get Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create List": {
        "main": [
          [
            {
              "node": "Validate list formatting",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Write video": {
        "main": [
          [
            {
              "node": "Get Audio from Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Raw File": {
        "main": [
          [
            {
              "node": "Upload Final Video",
              "type": "main",
              "index": 0
            },
            {
              "node": "Write video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Once Per Day": {
        "main": [
          [
            {
              "node": "Set API Keys",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set API Keys": {
        "main": [
          [
            {
              "node": "Load Google Sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "List Elements": {
        "main": [
          [
            {
              "node": "Pair Videos with Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait to retry": {
        "main": [
          [
            {
              "node": "Image-to-Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Image": {
        "main": [
          [
            {
              "node": "Wait 3min",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate voice": {
        "main": [
          [
            {
              "node": "Upload Voice Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Image-to-Video": {
        "main": [
          [
            {
              "node": "Wait 10min",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "List Elements1": {
        "main": [
          [
            {
              "node": "Pair Videos with Audio",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Generate Script": {
        "main": [
          [
            {
              "node": "Generate voice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Final Video": {
        "main": [
          [
            {
              "node": "Get Raw File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Permissions": {
        "main": [
          [
            {
              "node": "Update Google Sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Load Google Sheet": {
        "main": [
          [
            {
              "node": "Generate Video Captions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check for failures": {
        "main": [
          [
            {
              "node": "Wait 5min",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Image-to-Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Render Final Video": {
        "main": [
          [
            {
              "node": "Wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload Final Video": {
        "main": [
          [
            {
              "node": "Set Permissions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload Voice Audio": {
        "main": [
          [
            {
              "node": "Set Access Permissions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Google Sheet": {
        "main": [
          [
            {
              "node": "Notify me on Discord",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Audio from Video": {
        "main": [
          [
            {
              "node": "Generate Description for Videos  in Tiktok and Instagram",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Token Usage": {
        "main": [
          [
            {
              "node": "Generate Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Image Prompts": {
        "main": [
          [
            {
              "node": "Calculate Token Usage",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pair Videos with Audio": {
        "main": [
          [
            {
              "node": "Render Final Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Access Permissions": {
        "main": [
          [
            {
              "node": "List Elements1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Video Captions": {
        "main": [
          [
            {
              "node": "Create List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Validate list formatting": {
        "main": [
          [
            {
              "node": "Generate Image Prompts",
              "type": "main",
              "index": 0
            },
            {
              "node": "Match captions with videos",
              "type": "main",
              "index": 0
            },
            {
              "node": "Generate Script",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Generate Video Captions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Match captions with videos": {
        "main": [
          [
            {
              "node": "List Elements",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read Video from Google Drive": {
        "main": [
          [
            {
              "node": "Upload Video and Description to Tiktok",
              "type": "main",
              "index": 0
            },
            {
              "node": "Upload Video and Description to Instagram",
              "type": "main",
              "index": 0
            },
            {
              "node": "Upload Video and Description to Youtube",
              "type": "main",
              "index": 0
            },
            {
              "node": "Upload Video and Description to Facebook",
              "type": "main",
              "index": 0
            },
            {
              "node": "Upload Video and Description to Linkedin",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Description for Videos  in Tiktok and Instagram": {
        "main": [
          [
            {
              "node": "Read Video from Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "f2f7de7862d0ee6a4f18562bc70ca627316d8f13263a729541e12754b4ea41b0"
    },
    "tags": []
  },
  {
    "name": "AI-Powered WhatsApp Chatbot for Text, Voice, Images & PDFs",
    "nodes": [
      {
        "parameters": {
          "updates": [
            "messages"
          ],
          "options": {}
        },
        "id": "dbf250c0-5474-4175-8a53-7e739a3d4014",
        "name": "WhatsApp Trigger",
        "type": "n8n-nodes-base.whatsAppTrigger",
        "position": [
          -1024,
          992
        ],
        "webhookId": "d3978cae-2aca-4553-8ac7-ab89068deabc",
        "typeVersion": 1
      },
      {
        "parameters": {
          "url": "={{ $json.url }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "id": "f1f1fde7-4484-4cc7-943c-34473c1ceed9",
        "name": "Download Image",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          400,
          1024
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "resource": "image",
          "operation": "analyze",
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "text": "=You are an advanced image description AI assistant . Your primary function is to provide detailed, accurate descriptions of images submitted through WhatsApp.\n\nCORE FUNCTIONALITY:\n- When presented with an image, you will analyze it thoroughly and provide a comprehensive description in English.\n- Your descriptions should capture both the obvious and subtle elements within the image.\n\nIMAGE DESCRIPTION GUIDELINES:\n- Begin with a broad overview of what the image contains\n- Describe key subjects, people, objects, and their relationships\n- Note significant visual elements such as colors, lighting, composition, and perspective\n- Identify any text visible in the image\n- Describe the setting or environment\n- Mention any notable actions or events taking place\n- Comment on mood, tone, or atmosphere when relevant\n- If applicable, identify landmarks, famous people, or cultural references\n\nRESPONSE FORMAT:\n- Start with \"Image Description:\" followed by your analysis\n- Structure your description in a logical manner (general to specific)\n- Use clear, precise language appropriate for visual description\n- Format longer descriptions with paragraphs to enhance readability\n- End with any notable observations that might require special attention\n\nLIMITATIONS:\n- If the image is blurry, low resolution, or difficult to interpret, acknowledge these limitations\n- If an image contains potentially sensitive content, provide a factual description without judgment\n- Do not make assumptions about elements that cannot be clearly determined\n\nYour descriptions should be informative, objective, and thorough, enabling someone who cannot see the image to form an accurate mental picture of its contents.",
          "inputType": "base64",
          "options": {
            "detail": "auto"
          }
        },
        "id": "38d3f73b-9388-40a4-9875-ebbcd5dac0ce",
        "name": "Analyze Image",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          640,
          1024
        ],
        "typeVersion": 1.8
      },
      {
        "parameters": {
          "url": "={{ $json.url }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "id": "d57d66dc-c75c-477e-8a7b-b2e19553bce3",
        "name": "Download Audio",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          400,
          720
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {}
        },
        "id": "0830d7dc-1513-431b-9efa-2c7aac2fa5fa",
        "name": "Transcribe Audio",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          640,
          720
        ],
        "typeVersion": 1.8
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "id": "a0ce42fd-4a59-41d4-876e-7f0c246a4e68",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -160,
          2352
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.text }}",
          "options": {
            "systemMessage": "You are an intelligent assistant. Your purpose is to analyze various types of input and provide helpful, accurate responses.\n\nCAPABILITIES:\n- Process and respond to text messages\n- Analyze uploaded files\n- Interpret and describe images\n- Transcribe and understand voice messages\n\nINPUT HANDLING:\n1. For text messages: Analyze the content, understand the intent, and provide a relevant response.\n2. For file analysis: Examine the file content, extract key information, and summarize important points also based on the questions asked.\n3. For image analysis: Describe what you see in the image, identify key elements, and respond to any questions about the image.\n4. For voice messages: Transcribe the audio, understand the message, and respond appropriately.\n\nRESPONSE GUIDELINES:\n- Be concise but thorough\n- Prioritize accuracy over speculation\n- Maintain a professional and helpful tone\n- When uncertain, acknowledge limitations\n- Format responses for easy reading on mobile devices\n- Include actionable information when appropriate\n\nLIMITATIONS:\n- Mention if you're unable to process certain file formats\n- Indicate if an image is unclear or if details are difficult to discern\n- Note if audio quality impacts transcription accuracy\n\nSECURITY & PRIVACY:\n- Do not store or remember sensitive information shared in files, images, or voice notes\n- Do not share personal information across different user interactions\n- Inform users about data privacy limitations when relevant\n\nAnalyze all inputs carefully before responding. Your goal is to provide value through accurate information and helpful assistance."
          }
        },
        "id": "6d5802c3-bd0a-44e9-bf0c-be26e4e2585e",
        "name": "AI Agent1",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          -160,
          2128
        ],
        "typeVersion": 1.8
      },
      {
        "parameters": {
          "url": "={{ $json.url }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "id": "4d1474c1-c04e-4cd5-93f3-05b7adef19d0",
        "name": "Download File",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          400,
          1360
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "operation": "pdf",
          "options": {}
        },
        "id": "41378f10-be95-4c35-96d5-0f72d8a47361",
        "name": "Extract from File",
        "type": "n8n-nodes-base.extractFromFile",
        "position": [
          672,
          1360
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "=memory_{{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}",
          "contextWindowLength": 10
        },
        "id": "69903894-4ea2-48be-a6ba-d44b7a688705",
        "name": "Simple Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "position": [
          -16,
          2352
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {
          "resource": "media",
          "operation": "mediaUrlGet",
          "mediaGetId": "={{ $('WhatsApp Trigger').item.json.messages[0].document.id }}"
        },
        "id": "7915d1b9-4a5a-45eb-a321-2b7a08f1230e",
        "name": "Get File Url",
        "type": "n8n-nodes-base.whatsApp",
        "position": [
          192,
          1360
        ],
        "webhookId": "280bd5de-32d7-4d8f-93d2-e91e3b0bc161",
        "typeVersion": 1
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "f52d2aaa-e0b2-45e5-8c4b-ceef42182a0d",
                "operator": {
                  "name": "filter.operator.equals",
                  "type": "string",
                  "operation": "equals"
                },
                "leftValue": "={{ $json.messages[0].document.mime_type }}",
                "rightValue": "application/pdf"
              }
            ]
          },
          "options": {}
        },
        "id": "5f5fda86-d8c0-4380-846b-d85869dd0c45",
        "name": "Only PDF File",
        "type": "n8n-nodes-base.if",
        "position": [
          -96,
          1392
        ],
        "typeVersion": 2.2
      },
      {
        "parameters": {
          "jsCode": "for (const item of $input.all()) {\n  if (item.binary) {\n    const binaryPropertyNames = Object.keys(item.binary);\n    for (const propName of binaryPropertyNames) {\n      if (item.binary[propName].mimeType === 'audio/mp3') {\n        item.binary[propName].mimeType = 'audio/mpeg';\n      }\n    }\n  }\n}\n\nreturn $input.all();"
        },
        "id": "40a029d2-fcd9-4314-9cf8-91e78d3bf4e5",
        "name": "Fix mimeType for Audio",
        "type": "n8n-nodes-base.code",
        "position": [
          720,
          1984
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "send",
          "phoneNumberId": "470271332838881",
          "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.messages[0].from }}",
          "textBody": "={{ $json.output }}",
          "additionalFields": {}
        },
        "id": "6cd12d4f-622f-4fed-b593-c54aa4634096",
        "name": "Send message",
        "type": "n8n-nodes-base.whatsApp",
        "position": [
          528,
          2272
        ],
        "webhookId": "23834751-5066-48ba-8e19-549680df2b27",
        "typeVersion": 1
      },
      {
        "parameters": {
          "operation": "send",
          "phoneNumberId": "470271332838881",
          "recipientPhoneNumber": "={{ $('Input type').item.json.contacts[0].wa_id }}",
          "messageType": "audio",
          "mediaPath": "useMedian8n",
          "additionalFields": {}
        },
        "id": "41009526-d881-49b6-895e-584ac47faf0f",
        "name": "Send audio",
        "type": "n8n-nodes-base.whatsApp",
        "position": [
          944,
          1984
        ],
        "webhookId": "d18b2c98-84e4-43cf-a532-0c47d5161684",
        "typeVersion": 1
      },
      {
        "parameters": {
          "operation": "send",
          "phoneNumberId": "470271332838881",
          "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.messages[0].from }}",
          "textBody": "=Sorry but you can only send PDF files",
          "additionalFields": {}
        },
        "id": "4cb4ffa0-8b24-49ac-828e-14363b75ee7f",
        "name": "Incorrect format",
        "type": "n8n-nodes-base.whatsApp",
        "position": [
          192,
          1600
        ],
        "webhookId": "23834751-5066-48ba-8e19-549680df2b27",
        "typeVersion": 1
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c53cd9f9-77c1-4331-98ff-bfc9bdf95a3c",
                "name": "text",
                "type": "string",
                "value": "={{ $('WhatsApp Trigger').item.json.messages[0].text.body }}"
              }
            ]
          },
          "options": {}
        },
        "id": "3cc33eb5-dfb6-40a5-8a3e-aefd05125ae7",
        "name": "Text",
        "type": "n8n-nodes-base.set",
        "position": [
          928,
          384
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "219577d5-b028-48fc-90be-980f4171ab68",
                "name": "text",
                "type": "string",
                "value": "={{ $json.text }}"
              }
            ]
          },
          "options": {}
        },
        "id": "1b971f52-254b-4f7f-b6ec-6ca59b49cf8f",
        "name": "Audio",
        "type": "n8n-nodes-base.set",
        "position": [
          928,
          720
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "67552183-de2e-494a-878e-c2948e8cb6bb",
                "name": "text",
                "type": "string",
                "value": "=User request on the image:\n{{ \"Describe the following image\" || $('WhatsApp Trigger').item.json.messages[0].image.caption }}\n\nImage description:\n{{ $json.content }}"
              }
            ]
          },
          "options": {}
        },
        "id": "18e22534-b3ec-4314-a729-edd8bf92f151",
        "name": "Image",
        "type": "n8n-nodes-base.set",
        "position": [
          912,
          1024
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "67552183-de2e-494a-878e-c2948e8cb6bb",
                "name": "text",
                "type": "string",
                "value": "=User request on the file:\n{{ \"Describe this file\" || $('Only PDF File').item.json.messages[0].document.caption }}\n\nFile content:\n{{ $json.text }}"
              }
            ]
          },
          "options": {}
        },
        "id": "660a925d-992f-4eda-9f44-9c9a32b56db1",
        "name": "File",
        "type": "n8n-nodes-base.set",
        "position": [
          928,
          1360
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "operation": "send",
          "phoneNumberId": "470271332838881",
          "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.messages[0].from }}",
          "textBody": "=You can only send text messages, images, audio files and PDF documents.",
          "additionalFields": {}
        },
        "id": "54bf01f6-a78c-4508-83cd-815aebca0b10",
        "name": "Not supported",
        "type": "n8n-nodes-base.whatsApp",
        "position": [
          -576,
          1264
        ],
        "webhookId": "23834751-5066-48ba-8e19-549680df2b27",
        "typeVersion": 1
      },
      {
        "parameters": {
          "resource": "media",
          "operation": "mediaUrlGet",
          "mediaGetId": "={{ $('WhatsApp Trigger').item.json.messages[0].image.id }}"
        },
        "id": "cb6dc8b3-773d-4aab-ba74-cc7c9fe2beab",
        "name": "Get Image Url",
        "type": "n8n-nodes-base.whatsApp",
        "position": [
          160,
          1024
        ],
        "webhookId": "280bd5de-32d7-4d8f-93d2-e91e3b0bc161",
        "typeVersion": 1
      },
      {
        "parameters": {
          "resource": "media",
          "operation": "mediaUrlGet",
          "mediaGetId": "={{ $('WhatsApp Trigger').item.json.messages[0].audio.id }}"
        },
        "id": "943893f7-a575-4cbc-b24a-a924132d621b",
        "name": "Get Audio Url",
        "type": "n8n-nodes-base.whatsApp",
        "position": [
          144,
          720
        ],
        "webhookId": "87caa300-7204-47b5-959a-94f4a8fbf8cf",
        "typeVersion": 1
      },
      {
        "parameters": {
          "resource": "audio",
          "input": "={{ $('AI Agent1').item.json.output }}",
          "voice": "onyx",
          "options": {}
        },
        "id": "05efb231-051d-455a-8355-7f5bd0590b63",
        "name": "Generate Audio Response",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          528,
          1984
        ],
        "typeVersion": 1.8
      },
      {
        "parameters": {
          "content": "## Text",
          "height": 240,
          "width": 1340
        },
        "id": "3e7cf493-c194-47e1-a3f1-02a2c76b3da8",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -208,
          352
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## Voice",
          "height": 240,
          "width": 1340
        },
        "id": "a2c8bb34-6624-4ab7-add6-9d1c1647f8f9",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -208,
          672
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## Image",
          "height": 240,
          "width": 1340
        },
        "id": "9acc478a-fdae-4e78-b327-b1c51469dcc1",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -208,
          992
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## Document",
          "height": 240,
          "width": 1340
        },
        "id": "7cfee32e-7aa9-4ce7-b916-6fd50ee2258f",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -208,
          1328
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## Response",
          "height": 600,
          "width": 1340,
          "color": 5
        },
        "id": "f58f093e-57a0-4e07-9d9d-c2b6b5225624",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -208,
          1872
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "b9d1d759-f585-4791-a743-b9d72951e77c",
                "operator": {
                  "type": "object",
                  "operation": "exists",
                  "singleValue": true
                },
                "leftValue": "={{ $('WhatsApp Trigger').item.json.messages[0].audio }}",
                "rightValue": ""
              }
            ]
          },
          "options": {}
        },
        "id": "31085dcd-5fd1-4209-98f0-34b5ef62c628",
        "name": "From audio to audio?",
        "type": "n8n-nodes-base.if",
        "position": [
          272,
          2128
        ],
        "typeVersion": 2.2
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "08fd0c80-307e-4f45-b1de-35192ee4ec5e",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.messages[0].text.body }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "Text"
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "b7b64446-f1ea-4622-990c-22f3999a8269",
                      "operator": {
                        "type": "object",
                        "operation": "exists",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.messages[0].audio }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "Voice"
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "202af928-a324-411a-bf15-68a349e7bf9e",
                      "operator": {
                        "type": "object",
                        "operation": "exists",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.messages[0].image }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "Image"
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "combinator": "and",
                  "conditions": [
                    {
                      "id": "c63299e9-6069-4bc6-afb9-7beebf6e3d69",
                      "operator": {
                        "type": "object",
                        "operation": "exists",
                        "singleValue": true
                      },
                      "leftValue": "={{ $json.messages[0].document }}",
                      "rightValue": ""
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "Document"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra"
          }
        },
        "id": "cbd58ebe-381a-4200-a075-da4c0e93b53d",
        "name": "Input type",
        "type": "n8n-nodes-base.switch",
        "position": [
          -736,
          944
        ],
        "typeVersion": 3.2
      },
      {
        "parameters": {
          "content": "How to obtain Whatsapp API?\n\n\n### âœ… Prerequisites\nBefore you begin, make sure you have:\n- A **Meta Business Account**\n- A **Facebook Developer Account**\n- A **Verified Business**\n- A **Phone Number** to link to WhatsApp\n- Access to **Meta's Graph API Explorer** or **Meta for Developers portal**\n\n---\n\n### ðŸªœ STEP 1: Create a Meta App\n\n1. Go to [https://developers.facebook.com/apps](https://developers.facebook.com/apps)\n2. Click **â€œCreate Appâ€**\n3. Choose **\"Business\"** as the app type, then click **Next**\n4. Give your app a name and enter a contact email\n5. Choose your Business Account (or create one)\n6. Click **Create App**\n\n---\n\n### ðŸªœ STEP 2: Add WhatsApp Product\n\n1. In your app dashboard, scroll down to **\"Add a Product\"**\n2. Find **\"WhatsApp\"** and click **â€œSet Upâ€**\n3. Link your **Business Manager Account**\n\n---\n\n### ðŸªœ STEP 3: Create a WhatsApp Business Account (if needed)\n\n1. If you havenâ€™t already, go to [https://business.facebook.com/](https://business.facebook.com/)\n2. Click **â€œCreate Accountâ€**, and complete your business information\n3. Go to **Business Settings > Accounts > WhatsApp Accounts**\n4. Add a **Phone Number** (you'll receive a verification code)\n\n---\n\n### ðŸªœ STEP 4: Generate a Temporary Access Token (for development)\n\n1. In the **App Dashboard**, go to **WhatsApp > Getting Started**\n2. Choose your test phone number\n3. Copy the **temporary access token** (valid for 24 hours)\n4. Copy the **Phone Number ID** and **WhatsApp Business Account ID**\n\nâœ… Save these 3 values:\n- **Access Token**\n- **Phone Number ID**\n- **WABA ID**\n\nðŸ“ Tip: For production, you will later need to create a **permanent token** (see step 7).\n\n---\n\n### ðŸªœ STEP 5: Set Up a Webhook URL (n8n)\n\n1. In n8n, set up a **Webhook node** (or use the `WhatsApp Trigger` node)\n2. Copy the webhook URL\n3. In the Meta Developer Dashboard:\n   - Go to **WhatsApp > Configuration**\n   - Click **â€œEdit Callback URLâ€**\n   - Paste your n8n webhook URL and add a random **verify token**\n4. In n8n, configure your webhook to respond to the verification request\n\n---\n\n### ðŸªœ STEP 6: Subscribe to Webhook Fields\n\n1. Still under **WhatsApp > Configuration**, click **\"Manage Subscriptions\"**\n2. Enable:\n   - `messages`\n   - `message_status`\n   - (Optionally `message_template_status_update`)\n\n---\n\n### ðŸªœ STEP 7: (Optional but recommended) Generate a Permanent Token\n\n1. Go to [https://developers.facebook.com/tools/access_token/](https://developers.facebook.com/tools/access_token/)\n2. Select your app\n3. Click **Get Token > System User Token**\n4. Select the permissions:\n   - `whatsapp_business_management`\n   - `whatsapp_business_messaging`\n   - `business_management`\n5. Click **Generate Token**\n6. Copy and securely store this token\n\n---\n\n### ðŸªœ STEP 8: Configure Credentials in n8n\n\n1. Go to **n8n > Settings > Credentials**\n2. Create new credentials of type **HTTP Header Auth**\n   - **Name:** WhatsApp\n   - **Header Name:** `Authorization`\n   - **Value:** `Bearer <your_access_token>`\n3. Save\n\nThen, in your workflows:\n- Use the HTTP Request node or WhatsApp node\n- Set the `phone_number_id` in the node parameters\n- Connect it to your WhatsApp credential\n\n---\n\n### ðŸ§ª STEP 9: Test the Connection\n\n1. Use a WhatsApp number to send a message to your business phone\n2. Your n8n workflow should be triggered\n3. You can now send and receive messages programmatically ðŸŽ‰\n",
          "height": 2680,
          "width": 780,
          "color": 3
        },
        "id": "7241c454-df39-44dd-83ec-c38b5634f0bb",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1904,
          -240
        ],
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "File": {
        "main": [
          [
            {
              "node": "AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text": {
        "main": [
          [
            {
              "node": "AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Audio": {
        "main": [
          [
            {
              "node": "AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Image": {
        "main": [
          [
            {
              "node": "AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent1": {
        "main": [
          [
            {
              "node": "From audio to audio?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Input type": {
        "main": [
          [
            {
              "node": "Text",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Audio Url",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Image Url",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Only PDF File",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Not supported",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get File Url": {
        "main": [
          [
            {
              "node": "Download File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Image": {
        "main": [
          [
            {
              "node": "Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download File": {
        "main": [
          [
            {
              "node": "Extract from File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Audio Url": {
        "main": [
          [
            {
              "node": "Download Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Image Url": {
        "main": [
          [
            {
              "node": "Download Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Only PDF File": {
        "main": [
          [
            {
              "node": "Get File Url",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Incorrect format",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Download Audio": {
        "main": [
          [
            {
              "node": "Transcribe Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Image": {
        "main": [
          [
            {
              "node": "Analyze Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transcribe Audio": {
        "main": [
          [
            {
              "node": "Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "WhatsApp Trigger": {
        "main": [
          [
            {
              "node": "Input type",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract from File": {
        "main": [
          [
            {
              "node": "File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "From audio to audio?": {
        "main": [
          [
            {
              "node": "Generate Audio Response",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fix mimeType for Audio": {
        "main": [
          [
            {
              "node": "Send audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Audio Response": {
        "main": [
          [
            {
              "node": "Fix mimeType for Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "f2f7de7862d0ee6a4f18562bc70ca627316d8f13263a729541e12754b4ea41b0"
    },
    "tags": []
  },
  {
    "name": "AI - Email cevaplama",
    "nodes": [
      {
        "parameters": {
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          },
          "simple": false,
          "filters": {
            "q": "-from:me"
          },
          "options": {}
        },
        "id": "2eaebddb-7399-4d8b-95a7-4e41162db666",
        "name": "Gmail Trigger",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          -840,
          60
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "53849246-ad32-4845-9976-9f9688f5a6f2",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                },
                "leftValue": "={{ $json.needsReply }}",
                "rightValue": "true"
              }
            ]
          },
          "options": {}
        },
        "id": "06f6d037-a6e4-4fbf-b07a-acaf0ffe0a54",
        "name": "If Needs Reply",
        "type": "n8n-nodes-base.if",
        "position": [
          -260,
          40
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsonSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"needsReply\": {\n      \"type\": \"boolean\"\n      }\n  },\n  \"required\": [\"needsReply\"]\n}\n"
        },
        "id": "fe040aa5-c304-4cb2-8af1-2fe8af61aabe",
        "name": "JSON Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "position": [
          -400,
          200
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "options": {
            "responseFormat": "json_object",
            "temperature": 0
          }
        },
        "id": "aa8468e3-3601-4d95-8d87-7e0f1cea8d7a",
        "name": "OpenAI Chat",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -600,
          220
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "model": "gpt-4-turbo",
          "options": {}
        },
        "id": "3f7f34ce-38fb-4dae-880b-bcb63780f603",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          -20,
          220
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "resource": "draft",
          "subject": "=Re: {{ $('Gmail Trigger').item.json.headers.subject }}",
          "emailType": "html",
          "message": "={{ $json.text.replace(/\\n/g, \"<br />\\n\") }}",
          "options": {
            "threadId": "={{ $('Gmail Trigger').item.json.threadId }}",
            "sendTo": "={{ $('Gmail Trigger').item.json.headers.from }}"
          }
        },
        "id": "0083ba07-7c59-421a-87a8-c9642ccff56e",
        "name": "Gmail - Create Draft",
        "type": "n8n-nodes-base.gmail",
        "position": [
          400,
          40
        ],
        "typeVersion": 2.1,
        "webhookId": "2f127f58-e0c4-4761-9048-7f9748c74988"
      },
      {
        "parameters": {
          "prompt": "=Subject: {{ $json.subject }}\nMessage:\n{{ $json.textAsHtml }} ",
          "messages": {
            "messageValues": [
              {
                "message": "Your task is to assess if the message requires a response. Return in JSON format true if it does, false otherwise.\nMarketing emails don't require a response."
              }
            ]
          }
        },
        "id": "017849dc-2901-4256-b113-a8689fa12a70",
        "name": "Assess if message needs a reply",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "position": [
          -600,
          60
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Subject: {{ $('Gmail Trigger').item.json.subject }}\nMessage: {{ $('Gmail Trigger').item.json.textAsHtml }}",
          "messages": {
            "messageValues": [
              {
                "message": "You're a helpful personal assistant and your task is to draft replies on my behalf to my incoming emails. Whenever I provide some text from an email, return an appropriate draft reply for it and nothing else.\nEnsure that the reply is suitable for a professional email setting and addresses the topic in a clear, structured, and detailed manner.\nDo not make things up.\n\nDetailed instructions:\n- Be concise and maintain a business casual tone.\n- Start with \"Hello,\", and end with \"Best,\"\n- When replying to yes-no questions, draft 2 responses: one affirmative and one negative separated by \" - - - - - - - OR - - - - - - - \"\n- If you don't know an answer, you can leave placeholders like \"[YOUR_ANSWER_HERE]\".\n- Don't use any special formatting, only plain text.\n- Reply in the same language as the inbound email."
              }
            ]
          }
        },
        "id": "814dddfc-e5c8-4b0d-9116-f002596c7ceb",
        "name": "Generate email reply",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "position": [
          0,
          0
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "content": "## Emailini bagla"
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -860,
          -200
        ],
        "id": "3f86d861-7b67-44b8-b5fa-242ba60fb457",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "content": "Emailleri neye gore kategorize edecegini cikart"
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -580,
          -200
        ],
        "id": "b8e91a2f-bdba-4957-b50c-60640857279b",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "Emaili yapay zeka yazsin"
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          0,
          -200
        ],
        "id": "9289ad64-15f0-436f-bc74-d66f63bdec23",
        "name": "Sticky Note2"
      }
    ],
    "pinData": {},
    "connections": {
      "Gmail Trigger": {
        "main": [
          [
            {
              "node": "Assess if message needs a reply",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Needs Reply": {
        "main": [
          [
            {
              "node": "Generate email reply",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "JSON Parser": {
        "ai_outputParser": [
          [
            {
              "node": "Assess if message needs a reply",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat": {
        "ai_languageModel": [
          [
            {
              "node": "Assess if message needs a reply",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Generate email reply",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Assess if message needs a reply": {
        "main": [
          [
            {
              "node": "If Needs Reply",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate email reply": {
        "main": [
          [
            {
              "node": "Gmail - Create Draft",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "687db7c5-0c42-4482-81b0-18527f6e3cb5",
    "meta": {
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "m93ZsCK66ZUq7eZE",
    "tags": []
  },
  {
    "name": "APOLLO SCRAPER",
    "nodes": [
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "I want you to come with apollo url just natural language query/prompt given by the user.\n\nExample of search url: https://app.apollo.io/#/people?sortAscending=false&sortByField=%5Bnone%5D&page=1&qKeywords=design%20agency&personLocations[]=new%20york&personTitles[]=ceo&personTitles[]=ceo%20founder&personTitles[]=owner&personTitles[]=partner&personTitles[]=founder&personTitles[]=co-founder\n\nThis URL describes a search for people that are\n\nLocated in the new york.\nHold the titles: Owner, CEO, Founder, or Partner.\nHave a keyword association with â€œdesign agencyâ€.\nThe query of the user was: Design agency in new york\n\nThese are the fields you can change:\n\npersonLocations[], Keywords, personTitles[]\n\nDo not add or change any other fields. Use the above template\n\nReturn your response in JSON using this format:\n\n{\"searchUrl\":\"search url goes here\"}"
              },
              {
                "content": "You're a helpful, smart sales assistant.",
                "role": "system"
              },
              {
                "content": "={{ $json['Hedef kitle bilgisi'] }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          -2180,
          -20
        ],
        "id": "3a28a86d-d65d-4001-852e-27e866146b37",
        "name": "Apollo URL Maker",
        "alwaysOutputData": true,
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          -2320,
          420
        ],
        "id": "377e68db-8127-4143-84fe-2b2bab990361",
        "name": "When clicking â€˜Test workflowâ€™"
      },
      {
        "parameters": {
          "url": "=https://emailverifier.reoon.com/api/v1/verify?email={{ $json.email }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -20,
          600
        ],
        "id": "55f705a4-8658-4532-8c03-b36638cf2301",
        "name": "HTTP Request"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -300,
          580
        ],
        "id": "d4053699-2ba0-47d0-bf2c-c4a91783661e",
        "name": "Loop Over Items"
      },
      {
        "parameters": {
          "amount": 1
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          200,
          600
        ],
        "id": "17938e90-340c-4fa8-bcf9-c97b8a4b3524",
        "name": "Wait",
        "webhookId": "e6640f46-cb11-4141-b538-17eacf894392"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "6283c780-c2a3-4511-a863-a9a622718c77",
                "leftValue": "={{ $json.status }}",
                "rightValue": "=valid",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -20,
          460
        ],
        "id": "30afe92a-f47d-4f53-80b6-60a555739eb3",
        "name": "If"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1brV-OqheHn50uX_c2E8Pa7746_WU8y0obgT1fGdqFws",
            "mode": "list",
            "cachedResultName": "OTOMASYONLAR - BURHAN KOCABIYIK",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1brV-OqheHn50uX_c2E8Pa7746_WU8y0obgT1fGdqFws/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Apollo Scraper",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1brV-OqheHn50uX_c2E8Pa7746_WU8y0obgT1fGdqFws/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "id": "={{ $('Apify Actors').item.json.id }}",
              "first_name": "={{ $('Apify Actors').item.json.first_name }}",
              "last_name": "={{ $('Apify Actors').item.json.last_name }}",
              "name": "={{ $('Apify Actors').item.json.name }}",
              "linkedin_url": "={{ $('Apify Actors').item.json.linkedin_url }}",
              "title": "={{ $('Apify Actors').item.json.title }}",
              "email_status": "={{ $json.status }}",
              "email": "={{ $('Apify Actors').item.json.email }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "first_name",
                "displayName": "first_name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "last_name",
                "displayName": "last_name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "name",
                "displayName": "name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "linkedin_url",
                "displayName": "linkedin_url",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "title",
                "displayName": "title",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "email_status",
                "displayName": "email_status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "email",
                "displayName": "email",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          200,
          260
        ],
        "id": "2b23018c-d755-4256-90f3-33c974ec220b",
        "name": "Google Sheets",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "8cw6xg8w0MZaVeCC",
            "name": "PROTOTIPAL"
          }
        }
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          200,
          440
        ],
        "id": "3103feaa-aa49-4642-bf34-d01f3a2198dd",
        "name": "No Operation, do nothing"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "0bf62e63-5785-4e95-8602-16b40c375a7c",
                "leftValue": "={{ $json.email }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -1380,
          -20
        ],
        "id": "f52d8695-ef17-49e4-bd78-55d4512f8b52",
        "name": "If1"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          -1340,
          200
        ],
        "id": "86c668de-5b11-4a43-a09f-46fec083a783",
        "name": "No Operation, do nothing1"
      },
      {
        "parameters": {
          "formTitle": "Apollo Scraper",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Hedef kitle bilgisi",
                "placeholder": "Ã–rn: Ankarada bulunan pet shoplar"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.formTrigger",
        "typeVersion": 2.2,
        "position": [
          -2380,
          -20
        ],
        "id": "e8f7eb50-b8bd-4a43-8bd6-3f6888d35f23",
        "name": "On form submission",
        "webhookId": "0f9ace87-bb90-4876-9274-ac6513ebe5df"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.apify.com/v2/acts/code_crafter~apollo-io-scraper/run-sync-get-dataset-items?token",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n    \"getPersonalEmails\": true,\n    \"getWorkEmails\": true,\n    \"totalRecords\": 500,\n    \"url\": \"{{ $json.message.content.searchUrl }}\"\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -1800,
          -20
        ],
        "id": "e6bd9abf-fbbf-4bca-9482-4ea1755c1ebe",
        "name": "Apify Actors"
      },
      {
        "parameters": {
          "content": "## Maksimum SayÄ±\n\nVarsayÄ±lan 500 kiÅŸidir. DeÄŸiÅŸtirmek iÃ§in modÃ¼l iÃ§erisinden istediÄŸiniz kadar arttÄ±rabilirsiniz.",
          "height": 420,
          "width": 260,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1880,
          -220
        ],
        "typeVersion": 1,
        "id": "de2f37b1-3d8c-4d0d-9c46-e7b9cd5d765b",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "7b5699d6-b9c2-4113-b2b8-d765829582fa",
                "name": "message.content.searchUrl",
                "value": "https://app.apollo.io/#/people?page=1&sortAscending=false&sortByField=%5Bnone%5D&personLocations[]=ke%C3%A7i%C3%B6ren&personLocations[]=%C3%A7ankaya&contactEmailStatusV2[]=verified&organizationNumEmployeesRanges[]=11%2C20",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -2100,
          420
        ],
        "id": "4e0f15e3-1549-4423-b61a-c6fc275eb23a",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1brV-OqheHn50uX_c2E8Pa7746_WU8y0obgT1fGdqFws",
            "mode": "list",
            "cachedResultName": "OTOMASYONLAR - BURHAN KOCABIYIK",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1brV-OqheHn50uX_c2E8Pa7746_WU8y0obgT1fGdqFws/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Apollo Scraper",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1brV-OqheHn50uX_c2E8Pa7746_WU8y0obgT1fGdqFws/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "id": "={{ $('Apify Actors').item.json.id }}",
              "first_name": "={{ $('Apify Actors').item.json.first_name }}",
              "last_name": "={{ $('Apify Actors').item.json.last_name }}",
              "name": "={{ $('Apify Actors').item.json.name }}",
              "linkedin_url": "={{ $('Apify Actors').item.json.linkedin_url }}",
              "title": "={{ $('Apify Actors').item.json.title }}",
              "email_status": "={{ $json.email_status }}",
              "email": "={{ $('Apify Actors').item.json.email }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "first_name",
                "displayName": "first_name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "last_name",
                "displayName": "last_name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "name",
                "displayName": "name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "linkedin_url",
                "displayName": "linkedin_url",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "title",
                "displayName": "title",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "email_status",
                "displayName": "email_status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "email",
                "displayName": "email",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          -1020,
          -40
        ],
        "id": "d5336b3e-1acf-477a-bc7c-11056043ed26",
        "name": "Google Sheets1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "8cw6xg8w0MZaVeCC",
            "name": "PROTOTIPAL"
          }
        }
      },
      {
        "parameters": {
          "content": "# NOT\n\n## Burda 3. parti bir siteden email doÄŸrulamasÄ± yapÄ±yordu. Bunun yerine Ai agenta apollodaki doÄŸrulanmÄ±ÅŸ mail filtresini seÃ§mesini sÃ¶yleyip burayÄ± otomasyondan silmek daha mantÄ±klÄ±. ** ",
          "height": 820,
          "width": 940
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -440,
          20
        ],
        "typeVersion": 1,
        "id": "5e3629d3-6240-4127-baca-4dfffdd7f6ef",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "content": "## Email Filtesi\n\nEmail adresi var mÄ± yok mu kontrol eder.",
          "height": 300,
          "width": 260,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1460,
          -160
        ],
        "typeVersion": 1,
        "id": "79034a6d-827a-4e9d-8699-99a05ee90536",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "content": "## Manuel URL verme (silinebilir)",
          "height": 280,
          "width": 540
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2420,
          340
        ],
        "typeVersion": 1,
        "id": "71b82803-ad4e-40e5-b859-34d7b9866f9f",
        "name": "Sticky Note3"
      },
      {
        "parameters": {
          "content": "## Agent her defasÄ±nda apolloda bulunan \"DoÄŸrulanmÄ±ÅŸ mail\" filtresini seÃ§sin",
          "height": 180,
          "width": 280
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -2200,
          -220
        ],
        "typeVersion": 1,
        "id": "0418a019-b58c-4a87-b2de-4ee3c85efc3b",
        "name": "Sticky Note4"
      }
    ],
    "pinData": {
      "Apify Actors": [
        {
          "json": {
            "id": "54a49f5474686934420e0d56",
            "first_name": "Hakan",
            "last_name": "Tasci",
            "name": "Hakan Tasci",
            "linkedin_url": "http://www.linkedin.com/in/hakan-tasci-989b4249",
            "title": "Finance Specialist",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/C4E03AQH8FFZTIOtMCA/profile-displayphoto-shrink_800_800/0/1524214300398?e=2147483647&v=beta&t=tfMoQN62xqLl6Qlga5pGZvumkawKHbkMsDulPQ5bOJ8",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Finance Specialist",
            "email": "htasci@ataermadencilik.com.tr",
            "organization_id": "6383285cfd6a7e0001d1fd8f",
            "employment_history": [
              {
                "_id": "65358e912c236f00017c6408",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "6383285cfd6a7e0001d1fd8f",
                "organization_name": "Ataer Madencilik A.Åž.",
                "raw_address": null,
                "start_date": "2021-03-01",
                "title": "Finance Specialist",
                "updated_at": null,
                "id": "65358e912c236f00017c6408",
                "key": "65358e912c236f00017c6408"
              },
              {
                "_id": "65358e912c236f00017c6409",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2018-02-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5d0a6114f651251e4e93ed7e",
                "organization_name": "OrtadoÄŸu Stratejik AraÅŸtÄ±rmalar Merkezi (ORSAM)",
                "raw_address": null,
                "start_date": "2014-04-01",
                "title": "KOORDINATOR",
                "updated_at": null,
                "id": "65358e912c236f00017c6409",
                "key": "65358e912c236f00017c6409"
              },
              {
                "_id": "65358e912c236f00017c640a",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2014-04-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "54a1298369702dc8411b5e01",
                "organization_name": "TEB",
                "raw_address": null,
                "start_date": "2008-04-01",
                "title": "manager",
                "updated_at": null,
                "id": "65358e912c236f00017c640a",
                "key": "65358e912c236f00017c640a"
              },
              {
                "_id": "65358e912c236f00017c640b",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2007-12-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "Garanti BankasÄ±",
                "raw_address": null,
                "start_date": "2001-02-01",
                "title": "PORTFOY YONETICISI-MUDUR",
                "updated_at": null,
                "id": "65358e912c236f00017c640b",
                "key": "65358e912c236f00017c640b"
              },
              {
                "_id": "65358e912c236f00017c640c",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2000-07-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "ESBANK",
                "raw_address": null,
                "start_date": "1997-04-01",
                "title": "Pazarlama Yoneticisi",
                "updated_at": null,
                "id": "65358e912c236f00017c640c",
                "key": "65358e912c236f00017c640c"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "6383285cfd6a7e0001d1fd8f",
              "name": "Ataer Madencilik A.Åž.",
              "website_url": "http://www.ataermadencilik.com.tr",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/ataer-madencilik-a-%c5%9f",
              "twitter_url": null,
              "facebook_url": null,
              "primary_phone": {},
              "languages": [],
              "alexa_ranking": null,
              "phone": null,
              "linkedin_uid": "71722316",
              "founded_year": 2020,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6828c224e011af00015d46fb/picture",
              "crunchbase_url": null,
              "primary_domain": "ataermadencilik.com.tr",
              "sic_codes": [
                "1011"
              ],
              "naics_codes": [
                "21211"
              ],
              "organization_headcount_six_month_growth": 0.04761904761904762,
              "organization_headcount_twelve_month_growth": 0.2941176470588235,
              "organization_headcount_twenty_four_month_growth": 0.04761904761904762,
              "industry": "mining & metals",
              "keywords": [
                "mining",
                "iron ore production",
                "sustainability",
                "enrichment facility",
                "pelletizing",
                "resource creation",
                "turkey mining",
                "corporate governance",
                "training programs",
                "job applications",
                "environmental impact",
                "corporate responsibility",
                "anti-corruption policy",
                "business ethics",
                "personal data protection",
                "human resources",
                "community engagement",
                "social responsibility",
                "investment projects",
                "mining technology",
                "energy efficiency",
                "economic growth",
                "local investment",
                "mining operations",
                "metal processing",
                "quality assurance",
                "client satisfaction",
                "competitive advantage",
                "employment opportunities",
                "workforce development",
                "stakeholder engagement",
                "supply chain management",
                "environmental sustainability",
                "natural resource management",
                "industry standards",
                "mineral exploration",
                "technology advancement",
                "collaboration",
                "mineral processing",
                "resource management",
                "mineral reserves",
                "project development",
                "production efficiency",
                "supply assurance",
                "infrastructure development",
                "risk management",
                "voluntary compliance",
                "community investment",
                "economic contributions",
                "environmental services",
                "renewables & environment",
                "logistics & supply chain"
              ],
              "estimated_num_employees": "16",
              "industries": [
                "mining & metals"
              ],
              "secondary_industries": [],
              "raw_address": "Ataer Madencilik - Ankara Ã–n Cebeci Mahallesi AydoÄŸmuÅŸ Sokak No:1, Ã‡ankaya/ANKARA, TR",
              "street_address": "1 Aydogmus Sokak",
              "city": "Ankara",
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06590"
            },
            "departments": [
              "master_finance"
            ],
            "subdepartments": [
              "finance"
            ],
            "seniority": "entry",
            "functions": [
              "finance"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "Ataer Madencilik A.Åž.",
            "organization_website_url": "http://www.ataermadencilik.com.tr",
            "organization_linkedin_url": "http://www.linkedin.com/company/ataer-madencilik-a-%c5%9f",
            "organization_founded_year": 2020,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6828c224e011af00015d46fb/picture",
            "organization_linkedin_uid": "71722316",
            "organization_primary_domain": "ataermadencilik.com.tr",
            "organization_phone": null,
            "organization_twitter_url": null,
            "organization_facebook_url": null,
            "industry": "mining & metals",
            "estimated_num_employees": "16",
            "keywords": "mining, iron ore production, sustainability, enrichment facility, pelletizing, resource creation, turkey mining, corporate governance, training programs, job applications, environmental impact, corporate responsibility, anti-corruption policy, business ethics, personal data protection, human resources, community engagement, social responsibility, investment projects, mining technology, energy efficiency, economic growth, local investment, mining operations, metal processing, quality assurance, client satisfaction, competitive advantage, employment opportunities, workforce development, stakeholder engagement, supply chain management, environmental sustainability, natural resource management, industry standards, mineral exploration, technology advancement, collaboration, mineral processing, resource management, mineral reserves, project development, production efficiency, supply assurance, infrastructure development, risk management, voluntary compliance, community investment, economic contributions, environmental services, renewables & environment, logistics & supply chain",
            "organization_seo_description": "Ataer Madencilik",
            "organization_short_description": "OYAK ÅŸirketlerinden ATAER Madencilik, yerli doÄŸal kaynaklarÄ±mÄ±zÄ±n azami seviyede deÄŸerlendirilerek ekonomiye kazandÄ±rÄ±lmasÄ± ve pelet ithalatÄ±na ayrÄ±lan kaynaÄŸÄ±n yurt iÃ§inde kalmasÄ± amacÄ±yla Malatya- HasanÃ§elebi'de kurulacak olan Demir Cevheri ZenginleÅŸtirme ve Peletleme Tesisi'ni hayata geÃ§irmek iÃ§in 2020 yÄ±lÄ± iÃ§inde Ã§alÄ±ÅŸmalara baÅŸladÄ±. \nMalatya-HasanÃ§elebi'deki demir maden ocaÄŸÄ±, peletleme tesisi ve diÄŸer yardÄ±mcÄ± tesis projeleri ile TÃ¼rkiye'nin ve OYAK Grubu'nun ikinci ve en bÃ¼yÃ¼k kapasiteli demir cevheri peletleme tesisi olacak.\nProje, OYAK'Ä±n sÃ¼rdÃ¼rÃ¼lebilir bÃ¼yÃ¼me vizyonu doÄŸrultusunda yeni kaynak yaratma hedefiyle TÃ¼rkiye'nin 6.2 milyon ton pelet ihtiyacÄ±nÄ±n 4 milyon tonunu tek baÅŸÄ±na karÅŸÄ±layarak, TÃ¼rkiye'nin en bÃ¼yÃ¼k demir madeni sahibi ve Ã¼reticisi konumunda olacak. AyrÄ±ca tesis ile Ã¼lkemizin demir cevheri Ã¼retiminin de yÃ¼zde 65'inin gerÃ§ekleÅŸtirilmesi planlanÄ±yor. \nATAER Madencilik, bu yatÄ±rÄ±mÄ± ile Ã¼lkemizin zengin yeraltÄ± kaynaklarÄ±nÄ± en verimli ÅŸekilde iÅŸleyerek Ã¼lkemiz ekonomisine katkÄ±da bulunmayÄ± hedefliyor.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "Google Analytics, Google Maps, Google Maps (Non Paid Users), Microsoft Office 365, Outlook, reCAPTCHA",
            "organization_raw_address": "Ataer Madencilik - Ankara Ã–n Cebeci Mahallesi AydoÄŸmuÅŸ Sokak No:1, Ã‡ankaya/ANKARA, TR",
            "organization_street_address": "1 Aydogmus Sokak",
            "organization_city": "Ankara",
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06590"
          }
        },
        {
          "json": {
            "id": "557145a17369645875761500",
            "first_name": "Dugan",
            "last_name": "Bilgisayar",
            "name": "Dugan Bilgisayar",
            "linkedin_url": "http://www.linkedin.com/in/dugan-bilgisayar-201108a9",
            "title": "YÃ¶netim Kurulu BaÅŸkanÄ±",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/C4E03AQG7k__DajFUkg/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1517525507017?e=2147483647&v=beta&t=SUBqQYRYG5Clw7Cw-cy4UyDrnlcak--MRB9vxdXwR0E",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "YÃ¶netim Kurulu BaÅŸkanÄ±",
            "email": "dugan@dugan.com.tr",
            "organization_id": "5cb400fbf65125689fadf252",
            "employment_history": [
              {
                "_id": "6858b3352c129d0001ab39d9",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5cb400fbf65125689fadf252",
                "organization_name": "Dugan Bilgisayar",
                "raw_address": null,
                "start_date": "1997-01-01",
                "title": "YÃ¶netim Kurulu BaÅŸkanÄ±",
                "updated_at": null,
                "id": "6858b3352c129d0001ab39d9",
                "key": "6858b3352c129d0001ab39d9"
              }
            ],
            "state": "Ankara",
            "city": "Ankara",
            "country": "Tuerkiye",
            "organization": {
              "id": "5cb400fbf65125689fadf252",
              "name": "Dugan Bilgisayar",
              "website_url": "http://www.dugan.com.tr",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/dugan-bilgisayar",
              "twitter_url": "https://twitter.com/duganbilgisayar",
              "facebook_url": "https://tr-tr.facebook.com/duganbilgisayarltdsti/",
              "primary_phone": {
                "number": "+90 312 435 8032",
                "source": "Scraped",
                "sanitized_number": "+903124358032"
              },
              "languages": [],
              "alexa_ranking": null,
              "phone": "+90 312 435 8032",
              "linkedin_uid": "18488397",
              "founded_year": 1997,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6752dd533207ff000162aa69/picture",
              "crunchbase_url": null,
              "primary_domain": "dugan.com.tr",
              "sic_codes": [
                "7371"
              ],
              "naics_codes": [
                "54151"
              ],
              "sanitized_phone": "+903124358032",
              "organization_headcount_six_month_growth": 0.1818181818181818,
              "organization_headcount_twelve_month_growth": 0.3,
              "organization_headcount_twenty_four_month_growth": -0.07142857142857142,
              "industry": "information technology & services",
              "keywords": [
                "network",
                "computer",
                "storage",
                "support",
                "security",
                "server",
                "maintenance",
                "it services & it consulting",
                "it consultancy",
                "system integration",
                "data storage solutions",
                "backup systems",
                "network infrastructure",
                "cabling solutions",
                "data center",
                "wifi networking",
                "cctv systems",
                "ip camera solutions",
                "corporate technology solutions",
                "server installation",
                "technical support services",
                "enterprise technology",
                "security management systems",
                "it maintenance services",
                "digital transformation",
                "telecommunication services",
                "cloud services",
                "information security",
                "hardware procurement",
                "software solutions",
                "internet security solutions",
                "remote access solutions",
                "data management",
                "equipment leasing",
                "project management",
                "training services",
                "penetration testing",
                "malware analysis",
                "network configuration",
                "technical training",
                "quality assurance",
                "end-user computing",
                "desktop solutions",
                "laptop systems",
                "support & maintenance",
                "system upgrades",
                "data archiving",
                "incident response",
                "regulatory compliance",
                "personal data protection",
                "risk management",
                "server management",
                "collaboration tools",
                "smart city solutions",
                "value-added services",
                "custom hardware solutions",
                "business continuity planning",
                "information technology & services",
                "it consulting",
                "b2b",
                "consulting",
                "management consulting",
                "computer & network security",
                "internet service providers",
                "cloud computing",
                "enterprise software",
                "enterprises",
                "computer software",
                "productivity"
              ],
              "estimated_num_employees": "14",
              "industries": [
                "information technology & services"
              ],
              "secondary_industries": [],
              "raw_address": "Mutlukent Mahallesi 1977. Sokak no:17, Dugan Bilgisayar, Ankara, ÃœmitkÃ¶y 06350, TR",
              "street_address": "17 1977. Sokak",
              "city": "Ankara",
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06800"
            },
            "departments": [],
            "subdepartments": [],
            "seniority": "entry",
            "functions": [],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "Dugan Bilgisayar",
            "organization_website_url": "http://www.dugan.com.tr",
            "organization_linkedin_url": "http://www.linkedin.com/company/dugan-bilgisayar",
            "organization_founded_year": 1997,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6752dd533207ff000162aa69/picture",
            "organization_linkedin_uid": "18488397",
            "organization_primary_domain": "dugan.com.tr",
            "organization_phone": "+90 312 435 8032",
            "organization_twitter_url": "https://twitter.com/duganbilgisayar",
            "organization_facebook_url": "https://tr-tr.facebook.com/duganbilgisayarltdsti/",
            "industry": "information technology & services",
            "estimated_num_employees": "14",
            "keywords": "network, computer, storage, support, security, server, maintenance, it services & it consulting, it consultancy, system integration, data storage solutions, backup systems, network infrastructure, cabling solutions, data center, wifi networking, cctv systems, ip camera solutions, corporate technology solutions, server installation, technical support services, enterprise technology, security management systems, it maintenance services, digital transformation, telecommunication services, cloud services, information security, hardware procurement, software solutions, internet security solutions, remote access solutions, data management, equipment leasing, project management, training services, penetration testing, malware analysis, network configuration, technical training, quality assurance, end-user computing, desktop solutions, laptop systems, support & maintenance, system upgrades, data archiving, incident response, regulatory compliance, personal data protection, risk management, server management, collaboration tools, smart city solutions, value-added services, custom hardware solutions, business continuity planning, information technology & services, it consulting, b2b, consulting, management consulting, computer & network security, internet service providers, cloud computing, enterprise software, enterprises, computer software, productivity",
            "organization_seo_description": "Dugan Bilgisayar",
            "organization_short_description": "1997 yÄ±lÄ±ndan beri sektÃ¶rde kazandÄ±ÄŸÄ± tecrÃ¼besini, 2002 yÄ±lÄ±nda Kurumsal SatÄ±ÅŸ ve SatÄ±ÅŸ SonrasÄ± Hizmet ÃœrÃ¼nlerini kapsayacak bir yapÄ±ya dÃ¶nÃ¼ÅŸtÃ¼rerek, geniÅŸ mÃ¼ÅŸteri pÃ¶rtfÃ¶yÃ¼ne sahip bir ÅŸirket olarak bugÃ¼nkÃ¼ seviyesine gelmiÅŸtir.\n\nDugan Bilgisayar, tecrÃ¼beli insan kaynaÄŸÄ± ve dinamizmini geliÅŸmiÅŸ teknoloji ve modern yÃ¶netim sistemleri ile buluÅŸturarak kazandÄ±ÄŸÄ± rekabet gÃ¼cÃ¼ ve geniÅŸ mÃ¼ÅŸteri kitlesine hizmet sunmaktadÄ±r. Bu doÄŸrultuda Dugan Bilgisayar Ã¶ncelikle markasÄ±nÄ± tescil ettirmiÅŸ daha sonra TSE ve ISO 9001 kalite belgelerini alarak sektÃ¶rdeki yerini daha gÃ¼Ã§lÃ¼ bir ÅŸekilde hissettirmiÅŸtir.\n\nDugan Bilgisayar, gÃ¼nÃ¼mÃ¼z rekabet ortamÄ±nda hizmetin oluÅŸturulmasÄ± ve sunulmasÄ± sÃ¼recinin kurumsal bir yapÄ± ile desteklendiÄŸi ÅŸirketlerin mÃ¼ÅŸteriler tarafÄ±ndan uzun vadeli, gÃ¼venilir bir iÅŸ ortaÄŸÄ± olarak tercih edildiÄŸi yaklaÅŸÄ±mÄ± benimsemektedir. Bu amaÃ§la bÃ¼nyesinde kurumsal boyutta dÃ¼zenlemeler gerÃ§ekleÅŸtirerek; kaliteyi, satÄ±ÅŸ Ã¶ncesi ve satÄ±ÅŸ sonrasÄ± hizmetlere kadar geniÅŸ bir perspektif ve bÃ¼tÃ¼nlÃ¼k iÃ§erisinde oluÅŸturmakta, Åžirket kaynaklarÄ±nÄ± bu anlayÄ±ÅŸa uygun olarak yÃ¶netmektedir.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "Bootstrap Framework, Google Font API, Google Maps, Google Maps (Non Paid Users), IoT, Microsoft Office 365, Mobile Friendly, Outlook",
            "organization_raw_address": "Mutlukent Mahallesi 1977. Sokak no:17, Dugan Bilgisayar, Ankara, ÃœmitkÃ¶y 06350, TR",
            "organization_street_address": "17 1977. Sokak",
            "organization_city": "Ankara",
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06800"
          }
        },
        {
          "json": {
            "id": "5f00438529b6a7000176dd77",
            "first_name": "Mustafa",
            "last_name": "Tas",
            "name": "Mustafa Tas",
            "linkedin_url": "http://www.linkedin.com/in/mfeyzitas",
            "title": "Full Stack Developer",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/C5603AQHJaKQIANxaGg/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1555788119384?e=2147483647&v=beta&t=wKAWwW7558uv0AEWtCQuTTKO5_KHhvxP1-FKEFlCCEg",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Full Stack Developer",
            "email": "mustafa.tas@forestall.io",
            "organization_id": "5f3ffe546073820001137621",
            "employment_history": [
              {
                "_id": "68591d974bd731000172fad5",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5f3ffe546073820001137621",
                "organization_name": "Forestall Security",
                "raw_address": null,
                "start_date": "2023-05-01",
                "title": "Full Stack Developer",
                "updated_at": null,
                "id": "68591d974bd731000172fad5",
                "key": "68591d974bd731000172fad5"
              },
              {
                "_id": "68591d974bd731000172fad7",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2018-08-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "55e7f813f3e5bb67bf0000e3",
                "organization_name": "Kodpit Teknoloji A.Åž.",
                "raw_address": null,
                "start_date": "2018-07-01",
                "title": "Intern",
                "updated_at": null,
                "id": "68591d974bd731000172fad7",
                "key": "68591d974bd731000172fad7"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "5f3ffe546073820001137621",
              "name": "Forestall Security",
              "website_url": "http://www.forestall.io",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/forestall-security",
              "twitter_url": "https://twitter.com/forestallio",
              "facebook_url": null,
              "primary_phone": {},
              "languages": [],
              "alexa_ranking": null,
              "phone": null,
              "linkedin_uid": "37486945",
              "founded_year": 2020,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/68547eef3de78900014ff07d/picture",
              "crunchbase_url": null,
              "primary_domain": "forestall.io",
              "sic_codes": [
                "7374"
              ],
              "naics_codes": [
                "54151"
              ],
              "organization_headcount_six_month_growth": -0.07692307692307693,
              "organization_headcount_twelve_month_growth": 0.09090909090909091,
              "organization_headcount_twenty_four_month_growth": 0.5,
              "industry": "computer & network security",
              "keywords": [
                "active directory",
                "security assessment",
                "adversary simulation",
                "vulnerability assessment",
                "penetration testing",
                "threat detection",
                "incident response",
                "siem assessment",
                "source code auditing",
                "privilege escalation",
                "lateral movement",
                "risk mitigation",
                "attack path analysis",
                "threat intelligence",
                "malicious macro detection",
                "document security",
                "real-time monitoring",
                "aws security assessment",
                "compromise assessment",
                "configuration weaknesses",
                "continuous monitoring",
                "change management",
                "user activity monitoring",
                "red teaming",
                "security posture improvement",
                "automated threat analysis",
                "cyber risk reduction",
                "security frameworks",
                "mitre att&ck",
                "proactive countermeasures",
                "advanced threat protection",
                "attack vector identification",
                "security configuration",
                "privileged account security",
                "malware protection",
                "user behavior analytics",
                "incident mitigation strategy",
                "certification services",
                "access control auditing",
                "security vulnerability management",
                "log analysis",
                "endpoint security",
                "network security solutions",
                "enterprise security solutions",
                "cybersecurity services",
                "data breach prevention",
                "it security compliance",
                "computer & network security",
                "information technology & services"
              ],
              "estimated_num_employees": "11",
              "industries": [
                "computer & network security"
              ],
              "secondary_industries": [],
              "raw_address": "Ankara, Teknopark Ankara, TR",
              "street_address": "No:1 2224. Caddesi",
              "city": null,
              "state": "Ankara",
              "country": "Tuerkiye",
              "postal_code": "06378"
            },
            "departments": [
              "master_engineering_technical",
              "master_information_technology"
            ],
            "subdepartments": [
              "software_development",
              "application_development"
            ],
            "seniority": "entry",
            "functions": [
              "engineering"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "Forestall Security",
            "organization_website_url": "http://www.forestall.io",
            "organization_linkedin_url": "http://www.linkedin.com/company/forestall-security",
            "organization_founded_year": 2020,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/68547eef3de78900014ff07d/picture",
            "organization_linkedin_uid": "37486945",
            "organization_primary_domain": "forestall.io",
            "organization_phone": null,
            "organization_twitter_url": "https://twitter.com/forestallio",
            "organization_facebook_url": null,
            "industry": "computer & network security",
            "estimated_num_employees": "11",
            "keywords": "active directory, security assessment, adversary simulation, vulnerability assessment, penetration testing, threat detection, incident response, siem assessment, source code auditing, privilege escalation, lateral movement, risk mitigation, attack path analysis, threat intelligence, malicious macro detection, document security, real-time monitoring, aws security assessment, compromise assessment, configuration weaknesses, continuous monitoring, change management, user activity monitoring, red teaming, security posture improvement, automated threat analysis, cyber risk reduction, security frameworks, mitre att&ck, proactive countermeasures, advanced threat protection, attack vector identification, security configuration, privileged account security, malware protection, user behavior analytics, incident mitigation strategy, certification services, access control auditing, security vulnerability management, log analysis, endpoint security, network security solutions, enterprise security solutions, cybersecurity services, data breach prevention, it security compliance, computer & network security, information technology & services",
            "organization_seo_description": "Forestall provides adversary-centric cybersecurity services and products to help organizations to fight emerging threats.",
            "organization_short_description": "Emerging Threats, Advanced Solutions",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "CloudFlare Hosting, Cloudflare DNS, DoubleClick, Google AdSense, Google Analytics, Google Tag Manager, Hotjar, Mobile Friendly, Outlook, Proofpoint, WordPress.org",
            "organization_raw_address": "Ankara, Teknopark Ankara, TR",
            "organization_street_address": "No:1 2224. Caddesi",
            "organization_city": null,
            "organization_state": "Ankara",
            "organization_country": "Tuerkiye",
            "organization_postal_code": "06378"
          }
        },
        {
          "json": {
            "id": "5f58607432bc810001237aa8",
            "first_name": "Halilibrahim",
            "last_name": "Aslan",
            "name": "Halilibrahim Aslan",
            "linkedin_url": "http://www.linkedin.com/in/halilibrahim-aslan-a35358147",
            "title": "Sales Specialist",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/D4D03AQExOKZ783pMzg/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1722801442282?e=2147483647&v=beta&t=rjjv_R4dsf_ARTAJxxfXLgQtd1P7ai9UC2OWIxMhub4",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "BG-TEK BiliÅŸim GÃ¼venlik Teknolojileri",
            "email": "ibrahim.aslan@coslat.com",
            "organization_id": "5fcbacdf2c6c1d0001a0a946",
            "employment_history": [
              {
                "_id": "686f3304c5ea740001c9146e",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "BG-Tek Bilgi GÃ¼venliÄŸi Teknolojileri",
                "raw_address": null,
                "start_date": "2022-05-01",
                "title": "Ankara Office Manager",
                "updated_at": null,
                "id": "686f3304c5ea740001c9146e",
                "key": "686f3304c5ea740001c9146e"
              },
              {
                "_id": "686f3304c5ea740001c9146f",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5fcbacdf2c6c1d0001a0a946",
                "organization_name": "PentestBX",
                "raw_address": null,
                "start_date": "2022-05-01",
                "title": "Sales Specialist",
                "updated_at": null,
                "id": "686f3304c5ea740001c9146f",
                "key": "686f3304c5ea740001c9146f"
              },
              {
                "_id": "686f3304c5ea740001c91470",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5e5808096c1394000167553f",
                "organization_name": "Coslat",
                "raw_address": null,
                "start_date": "2022-05-01",
                "title": "Ankara Office Manager",
                "updated_at": null,
                "id": "686f3304c5ea740001c91470",
                "key": "686f3304c5ea740001c91470"
              },
              {
                "_id": "686f3304c5ea740001c91472",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2022-05-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "BG-Tek Bilgi GÃ¼venliÄŸi Teknolojileri",
                "raw_address": null,
                "start_date": "2017-04-01",
                "title": "Sales Specialist",
                "updated_at": null,
                "id": "686f3304c5ea740001c91472",
                "key": "686f3304c5ea740001c91472"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "5fcbacdf2c6c1d0001a0a946",
              "name": "PentestBX",
              "website_url": "http://www.pentestbx.com",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/pentestbx",
              "twitter_url": null,
              "facebook_url": "https://www.facebook.com/people/Pentestbx/100091381759899/",
              "primary_phone": {
                "number": "+90 850 420 3650",
                "source": "Scraped",
                "sanitized_number": "+908504203650"
              },
              "languages": [],
              "alexa_ranking": null,
              "phone": "+90 850 420 3650",
              "linkedin_uid": "68692569",
              "founded_year": 2022,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/66dc2d109aacf300016daaf1/picture",
              "crunchbase_url": null,
              "primary_domain": "pentestbx.com",
              "sic_codes": [
                "7375"
              ],
              "naics_codes": [
                "54151"
              ],
              "sanitized_phone": "+908504203650",
              "organization_headcount_six_month_growth": -0.1333333333333333,
              "organization_headcount_twelve_month_growth": 0,
              "organization_headcount_twenty_four_month_growth": 0.4444444444444444,
              "industry": "computer & network security",
              "keywords": [
                "zafiyetyonetimi",
                "vulnerability assesstment",
                "vulnerability scanning",
                "sizmatesti",
                "cyber threat intelligence",
                "penetrasyon testi",
                "periyodiksizmatesti",
                "zafiyet taramasi",
                "vulnerability management",
                "web application scanning",
                "cybersecurity",
                "mailbox threat detection",
                "pentest",
                "siberguvenlik",
                "attack surface management",
                "vulnerability assessment",
                "penetration testing",
                "network security",
                "asset discovery",
                "automated security",
                "risk management",
                "malware detection",
                "phishing prevention",
                "cve tracking",
                "email security",
                "endpoint security",
                "data breach prevention",
                "security compliance",
                "owasp top 10",
                "network topology mapping",
                "account leak detection",
                "real-time monitoring",
                "security reporting",
                "cybersecurity threats",
                "spam filter testing",
                "unauthorized file sharing",
                "network vulnerabilities",
                "internal scanning",
                "external scanning",
                "credential scanning",
                "network shares",
                "user-friendly interface",
                "cybersecurity strategy",
                "it asset management",
                "proactive defense",
                "security posture improvement",
                "cost-effective cybersecurity",
                "continuous monitoring",
                "system vulnerabilities",
                "remediation prioritization",
                "incident updates",
                "cloud security assessment",
                "automatic vulnerability scanning",
                "deep scanning",
                "cyber incident response",
                "employee security training",
                "it resource optimization",
                "cybersecurity tools",
                "detailed reporting",
                "security audits",
                "computer & network security",
                "information technology & services"
              ],
              "estimated_num_employees": "12",
              "industries": [
                "computer & network security"
              ],
              "secondary_industries": [],
              "raw_address": "Sogukkuyu Mah. 1. Hurriyet Cad. No: 8 Ic KapÄ± No: 2 Osmangazi, Bursa, TR",
              "street_address": "8 1. HÃ¼rriyet Caddesi",
              "city": "Bursa",
              "state": "Bursa",
              "country": "TÃ¼rkiye",
              "postal_code": "16170"
            },
            "departments": [
              "master_sales"
            ],
            "subdepartments": [
              "sales"
            ],
            "seniority": "entry",
            "functions": [
              "sales"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "PentestBX",
            "organization_website_url": "http://www.pentestbx.com",
            "organization_linkedin_url": "http://www.linkedin.com/company/pentestbx",
            "organization_founded_year": 2022,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/66dc2d109aacf300016daaf1/picture",
            "organization_linkedin_uid": "68692569",
            "organization_primary_domain": "pentestbx.com",
            "organization_phone": "+90 850 420 3650",
            "organization_twitter_url": null,
            "organization_facebook_url": "https://www.facebook.com/people/Pentestbx/100091381759899/",
            "industry": "computer & network security",
            "estimated_num_employees": "12",
            "keywords": "zafiyetyonetimi, vulnerability assesstment, vulnerability scanning, sizmatesti, cyber threat intelligence, penetrasyon testi, periyodiksizmatesti, zafiyet taramasi, vulnerability management, web application scanning, cybersecurity, mailbox threat detection, pentest, siberguvenlik, attack surface management, vulnerability assessment, penetration testing, network security, asset discovery, automated security, risk management, malware detection, phishing prevention, cve tracking, email security, endpoint security, data breach prevention, security compliance, owasp top 10, network topology mapping, account leak detection, real-time monitoring, security reporting, cybersecurity threats, spam filter testing, unauthorized file sharing, network vulnerabilities, internal scanning, external scanning, credential scanning, network shares, user-friendly interface, cybersecurity strategy, it asset management, proactive defense, security posture improvement, cost-effective cybersecurity, continuous monitoring, system vulnerabilities, remediation prioritization, incident updates, cloud security assessment, automatic vulnerability scanning, deep scanning, cyber incident response, employee security training, it resource optimization, cybersecurity tools, detailed reporting, security audits, computer & network security, information technology & services",
            "organization_seo_description": "PentestBX offers advanced security software and penetration testing services to enhance your business cybersecurity.",
            "organization_short_description": "Pentestbx allows you to manage risks dynamically and cost-effectively. It makes the advantages of the security tests carried out once or twice a year. It monitors the changes and reports new findings instantly.\n\nAsset Discovery & Risk Identification\nContinuous Vulnerability Scanning\nReporting & Alerting",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "Apache, Bootstrap Framework, Django, DoubleClick, DoubleClick Conversion, Gmail, Google AdWords Conversion, Google Apps, Google Cloud Hosting, Google Dynamic Remarketing, Google Font API, Google Frontend (Webserver), Google Tag Manager, Hotjar, JivoSite, Linkedin Marketing Solutions, Mobile Friendly, Nginx, Ubuntu, WordPress.org, YouTube, reCAPTCHA",
            "organization_raw_address": "Sogukkuyu Mah. 1. Hurriyet Cad. No: 8 Ic KapÄ± No: 2 Osmangazi, Bursa, TR",
            "organization_street_address": "8 1. HÃ¼rriyet Caddesi",
            "organization_city": "Bursa",
            "organization_state": "Bursa",
            "organization_country": "TÃ¼rkiye",
            "organization_postal_code": "16170"
          }
        },
        {
          "json": {
            "id": "5ff04045ebbdc100012e8fb4",
            "first_name": "Firat",
            "last_name": "Oguz",
            "name": "Firat Oguz",
            "linkedin_url": "http://www.linkedin.com/in/f%c4%b1rat-oguz-815426199",
            "title": "Founder",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/D4D03AQGXkv6aGdlXdg/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1664724181128?e=2147483647&v=beta&t=rO7kHu2FRm2433hOWXP74MuIu4jIvrzdb5CRhfNWsuc",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Founder",
            "email": "firat@sihirdukkani.com",
            "organization_id": "5fcad347f8d7410001a642a9",
            "employment_history": [
              {
                "_id": "6870b071855c4500011594bb",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5fcad347f8d7410001a642a9",
                "organization_name": "Sihir DÃ¼kkanÄ±",
                "raw_address": null,
                "start_date": "2018-09-01",
                "title": "Founder",
                "updated_at": null,
                "id": "6870b071855c4500011594bb",
                "key": "6870b071855c4500011594bb"
              }
            ],
            "state": "Ankara",
            "city": "Ankara",
            "country": "Tuerkiye",
            "organization": {
              "id": "5fcad347f8d7410001a642a9",
              "name": "Sihir DÃ¼kkanÄ±",
              "website_url": "http://www.sihirdukkani.com",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/sihir-d%c3%bckkan%c4%b1",
              "twitter_url": null,
              "facebook_url": "https://www.facebook.com/profile.php",
              "primary_phone": {},
              "languages": [],
              "alexa_ranking": null,
              "phone": null,
              "linkedin_uid": "66621721",
              "founded_year": 2018,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/67109764694b420001ba7712/picture",
              "crunchbase_url": null,
              "primary_domain": "sihirdukkani.com",
              "sic_codes": [
                "5099"
              ],
              "organization_headcount_six_month_growth": -0.1428571428571428,
              "organization_headcount_twelve_month_growth": 0.2,
              "organization_headcount_twenty_four_month_growth": 0.5,
              "industry": "information technology & services",
              "keywords": [
                "harry potter",
                "wizarding world",
                "oyuncak",
                "ev dekorasyon",
                "ofiskirtasiye",
                "aksesuar",
                "eticaret",
                "hediyelik esya",
                "technology, information & internet",
                "collectibles",
                "accessories",
                "t-shirts",
                "sweatshirts",
                "posters",
                "puzzles",
                "funko pop",
                "stationery",
                "mugs",
                "gift items",
                "keychains",
                "jewelry",
                "decoration",
                "gryffindor",
                "slytherin",
                "ravenclaw",
                "hufflepuff",
                "backpacks",
                "notebooks",
                "night lights",
                "stickers",
                "decorative items",
                "clothing",
                "hats",
                "socks",
                "costumes",
                "bookmarks",
                "magazines",
                "character figurines",
                "maps",
                "house items",
                "puzzle boxes",
                "hiking bags",
                "enamel pins",
                "art prints",
                "children's games",
                "toys",
                "playsets",
                "home decor",
                "character dolls",
                "collectible cards",
                "art supplies",
                "themed gifts",
                "trivia games",
                "birthday gifts",
                "holiday decorations",
                "character wands",
                "information technology & services",
                "publishing",
                "media"
              ],
              "estimated_num_employees": "13",
              "industries": [
                "information technology & services"
              ],
              "secondary_industries": [],
              "raw_address": "Turan GÃ¼neÅŸ BulvarÄ±, Ã‡ankaya, Ankara 06550, TR",
              "street_address": "Turan Guenes Bulvari",
              "city": "Ankara",
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06550"
            },
            "departments": [
              "c_suite"
            ],
            "subdepartments": [
              "founder"
            ],
            "seniority": "founder",
            "functions": [
              "entrepreneurship"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "Sihir DÃ¼kkanÄ±",
            "organization_website_url": "http://www.sihirdukkani.com",
            "organization_linkedin_url": "http://www.linkedin.com/company/sihir-d%c3%bckkan%c4%b1",
            "organization_founded_year": 2018,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/67109764694b420001ba7712/picture",
            "organization_linkedin_uid": "66621721",
            "organization_primary_domain": "sihirdukkani.com",
            "organization_phone": null,
            "organization_twitter_url": null,
            "organization_facebook_url": "https://www.facebook.com/profile.php",
            "industry": "information technology & services",
            "estimated_num_employees": "13",
            "keywords": "harry potter, wizarding world, oyuncak, ev dekorasyon, ofiskirtasiye, aksesuar, eticaret, hediyelik esya, technology, information & internet, collectibles, accessories, t-shirts, sweatshirts, posters, puzzles, funko pop, stationery, mugs, gift items, keychains, jewelry, decoration, gryffindor, slytherin, ravenclaw, hufflepuff, backpacks, notebooks, night lights, stickers, decorative items, clothing, hats, socks, costumes, bookmarks, magazines, character figurines, maps, house items, puzzle boxes, hiking bags, enamel pins, art prints, children's games, toys, playsets, home decor, character dolls, collectible cards, art supplies, themed gifts, trivia games, birthday gifts, holiday decorations, character wands, information technology & services, publishing, media",
            "organization_seo_description": "Sihir DÃ¼kkanÄ± - TÃ¼m Harry Potter ÃœrÃ¼nleri Sihir DÃ¼kkanÄ± Sihir DÃ¼kkanÄ± - TÃ¼m Harry Potter ÃœrÃ¼nleri Sihir DÃ¼kkanÄ±",
            "organization_short_description": "As a Harry Potter&Wizarding World licensee, Sihir DÃ¼kkanÄ± Warner Bros. is a partner. It owns the full production, distribution, marketing and sales rights of the Harry Potter Brand. As a Global Licensee, it produces Harry Potter Licensed products and sells it at 20,000 points, both at home and abroad. As a Turkish company, we are happy to launch the most profitable and advantageous Collectible Product group in the Global market, as we have the most advantageous and reasonable production network in the world.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "Bootstrap Framework, CloudFlare Hosting, Cloudflare DNS, DoubleClick, DoubleClick Conversion, Facebook Custom Audiences, Facebook Login (Connect), Facebook Widget, Gmail, Google Apps, Google Dynamic Remarketing, Google Font API, Google Tag Manager, Mobile Friendly, Nginx, Woo Commerce, WordPress.org",
            "organization_raw_address": "Turan GÃ¼neÅŸ BulvarÄ±, Ã‡ankaya, Ankara 06550, TR",
            "organization_street_address": "Turan Guenes Bulvari",
            "organization_city": "Ankara",
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06550"
          }
        },
        {
          "json": {
            "id": "620602e61e515200010e754d",
            "first_name": "Berk",
            "last_name": "Atac",
            "name": "Berk Atac",
            "linkedin_url": "http://www.linkedin.com/in/berk-ata%c3%a7-35015989",
            "title": "Frontend Developer",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/D4D03AQF2Qj5rJXXe6Q/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1675440100512?e=2147483647&v=beta&t=cvi_HV7kydGSxjNq_NKMIozzpElG28WcEqRquz5I_uw",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Frontend Developer",
            "email": "batac@mobiversite.com",
            "organization_id": "56d8def1f3e5bb57d8001a22",
            "employment_history": [
              {
                "_id": "68708782e2c51f00011a35de",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "56d8def1f3e5bb57d8001a22",
                "organization_name": "Mobiversite",
                "raw_address": null,
                "start_date": "2022-08-01",
                "title": "Frontend Developer",
                "updated_at": null,
                "id": "68708782e2c51f00011a35de",
                "key": "68708782e2c51f00011a35de"
              },
              {
                "_id": "68708782e2c51f00011a35df",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2022-07-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "ACV Private Company",
                "raw_address": null,
                "start_date": "2022-01-01",
                "title": "Web Application Developer",
                "updated_at": null,
                "id": "68708782e2c51f00011a35df",
                "key": "68708782e2c51f00011a35df"
              },
              {
                "_id": "68708782e2c51f00011a35e0",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2022-01-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "66f79ec8b8a7640001d82a68",
                "organization_name": "KasabaWorks",
                "raw_address": null,
                "start_date": "2021-06-01",
                "title": "Web Developer",
                "updated_at": null,
                "id": "68708782e2c51f00011a35e0",
                "key": "68708782e2c51f00011a35e0"
              },
              {
                "_id": "68708782e2c51f00011a35e1",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2021-06-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "Kendi iÅŸim",
                "raw_address": null,
                "start_date": "2020-08-01",
                "title": "Freelance",
                "updated_at": null,
                "id": "68708782e2c51f00011a35e1",
                "key": "68708782e2c51f00011a35e1"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "56d8def1f3e5bb57d8001a22",
              "name": "Mobiversite",
              "website_url": "http://www.mobiversite.com",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/mobiversite",
              "twitter_url": null,
              "facebook_url": null,
              "primary_phone": {
                "number": "+90 850 305 0663",
                "source": "Account",
                "sanitized_number": "+908503050663"
              },
              "languages": [
                "English"
              ],
              "alexa_ranking": 548564,
              "phone": "+90 850 305 0663",
              "linkedin_uid": "10247898",
              "founded_year": 2015,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/687a5fe0a812c10001fa2ca9/picture",
              "crunchbase_url": null,
              "primary_domain": "mobiversite.com",
              "sic_codes": [
                "7375"
              ],
              "naics_codes": [
                "54151"
              ],
              "sanitized_phone": "+908503050663",
              "organization_headcount_six_month_growth": 0.1481481481481481,
              "organization_headcount_twelve_month_growth": 0.55,
              "organization_headcount_twenty_four_month_growth": 0.55,
              "industry": "information technology & services",
              "keywords": [
                "mobile application",
                "software development",
                "mobile app development",
                "ios development",
                "android development",
                "ai music app",
                "ai photo generator",
                "photo enhancement",
                "object removal",
                "background removal",
                "social media apps",
                "influencer marketing",
                "user-friendly design",
                "app localization",
                "user acquisition",
                "digital marketing",
                "campaign management",
                "mobile payment solutions",
                "cloud services",
                "backend development",
                "programming languages",
                "javascript frameworks",
                "native app features",
                "app store optimization",
                "mobile user engagement",
                "cross-platform applications",
                "photo editing tools",
                "custom wallpapers",
                "digital storytelling",
                "ai keyboard",
                "text assistant features",
                "video content creation",
                "remote work solutions",
                "e-learning apps",
                "online health apps",
                "applications for businesses",
                "digital wallets",
                "contactless payments",
                "millions of users",
                "user satisfaction",
                "app performance optimization",
                "mobile app analytics",
                "team collaboration tools",
                "augmented reality in apps",
                "realistic vocals processing",
                "mobile shopping solutions",
                "remote communication apps",
                "app discovery tactics",
                "community-driven apps",
                "future of mobile application",
                "mobile app trends",
                "internet",
                "information technology & services",
                "computer software",
                "mobile",
                "marketing & advertising",
                "cloud computing",
                "enterprise software",
                "enterprises",
                "b2b"
              ],
              "estimated_num_employees": "18",
              "industries": [
                "information technology & services"
              ],
              "secondary_industries": [],
              "raw_address": "Ankara Teknoloji GeliÅŸtirme BÃ¶lgesi, Cyberpark Tepe BinasÄ± No:5/Z14, Ankara, Ã‡ankaya 06800, TR",
              "street_address": "Bilkent Cyberpark",
              "city": "Ankara",
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06800"
            },
            "departments": [
              "master_engineering_technical",
              "master_information_technology"
            ],
            "subdepartments": [
              "engineering_technical",
              "software_development",
              "application_development"
            ],
            "seniority": "entry",
            "functions": [
              "engineering"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "Mobiversite",
            "organization_website_url": "http://www.mobiversite.com",
            "organization_linkedin_url": "http://www.linkedin.com/company/mobiversite",
            "organization_founded_year": 2015,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/687a5fe0a812c10001fa2ca9/picture",
            "organization_linkedin_uid": "10247898",
            "organization_primary_domain": "mobiversite.com",
            "organization_phone": "+90 850 305 0663",
            "organization_twitter_url": null,
            "organization_facebook_url": null,
            "industry": "information technology & services",
            "estimated_num_employees": "18",
            "keywords": "mobile application, software development, mobile app development, ios development, android development, ai music app, ai photo generator, photo enhancement, object removal, background removal, social media apps, influencer marketing, user-friendly design, app localization, user acquisition, digital marketing, campaign management, mobile payment solutions, cloud services, backend development, programming languages, javascript frameworks, native app features, app store optimization, mobile user engagement, cross-platform applications, photo editing tools, custom wallpapers, digital storytelling, ai keyboard, text assistant features, video content creation, remote work solutions, e-learning apps, online health apps, applications for businesses, digital wallets, contactless payments, millions of users, user satisfaction, app performance optimization, mobile app analytics, team collaboration tools, augmented reality in apps, realistic vocals processing, mobile shopping solutions, remote communication apps, app discovery tactics, community-driven apps, future of mobile application, mobile app trends, internet, information technology & services, computer software, mobile, marketing & advertising, cloud computing, enterprise software, enterprises, b2b",
            "organization_seo_description": "Native iOS and Android mobile apps are freshly made here in Mobiversite. We are an Ankara based mobile application development company in Bilkent Cyberpark. Working hard to make a better future for mobile users, we grow faster each year with more active users.",
            "organization_short_description": "Being here to make your life easier, we aim to go beyond the limits with our practical thinking in developing iOS and Android mobile applications to disclose the full potential of the power of mobile applications in various areas. Our mission in the digital world is finding solutions for everyone with innovation while making a path to success.\n\nMobile applications for your whatever needs are freshly developed here in Mobiversite! \n\nFor more information:\ninfo@mobiversite.com\n\nSky's the limit!",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "AI, Android, Basis, Gmail, Google Apps, Google Cloud Hosting, Google Play, Google Tag Manager, MailJet, Microsoft Office 365, Mobile Friendly, React Native, Unruly Media, Varnish, Wix",
            "organization_raw_address": "Ankara Teknoloji GeliÅŸtirme BÃ¶lgesi, Cyberpark Tepe BinasÄ± No:5/Z14, Ankara, Ã‡ankaya 06800, TR",
            "organization_street_address": "Bilkent Cyberpark",
            "organization_city": "Ankara",
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06800"
          }
        },
        {
          "json": {
            "id": "623c5d3b0099ea0001f47a03",
            "first_name": "Pinar",
            "last_name": "Yazdic",
            "name": "Pinar Yazdic",
            "linkedin_url": "http://www.linkedin.com/in/p%c4%b1nar-yazd%c4%b1%c3%a7-490138216",
            "title": "3D Artist / Co-Founder",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/D4D03AQEqbZuKVfipdQ/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1683192067634?e=2147483647&v=beta&t=O0Cd_t1L0DNYfrVrUofYaJiEuqbNfMIsJ9ivu0zfwp8",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Co-Founder @Oreon Studios",
            "email": "pinar@oreonstudios.com",
            "organization_id": "62b542f959f9300001d94081",
            "employment_history": [
              {
                "_id": "686e32a278bb9700011b991f",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "62b542f959f9300001d94081",
                "organization_name": "Oreon Studios",
                "raw_address": null,
                "start_date": "2022-04-01",
                "title": "3D Artist / Co-Founder",
                "updated_at": null,
                "id": "686e32a278bb9700011b991f",
                "key": "686e32a278bb9700011b991f"
              },
              {
                "_id": "686e32a278bb9700011b9920",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2022-04-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5e57a9ea4ab14d00019aed09",
                "organization_name": "MagicLab Game Technologies",
                "raw_address": null,
                "start_date": "2020-04-01",
                "title": "Game Designer /3D Artist",
                "updated_at": null,
                "id": "686e32a278bb9700011b9920",
                "key": "686e32a278bb9700011b9920"
              },
              {
                "_id": "686e32a278bb9700011b9921",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2020-03-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "6547c29bbd105b0001bcc810",
                "organization_name": "Kahraman MimarlÄ±k",
                "raw_address": null,
                "start_date": "2019-03-01",
                "title": "Architect",
                "updated_at": null,
                "id": "686e32a278bb9700011b9921",
                "key": "686e32a278bb9700011b9921"
              },
              {
                "_id": "686e32a278bb9700011b9922",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2017-09-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "Orta DoÄŸu Teknik Ãœniversitesi",
                "raw_address": null,
                "start_date": "2014-10-01",
                "title": "Research Assistant",
                "updated_at": null,
                "id": "686e32a278bb9700011b9922",
                "key": "686e32a278bb9700011b9922"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "62b542f959f9300001d94081",
              "name": "Oreon Studios",
              "website_url": "http://www.oreonstudios.com",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/oreon-studios",
              "twitter_url": null,
              "facebook_url": null,
              "primary_phone": {},
              "languages": [],
              "alexa_ranking": null,
              "phone": null,
              "linkedin_uid": "80548436",
              "founded_year": null,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6847e158d3e56f000103f018/picture",
              "crunchbase_url": null,
              "primary_domain": "oreonstudios.com",
              "sic_codes": [
                "7375"
              ],
              "naics_codes": [
                "519"
              ],
              "organization_headcount_six_month_growth": 0.4,
              "organization_headcount_twelve_month_growth": 0.5555555555555556,
              "organization_headcount_twenty_four_month_growth": 0.07692307692307693,
              "industry": "computer games",
              "keywords": [
                "mobile gaming apps",
                "game development",
                "mobile games",
                "hypercasual games",
                "hhybridcasual games",
                "game publishing",
                "ios games",
                "android games",
                "3d game artists",
                "game designers",
                "unity engine",
                "c#",
                "game prototyping",
                "casual gaming",
                "games with high downloads",
                "data privacy",
                "user data protection",
                "user experience",
                "mobile game industry",
                "game optimization",
                "in-game analytics",
                "performance tracking",
                "advertising partnerships",
                "multiplatform gaming",
                "game monetization",
                "personalized advertising",
                "game assets",
                "game features",
                "collaborative development",
                "teamwork",
                "game creativity",
                "energy games",
                "downloadable games",
                "user interaction",
                "market research",
                "mobile platform",
                "game security",
                "freemium games",
                "fruitful communication",
                "problem solving",
                "customer engagement",
                "fast-paced environment",
                "flexible work schedule",
                "game testing",
                "game technical optimization",
                "animation & design",
                "multimedia production",
                "digital graphics",
                "interactive entertainment",
                "game mechanics",
                "computer games",
                "games",
                "consumers",
                "computer software",
                "information technology & services",
                "internet",
                "ux"
              ],
              "estimated_num_employees": "8",
              "industries": [
                "computer games"
              ],
              "secondary_industries": [],
              "raw_address": "Ankara, TR",
              "street_address": "",
              "city": "Ankara",
              "state": "Ankara Province",
              "country": "Turkey",
              "postal_code": null
            },
            "departments": [
              "c_suite"
            ],
            "subdepartments": [
              "founder"
            ],
            "seniority": "founder",
            "functions": [
              "entrepreneurship"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": true,
            "personal_emails": [],
            "organization_name": "Oreon Studios",
            "organization_website_url": "http://www.oreonstudios.com",
            "organization_linkedin_url": "http://www.linkedin.com/company/oreon-studios",
            "organization_founded_year": null,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6847e158d3e56f000103f018/picture",
            "organization_linkedin_uid": "80548436",
            "organization_primary_domain": "oreonstudios.com",
            "organization_phone": null,
            "organization_twitter_url": null,
            "organization_facebook_url": null,
            "industry": "computer games",
            "estimated_num_employees": "8",
            "keywords": "mobile gaming apps, game development, mobile games, hypercasual games, hhybridcasual games, game publishing, ios games, android games, 3d game artists, game designers, unity engine, c#, game prototyping, casual gaming, games with high downloads, data privacy, user data protection, user experience, mobile game industry, game optimization, in-game analytics, performance tracking, advertising partnerships, multiplatform gaming, game monetization, personalized advertising, game assets, game features, collaborative development, teamwork, game creativity, energy games, downloadable games, user interaction, market research, mobile platform, game security, freemium games, fruitful communication, problem solving, customer engagement, fast-paced environment, flexible work schedule, game testing, game technical optimization, animation & design, multimedia production, digital graphics, interactive entertainment, game mechanics, computer games, games, consumers, computer software, information technology & services, internet, ux",
            "organization_seo_description": "",
            "organization_short_description": "We make all kinds of games.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "AI, Discord, Gmail, Google Apps, Google Font API, Google Play, Mobile Friendly, Render, Reviews, Unruly Media, WordPress.org",
            "organization_raw_address": "Ankara, TR",
            "organization_street_address": "",
            "organization_city": "Ankara",
            "organization_state": "Ankara Province",
            "organization_country": "Turkey",
            "organization_postal_code": null
          }
        },
        {
          "json": {
            "id": "62621752a4b7fd00013db1ee",
            "first_name": "Adem",
            "last_name": "Toprak",
            "name": "Adem Toprak",
            "linkedin_url": "http://www.linkedin.com/in/adem-toprak-2b1b83231",
            "title": "International Business Development Officer",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/D4D03AQGY0CSlQqIFPQ/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1668172271121?e=2147483647&v=beta&t=DklGiTMIJcJFHgiOm91IYS6ZHT-LXEAC-7NJasZwpU4",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Stenkim Chemicals Inc. ÅŸirketinde International Business Development Officer",
            "email": "adem.toprak@stenkim.com.tr",
            "organization_id": "5e57a95b289546000159c54e",
            "employment_history": [
              {
                "_id": "6873b38c9c5c0a0001ac788c",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5e57a95b289546000159c54e",
                "organization_name": "Stenkim YapÄ± KimyasallarÄ±",
                "raw_address": null,
                "start_date": "2019-06-01",
                "title": "International Business Development Officer",
                "updated_at": null,
                "id": "6873b38c9c5c0a0001ac788c",
                "key": "6873b38c9c5c0a0001ac788c"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "5e57a95b289546000159c54e",
              "name": "Stenkim Construction Chemicals",
              "website_url": "http://www.stenkim.com.tr",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/stenkim",
              "twitter_url": null,
              "facebook_url": "https://www.facebook.com/Stenkim-Kimyasal-Maddeler-Sanayi-ve-Ticaret-A%C5%9E-702645663185719/",
              "primary_phone": {},
              "languages": [],
              "alexa_ranking": null,
              "phone": null,
              "linkedin_uid": "28568548",
              "founded_year": 1986,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6736e722a95fad00018be8ee/picture",
              "crunchbase_url": null,
              "primary_domain": "stenkim.com.tr",
              "sic_codes": [
                "2899"
              ],
              "naics_codes": [
                "32551"
              ],
              "organization_headcount_six_month_growth": 0.25,
              "organization_headcount_twelve_month_growth": 0.25,
              "organization_headcount_twenty_four_month_growth": 0.5,
              "industry": "building materials",
              "keywords": [
                "zemin kaplama malzemeleri",
                "beton katki malzemeleri",
                "beton kuer malzemeleri",
                "beton tamir malzemeleri",
                "derz dolgu malzemeleri",
                "koruyucu boya ve kaplamalar",
                "su izolasyon malzemeleri",
                "su ve yag itici malzemeler",
                "polikarboksilatlar",
                "epoksi",
                "poliueretan",
                "bituem",
                "wholesale building materials",
                "floor coating",
                "epoxy based",
                "polyurethane products",
                "surface primers",
                "joint sealants",
                "crack repair",
                "waterproofing",
                "concrete additives",
                "decorative flooring",
                "high durability",
                "chemical resistance",
                "self-leveling",
                "indoor coatings",
                "outdoor coatings",
                "sports flooring",
                "industrial flooring",
                "residential flooring",
                "protection coatings",
                "road marking paints",
                "epoxy sealants",
                "antimicrobial coatings",
                "construction chemicals",
                "construction adhesives",
                "surface preparation",
                "aesthetic coatings",
                "environmentally friendly",
                "sustainable construction",
                "high-performance materials",
                "polycarboxylate",
                "thixotropic coatings",
                "hygienic surfaces",
                "scratch resistance",
                "moisture barrier",
                "fume building",
                "fire-resistant materials",
                "polyurethane sealants",
                "injectable resins",
                "epoxy coatings",
                "pigmented coatings",
                "enhanced slip resistance",
                "chemical resistant coatings",
                "rust prevention",
                "acrylic sealers",
                "protective sealants",
                "weatherproofing",
                "freeze-resistant",
                "anti-uv coatings",
                "superplasticizers"
              ],
              "estimated_num_employees": "12",
              "industries": [
                "building materials"
              ],
              "secondary_industries": [],
              "raw_address": "Portakal Ã‡iÃ§eÄŸi Sokak, Ansera Ä°ÅŸ Merkezi, Ã‡ankaya, Ankara 06690, TR",
              "street_address": "Portakal Cicegi Sokak",
              "city": "Ankara",
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06690"
            },
            "departments": [
              "master_sales"
            ],
            "subdepartments": [
              "business_development"
            ],
            "seniority": "entry",
            "functions": [
              "business_development"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": true,
            "personal_emails": [],
            "organization_name": "Stenkim Construction Chemicals",
            "organization_website_url": "http://www.stenkim.com.tr",
            "organization_linkedin_url": "http://www.linkedin.com/company/stenkim",
            "organization_founded_year": 1986,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6736e722a95fad00018be8ee/picture",
            "organization_linkedin_uid": "28568548",
            "organization_primary_domain": "stenkim.com.tr",
            "organization_phone": null,
            "organization_twitter_url": null,
            "organization_facebook_url": "https://www.facebook.com/Stenkim-Kimyasal-Maddeler-Sanayi-ve-Ticaret-A%C5%9E-702645663185719/",
            "industry": "building materials",
            "estimated_num_employees": "12",
            "keywords": "zemin kaplama malzemeleri, beton katki malzemeleri, beton kuer malzemeleri, beton tamir malzemeleri, derz dolgu malzemeleri, koruyucu boya ve kaplamalar, su izolasyon malzemeleri, su ve yag itici malzemeler, polikarboksilatlar, epoksi, poliueretan, bituem, wholesale building materials, floor coating, epoxy based, polyurethane products, surface primers, joint sealants, crack repair, waterproofing, concrete additives, decorative flooring, high durability, chemical resistance, self-leveling, indoor coatings, outdoor coatings, sports flooring, industrial flooring, residential flooring, protection coatings, road marking paints, epoxy sealants, antimicrobial coatings, construction chemicals, construction adhesives, surface preparation, aesthetic coatings, environmentally friendly, sustainable construction, high-performance materials, polycarboxylate, thixotropic coatings, hygienic surfaces, scratch resistance, moisture barrier, fume building, fire-resistant materials, polyurethane sealants, injectable resins, epoxy coatings, pigmented coatings, enhanced slip resistance, chemical resistant coatings, rust prevention, acrylic sealers, protective sealants, weatherproofing, freeze-resistant, anti-uv coatings, superplasticizers",
            "organization_seo_description": "",
            "organization_short_description": "Stenkim was established in 1986 and our company specializes about construction chemeicals. We are a Turkish company and we are proud to be the first manufacture and still the sole producer of many products in Turkey. Stenkim has kept at the forefront of R&D investments and R&D activities.\n\nOur R&D activities, new product designs and quality control processes emerge in our 600 m2 laborotary which is well equipped with high-tech and special devices. Stenkim has wide range of produciton capacity with own Know-How and Turkish engineers which are specialized about construction chemicals. Our products from raw material stage to the final product which became kept under constant supervision of our expert staff, therby we provide to achieve the desired quality of the products with own high production capacity and wide range of product.\n\nStenkim provides solutions for large-scale and prestigious projects in domestic market and 24 different countries with innovative and perfectionist approches, high production capacity and product variety.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "ASP.NET, Acumatica, Bootstrap Framework, Google Analytics, Microsoft-IIS, Mobile Friendly",
            "organization_raw_address": "Portakal Ã‡iÃ§eÄŸi Sokak, Ansera Ä°ÅŸ Merkezi, Ã‡ankaya, Ankara 06690, TR",
            "organization_street_address": "Portakal Cicegi Sokak",
            "organization_city": "Ankara",
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06690"
          }
        },
        {
          "json": {
            "id": "635aa455524fe400011555ce",
            "first_name": "Idil",
            "last_name": "Akgoez",
            "name": "Idil Akgoez",
            "linkedin_url": "http://www.linkedin.com/in/idil-akg%c3%b6z",
            "title": "Ä°dari ve Mali Ä°ÅŸler MÃ¼dÃ¼rÃ¼",
            "email_status": "verified",
            "photo_url": "https://static.licdn.com/aero-v1/sc/h/9c8pery4andzj6ohjkjp54ma2",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Ä°dari ve Mali Ä°ÅŸler MÃ¼dÃ¼rÃ¼",
            "email": "idil.akgoez@simofis.com.tr",
            "organization_id": "5da3728e205a3200011dd007",
            "employment_history": [
              {
                "_id": "68714d75491e51000137aff0",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5da3728e205a3200011dd007",
                "organization_name": "Simofis MÃ¼hendislik A.Åž.",
                "raw_address": null,
                "start_date": "2023-01-01",
                "title": "Ä°dari ve Mali Ä°ÅŸler MÃ¼dÃ¼rÃ¼",
                "updated_at": null,
                "id": "68714d75491e51000137aff0",
                "key": "68714d75491e51000137aff0"
              },
              {
                "_id": "68714d75491e51000137aff1",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2023-01-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5da3728e205a3200011dd007",
                "organization_name": "Simofis MÃ¼hendislik A.Åž.",
                "raw_address": null,
                "start_date": "2019-05-01",
                "title": "Ä°dari ve Mali Ä°ÅŸler Sorumlusu",
                "updated_at": null,
                "id": "68714d75491e51000137aff1",
                "key": "68714d75491e51000137aff1"
              },
              {
                "_id": "68714d75491e51000137aff2",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2015-03-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "Supercom BiliÅŸim",
                "raw_address": null,
                "start_date": "2013-02-01",
                "title": "Kurumsal MÃ¼ÅŸteri Temsilcisi",
                "updated_at": null,
                "id": "68714d75491e51000137aff2",
                "key": "68714d75491e51000137aff2"
              },
              {
                "_id": "68714d75491e51000137aff3",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2010-09-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5e56d68b1501e50001ec1cc7",
                "organization_name": "Allianz TÃ¼rkiye",
                "raw_address": null,
                "start_date": "2008-09-01",
                "title": "Finansal DanÄ±ÅŸman",
                "updated_at": null,
                "id": "68714d75491e51000137aff3",
                "key": "68714d75491e51000137aff3"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "5da3728e205a3200011dd007",
              "name": "Simofis MÃ¼hendislik",
              "website_url": "http://www.simofis.com.tr",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/simofis",
              "twitter_url": null,
              "facebook_url": null,
              "primary_phone": {
                "number": "+90 312 514 8183",
                "source": "Scraped",
                "sanitized_number": "+903125148183"
              },
              "languages": [],
              "alexa_ranking": null,
              "phone": "+90 312 514 8183",
              "linkedin_uid": "35467067",
              "founded_year": 2018,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/682a3ade5a7920000109424b/picture",
              "crunchbase_url": null,
              "primary_domain": "simofis.com.tr",
              "sic_codes": [
                "8731"
              ],
              "naics_codes": [
                "54133"
              ],
              "sanitized_phone": "+903125148183",
              "organization_headcount_six_month_growth": 0.625,
              "organization_headcount_twelve_month_growth": 0.8571428571428571,
              "organization_headcount_twenty_four_month_growth": 0.08333333333333333,
              "industry": "information technology & services",
              "keywords": [
                "simcenter floefd",
                "simcenter prescan",
                "simcenter 3d",
                "simcenter motorsolve",
                "simcenter magnet",
                "proje",
                "simcenter flomaster",
                "simcenter speed",
                "simuelasyon",
                "simcenter amesim",
                "muehendislik",
                "engineering services",
                "cfd simulation",
                "system simulation",
                "thermal analysis",
                "electromagnetic simulation",
                "mechanical system modeling",
                "modeling software",
                "design optimization",
                "prototyping tools",
                "digital twin technology",
                "multi-domain simulation",
                "engine analysis",
                "fluid dynamics",
                "electrical system modeling",
                "1d simulation",
                "2d & 3d modeling",
                "performance testing",
                "automation software",
                "control systems",
                "thermal management solutions",
                "hydraulic system analysis",
                "integration with cad",
                "performance validation",
                "mechatronic systems",
                "quick problem solving",
                "reliability engineering",
                "material selection",
                "testing procedures",
                "simulation efficiency",
                "iot integration",
                "design validation",
                "data-driven insights",
                "parametric studies",
                "transient analysis",
                "dynamic simulations",
                "robust design",
                "emc testing tools",
                "thermal conductivity testing",
                "stress analysis",
                "structural dynamics",
                "thermal modeling",
                "embedded systems simulation",
                "real-time analysis",
                "energy management systems",
                "software development",
                "motor design software",
                "robust optimization",
                "integrated design systems",
                "user-friendly interface",
                "advanced analytics",
                "cross-discipline collaboration",
                "information technology & services"
              ],
              "estimated_num_employees": "9",
              "industries": [
                "information technology & services"
              ],
              "secondary_industries": [],
              "raw_address": "Mevlana BulvarÄ± (Konya Yolu Ãœzeri), Ege Plaza No:182/B Kat:5 No:20, Ankara, Ã‡ankaya 06520, TR",
              "street_address": "182B Mevlana Bulvari",
              "city": "Ankara",
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06530"
            },
            "departments": [],
            "subdepartments": [],
            "seniority": "entry",
            "functions": [],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "Simofis MÃ¼hendislik",
            "organization_website_url": "http://www.simofis.com.tr",
            "organization_linkedin_url": "http://www.linkedin.com/company/simofis",
            "organization_founded_year": 2018,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/682a3ade5a7920000109424b/picture",
            "organization_linkedin_uid": "35467067",
            "organization_primary_domain": "simofis.com.tr",
            "organization_phone": "+90 312 514 8183",
            "organization_twitter_url": null,
            "organization_facebook_url": null,
            "industry": "information technology & services",
            "estimated_num_employees": "9",
            "keywords": "simcenter floefd, simcenter prescan, simcenter 3d, simcenter motorsolve, simcenter magnet, proje, simcenter flomaster, simcenter speed, simuelasyon, simcenter amesim, muehendislik, engineering services, cfd simulation, system simulation, thermal analysis, electromagnetic simulation, mechanical system modeling, modeling software, design optimization, prototyping tools, digital twin technology, multi-domain simulation, engine analysis, fluid dynamics, electrical system modeling, 1d simulation, 2d & 3d modeling, performance testing, automation software, control systems, thermal management solutions, hydraulic system analysis, integration with cad, performance validation, mechatronic systems, quick problem solving, reliability engineering, material selection, testing procedures, simulation efficiency, iot integration, design validation, data-driven insights, parametric studies, transient analysis, dynamic simulations, robust design, emc testing tools, thermal conductivity testing, stress analysis, structural dynamics, thermal modeling, embedded systems simulation, real-time analysis, energy management systems, software development, motor design software, robust optimization, integrated design systems, user-friendly interface, advanced analytics, cross-discipline collaboration, information technology & services",
            "organization_seo_description": "",
            "organization_short_description": "Siemens PLM helps companies to develop innovative products and processes for the digitalisation era. Simofis provides Siemens PLM products and services to help its clients to achieve their goals. \n\nOur aim is to add new expertise and solutions to our portfolio and able to provide expert services internationally.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "CloudFlare Hosting, Cloudflare DNS, Google Font API, Google Tag Manager, Mobile Friendly, Nginx, Outlook",
            "organization_raw_address": "Mevlana BulvarÄ± (Konya Yolu Ãœzeri), Ege Plaza No:182/B Kat:5 No:20, Ankara, Ã‡ankaya 06520, TR",
            "organization_street_address": "182B Mevlana Bulvari",
            "organization_city": "Ankara",
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06530"
          }
        },
        {
          "json": {
            "id": "63a983e9ea884200016328bf",
            "first_name": "Genco",
            "last_name": "Percin",
            "name": "Genco Percin",
            "linkedin_url": "http://www.linkedin.com/in/gencopercin",
            "title": "Junior Finance Specialist",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/D4D03AQHQv28eKZgr6w/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1727097580766?e=2147483647&v=beta&t=bsf99EjuZYXMHeNpNe94i9OCx0_SP8cE8QbHmbxY4Xs",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Junior Finance Specialist",
            "email": "genco.percin@misscat.co",
            "organization_id": "5a9e92dfa6da98d9356d00b5",
            "employment_history": [
              {
                "_id": "6858e834e7028800014efa94",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5a9e92dfa6da98d9356d00b5",
                "organization_name": "MissCat Digital",
                "raw_address": null,
                "start_date": "2024-09-01",
                "title": "Junior Finance Specialist",
                "updated_at": null,
                "id": "6858e834e7028800014efa94",
                "key": "6858e834e7028800014efa94"
              },
              {
                "_id": "6858e834e7028800014efa95",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2024-09-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "640305e0c8e7640001658198",
                "organization_name": "Arel Ã‡evre YatÄ±rÄ±mlarÄ± Enerji ve Elektrik Ãœretimi A.Åž.",
                "raw_address": null,
                "start_date": "2024-03-01",
                "title": "Purchasing Assistant",
                "updated_at": null,
                "id": "6858e834e7028800014efa95",
                "key": "6858e834e7028800014efa95"
              },
              {
                "_id": "6858e834e7028800014efa96",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2023-08-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "618257587ce5c600a4e05ec6",
                "organization_name": "IOM - UN Migration",
                "raw_address": null,
                "start_date": "2022-11-01",
                "title": "Immigration and Border Governance Intern",
                "updated_at": null,
                "id": "6858e834e7028800014efa96",
                "key": "6858e834e7028800014efa96"
              },
              {
                "_id": "6858e834e7028800014efa97",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2022-09-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "55f983c0f3e5bb23b5000c68",
                "organization_name": "Ankara BÃ¼yÃ¼kÅŸehir Belediyesi",
                "raw_address": null,
                "start_date": "2022-08-01",
                "title": "DÄ±ÅŸ Ä°liÅŸkiler Birimi/ Foreign Relations Department",
                "updated_at": null,
                "id": "6858e834e7028800014efa97",
                "key": "6858e834e7028800014efa97"
              },
              {
                "_id": "6858e834e7028800014efa98",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2022-02-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5d0a058ef651258594f38387",
                "organization_name": "WYG TÃ¼rkiye",
                "raw_address": null,
                "start_date": "2022-01-01",
                "title": "Intern",
                "updated_at": null,
                "id": "6858e834e7028800014efa98",
                "key": "6858e834e7028800014efa98"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "5a9e92dfa6da98d9356d00b5",
              "name": "MissCat Digital",
              "website_url": "http://www.misscat.co",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/misscat-digital",
              "twitter_url": null,
              "facebook_url": null,
              "primary_phone": {
                "number": "+90 555 802 1234",
                "source": "Scraped",
                "sanitized_number": "+905558021234"
              },
              "languages": [],
              "alexa_ranking": null,
              "phone": "+90 555 802 1234",
              "linkedin_uid": "17876664",
              "founded_year": 2016,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/68441a3738f4830001c2ada1/picture",
              "crunchbase_url": null,
              "primary_domain": "misscat.co",
              "sic_codes": [
                "7375"
              ],
              "naics_codes": [
                "54151"
              ],
              "sanitized_phone": "+905558021234",
              "organization_headcount_six_month_growth": 0.05555555555555555,
              "organization_headcount_twelve_month_growth": 0.2666666666666667,
              "organization_headcount_twenty_four_month_growth": 2.166666666666667,
              "industry": "telecommunications",
              "keywords": [
                "online marketing",
                "mobile marketing",
                "vas",
                "digital product management",
                "marketing & advertising"
              ],
              "estimated_num_employees": "8",
              "industries": [
                "telecommunications"
              ],
              "secondary_industries": [],
              "raw_address": "Levent 199, Istanbul, Levent 34330, TR",
              "street_address": "18/1 Levent Caddesi",
              "city": "Istanbul",
              "state": "Istanbul",
              "country": "Turkey",
              "postal_code": "34330"
            },
            "departments": [
              "master_finance"
            ],
            "subdepartments": [
              "finance"
            ],
            "seniority": "entry",
            "functions": [
              "finance"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "MissCat Digital",
            "organization_website_url": "http://www.misscat.co",
            "organization_linkedin_url": "http://www.linkedin.com/company/misscat-digital",
            "organization_founded_year": 2016,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/68441a3738f4830001c2ada1/picture",
            "organization_linkedin_uid": "17876664",
            "organization_primary_domain": "misscat.co",
            "organization_phone": "+90 555 802 1234",
            "organization_twitter_url": null,
            "organization_facebook_url": null,
            "industry": "telecommunications",
            "estimated_num_employees": "8",
            "keywords": "online marketing, mobile marketing, vas, digital product management, marketing & advertising",
            "organization_seo_description": "",
            "organization_short_description": "MissCat is a startup company operating in the mobile market in Turkey. \nWith recently established team, MissCat is  providing Value Added Services, mobile marketing campaigns and brand-new apps for local and global markets.\n\nIt offers innovative digital products for telecom operators in a partnership with content producers and mobile payment solution companies.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "Gmail, Google Apps, Mobile Friendly, Nginx, Vimeo, WordPress.org",
            "organization_raw_address": "Levent 199, Istanbul, Levent 34330, TR",
            "organization_street_address": "18/1 Levent Caddesi",
            "organization_city": "Istanbul",
            "organization_state": "Istanbul",
            "organization_country": "Turkey",
            "organization_postal_code": "34330"
          }
        },
        {
          "json": {
            "id": "6426cf8f94dc360001e09338",
            "first_name": "Zafer",
            "last_name": "Ege",
            "name": "Zafer Ege",
            "linkedin_url": "http://www.linkedin.com/in/zafer-ege-ab64971a0",
            "title": "Lawyer",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/C5603AQGGtj021m9sRw/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1580586481944?e=2147483647&v=beta&t=OaB5IuMgd7WkW5D8TZfXhIyKmte7nJoBTDXR4IbpUvY",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Av. Zafer EGE ÅŸirketinde Lawyer - KVKK UZMANI",
            "email": "zafer.ege@srd3kgrup.com.tr",
            "organization_id": "54a1351169702d4255fe6b00",
            "employment_history": [
              {
                "_id": "686b64ae51661a0001f988fb",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "54a1351169702d4255fe6b00",
                "organization_name": "SRD 3K GROUP COMPANY",
                "raw_address": null,
                "start_date": "2019-01-01",
                "title": "Lawyer",
                "updated_at": null,
                "id": "686b64ae51661a0001f988fb",
                "key": "686b64ae51661a0001f988fb"
              },
              {
                "_id": "686b64ae51661a0001f988fc",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "Av. Zafer EGE",
                "raw_address": null,
                "start_date": "2011-01-01",
                "title": "Lawyer",
                "updated_at": null,
                "id": "686b64ae51661a0001f988fc",
                "key": "686b64ae51661a0001f988fc"
              },
              {
                "_id": "686b64ae51661a0001f988fd",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5d092f51f6512509bf09d491",
                "organization_name": "Hukuk",
                "raw_address": null,
                "start_date": "2010-01-01",
                "title": "Av. Zafer Ege",
                "updated_at": null,
                "id": "686b64ae51661a0001f988fd",
                "key": "686b64ae51661a0001f988fd"
              },
              {
                "_id": "686b64ae51661a0001f988ff",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2018-04-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "556dce4e736964124391a001",
                "organization_name": "Vodafone",
                "raw_address": null,
                "start_date": "2016-01-01",
                "title": "Lawyer",
                "updated_at": null,
                "id": "686b64ae51661a0001f988ff",
                "key": "686b64ae51661a0001f988ff"
              }
            ],
            "state": "Ankara",
            "city": "Ankara",
            "country": "Tuerkiye",
            "organization": {
              "id": "54a1351169702d4255fe6b00",
              "name": "SRD 3K GROUP COMPANY",
              "website_url": "http://www.srd3kgrup.com.tr",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/srd-3k-group-company",
              "twitter_url": null,
              "facebook_url": null,
              "primary_phone": {},
              "languages": [
                "English"
              ],
              "alexa_ranking": null,
              "phone": null,
              "linkedin_uid": "1708215",
              "founded_year": 2005,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/66dc32c699c6060001ca6afa/picture",
              "crunchbase_url": null,
              "primary_domain": "srd3kgrup.com.tr",
              "organization_headcount_six_month_growth": 0,
              "organization_headcount_twelve_month_growth": 0,
              "organization_headcount_twenty_four_month_growth": 0,
              "industry": "architecture & planning",
              "keywords": [
                "architecture",
                "epc",
                "energy",
                "epc architecture energy"
              ],
              "estimated_num_employees": "21",
              "industries": [
                "architecture & planning"
              ],
              "secondary_industries": [],
              "raw_address": "BÃ¼yÃ¼kesat Mahallesi, UÄŸur Mumcu Cd. 87/13, 06700 Ã‡ankaya/Ankara, TurquÃ­a",
              "street_address": "87 Ugur Mumcu Caddesi",
              "city": null,
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06700"
            },
            "departments": [
              "master_legal"
            ],
            "subdepartments": [
              "lawyer_attorney"
            ],
            "seniority": "entry",
            "functions": [
              "legal"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "SRD 3K GROUP COMPANY",
            "organization_website_url": "http://www.srd3kgrup.com.tr",
            "organization_linkedin_url": "http://www.linkedin.com/company/srd-3k-group-company",
            "organization_founded_year": 2005,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/66dc32c699c6060001ca6afa/picture",
            "organization_linkedin_uid": "1708215",
            "organization_primary_domain": "srd3kgrup.com.tr",
            "organization_phone": null,
            "organization_twitter_url": null,
            "organization_facebook_url": null,
            "industry": "architecture & planning",
            "estimated_num_employees": "21",
            "keywords": "architecture, epc, energy, epc architecture energy",
            "organization_seo_description": "",
            "organization_short_description": "ABOUT US\n\nFounded in 2005 and the SRD 3K Group Construction LLC, a leading brand in a short time in the construction sector has managed to become a major corporate company. \n\nIn our country, the collective housing, villas, social facilities, stadiums, hospitals and a significant number of international quality and leadership in the architectural work was built. Our country and around the world adapt to natural conditions, the aesthetic and historic values into consideration and work in this sense, quality and robustness of principle, projects and applications continue to quickly search for the target set on is an innovative company. Architecture and energy projects since its establishment in its working group SRD 3K Group, facility owners and managers in this area engineering and architectural services. \n\nSRD 3K Group in Turkey, especially in exchange for center services approach, \nhave continued to provide a different profile, and discussed with people and building a mission to carry around. Knowledge, information processing and technology, paying particular attention to the development, engineering and architectural achievements of domestic and foreign scientific institutions or the work environment and awarded by states are. \n\nPlease read more below link.\nhttp://srd3kgrup.com.tr/en/index.html\n\nFor turkish:\nhttp://srd3kgrup.com.tr/tr/index.html",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "Remote",
            "organization_raw_address": "BÃ¼yÃ¼kesat Mahallesi, UÄŸur Mumcu Cd. 87/13, 06700 Ã‡ankaya/Ankara, TurquÃ­a",
            "organization_street_address": "87 Ugur Mumcu Caddesi",
            "organization_city": null,
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06700"
          }
        },
        {
          "json": {
            "id": "64a82d6fb578550001c0986e",
            "first_name": "Ersin",
            "last_name": "Guecenmez",
            "name": "Ersin Guecenmez",
            "linkedin_url": "http://www.linkedin.com/in/ersin-g%c3%bccenmez-706a859b",
            "title": "Webmaster",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/D4D03AQE_GxvWxtAPlA/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1678780638262?e=2147483647&v=beta&t=1aJrhuBy1NxdLz0acu5UtAFgrM57fe3mTIUURt4uul8",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Webmaster",
            "email": "ersin@artarda.com",
            "organization_id": "5ed0f8d7b553a40001c365a4",
            "employment_history": [
              {
                "_id": "685a853958c4c000014db9d4",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5ed0f8d7b553a40001c365a4",
                "organization_name": "ArtArda Reklam AjansÄ±",
                "raw_address": null,
                "start_date": "2016-09-01",
                "title": "Webmaster",
                "updated_at": null,
                "id": "685a853958c4c000014db9d4",
                "key": "685a853958c4c000014db9d4"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "5ed0f8d7b553a40001c365a4",
              "name": "ArtArda Reklam AjansÄ±",
              "website_url": "http://www.artarda.com",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/artardareklam",
              "twitter_url": null,
              "facebook_url": "https://www.facebook.com/artardareklam/",
              "primary_phone": {},
              "languages": [],
              "alexa_ranking": null,
              "phone": null,
              "linkedin_uid": "2467737",
              "founded_year": 2007,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/671213c6053bbf0001622736/picture",
              "crunchbase_url": null,
              "primary_domain": "artarda.com",
              "sic_codes": [
                "7311"
              ],
              "naics_codes": [
                "54181"
              ],
              "organization_headcount_six_month_growth": -0.3,
              "organization_headcount_twelve_month_growth": -0.3,
              "organization_headcount_twenty_four_month_growth": -0.125,
              "industry": "marketing & advertising",
              "keywords": [
                "reklam",
                "web tasarim",
                "masauestue yayincilik",
                "sosyal medya",
                "marka",
                "dijital reklam",
                "pazarlama",
                "ui",
                "ux",
                "seo",
                "advertising services",
                "information technology & services",
                "search marketing",
                "marketing",
                "marketing & advertising"
              ],
              "estimated_num_employees": "15",
              "industries": [
                "marketing & advertising"
              ],
              "secondary_industries": [],
              "raw_address": "Sedat Simavi Sokak, 60/5, Ã‡ankaya, Ankara 06690, TR",
              "street_address": "60 Sedat Simavi Sokak",
              "city": "Ankara",
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06690"
            },
            "departments": [
              "master_information_technology"
            ],
            "subdepartments": [
              "collaboration_web_app"
            ],
            "seniority": "entry",
            "functions": [],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "ArtArda Reklam AjansÄ±",
            "organization_website_url": "http://www.artarda.com",
            "organization_linkedin_url": "http://www.linkedin.com/company/artardareklam",
            "organization_founded_year": 2007,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/671213c6053bbf0001622736/picture",
            "organization_linkedin_uid": "2467737",
            "organization_primary_domain": "artarda.com",
            "organization_phone": null,
            "organization_twitter_url": null,
            "organization_facebook_url": "https://www.facebook.com/artardareklam/",
            "industry": "marketing & advertising",
            "estimated_num_employees": "15",
            "keywords": "reklam, web tasarim, masauestue yayincilik, sosyal medya, marka, dijital reklam, pazarlama, ui, ux, seo, advertising services, information technology & services, search marketing, marketing, marketing & advertising",
            "organization_seo_description": "",
            "organization_short_description": "ArtArda Enerji Ã¼retir  ! Enerji kaynaÄŸÄ±nÄ± yaratÄ±cÄ±lÄ±k ve araÅŸtÄ±rma sonucu edindiÄŸi donelerle besle. TakÄ±m Ã§alÄ±ÅŸmasÄ±nÄ±, mÃ¼ÅŸteriyle iletiÅŸim iÃ§inde sÃ¼rdÃ¼rÃ¼r. Hedef, kÄ±sa zamanda profesyonel iÅŸ Ã§Ä±kartmak ve doÄŸru noktaya atÄ±ÅŸ yapmaktÄ±r. BÃ¼tÃ¼n bunlarÄ±n ardÄ±ndan gÃ¶rdÃ¼ÄŸÃ¼mÃ¼z \"MÃ¼ÅŸteri TebessÃ¼mÃ¼\" bizim en deÄŸerli Ã¶dÃ¼lÃ¼mÃ¼zdÃ¼r.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "AI, Android, CloudFlare Hosting, Cloudflare DNS, Flutter, Gmail, Google Apps, IoT, Python, SharePoint",
            "organization_raw_address": "Sedat Simavi Sokak, 60/5, Ã‡ankaya, Ankara 06690, TR",
            "organization_street_address": "60 Sedat Simavi Sokak",
            "organization_city": "Ankara",
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06690"
          }
        },
        {
          "json": {
            "id": "662b0d1475c8d7000798d93e",
            "first_name": "Fatih",
            "last_name": "Dogan",
            "name": "Fatih Dogan",
            "linkedin_url": "http://www.linkedin.com/in/fatih-do%c4%9fan-73088127a",
            "title": "General Manager",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/D4E03AQFjvP8xPncbfg/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1686335966653?e=2147483647&v=beta&t=FpFIFYItCOg0i_T8du-Ta1-EfbZUqcpcl1sTt_DnMKE",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Mite Defence ÅŸirketinde General Manager",
            "email": "fatih.dogan@mitedefence.com",
            "organization_id": "64fcbdb72947450001b83556",
            "employment_history": [
              {
                "_id": "68589ffe94276b00015df8b3",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "64fcbdb72947450001b83556",
                "organization_name": "Mite Defence",
                "raw_address": null,
                "start_date": "2023-02-01",
                "title": "General Manager",
                "updated_at": null,
                "id": "68589ffe94276b00015df8b3",
                "key": "68589ffe94276b00015df8b3"
              },
              {
                "_id": "68589ffe94276b00015df8b4",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "64fcbdb72947450001b83556",
                "organization_name": "Mite Defence",
                "raw_address": null,
                "start_date": null,
                "title": "General Manager",
                "updated_at": null,
                "id": "68589ffe94276b00015df8b4",
                "key": "68589ffe94276b00015df8b4"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "64fcbdb72947450001b83556",
              "name": "Mite Defence",
              "website_url": "http://www.mitedefence.com",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/mite-defence",
              "twitter_url": null,
              "facebook_url": null,
              "primary_phone": {},
              "languages": [],
              "alexa_ranking": null,
              "phone": null,
              "linkedin_uid": "85637397",
              "founded_year": null,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6870e551de9df5000175b238/picture",
              "crunchbase_url": null,
              "primary_domain": "mitedefence.com",
              "sic_codes": [
                "3482"
              ],
              "naics_codes": [
                "33299"
              ],
              "organization_headcount_six_month_growth": -0.2,
              "organization_headcount_twelve_month_growth": -0.6,
              "organization_headcount_twenty_four_month_growth": -0.5555555555555556,
              "industry": "defense & space",
              "keywords": [
                "defense & space manufacturing",
                "ammunition production",
                "5.56 bullet",
                "7.62 bullet",
                "9.19 bullet",
                "defense industry",
                "cartridge manufacturing",
                "turnkey projects",
                "production line solutions",
                "high-quality ammunition",
                "r&d technology",
                "military standards",
                "consultation services",
                "cost analysis",
                "production improvement",
                "engineering services",
                "automation solutions",
                "bullet production",
                "factory construction",
                "machinery revision",
                "metal localization",
                "composite materials r&d",
                "small arms ammunition",
                "medium caliber ammunition",
                "pistol calibers",
                "rifle calibers",
                "technical documentation",
                "spare parts supply",
                "raw material sourcing",
                "performance testing",
                "acceptance testing",
                "innovation",
                "quality control",
                "transparency in business",
                "ethics in defense",
                "stakeholder engagement",
                "supply chain management",
                "market competitiveness",
                "project development",
                "client partnership",
                "product design superiority",
                "production capacity",
                "industry compliance",
                "defense solutions",
                "original technologies",
                "customer-centric services",
                "product line development",
                "business process improvement",
                "global defense solutions",
                "manufacturing expertise",
                "cost-effective solutions",
                "information technology & services",
                "logistics & supply chain"
              ],
              "estimated_num_employees": "13",
              "industries": [
                "defense & space"
              ],
              "secondary_industries": [],
              "raw_address": "406 takipÃ§i",
              "street_address": "",
              "city": null,
              "state": null,
              "country": null,
              "postal_code": null
            },
            "departments": [],
            "subdepartments": [],
            "seniority": "manager",
            "functions": [],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "Mite Defence",
            "organization_website_url": "http://www.mitedefence.com",
            "organization_linkedin_url": "http://www.linkedin.com/company/mite-defence",
            "organization_founded_year": null,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6870e551de9df5000175b238/picture",
            "organization_linkedin_uid": "85637397",
            "organization_primary_domain": "mitedefence.com",
            "organization_phone": null,
            "organization_twitter_url": null,
            "organization_facebook_url": null,
            "industry": "defense & space",
            "estimated_num_employees": "13",
            "keywords": "defense & space manufacturing, ammunition production, 5.56 bullet, 7.62 bullet, 9.19 bullet, defense industry, cartridge manufacturing, turnkey projects, production line solutions, high-quality ammunition, r&d technology, military standards, consultation services, cost analysis, production improvement, engineering services, automation solutions, bullet production, factory construction, machinery revision, metal localization, composite materials r&d, small arms ammunition, medium caliber ammunition, pistol calibers, rifle calibers, technical documentation, spare parts supply, raw material sourcing, performance testing, acceptance testing, innovation, quality control, transparency in business, ethics in defense, stakeholder engagement, supply chain management, market competitiveness, project development, client partnership, product design superiority, production capacity, industry compliance, defense solutions, original technologies, customer-centric services, product line development, business process improvement, global defense solutions, manufacturing expertise, cost-effective solutions, information technology & services, logistics & supply chain",
            "organization_seo_description": "",
            "organization_short_description": "Savunma sanayi ve kamu baÅŸta olmak Ã¼zere tÃ¼m mÃ¼ÅŸterilerimize;\nBilimsel bilgiye dayalÄ±, Ã¶zgÃ¼n, yenilikÃ§i, yÃ¼ksek teknolojili \"Ã¼rÃ¼n, Ã§Ã¶zÃ¼m ve hizmetleri\" kÃ¼resel olarak sunmak,\nÃ–zgÃ¼n, dijital dÃ¶nÃ¼ÅŸÃ¼me Ã¶ncÃ¼lÃ¼k edecek, teknoloji, Ã¼rÃ¼n ve Ã§Ã¶zÃ¼mler geliÅŸtirmek.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "Bootstrap Framework, Mobile Friendly, Outlook",
            "organization_raw_address": "406 takipÃ§i",
            "organization_street_address": "",
            "organization_city": null,
            "organization_state": null,
            "organization_country": null,
            "organization_postal_code": null
          }
        },
        {
          "json": {
            "id": "6652add2d5419d0001be9bf4",
            "first_name": "Seyda",
            "last_name": "Berkil",
            "name": "Seyda Berkil",
            "linkedin_url": "http://www.linkedin.com/in/%c5%9feyda-berkil-64a856212",
            "title": "Management Consultant",
            "email_status": "verified",
            "photo_url": "https://static.licdn.com/aero-v1/sc/h/9c8pery4andzj6ohjkjp54ma2",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Management Consultant",
            "email": "s.berkil@benovaconsulting.com",
            "organization_id": "6049f70942ea8000019fc98f",
            "employment_history": [
              {
                "_id": "687b7c79152d450001c6afe8",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "6049f70942ea8000019fc98f",
                "organization_name": "BeNova Consulting",
                "raw_address": null,
                "start_date": "2024-05-01",
                "title": "Management Consultant",
                "updated_at": null,
                "id": "687b7c79152d450001c6afe8",
                "key": "687b7c79152d450001c6afe8"
              },
              {
                "_id": "687b7c79152d450001c6afe9",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2024-05-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "63c66a30e9f83e0001a9027d",
                "organization_name": "AK YAPI AÅž.",
                "raw_address": null,
                "start_date": "2023-11-01",
                "title": "Corporate Commmunication & Marketing Specialist",
                "updated_at": null,
                "id": "687b7c79152d450001c6afe9",
                "key": "687b7c79152d450001c6afe9"
              },
              {
                "_id": "687b7c79152d450001c6afea",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2023-07-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "6049f70942ea8000019fc98f",
                "organization_name": "BeNova Consulting",
                "raw_address": null,
                "start_date": "2022-10-01",
                "title": "Jr. Business Development Specialist",
                "updated_at": null,
                "id": "687b7c79152d450001c6afea",
                "key": "687b7c79152d450001c6afea"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "6049f70942ea8000019fc98f",
              "name": "BeNova Consulting",
              "website_url": "http://www.benovaconsulting.com",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/benovaconsulting",
              "twitter_url": null,
              "facebook_url": null,
              "primary_phone": {
                "number": "+90 533 142 1582",
                "source": "Scraped",
                "sanitized_number": "+905331421582"
              },
              "languages": [],
              "alexa_ranking": null,
              "phone": "+90 533 142 1582",
              "linkedin_uid": "70408325",
              "founded_year": 2020,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6714cce44a42d70001be6e7a/picture",
              "crunchbase_url": null,
              "primary_domain": "benovaconsulting.com",
              "sic_codes": [
                "8742"
              ],
              "naics_codes": [
                "54161"
              ],
              "sanitized_phone": "+905331421582",
              "organization_headcount_six_month_growth": -0.1176470588235294,
              "organization_headcount_twelve_month_growth": -0.3181818181818182,
              "organization_headcount_twenty_four_month_growth": -0.4230769230769231,
              "industry": "management consulting",
              "keywords": [
                "consulting",
                "strategy",
                "marketing",
                "digital marketing",
                "training",
                "coaching",
                "public relations",
                "human resources",
                "defense industry",
                "management consultancy",
                "sales",
                "export",
                "business consulting & services",
                "strategic management consulting",
                "organizational change",
                "sustainable finance",
                "cost management",
                "turquality consulting",
                "government incentives",
                "export strategies",
                "management training",
                "organizational development",
                "strategic planning",
                "supply chain management",
                "digital transformation",
                "performance optimization",
                "market analysis",
                "competitive advantage",
                "business development",
                "financial restructuring",
                "capacity building",
                "innovation management",
                "stakeholder engagement",
                "resource allocation",
                "risk management",
                "project management",
                "executive coaching",
                "business assessment",
                "sustainability initiatives",
                "human resources management",
                "talent acquisition",
                "corporate governance",
                "performance evaluation",
                "organizational restructuring",
                "customer engagement",
                "brand management",
                "business strategy",
                "financial performance",
                "operational efficiency",
                "change management",
                "organizational culture",
                "leadership development",
                "best practices",
                "client-centric solutions",
                "benchmarking",
                "strategic roadmaps",
                "data-driven decision making",
                "profitability improvement",
                "sustainable growth strategies",
                "consulting methodologies",
                "expert advisory services",
                "consultancy best practices",
                "transformational leadership",
                "strategy development",
                "business process improvement",
                "market entry strategies",
                "export consulting",
                "organizational change management",
                "brand communication",
                "financial management",
                "sustainability",
                "holistic analysis",
                "impact-focused solutions",
                "training & development",
                "customer segmentation",
                "innovation",
                "cost reduction",
                "supply chain optimization",
                "technology implementation",
                "public institutions",
                "private sector",
                "turkey",
                "global reach",
                "smes",
                "large corporations",
                "consulting partnerships",
                "continuous improvement",
                "post-assessment",
                "client collaboration",
                "market research",
                "competitor analysis",
                "marketing & advertising",
                "management consulting",
                "international trade & development",
                "logistics & supply chain",
                "b2b",
                "productivity",
                "professional training & coaching",
                "environmental services",
                "renewables & environment"
              ],
              "estimated_num_employees": "27",
              "industries": [
                "management consulting"
              ],
              "secondary_industries": [],
              "raw_address": "Tepe Prime Ä°ÅŸ Merkezi, B blok, D:76, Ankara, 06510, TR",
              "street_address": "Tepe Prime",
              "city": "Ankara",
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06530"
            },
            "departments": [
              "consulting"
            ],
            "subdepartments": [
              "consultant"
            ],
            "seniority": "entry",
            "functions": [
              "consulting"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "BeNova Consulting",
            "organization_website_url": "http://www.benovaconsulting.com",
            "organization_linkedin_url": "http://www.linkedin.com/company/benovaconsulting",
            "organization_founded_year": 2020,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6714cce44a42d70001be6e7a/picture",
            "organization_linkedin_uid": "70408325",
            "organization_primary_domain": "benovaconsulting.com",
            "organization_phone": "+90 533 142 1582",
            "organization_twitter_url": null,
            "organization_facebook_url": null,
            "industry": "management consulting",
            "estimated_num_employees": "27",
            "keywords": "consulting, strategy, marketing, digital marketing, training, coaching, public relations, human resources, defense industry, management consultancy, sales, export, business consulting & services, strategic management consulting, organizational change, sustainable finance, cost management, turquality consulting, government incentives, export strategies, management training, organizational development, strategic planning, supply chain management, digital transformation, performance optimization, market analysis, competitive advantage, business development, financial restructuring, capacity building, innovation management, stakeholder engagement, resource allocation, risk management, project management, executive coaching, business assessment, sustainability initiatives, human resources management, talent acquisition, corporate governance, performance evaluation, organizational restructuring, customer engagement, brand management, business strategy, financial performance, operational efficiency, change management, organizational culture, leadership development, best practices, client-centric solutions, benchmarking, strategic roadmaps, data-driven decision making, profitability improvement, sustainable growth strategies, consulting methodologies, expert advisory services, consultancy best practices, transformational leadership, strategy development, business process improvement, market entry strategies, export consulting, organizational change management, brand communication, financial management, sustainability, holistic analysis, impact-focused solutions, training & development, customer segmentation, innovation, cost reduction, supply chain optimization, technology implementation, public institutions, private sector, turkey, global reach, smes, large corporations, consulting partnerships, continuous improvement, post-assessment, client collaboration, market research, competitor analysis, marketing & advertising, management consulting, international trade & development, logistics & supply chain, b2b, productivity, professional training & coaching, environmental services, renewables & environment",
            "organization_seo_description": "YÄ±llarÄ±n tecrÃ¼besi ile danÄ±ÅŸmanlÄ±k hizmeti veriyoruz. YÃ¶netim ve strateji,kurumsal dÃ¶nÃ¼ÅŸÃ¼m,ihracat,hibe ve teÅŸvik,Ä°K danÄ±ÅŸmanlÄ±k hizmetleri ile kurumunuzu bÃ¼tÃ¼nsel olarak analiz ediyoruz.",
            "organization_short_description": "SonuÃ§ odaklÄ± bir yÃ¶netim danÄ±ÅŸmanlÄ±ÄŸÄ± firmasÄ± olarak sektÃ¶rÃ¼nÃ¼zde etki bÄ±rakmanÄ±z iÃ§in kurumunuza Ã¶zel tasarlanan Ã§Ã¶zÃ¼mlerimizle yanÄ±nÄ±zdayÄ±z! Bilgi birikimimiz ve sektÃ¶r deneyimimizle size farklÄ± bir bakÄ±ÅŸ aÃ§Ä±sÄ± sunuyoruz. Deneyimli kadromuz ve Ã§Ã¶zÃ¼m ortaklarÄ±mÄ±z ile sizlerin de yol arkadaÅŸÄ± olmaya hazÄ±rÄ±z.\n\nDanÄ±ÅŸmanlÄ±k Hizmetlerimiz:\n* Ã–n Ä°nceleme ve Analiz DanÄ±ÅŸmanlÄ±ÄŸÄ±\n* SatÄ±ÅŸ ve Ä°hracat DanÄ±ÅŸmanlÄ±ÄŸÄ±\n* Ä°nsan KaynaklarÄ± DanÄ±ÅŸmanlÄ±ÄŸÄ±\n* DijitalleÅŸme DanÄ±ÅŸmanlÄ±ÄŸÄ±\n* Strateji DanÄ±ÅŸmanlÄ±ÄŸÄ±\n* Marka Ä°letiÅŸimi DanÄ±ÅŸmanlÄ±ÄŸÄ±\n* Maliyet DÃ¶nÃ¼ÅŸÃ¼mÃ¼ ve BÃ¼tÃ§eleme DanÄ±ÅŸmanlÄ±ÄŸÄ±\n* Ä°novasyon DanÄ±ÅŸmanlÄ±ÄŸÄ±\n\nDetaylÄ± bilgi iÃ§in www.BeNovaConsulting.com sitemizi ziyaret edebilir, info@benovaconsulting.com adresinden bizlere ulaÅŸabilirsiniz.\n\n----\n\nAs a result-oriented management consultancy firm, we are at your side with our solutions specially designed for your company to make an impact in your industry! We offer you a different perspective with our knowledge and industry experience. We are ready to be your companion with our experienced consultants and partners.\n\nOur Consulting Services:\n* Preliminary Survey and Analysis Consultancy\n* Sales and Export Consultancy\n* Human Resources Consultancy\n* Digitalization Consultancy\n* Strategy Consultancy\n* Brand Communications Consultancy\n* Value Creation and Budgeting Consultancy\n* Innovation Consultancy\n\nFor detailed information, you can visit our website www.BeNovaConsulting.com and reach us at info@benovaconsulting.com.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "Google Analytics, Google Font API, Google Tag Manager, Mobile Friendly, Python, WordPress.org",
            "organization_raw_address": "Tepe Prime Ä°ÅŸ Merkezi, B blok, D:76, Ankara, 06510, TR",
            "organization_street_address": "Tepe Prime",
            "organization_city": "Ankara",
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06530"
          }
        },
        {
          "json": {
            "id": "66d19d82df366e0001336235",
            "first_name": "Kerim",
            "last_name": "Caliskan",
            "name": "Kerim Caliskan",
            "linkedin_url": "http://www.linkedin.com/in/kerim-caliskan-19183b225",
            "title": "Back End Engineer",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/D4D03AQFn7n4lgZqzgA/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1676323136898?e=2147483647&v=beta&t=L5KbQJRfTOF1uhEZeOkFQE3E013Z1Ri-GfeYXpSSlV4",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Physicist | Software Engineer | Deep Learning Scientist | Embedded Systems Developer",
            "email": "kerim.caliskan@octoxlabs.com",
            "organization_id": "61c557a6804c4a00c24eba79",
            "employment_history": [
              {
                "_id": "685b8f8f07994e0001536547",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "61c557a6804c4a00c24eba79",
                "organization_name": "OctoXLabs",
                "raw_address": null,
                "start_date": "2025-03-01",
                "title": "Back End Engineer",
                "updated_at": null,
                "id": "685b8f8f07994e0001536547",
                "key": "685b8f8f07994e0001536547"
              },
              {
                "_id": "685b8f8f07994e0001536548",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2025-03-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "57c4ac64a6da9867d6e9eca0",
                "organization_name": "TDG Deprem ve YapÄ± SaÄŸlÄ±ÄŸÄ± Ä°zleme Sistemleri",
                "raw_address": null,
                "start_date": "2024-07-01",
                "title": "Software R&D Engineer",
                "updated_at": null,
                "id": "685b8f8f07994e0001536548",
                "key": "685b8f8f07994e0001536548"
              },
              {
                "_id": "685b8f8f07994e0001536549",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2024-05-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "57c4ac64a6da9867d6e9eca0",
                "organization_name": "TDG Deprem ve YapÄ± SaÄŸlÄ±ÄŸÄ± Ä°zleme Sistemleri",
                "raw_address": null,
                "start_date": "2024-03-01",
                "title": "Software Engineer",
                "updated_at": null,
                "id": "685b8f8f07994e0001536549",
                "key": "685b8f8f07994e0001536549"
              },
              {
                "_id": "685b8f8f07994e000153654a",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2024-03-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "57c4ac64a6da9867d6e9eca0",
                "organization_name": "TDG Deprem ve YapÄ± SaÄŸlÄ±ÄŸÄ± Ä°zleme Sistemleri",
                "raw_address": null,
                "start_date": "2024-01-01",
                "title": "Intern",
                "updated_at": null,
                "id": "685b8f8f07994e000153654a",
                "key": "685b8f8f07994e000153654a"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "61c557a6804c4a00c24eba79",
              "name": "OctoXLabs",
              "website_url": "http://www.octoxlabs.com",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/octoxlabs",
              "twitter_url": "https://twitter.com/octoxlabs",
              "facebook_url": null,
              "primary_phone": {},
              "languages": [],
              "alexa_ranking": null,
              "phone": null,
              "linkedin_uid": "80313254",
              "founded_year": 2021,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/686d18607b96cf0001d26730/picture",
              "crunchbase_url": null,
              "primary_domain": "octoxlabs.com",
              "sic_codes": [
                "7374"
              ],
              "naics_codes": [
                "54151"
              ],
              "organization_headcount_six_month_growth": 0.2631578947368421,
              "organization_headcount_twelve_month_growth": 0.4117647058823529,
              "organization_headcount_twenty_four_month_growth": 1,
              "industry": "computer & network security",
              "keywords": [
                "cybersecurity",
                "asset management",
                "vulnerability management",
                "application inventory",
                "license management",
                "user inventory",
                "risk assessment",
                "api integrations",
                "automation",
                "action center",
                "threat detection",
                "it security",
                "cloud security",
                "iot device management",
                "third-party software management",
                "security auditing",
                "compliance management",
                "security gap analysis",
                "security policy enforcement",
                "user access management",
                "visibility enhancement",
                "integration capabilities",
                "cyber asset attack surface management",
                "real-time monitoring",
                "incident response",
                "continuous security posture management",
                "risk mapping",
                "endpoint protection",
                "data security",
                "monitoring dashboard",
                "security analytics",
                "security intelligence",
                "remediation processes",
                "threat prioritization",
                "automated notifications",
                "device discovery",
                "application tracking",
                "license tracking",
                "security automation",
                "user data enrichment",
                "trusted vulnerability sources",
                "threat intelligence",
                "patch management",
                "collaboration tools for security teams",
                "documentation portal",
                "integration adapters",
                "systems requirements management",
                "platform security",
                "security operations",
                "computer & network security",
                "information technology & services"
              ],
              "estimated_num_employees": "14",
              "industries": [
                "computer & network security"
              ],
              "secondary_industries": [],
              "raw_address": "567 east 234th street, istanbul, istanbul, turkey",
              "street_address": "2B Istiklal Caddesi",
              "city": "Atasehir",
              "state": "Istanbul",
              "country": "Turkey",
              "postal_code": "34746"
            },
            "departments": [
              "master_engineering_technical"
            ],
            "subdepartments": [
              "engineering_technical",
              "software_development"
            ],
            "seniority": "entry",
            "functions": [
              "engineering"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": true,
            "personal_emails": [],
            "organization_name": "OctoXLabs",
            "organization_website_url": "http://www.octoxlabs.com",
            "organization_linkedin_url": "http://www.linkedin.com/company/octoxlabs",
            "organization_founded_year": 2021,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/686d18607b96cf0001d26730/picture",
            "organization_linkedin_uid": "80313254",
            "organization_primary_domain": "octoxlabs.com",
            "organization_phone": null,
            "organization_twitter_url": "https://twitter.com/octoxlabs",
            "organization_facebook_url": null,
            "industry": "computer & network security",
            "estimated_num_employees": "14",
            "keywords": "cybersecurity, asset management, vulnerability management, application inventory, license management, user inventory, risk assessment, api integrations, automation, action center, threat detection, it security, cloud security, iot device management, third-party software management, security auditing, compliance management, security gap analysis, security policy enforcement, user access management, visibility enhancement, integration capabilities, cyber asset attack surface management, real-time monitoring, incident response, continuous security posture management, risk mapping, endpoint protection, data security, monitoring dashboard, security analytics, security intelligence, remediation processes, threat prioritization, automated notifications, device discovery, application tracking, license tracking, security automation, user data enrichment, trusted vulnerability sources, threat intelligence, patch management, collaboration tools for security teams, documentation portal, integration adapters, systems requirements management, platform security, security operations, computer & network security, information technology & services",
            "organization_seo_description": "Secure your inventory. Don't worry about which of your devices are safe. Improve the security maturity level with OctoXLabs CSAM Platform.",
            "organization_short_description": "We are focusing on biggest challenges in IT and Security.\nImagine a platform that correlates asset data from existing solutions to provide an always up-to-date inventory, uncover gaps, and automate action to control complexity.\n#CAASM",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "ASP.NET, CloudFlare Hosting, Cloudflare DNS, Mobile Friendly, Outlook, Python, React Native, reCAPTCHA",
            "organization_raw_address": "567 east 234th street, istanbul, istanbul, turkey",
            "organization_street_address": "2B Istiklal Caddesi",
            "organization_city": "Atasehir",
            "organization_state": "Istanbul",
            "organization_country": "Turkey",
            "organization_postal_code": "34746"
          }
        },
        {
          "json": {
            "id": "66eecd770752dd000172bdb3",
            "first_name": "Ozan",
            "last_name": "Kantar",
            "name": "Ozan Kantar",
            "linkedin_url": "http://www.linkedin.com/in/ozankantar",
            "title": "Technical Manager",
            "email_status": "verified",
            "photo_url": "https://static.licdn.com/aero-v1/sc/h/9c8pery4andzj6ohjkjp54ma2",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Technical Manager",
            "email": "ozan.kantar@liberyus.com",
            "organization_id": "5da29d9808e98f0001a35354",
            "employment_history": [
              {
                "_id": "68590a9ed481ed0001934504",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5da29d9808e98f0001a35354",
                "organization_name": "Liberyus",
                "raw_address": null,
                "start_date": "1982-01-01",
                "title": "Technical Manager",
                "updated_at": null,
                "id": "68590a9ed481ed0001934504",
                "key": "68590a9ed481ed0001934504"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "5da29d9808e98f0001a35354",
              "name": "Liberyus",
              "website_url": "http://www.liberyus.com",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/liberyus",
              "twitter_url": null,
              "facebook_url": null,
              "primary_phone": {
                "number": "+90 312 437 0222",
                "source": "Scraped",
                "sanitized_number": "+903124370222"
              },
              "languages": [],
              "alexa_ranking": null,
              "phone": "+90 312 437 0222",
              "linkedin_uid": "11449280",
              "founded_year": 2018,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/66f92309b254b40001154615/picture",
              "crunchbase_url": null,
              "primary_domain": "liberyus.com",
              "sanitized_phone": "+903124370222",
              "organization_headcount_six_month_growth": 0.07692307692307693,
              "organization_headcount_twelve_month_growth": -0.06666666666666667,
              "organization_headcount_twenty_four_month_growth": 0.2727272727272727,
              "industry": "information technology & services",
              "keywords": [
                "digitalmarketing",
                "web portal development",
                "digital media managment",
                "mobil application development",
                "yazilim",
                "sosyal medya yoenetimi",
                "hyper casual game development",
                "social media marketing",
                "dijital medya",
                "reklam",
                "reklam tasarimi",
                "web sitesi yoenetimi",
                "dijital pazarlama",
                "kurumsal kimlik",
                "sosyal medya reklami",
                "kampanya yoenetimi",
                "tasarim",
                "design",
                "web sitesi tasarimi",
                "development",
                "software development",
                "digital media",
                "software solutions",
                "web applications",
                "ui-ux design",
                "project management",
                "mobile application development",
                "cross-platform apps",
                "ios development",
                "android development",
                "custom software",
                "technical support",
                "devops services",
                "data analysis",
                "user-friendly interfaces",
                "project planning",
                "project execution",
                "performance tracking",
                "report generation",
                "sustainable media",
                "brand reputation management",
                "client engagement",
                "creative solutions",
                "blogging platforms",
                "social responsibility",
                "digital marketing",
                "portfolio management",
                "software innovation",
                "team collaboration",
                "technology adaptation",
                "technical consultancy",
                "website cms",
                "user loyalty",
                "interface design",
                "digital strategy",
                "market analysis",
                "digital transformation",
                "content management systems",
                "reseller solutions",
                "business analytics",
                "project evaluation",
                "system integration",
                "user engagement",
                "software maintenance",
                "mobile-first design",
                "scalable solutions",
                "customer feedback",
                "feedback loops",
                "media planning",
                "custom projects",
                "consumer internet",
                "consumers",
                "internet",
                "information technology & services",
                "marketing & advertising",
                "productivity",
                "mobile app development",
                "mobile",
                "data analytics",
                "media",
                "marketing"
              ],
              "estimated_num_employees": "13",
              "industries": [
                "information technology & services",
                "internet"
              ],
              "secondary_industries": [
                "internet"
              ],
              "raw_address": "ReÅŸit Galip Caddesi 56/2, ANKARA, Ã‡ankaya 06680, TR",
              "street_address": "2 Resit Galip Caddesi",
              "city": "Ankara",
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06680"
            },
            "departments": [],
            "subdepartments": [],
            "seniority": "manager",
            "functions": [],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "Liberyus",
            "organization_website_url": "http://www.liberyus.com",
            "organization_linkedin_url": "http://www.linkedin.com/company/liberyus",
            "organization_founded_year": 2018,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/66f92309b254b40001154615/picture",
            "organization_linkedin_uid": "11449280",
            "organization_primary_domain": "liberyus.com",
            "organization_phone": "+90 312 437 0222",
            "organization_twitter_url": null,
            "organization_facebook_url": null,
            "industry": "information technology & services",
            "estimated_num_employees": "13",
            "keywords": "digitalmarketing, web portal development, digital media managment, mobil application development, yazilim, sosyal medya yoenetimi, hyper casual game development, social media marketing, dijital medya, reklam, reklam tasarimi, web sitesi yoenetimi, dijital pazarlama, kurumsal kimlik, sosyal medya reklami, kampanya yoenetimi, tasarim, design, web sitesi tasarimi, development, software development, digital media, software solutions, web applications, ui-ux design, project management, mobile application development, cross-platform apps, ios development, android development, custom software, technical support, devops services, data analysis, user-friendly interfaces, project planning, project execution, performance tracking, report generation, sustainable media, brand reputation management, client engagement, creative solutions, blogging platforms, social responsibility, digital marketing, portfolio management, software innovation, team collaboration, technology adaptation, technical consultancy, website cms, user loyalty, interface design, digital strategy, market analysis, digital transformation, content management systems, reseller solutions, business analytics, project evaluation, system integration, user engagement, software maintenance, mobile-first design, scalable solutions, customer feedback, feedback loops, media planning, custom projects, consumer internet, consumers, internet, information technology & services, marketing & advertising, productivity, mobile app development, mobile, data analytics, media, marketing",
            "organization_seo_description": "AjansÄ±mÄ±zda; yazÄ±lÄ±m, dijital medya ve tasarÄ±m hizmetleri baÅŸta olmak Ã¼zere ulusal ve uluslararasÄ± projelere imza atÄ±yoruz. +90 312 437 0 222",
            "organization_short_description": "We know very well that; People with dreams are unstoppable and these people build the future. It is getting more and more difficult for the same ideas to find their place in the globalizing world. Liberyus; serves as an idea workshop with its young and dynamic structure. In this way, we will be your right solution partner by offering creative ideas in all your work. To feel the happiness of watching the success of your creation's brand, you must have a companion who will make you happy on your way to success. With many service lines, Liberyus offers you the privilege of performing all your work you need from a single company.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "Android, Facebook Custom Audiences, Facebook Login (Connect), Facebook Widget, Google Font API, Google Tag Manager, JivoSite, Laravel, Mobile Friendly, Nginx, React Native, Remote, Woo Commerce, WordPress.org, Yandex Metrica",
            "organization_raw_address": "ReÅŸit Galip Caddesi 56/2, ANKARA, Ã‡ankaya 06680, TR",
            "organization_street_address": "2 Resit Galip Caddesi",
            "organization_city": "Ankara",
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06680"
          }
        },
        {
          "json": {
            "id": "66f95f8061199700014ea66b",
            "first_name": "Ozan",
            "last_name": "Yigit",
            "name": "Ozan Yigit",
            "linkedin_url": "http://www.linkedin.com/in/ozan-yi%c4%9fit-3ba415256",
            "title": "Director of Operations",
            "email_status": "verified",
            "photo_url": "https://media.licdn.com/dms/image/v2/D4D03AQErPYoxveb8xA/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1668586470952?e=2147483647&v=beta&t=X_qgwM9F3HiAZqlp25Skx4gZhaIEa0lt3P6tGCmXv7A",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "Director of Operations",
            "email": "ozan@ogselektronik.com.tr",
            "organization_id": "5e583598d2bd680001c9773c",
            "employment_history": [
              {
                "_id": "686ed4d49ed3280001b09dd9",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "5e583598d2bd680001c9773c",
                "organization_name": "OGS Elektronik",
                "raw_address": null,
                "start_date": "2020-03-01",
                "title": "Director of Operations",
                "updated_at": null,
                "id": "686ed4d49ed3280001b09dd9",
                "key": "686ed4d49ed3280001b09dd9"
              },
              {
                "_id": "686ed4d49ed3280001b09dda",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "6714a5693c0160000115785d",
                "organization_name": "OGB Global",
                "raw_address": null,
                "start_date": "2022-09-01",
                "title": "Managing Partner",
                "updated_at": null,
                "id": "686ed4d49ed3280001b09dda",
                "key": "686ed4d49ed3280001b09dda"
              },
              {
                "_id": "686ed4d49ed3280001b09ddb",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2020-02-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "3P Industrial Packaging Systems",
                "raw_address": null,
                "start_date": "2015-11-01",
                "title": "Co-Founder",
                "updated_at": null,
                "id": "686ed4d49ed3280001b09ddb",
                "key": "686ed4d49ed3280001b09ddb"
              },
              {
                "_id": "686ed4d49ed3280001b09ddc",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2015-11-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "54a2717b7468693a7e3c3123",
                "organization_name": "PSC International",
                "raw_address": null,
                "start_date": "2013-04-01",
                "title": "Branch Owner",
                "updated_at": null,
                "id": "686ed4d49ed3280001b09ddc",
                "key": "686ed4d49ed3280001b09ddc"
              },
              {
                "_id": "686ed4d49ed3280001b09ddd",
                "created_at": null,
                "current": false,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": "2013-03-01",
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": null,
                "organization_name": "DEPAR International Consulting and Engineering",
                "raw_address": null,
                "start_date": "2011-06-01",
                "title": "Business Assistant",
                "updated_at": null,
                "id": "686ed4d49ed3280001b09ddd",
                "key": "686ed4d49ed3280001b09ddd"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "5e583598d2bd680001c9773c",
              "name": "OGS Elektronik",
              "website_url": "http://www.ogselektronik.com.tr",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/ogselektronik",
              "twitter_url": "https://twitter.com/ogselektronik",
              "facebook_url": null,
              "primary_phone": {
                "number": "+90 444 9 080",
                "source": "Scraped",
                "sanitized_number": "+904449080"
              },
              "languages": [],
              "alexa_ranking": null,
              "phone": "+90 444 9 080",
              "linkedin_uid": "19116793",
              "founded_year": 2006,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/66e508cbb814110001e6e425/picture",
              "crunchbase_url": null,
              "primary_domain": "ogselektronik.com.tr",
              "sic_codes": [
                "3669"
              ],
              "naics_codes": [
                "33451"
              ],
              "sanitized_phone": "+904449080",
              "organization_headcount_six_month_growth": -0.2142857142857143,
              "organization_headcount_twelve_month_growth": -0.1538461538461539,
              "organization_headcount_twenty_four_month_growth": 0.5714285714285714,
              "industry": "electrical/electronic manufacturing",
              "keywords": [
                "elektronik",
                "light bar",
                "guevenlik",
                "elektronik & guevenlik",
                "tepe lambasi",
                "appliances, electrical, & electronics manufacturing",
                "warning light bars",
                "siren announcement devices",
                "emergency lighting",
                "digital message boards",
                "rechargeable warning lights",
                "intercom systems",
                "vehicle safety products",
                "ambulance interior lights",
                "traffic advisor lights",
                "led lighting solutions",
                "safety alert systems",
                "protocol products",
                "tablet systems",
                "special applications",
                "vehicle customization",
                "public alarm systems",
                "audio & video systems",
                "ballistic shield lighting",
                "creative solutions",
                "customer-focused innovations",
                "bluetooth siren systems",
                "wireless control systems",
                "urban alert systems",
                "environmental lighting systems",
                "motorcycle warning lights",
                "interior mount warning lights",
                "powered by technology",
                "reliable service standards",
                "active response systems",
                "high visibility lighting",
                "emergency response solutions",
                "electricity-electronics",
                "dynamic workforce",
                "customizable products",
                "flexible service structure",
                "vehicle safety enhancement",
                "safety & security solutions",
                "integrated alert systems",
                "official vehicle lighting",
                "professional r&d",
                "global market presence",
                "fast & efficient service",
                "unique design options",
                "market-leading technology",
                "high-performance devices",
                "advanced safety features",
                "customer satisfaction",
                "industry-specific solutions",
                "smart lighting solutions",
                "connectivity & integration",
                "electrical/electronic manufacturing",
                "mechanical or industrial engineering"
              ],
              "estimated_num_employees": "12",
              "industries": [
                "electrical/electronic manufacturing"
              ],
              "secondary_industries": [],
              "raw_address": "2310/1, ANKARA, Ankara/Yenimahalle/Ergazi 06200, TR",
              "street_address": "",
              "city": "Ankara",
              "state": "Ankara",
              "country": "Turkey",
              "postal_code": "06370"
            },
            "departments": [
              "master_operations"
            ],
            "subdepartments": [
              "operations"
            ],
            "seniority": "director",
            "functions": [
              "operations"
            ],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": true,
            "personal_emails": [],
            "organization_name": "OGS Elektronik",
            "organization_website_url": "http://www.ogselektronik.com.tr",
            "organization_linkedin_url": "http://www.linkedin.com/company/ogselektronik",
            "organization_founded_year": 2006,
            "organization_market_cap": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/66e508cbb814110001e6e425/picture",
            "organization_linkedin_uid": "19116793",
            "organization_primary_domain": "ogselektronik.com.tr",
            "organization_phone": "+90 444 9 080",
            "organization_twitter_url": "https://twitter.com/ogselektronik",
            "organization_facebook_url": null,
            "industry": "electrical/electronic manufacturing",
            "estimated_num_employees": "12",
            "keywords": "elektronik, light bar, guevenlik, elektronik & guevenlik, tepe lambasi, appliances, electrical, & electronics manufacturing, warning light bars, siren announcement devices, emergency lighting, digital message boards, rechargeable warning lights, intercom systems, vehicle safety products, ambulance interior lights, traffic advisor lights, led lighting solutions, safety alert systems, protocol products, tablet systems, special applications, vehicle customization, public alarm systems, audio & video systems, ballistic shield lighting, creative solutions, customer-focused innovations, bluetooth siren systems, wireless control systems, urban alert systems, environmental lighting systems, motorcycle warning lights, interior mount warning lights, powered by technology, reliable service standards, active response systems, high visibility lighting, emergency response solutions, electricity-electronics, dynamic workforce, customizable products, flexible service structure, vehicle safety enhancement, safety & security solutions, integrated alert systems, official vehicle lighting, professional r&d, global market presence, fast & efficient service, unique design options, market-leading technology, high-performance devices, advanced safety features, customer satisfaction, industry-specific solutions, smart lighting solutions, connectivity & integration, electrical/electronic manufacturing, mechanical or industrial engineering",
            "organization_seo_description": "Åžirketimiz 2006 yÄ±lÄ±ndan bu yana bu bilinÃ§le Ã¶zgÃ¼n hizmet anlayÄ±ÅŸÄ± sunarak gÃ¼ncel teknoloji kullanÄ±mÄ±nÄ±, sektÃ¶rdeki uzmanlÄ±ÄŸÄ±nÄ± iÅŸ deneyimi ile birleÅŸtirip mÃ¼ÅŸterilerinin iÅŸ ihtiyaÃ§larÄ±na bire bir cevap veren Ã§Ã¶zÃ¼mler sunmaktadÄ±r.",
            "organization_short_description": "BilinÃ§ dÃ¼zeyi artmÄ±ÅŸ mÃ¼ÅŸterilerin deÄŸiÅŸen istek ve beklentileri gerek Ã¼rÃ¼nlerin gerekse sunulan hizmetlerin sÃ¼rekli geliÅŸtirilmesini ve iyileÅŸtirilmesini zorunlu kÄ±lmaktadÄ±r. Åžirketimiz 2006 yÄ±lÄ±ndan bu yana bu bilinÃ§le Ã¶zgÃ¼n hizmet anlayÄ±ÅŸÄ± sunarak gÃ¼ncel teknoloji kullanÄ±mÄ±nÄ±, sektÃ¶rdeki uzmanlÄ±ÄŸÄ±nÄ± iÅŸ deneyimi ile birleÅŸtirip mÃ¼ÅŸterilerinin iÅŸ ihtiyaÃ§larÄ±na bire bir cevap veren Ã§Ã¶zÃ¼mler sunmaktadÄ±r.\n\nSektÃ¶rdeki talep ve beklentileri yoÄŸun tecrÃ¼besi ve konuya uzman bakÄ±ÅŸÄ±yla profesyonel biÃ§imde deÄŸerlendirmekte; yenilikÃ§i, geliÅŸmece bir yaklaÅŸÄ±mla mÃ¼ÅŸteri memnuniyetini artÄ±rmaya Ã§alÄ±ÅŸmaktadÄ±r. Bu sayede kÄ±sa sÃ¼rede tanÄ±nan ve Ã¶rnek alÄ±nan bir kurum haline gelmiÅŸtir. Åžirketimiz kuruluÅŸundan bu yana geÃ§en sÃ¼re iÃ§inde hÄ±zlÄ±, kaliteli, gÃ¼venilir, evrensel standartlarda ve uzmanlaÅŸmÄ±ÅŸ hizmet anlayÄ±ÅŸÄ±nÄ± TÃ¼rkiye'yi kapsayacak ÅŸekilde hÄ±zla yÃ¼rÃ¼tmektedir.\n\nYurtiÃ§inde ve yurt dÄ±ÅŸÄ±nda elde edilen baÅŸarÄ±yÄ± sÃ¼rekli geliÅŸtirerek sektÃ¶rÃ¼nde kÃ¼resel bir ÅŸirket olma yÃ¶nÃ¼nde emin adÄ±mlarla ilerleyen OGS, dinamik ve yetkin kadrosuyla giriÅŸimci, saÄŸduyulu, mÃ¼ÅŸteri odaklÄ± yaklaÅŸÄ±mÄ±yla mÃ¼kemmel hizmet ve teknoloji ÅŸirketi olmuÅŸtur.\n\nMÃ¼ÅŸterilerimizin deÄŸiÅŸen ihtiyaÃ§larÄ±nÄ±n farkÄ±ndayÄ±z ve esnek yapÄ±mÄ±zla, Ã¶ncÃ¼ ve yaratÄ±cÄ± Ã§Ã¶zÃ¼mlerimizle mÃ¼ÅŸterilerimize deÄŸer katan, onlarÄ± farklÄ± kÄ±lan Ã¼rÃ¼n ve hizmetler tasarlayÄ±p sunmaktayÄ±z. MÃ¼ÅŸterilerimizin yaratÄ±cÄ±lÄ±ÄŸÄ±nÄ± tetikleyerek Ã¼rÃ¼nler ve Ã¶zgÃ¼r seÃ§im olanaklarÄ± sunarak farklÄ± olan ve farklÄ± kÄ±lan olarak algÄ±lanÄ±rÄ±z.",
            "organization_annual_revenue": null,
            "organization_annual_revenue_printed": null,
            "organization_total_funding": null,
            "organization_total_funding_printed": null,
            "organization_technologies": "ASP.NET, Bootstrap Framework, Google Tag Manager, Microsoft-IIS, Mobile Friendly",
            "organization_raw_address": "2310/1, ANKARA, Ankara/Yenimahalle/Ergazi 06200, TR",
            "organization_street_address": "",
            "organization_city": "Ankara",
            "organization_state": "Ankara",
            "organization_country": "Turkey",
            "organization_postal_code": "06370"
          }
        },
        {
          "json": {
            "id": "67454e5ef3aed000011639dd",
            "first_name": "Sedat",
            "last_name": "Demir",
            "name": "Sedat Demir",
            "linkedin_url": "http://www.linkedin.com/in/sedat-demir-694682264",
            "title": "Enterprise Resources Planning Project Manager",
            "email_status": null,
            "photo_url": "https://static.licdn.com/aero-v1/sc/h/9c8pery4andzj6ohjkjp54ma2",
            "twitter_url": null,
            "github_url": null,
            "facebook_url": null,
            "extrapolated_email_confidence": null,
            "headline": "ecanta.com.tr ÅŸirketinde Enterprise Resources Planning Project Manager",
            "email": null,
            "organization_id": "54a1226969702d7fe6972003",
            "employment_history": [
              {
                "_id": "684a5d46ab1756000155f68d",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "54a1226969702d7fe6972003",
                "organization_name": "ecanta.com.tr",
                "raw_address": null,
                "start_date": "2022-11-01",
                "title": "Enterprise Resources Planning Project Manager",
                "updated_at": null,
                "id": "684a5d46ab1756000155f68d",
                "key": "684a5d46ab1756000155f68d"
              },
              {
                "_id": "684a5d46ab1756000155f68e",
                "created_at": null,
                "current": true,
                "degree": null,
                "description": null,
                "emails": null,
                "end_date": null,
                "grade_level": null,
                "kind": null,
                "major": null,
                "organization_id": "54a1226969702d7fe6972003",
                "organization_name": "ecanta.com.tr",
                "raw_address": null,
                "start_date": null,
                "title": "IT Manager",
                "updated_at": null,
                "id": "684a5d46ab1756000155f68e",
                "key": "684a5d46ab1756000155f68e"
              }
            ],
            "state": "Ankara",
            "city": null,
            "country": "Turkey",
            "organization": {
              "id": "54a1226969702d7fe6972003",
              "name": "ECANTA",
              "website_url": "http://www.ecanta.com.tr",
              "blog_url": null,
              "angellist_url": null,
              "linkedin_url": "http://www.linkedin.com/company/ecanta",
              "twitter_url": null,
              "facebook_url": null,
              "primary_phone": {
                "number": "+90 850 811 1121",
                "source": "Scraped",
                "sanitized_number": "+908508111121"
              },
              "languages": [],
              "alexa_ranking": 711692,
              "phone": "+90 850 811 1121",
              "linkedin_uid": "2403048",
              "founded_year": null,
              "publicly_traded_symbol": null,
              "publicly_traded_exchange": null,
              "logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6864eeafcc4ddc00012ecb05/picture",
              "crunchbase_url": null,
              "primary_domain": "ecanta.com.tr",
              "sic_codes": [
                "5099"
              ],
              "sanitized_phone": "+908508111121",
              "organization_headcount_six_month_growth": 0,
              "organization_headcount_twelve_month_growth": -0.08333333333333333,
              "organization_headcount_twenty_four_month_growth": -0.08333333333333333
            },
            "departments": [
              "master_engineering_technical"
            ],
            "subdepartments": [
              "project_management"
            ],
            "seniority": "manager",
            "functions": [],
            "intent_strength": null,
            "show_intent": true,
            "email_domain_catchall": false,
            "personal_emails": [],
            "organization_name": "ECANTA",
            "organization_website_url": "http://www.ecanta.com.tr",
            "organization_linkedin_url": "http://www.linkedin.com/company/ecanta",
            "organization_founded_year": null,
            "organization_logo_url": "https://zenprospect-production.s3.amazonaws.com/uploads/pictures/6864eeafcc4ddc00012ecb05/picture",
            "organization_linkedin_uid": "2403048",
            "organization_primary_domain": "ecanta.com.tr",
            "organization_phone": "+90 850 811 1121",
            "organization_twitter_url": null,
            "organization_facebook_url": null
          }
        }
      ]
    },
    "connections": {
      "Apollo URL Maker": {
        "main": [
          [
            {
              "node": "Apify Actors",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking â€˜Test workflowâ€™": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request": {
        "main": [
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets": {
        "main": [
          []
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "Google Sheets1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On form submission": {
        "main": [
          [
            {
              "node": "Apollo URL Maker",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Apify Actors": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          []
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "5ef43fbd-c28f-4cbb-b42b-426cfd8decf3",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "cfKLohJNTwoNW7ET",
    "tags": []
  },
  {
    "name": "Arcads Tool - Remove BG",
    "nodes": [
      {
        "parameters": {
          "method": "POST",
          "url": "https://external-api.arcads.ai/v1/folders",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "accept",
                "value": "application/json"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "name",
                "value": "=KlasÃ¶r-{{ $now.format('dd-MM-yyyy') }}"
              },
              {
                "name": "productId",
                "value": "={{ $json.workspace_id }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -208,
          -608
        ],
        "id": "34779bdb-1b0a-4b0f-86b8-8184da95a32c",
        "name": "KlasÃ¶r OluÅŸtur",
        "retryOnFail": true,
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          }
        }
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=You are a helpful assistant.\n\n\nÅžuna uygun bir aktÃ¶r verisi Ã§ek get actors ile ve bunu output olarak ver.\n\n{{ $('When Executed by Another Workflow').item.json.gender_age }}\n\nTooldaki id Ã§Ä±ktÄ±sÄ±nÄ± (actor.id DEÄžÄ°L, Ã¼stteki id deÄŸeri), Ã§Ä±ktÄ±da id olarak, defaultVoiceId deÄŸerini de defaultVoiceId olarak ver."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2.2,
        "position": [
          80,
          -608
        ],
        "id": "5a13eadc-807b-4a04-8aee-478473f5ba3c",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-5-mini",
            "mode": "list",
            "cachedResultName": "gpt-5-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          160,
          -720
        ],
        "id": "709697a0-9c04-4825-a43c-a1b22d70234d",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "yULUzfG7RC6WaY9a",
            "name": "Burhan API"
          }
        }
      },
      {
        "parameters": {
          "toolDescription": "=Bu aracÄ± bÃ¼tÃ¼n aktÃ¶r verilerini Ã§ekmek iÃ§in kullan.\n\nactorGender = Filter by actor gender (case-insensitive). Values: male, female\n\nactorAge = Filter by actor age (case-insensitive). Values: adult, senior, young adult",
          "url": "https://external-api.arcads.ai/v1/situations",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "page",
                "value": "1"
              },
              {
                "name": "pageSize",
                "value": "1"
              },
              {
                "name": "ispro",
                "value": "true"
              },
              {
                "name": "actorGender",
                "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters3_Value', ``, 'string') }}"
              },
              {
                "name": "actorAge",
                "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters4_Value', ``, 'string') }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "accept",
                "value": "application/json"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.2,
        "position": [
          48,
          -416
        ],
        "id": "55c95ca0-456e-4cb4-b30e-98185c6ed457",
        "name": "Get Actors",
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          }
        }
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n\t\"id\": \"\",\n\t\"defaultVoiceId\": \"\"\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          272,
          -400
        ],
        "id": "8a981b2a-a2a0-42e6-be0e-e6b1d5a2c0c4",
        "name": "Structured Output Parser"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "ed6b3544-518d-4ff5-85d4-f9ac623ee89e",
                "leftValue": "={{ $json.videoUrl }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1552,
          -608
        ],
        "id": "80e3b8ae-16b7-4574-9421-37cfc1ae0db3",
        "name": "If"
      },
      {
        "parameters": {
          "unit": "minutes"
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          1088,
          -608
        ],
        "id": "ff30acd8-2c1b-437a-9c81-1940537b91bf",
        "name": "Wait",
        "webhookId": "e4c88be2-b051-4adc-98ce-0f90fd0e74d3"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://external-api.arcads.ai/v1/scripts",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "accept",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"folderId\": \"{{ $('KlasÃ¶r OluÅŸtur').item.json.id }}\",\n  \"name\": \"string\",\n  \"text\": \"{{ $('When Executed by Another Workflow').item.json.script }}\",\n  \"videos\": [\n    {\n      \"situationId\": \"{{ $json.output.id }}\",\n      \"voiceId\": \"{{ $json.output.defaultVoiceId }}\"\n    }\n  ]\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          560,
          -608
        ],
        "id": "94001feb-d98b-4e10-87dc-e1c1e909af12",
        "name": "Script",
        "retryOnFail": true,
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://external-api.arcads.ai/v1/scripts/{{ $json.id }}/generate",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "accept",
                "value": "application/json"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          848,
          -608
        ],
        "id": "ee97b6c1-4fb2-434d-8d75-57d655eb4f52",
        "name": "Ãœretim",
        "retryOnFail": true,
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://queue.fal.run/fal-ai/ben/v2/video",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "video_url",
                "value": "={{ $('Videoyu Al').item.json.videoUrl }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1856,
          -208
        ],
        "id": "7d282aaa-3654-46e0-9950-a72ecf0f3380",
        "name": "Ä°stek",
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          },
          "httpHeaderAuth": {
            "id": "HWrf6X4nsntv8BlR",
            "name": "fal.ai"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/ben/requests/{{ $json.request_id }}/status",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2320,
          -208
        ],
        "id": "8594d3c7-2fff-4365-a812-5bbed65f5a88",
        "name": "Kontrol",
        "credentials": {
          "httpHeaderAuth": {
            "id": "HWrf6X4nsntv8BlR",
            "name": "fal.ai"
          }
        }
      },
      {
        "parameters": {
          "name": "=Background Removed UGC - {{ $now }}",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "folderId": {
            "__rl": true,
            "value": "1KaKd8b0fmT2ug3PUWZDGbmtH0OKFd9hW",
            "mode": "list",
            "cachedResultName": "Marketing Team",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1KaKd8b0fmT2ug3PUWZDGbmtH0OKFd9hW"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          3296,
          -224
        ],
        "id": "0c09da10-c8f1-4dde-808c-d03c74510369",
        "name": "Upload file",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "YuJeLDU2kzOhnjsq",
            "name": "49 Drive"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/ben/requests/{{ $json.request_id }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2832,
          -224
        ],
        "id": "404dbc7d-50a3-4e44-871c-37edf057e1f3",
        "name": "Al",
        "credentials": {
          "httpHeaderAuth": {
            "id": "HWrf6X4nsntv8BlR",
            "name": "fal.ai"
          }
        }
      },
      {
        "parameters": {
          "url": "={{ $json.video.url }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          3056,
          -224
        ],
        "id": "6b0abf5e-4c09-4688-812e-c6bc23e2f7bc",
        "name": "Ä°ndir"
      },
      {
        "parameters": {
          "amount": 1,
          "unit": "minutes"
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2096,
          -208
        ],
        "id": "cad080f1-796e-40a0-9325-581bd30edf2f",
        "name": "Wait1",
        "webhookId": "1f76d887-9f8a-49be-8cdd-1b1146c4c824"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "5a8a2d4e-6855-45fd-93c9-205e0a381de8",
                "leftValue": "={{ $json.status }}",
                "rightValue": "COMPLETED",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          2528,
          -208
        ],
        "id": "b59aa765-f83a-4e9b-a712-578b285b6832",
        "name": "If1"
      },
      {
        "parameters": {
          "url": "=https://external-api.arcads.ai/v1/scripts/{{ $('Script').item.json.id }}/videos",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1312,
          -608
        ],
        "id": "4f955900-ee5b-41f5-a5c7-0d1ad1e1c2c3",
        "name": "Videoyu Al",
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "workspace_id"
              },
              {
                "name": "gender_age"
              },
              {
                "name": "script"
              },
              {
                "name": "telegram_id"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -496,
          -608
        ],
        "id": "d6013456-5914-4a2d-ad2a-3fe7139a5f80",
        "name": "When Executed by Another Workflow"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "10tfLIcw-bnOaiQhlPTE9TGVboqtiX7KPz1mHb9t_zKA",
            "mode": "list",
            "cachedResultName": "Marketing Team",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10tfLIcw-bnOaiQhlPTE9TGVboqtiX7KPz1mHb9t_zKA/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sayfa1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10tfLIcw-bnOaiQhlPTE9TGVboqtiX7KPz1mHb9t_zKA/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Type": "UGC without background",
              "Link": "={{ $json.webViewLink }}",
              "Title": "=UGC - {{ $now }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Title",
                "displayName": "Title",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Type",
                "displayName": "Type",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Request",
                "displayName": "Request",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "ID",
                "displayName": "ID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Link",
                "displayName": "Link",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          3504,
          -224
        ],
        "id": "fecdf286-f536-421b-8e72-97d37e2c5914",
        "name": "Append row in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "8cw6xg8w0MZaVeCC",
            "name": "PROTOTIPAL"
          }
        }
      },
      {
        "parameters": {
          "chatId": "={{ $('When Executed by Another Workflow').item.json.telegram_id }}",
          "text": "=Your UGC video is ready and uploaded to Drive and added to sheet.\n\n{{ $('Upload file').item.json.webViewLink }}",
          "additionalFields": {}
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          3712,
          -224
        ],
        "id": "771f2d9c-4923-4da4-9b92-77e5b8eedde4",
        "name": "Send a text message",
        "webhookId": "938e1e8c-4b58-4ea6-9c71-e2fa5b09082a",
        "credentials": {
          "telegramApi": {
            "id": "uXHAFQk49G65Euci",
            "name": "marketing_team"
          }
        }
      },
      {
        "parameters": {
          "operation": "sendVideo",
          "chatId": "={{ $('When Executed by Another Workflow').item.json.telegram_id }}",
          "binaryData": true,
          "additionalFields": {}
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          3312,
          0
        ],
        "id": "0f5ff39a-7803-42ca-9210-600c7ce0be4c",
        "name": "Send a video",
        "webhookId": "51205aed-04f4-474b-9d02-0423d0c30b9a",
        "credentials": {
          "telegramApi": {
            "id": "czT9blrJemMNoklz",
            "name": "Telegram account 2"
          }
        }
      }
    ],
    "pinData": {
      "When Executed by Another Workflow": [
        {
          "json": {
            "workspace_id": "0c98d250-7dae-4dbb-9531-8351f79b844e",
            "gender_age": "25 yaÅŸÄ±nda kadÄ±n",
            "script": "Leftflow'u kullanmaya baÅŸladÄ±ÄŸÄ±mdan beri Ã§ok memnunum. GerÃ§ekten hayatÄ±mÄ± kolaylaÅŸtÄ±rdÄ± ve performansÄ± mÃ¼kemmel!",
            "telegram_id": 5181466144
          }
        }
      ]
    },
    "connections": {
      "KlasÃ¶r OluÅŸtur": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "Script",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Actors": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Agent",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Ä°stek",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Videoyu Al",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Script": {
        "main": [
          [
            {
              "node": "Ãœretim",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ãœretim": {
        "main": [
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ä°stek": {
        "main": [
          [
            {
              "node": "Wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Kontrol": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Al": {
        "main": [
          [
            {
              "node": "Ä°ndir",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ä°ndir": {
        "main": [
          [
            {
              "node": "Upload file",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send a video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait1": {
        "main": [
          [
            {
              "node": "Kontrol",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "Al",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Videoyu Al": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "KlasÃ¶r OluÅŸtur",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload file": {
        "main": [
          [
            {
              "node": "Append row in sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Append row in sheet": {
        "main": [
          [
            {
              "node": "Send a text message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send a text message": {
        "main": [
          []
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "921d4dea-0790-47c9-b793-e534bf73a7ca",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "Ec9GfB59HcLys2lO",
    "tags": []
  },
  {
    "name": "Arcads Tool",
    "nodes": [
      {
        "parameters": {
          "method": "POST",
          "url": "https://external-api.arcads.ai/v1/folders",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "accept",
                "value": "application/json"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "name",
                "value": "=KlasÃ¶r-{{ $now.format('dd-MM-yyyy') }}"
              },
              {
                "name": "productId",
                "value": "={{ $json.workspace_id }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -208,
          -608
        ],
        "id": "278b512b-16af-48be-8d11-fe773f22c3c9",
        "name": "KlasÃ¶r OluÅŸtur",
        "retryOnFail": true,
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          }
        }
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=You are a helpful assistant.\n\n\nÅžuna uygun bir aktÃ¶r verisi Ã§ek get actors ile ve bunu output olarak ver.\n\n{{ $('When Executed by Another Workflow').item.json.gender_age }}\n\nTooldaki id Ã§Ä±ktÄ±sÄ±nÄ± (actor.id DEÄžÄ°L, Ã¼stteki id deÄŸeri), Ã§Ä±ktÄ±da id olarak, defaultVoiceId deÄŸerini de defaultVoiceId olarak ver."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2.2,
        "position": [
          80,
          -608
        ],
        "id": "d99fc73c-3cfa-4e9e-9ee7-aed5f5ef332f",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-5-mini",
            "mode": "list",
            "cachedResultName": "gpt-5-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          160,
          -720
        ],
        "id": "4281c79e-2b4a-4470-8cd5-346f71465fe8",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "yULUzfG7RC6WaY9a",
            "name": "Burhan API"
          }
        }
      },
      {
        "parameters": {
          "toolDescription": "=Bu aracÄ± bÃ¼tÃ¼n aktÃ¶r verilerini Ã§ekmek iÃ§in kullan.\n\nactorGender = Filter by actor gender (case-insensitive). Values: male, female\n\nactorAge = Filter by actor age (case-insensitive). Values: adult, senior, young adult",
          "url": "https://external-api.arcads.ai/v1/situations",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "page",
                "value": "1"
              },
              {
                "name": "pageSize",
                "value": "1"
              },
              {
                "name": "ispro",
                "value": "true"
              },
              {
                "name": "actorGender",
                "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters3_Value', ``, 'string') }}"
              },
              {
                "name": "actorAge",
                "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters4_Value', ``, 'string') }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "accept",
                "value": "application/json"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.2,
        "position": [
          48,
          -416
        ],
        "id": "a4d064da-0220-4446-b643-a12ece6366ae",
        "name": "Get Actors",
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          }
        }
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n\t\"id\": \"\",\n\t\"defaultVoiceId\": \"\"\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          272,
          -400
        ],
        "id": "5c88afb0-0afe-4bad-8cb1-46e8b99a15e5",
        "name": "Structured Output Parser"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "ed6b3544-518d-4ff5-85d4-f9ac623ee89e",
                "leftValue": "={{ $json.videoUrl }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1552,
          -608
        ],
        "id": "6486a8ee-f058-4541-8a8e-9b9d93024e53",
        "name": "If"
      },
      {
        "parameters": {
          "unit": "minutes"
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          1088,
          -608
        ],
        "id": "5649fbbc-5aab-460d-a4db-62ca23447a2f",
        "name": "Wait",
        "webhookId": "430de2a0-a5b9-4ee2-bf98-f13134c5d840"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://external-api.arcads.ai/v1/scripts",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "accept",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"folderId\": \"{{ $('KlasÃ¶r OluÅŸtur').item.json.id }}\",\n  \"name\": \"string\",\n  \"text\": \"{{ $('When Executed by Another Workflow').item.json.script }}\",\n  \"videos\": [\n    {\n      \"situationId\": \"{{ $json.output.id }}\",\n      \"voiceId\": \"{{ $json.output.defaultVoiceId }}\"\n    }\n  ]\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          560,
          -608
        ],
        "id": "6ff0452a-2dc3-4bf5-8f04-827a17fed76d",
        "name": "Script",
        "retryOnFail": true,
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://external-api.arcads.ai/v1/scripts/{{ $json.id }}/generate",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "accept",
                "value": "application/json"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          848,
          -608
        ],
        "id": "b614f6c5-b4a8-4a51-bab9-7d0fa1bcb162",
        "name": "Ãœretim",
        "retryOnFail": true,
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          }
        }
      },
      {
        "parameters": {
          "name": "=Background Removed UGC - {{ $now }}",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "folderId": {
            "__rl": true,
            "value": "1KaKd8b0fmT2ug3PUWZDGbmtH0OKFd9hW",
            "mode": "list",
            "cachedResultName": "Marketing Team",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1KaKd8b0fmT2ug3PUWZDGbmtH0OKFd9hW"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          2192,
          -624
        ],
        "id": "2fa71906-c47b-4213-acd6-be720348b4dd",
        "name": "Upload file",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "YuJeLDU2kzOhnjsq",
            "name": "49 Drive"
          }
        }
      },
      {
        "parameters": {
          "url": "={{ $('Videoyu Al').item.json.videoUrl }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1952,
          -624
        ],
        "id": "6df524e7-8084-44ba-9778-bdbbe66d4faa",
        "name": "Ä°ndir"
      },
      {
        "parameters": {
          "url": "=https://external-api.arcads.ai/v1/scripts/{{ $('Script').item.json.id }}/videos",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpBasicAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1312,
          -608
        ],
        "id": "4507141e-7342-4662-88a1-636111a4a355",
        "name": "Videoyu Al",
        "credentials": {
          "httpBasicAuth": {
            "id": "JJfIYWBt9KFEE8Br",
            "name": "Arcads"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "workspace_id"
              },
              {
                "name": "gender_age"
              },
              {
                "name": "script"
              },
              {
                "name": "telegram_id"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -496,
          -608
        ],
        "id": "14c3ba88-cbcd-4824-b437-8324381f38a3",
        "name": "When Executed by Another Workflow"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "10tfLIcw-bnOaiQhlPTE9TGVboqtiX7KPz1mHb9t_zKA",
            "mode": "list",
            "cachedResultName": "Marketing Team",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10tfLIcw-bnOaiQhlPTE9TGVboqtiX7KPz1mHb9t_zKA/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sayfa1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10tfLIcw-bnOaiQhlPTE9TGVboqtiX7KPz1mHb9t_zKA/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Type": "UGC",
              "Link": "={{ $json.webViewLink }}",
              "Title": "=UGC - {{ $now }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Title",
                "displayName": "Title",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Type",
                "displayName": "Type",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Request",
                "displayName": "Request",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "ID",
                "displayName": "ID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Link",
                "displayName": "Link",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2400,
          -624
        ],
        "id": "88a35404-518c-482a-babf-5c81dd8291d3",
        "name": "Append row in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "8cw6xg8w0MZaVeCC",
            "name": "PROTOTIPAL"
          }
        }
      },
      {
        "parameters": {
          "chatId": "={{ $('When Executed by Another Workflow').item.json.telegram_id }}",
          "text": "=Your UGC video is ready and uploaded to Drive and added to sheet.\n\n{{ $('Upload file').item.json.webViewLink }}",
          "additionalFields": {}
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          2608,
          -624
        ],
        "id": "ea1f7e91-a3b6-40d8-8ae6-7ffc20911c28",
        "name": "Send a text message",
        "webhookId": "6e00ae5d-a407-4b83-aae6-1e0193bfe16e",
        "credentials": {
          "telegramApi": {
            "id": "uXHAFQk49G65Euci",
            "name": "marketing_team"
          }
        }
      },
      {
        "parameters": {
          "operation": "sendVideo",
          "chatId": "={{ $('When Executed by Another Workflow').item.json.telegram_id }}",
          "binaryData": true,
          "additionalFields": {}
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          2176,
          -832
        ],
        "id": "55b8c28e-c478-495f-b3d4-96b2f5286d22",
        "name": "Send a video",
        "webhookId": "51205aed-04f4-474b-9d02-0423d0c30b9a",
        "credentials": {
          "telegramApi": {
            "id": "czT9blrJemMNoklz",
            "name": "Telegram account 2"
          }
        }
      }
    ],
    "pinData": {
      "When Executed by Another Workflow": [
        {
          "json": {
            "workspace_id": "0c98d250-7dae-4dbb-9531-8351f79b844e",
            "gender_age": "50 yaÅŸÄ±nda kadÄ±n",
            "script": "Bu Ã¼rÃ¼nÃ¼ tamamen tesadÃ¼fen keÅŸfettim ve iyi ki keÅŸfetmiÅŸim! Ä°lk kullandÄ±ÄŸÄ±m andan itibaren farkÄ± hissettim. Hem kullanÄ±mÄ± Ã§ok pratik hem de gerÃ§ekten iÅŸe yarÄ±yor. GÃ¼nlÃ¼k rutinimin vazgeÃ§ilmezi haline geldi. Daha Ã¶nce neden denememiÅŸim diye kendime kÄ±zÄ±yorum! EÄŸer siz de benim gibi sÃ¼rekli yeni ÅŸeyler denemeyi seviyorsanÄ±z, bu Ã¼rÃ¼nÃ¼ mutlaka bir deneyin derim. BayÄ±ldÄ±m!"
          }
        }
      ]
    },
    "connections": {
      "KlasÃ¶r OluÅŸtur": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "Script",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Actors": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Agent",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Ä°ndir",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Videoyu Al",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Script": {
        "main": [
          [
            {
              "node": "Ãœretim",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ãœretim": {
        "main": [
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ä°ndir": {
        "main": [
          [
            {
              "node": "Upload file",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send a video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Videoyu Al": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "KlasÃ¶r OluÅŸtur",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload file": {
        "main": [
          [
            {
              "node": "Append row in sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Append row in sheet": {
        "main": [
          [
            {
              "node": "Send a text message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "c6089ea8-e60c-44d1-a94b-6baa0f3cb66b",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "ylEqhRhAd9V0Bghk",
    "tags": []
  },
  {
    "name": "Asistan",
    "nodes": [
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.text }}",
          "options": {
            "systemMessage": "=# Overview\nYou are the ultimate personal assistant. Your job is to send the user's query to the correct tool. You should never be writing emails, or creating even summaries, you just need to call the correct tool.\n\n## Tools\n- Think: Use this to think deeply or if you get stuck\n- emailAgent: Use this tool to take action in email\n- calendarAgent: Use this tool to take action in calendar\n- contactAgent: Use this tool to get, update, or add contacts\n- contentCreator: Use this tool to create blog posts\n- Tavily: Use this tool to search the web\n\n## Rules\n- Write Turkish\n- Some actions require you to look up contact information first. For the following actions, you must get contact information and send that to the agent who needs it:\n  - sending emails\n  - drafting emails\n  - creating calendar event with attendee\n\n## Instructions\n1) Call the neccessary tools based on the user request\n2) Use the \"Think\" tool to verify you took the right steps. This tool should be called every time.\n\n\n## Examples\n1) \n- Input: send an email to nate herkelman asking him what time he wants to leave\n  - Action: Use contactAgent to get nate herkelman's email\n  - Action: Use emailAgent to send the email. You will pass the tool a query like \"send BURHAN KOCABIYIK an email to ask what time he wants to leave. here is his email: [email address]\n- Output: The email has been sent to BURHAN KOCABIYIK. Anything else I can help you with?\n\n\n## Final Reminders\nHere is the current date/time: {{ $now }}\n"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          1888,
          224
        ],
        "id": "36aa068e-9c3b-491e-8d66-009430cb6f3b",
        "name": "Ultimate Assistant"
      },
      {
        "parameters": {
          "name": "emailAgent",
          "description": "Call this tool for any email actions.",
          "workflowId": {
            "__rl": true,
            "value": "tXp19Eb4GfIy5clN",
            "mode": "list",
            "cachedResultName": "email"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2,
        "position": [
          1792,
          768
        ],
        "id": "d301bb0d-154b-48ba-a230-6d6f4d02c30a",
        "name": "Email Agent"
      },
      {
        "parameters": {
          "name": "contactAgent",
          "description": "Call this tool for any contact related actions.",
          "workflowId": {
            "__rl": true,
            "value": "eSNKiA8kWNb5gnrL",
            "mode": "list",
            "cachedResultName": "sub - contact"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2,
        "position": [
          2064,
          768
        ],
        "id": "b2dca962-409e-4136-86e1-0e08c3e4c964",
        "name": "Contact Agent"
      },
      {
        "parameters": {
          "name": "contentCreator",
          "description": "Call this tool to create blog posts.",
          "workflowId": {
            "__rl": true,
            "value": "8QmlnUgNP9oTbD9s",
            "mode": "list",
            "cachedResultName": "sub - content creator"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2,
        "position": [
          2208,
          768
        ],
        "id": "39b36b53-ffe0-4927-8b0f-c0a8b9b80818",
        "name": "Content Creator Agent"
      },
      {
        "parameters": {
          "toolDescription": "Use this tool to search the internet",
          "method": "POST",
          "url": "https://api.tavily.com/search",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "{\n    \"api_key\": \"\",\n    \"query\": \"{searchTerm}\",\n    \"search_depth\": \"basic\",\n    \"include_answer\": true,\n    \"topic\": \"news\",\n    \"include_raw_content\": true,\n    \"max_results\": 3\n} ",
          "placeholderDefinitions": {
            "values": [
              {
                "name": "searchTerm",
                "description": "What the user has requested to search the internet for",
                "type": "string"
              }
            ]
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "typeVersion": 1.1,
        "position": [
          2400,
          512
        ],
        "id": "344dcaa4-9ed3-4464-8e29-f986022e5f5a",
        "name": "Tavily"
      },
      {
        "parameters": {},
        "type": "@n8n/n8n-nodes-langchain.toolCalculator",
        "typeVersion": 1,
        "position": [
          2560,
          512
        ],
        "id": "f803e468-b319-459b-9176-1c0e8d2683f2",
        "name": "Calculator"
      },
      {
        "parameters": {
          "name": "calendarAgent",
          "description": "Call this tool for any calendar action.",
          "workflowId": {
            "__rl": true,
            "value": "V7spe8aGpkrEggB2",
            "mode": "list",
            "cachedResultName": "sub - calendar"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2,
        "position": [
          1920,
          768
        ],
        "id": "d9cbce2c-3b4d-49f8-9a53-b2cc0041f633",
        "name": "Calendar Agent"
      },
      {
        "parameters": {
          "content": "# Parent Agent\n\n",
          "height": 260,
          "width": 420,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1808,
          128
        ],
        "typeVersion": 1,
        "id": "fe58a618-9d3e-40a0-9274-818c3076844a",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "# Children\n## Sub-Workflows\n",
          "height": 200,
          "width": 800,
          "color": 2
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1552,
          720
        ],
        "typeVersion": 1,
        "id": "b59a9728-1892-47a4-ab15-22002568c995",
        "name": "Sticky Note1"
      },
      {
        "parameters": {},
        "type": "@n8n/n8n-nodes-langchain.toolThink",
        "typeVersion": 1,
        "position": [
          2448,
          800
        ],
        "id": "132fe19e-4d81-4341-aab4-94a830edc069",
        "name": "Think"
      },
      {
        "parameters": {
          "content": "# Think\n",
          "height": 200,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          2368,
          720
        ],
        "id": "628790ad-e02f-45d0-acc5-1764dba5c5b1",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "updates": [
            "message"
          ],
          "additionalFields": {}
        },
        "id": "3b1dfad3-c43e-4dc0-984c-7339a721af87",
        "name": "Telegram Trigger",
        "type": "n8n-nodes-base.telegramTrigger",
        "typeVersion": 1.1,
        "position": [
          1088,
          224
        ],
        "webhookId": "99eab1a0-569d-4f0f-a49e-578a02abfe63",
        "credentials": {
          "telegramApi": {
            "id": "b1omZkvG0vnucyaA",
            "name": "prototipal_asistan_bot"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "fe7ecc99-e1e8-4a5e-bdd6-6fce9757b234",
                "name": "text",
                "value": "={{ $json.message.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "ff33e9e3-6955-4b11-8a1e-0e98dbaca1c8",
        "name": "Set 'Text'",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1472,
          240
        ]
      },
      {
        "parameters": {
          "resource": "file",
          "fileId": "={{ $json.message.voice.file_id }}",
          "additionalFields": {}
        },
        "id": "fe6254e0-0a02-4b97-bb97-08a2ae42079c",
        "name": "Download Voice File",
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          1408,
          80
        ],
        "webhookId": "c0b376b1-7b63-41b6-8063-0b3096b8333d",
        "credentials": {
          "telegramApi": {
            "id": "b1omZkvG0vnucyaA",
            "name": "prototipal_asistan_bot"
          }
        }
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {}
        },
        "id": "eb496f09-3354-4828-b1bc-4da067076e94",
        "name": "Transcribe Audio",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          1568,
          80
        ],
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.message.voice.file_id }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Voice"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "8c844924-b2ed-48b0-935c-c66a8fd0c778",
                      "leftValue": "={{ $json.message.text }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Text"
              }
            ]
          },
          "options": {}
        },
        "id": "e66f1112-d241-45aa-8274-fdfcb336a07d",
        "name": "Switch",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          1232,
          224
        ]
      },
      {
        "parameters": {
          "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
          "text": "={{ $json.output }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "id": "0f339eaf-2932-4193-ba9b-76e663fe503a",
        "name": "Response",
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          2304,
          224
        ],
        "webhookId": "682ca5ab-d30c-4ea5-bb25-c2f26206e761",
        "credentials": {
          "telegramApi": {
            "id": "b1omZkvG0vnucyaA",
            "name": "prototipal_asistan_bot"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          1728,
          528
        ],
        "id": "07a93495-badb-4e58-a2c6-6ff4efb2cfd5",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          1568,
          512
        ],
        "id": "09fa3f2d-e3fa-4e34-9df0-12b5835eb376",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      }
    ],
    "pinData": {},
    "connections": {
      "Email Agent": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Contact Agent": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Content Creator Agent": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Tavily": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Calculator": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Calendar Agent": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Think": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Telegram Trigger": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Voice File": {
        "main": [
          [
            {
              "node": "Transcribe Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Download Voice File",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set 'Text'",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set 'Text'": {
        "main": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transcribe Audio": {
        "main": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ultimate Assistant": {
        "main": [
          [
            {
              "node": "Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "fd0c924e-fc26-4310-970b-acbd41285be0",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "rguqU83R2P7Jm4tR",
    "tags": []
  },
  {
    "name": "Asistan",
    "nodes": [
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.text }}",
          "options": {
            "systemMessage": "=# Overview\nYou are the ultimate personal assistant. Your job is to send the user's query to the correct tool. You should never be writing emails, or creating even summaries, you just need to call the correct tool.\n\n## Tools\n- Think: Use this to think deeply or if you get stuck\n- emailAgent: Use this tool to take action in email\n- calendarAgent: Use this tool to take action in calendar\n- contactAgent: Use this tool to get, update, or add contacts\n- contentCreator: Use this tool to create blog posts\n- Tavily: Use this tool to search the web\n\n## Rules\n- Write Turkish\n- Some actions require you to look up contact information first. For the following actions, you must get contact information and send that to the agent who needs it:\n  - sending emails\n  - drafting emails\n  - creating calendar event with attendee\n\n## Instructions\n1) Call the neccessary tools based on the user request\n2) Use the \"Think\" tool to verify you took the right steps. This tool should be called every time.\n\n\n## Examples\n1) \n- Input: send an email to nate herkelman asking him what time he wants to leave\n  - Action: Use contactAgent to get nate herkelman's email\n  - Action: Use emailAgent to send the email. You will pass the tool a query like \"send BURHAN KOCABIYIK an email to ask what time he wants to leave. here is his email: [email address]\n- Output: The email has been sent to BURHAN KOCABIYIK. Anything else I can help you with?\n\n\n## Final Reminders\nHere is the current date/time: {{ $now }}\n"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          1888,
          224
        ],
        "id": "36aa068e-9c3b-491e-8d66-009430cb6f3b",
        "name": "Ultimate Assistant"
      },
      {
        "parameters": {
          "name": "emailAgent",
          "description": "Call this tool for any email actions.",
          "workflowId": {
            "__rl": true,
            "value": "tXp19Eb4GfIy5clN",
            "mode": "list",
            "cachedResultName": "email"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2,
        "position": [
          1792,
          768
        ],
        "id": "d301bb0d-154b-48ba-a230-6d6f4d02c30a",
        "name": "Email Agent"
      },
      {
        "parameters": {
          "name": "contactAgent",
          "description": "Call this tool for any contact related actions.",
          "workflowId": {
            "__rl": true,
            "value": "eSNKiA8kWNb5gnrL",
            "mode": "list",
            "cachedResultName": "sub - contact"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2,
        "position": [
          2064,
          768
        ],
        "id": "b2dca962-409e-4136-86e1-0e08c3e4c964",
        "name": "Contact Agent"
      },
      {
        "parameters": {
          "name": "contentCreator",
          "description": "Call this tool to create blog posts.",
          "workflowId": {
            "__rl": true,
            "value": "8QmlnUgNP9oTbD9s",
            "mode": "list",
            "cachedResultName": "sub - content creator"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2,
        "position": [
          2208,
          768
        ],
        "id": "39b36b53-ffe0-4927-8b0f-c0a8b9b80818",
        "name": "Content Creator Agent"
      },
      {
        "parameters": {
          "toolDescription": "Use this tool to search the internet",
          "method": "POST",
          "url": "https://api.tavily.com/search",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "{\n    \"api_key\": \"\",\n    \"query\": \"{searchTerm}\",\n    \"search_depth\": \"basic\",\n    \"include_answer\": true,\n    \"topic\": \"news\",\n    \"include_raw_content\": true,\n    \"max_results\": 3\n} ",
          "placeholderDefinitions": {
            "values": [
              {
                "name": "searchTerm",
                "description": "What the user has requested to search the internet for",
                "type": "string"
              }
            ]
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "typeVersion": 1.1,
        "position": [
          2400,
          512
        ],
        "id": "344dcaa4-9ed3-4464-8e29-f986022e5f5a",
        "name": "Tavily"
      },
      {
        "parameters": {},
        "type": "@n8n/n8n-nodes-langchain.toolCalculator",
        "typeVersion": 1,
        "position": [
          2560,
          512
        ],
        "id": "f803e468-b319-459b-9176-1c0e8d2683f2",
        "name": "Calculator"
      },
      {
        "parameters": {
          "name": "calendarAgent",
          "description": "Call this tool for any calendar action.",
          "workflowId": {
            "__rl": true,
            "value": "V7spe8aGpkrEggB2",
            "mode": "list",
            "cachedResultName": "sub - calendar"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2,
        "position": [
          1920,
          768
        ],
        "id": "d9cbce2c-3b4d-49f8-9a53-b2cc0041f633",
        "name": "Calendar Agent"
      },
      {
        "parameters": {
          "content": "# Parent Agent\n\n",
          "height": 260,
          "width": 420,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1808,
          128
        ],
        "typeVersion": 1,
        "id": "fe58a618-9d3e-40a0-9274-818c3076844a",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "# Children\n## Sub-Workflows\n",
          "height": 200,
          "width": 800,
          "color": 2
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1552,
          720
        ],
        "typeVersion": 1,
        "id": "b59a9728-1892-47a4-ab15-22002568c995",
        "name": "Sticky Note1"
      },
      {
        "parameters": {},
        "type": "@n8n/n8n-nodes-langchain.toolThink",
        "typeVersion": 1,
        "position": [
          2448,
          800
        ],
        "id": "132fe19e-4d81-4341-aab4-94a830edc069",
        "name": "Think"
      },
      {
        "parameters": {
          "content": "# Think\n",
          "height": 200,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          2368,
          720
        ],
        "id": "628790ad-e02f-45d0-acc5-1764dba5c5b1",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "updates": [
            "message"
          ],
          "additionalFields": {}
        },
        "id": "3b1dfad3-c43e-4dc0-984c-7339a721af87",
        "name": "Telegram Trigger",
        "type": "n8n-nodes-base.telegramTrigger",
        "typeVersion": 1.1,
        "position": [
          1088,
          224
        ],
        "webhookId": "99eab1a0-569d-4f0f-a49e-578a02abfe63",
        "credentials": {
          "telegramApi": {
            "id": "b1omZkvG0vnucyaA",
            "name": "prototipal_asistan_bot"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "fe7ecc99-e1e8-4a5e-bdd6-6fce9757b234",
                "name": "text",
                "value": "={{ $json.message.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "ff33e9e3-6955-4b11-8a1e-0e98dbaca1c8",
        "name": "Set 'Text'",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1472,
          240
        ]
      },
      {
        "parameters": {
          "resource": "file",
          "fileId": "={{ $json.message.voice.file_id }}",
          "additionalFields": {}
        },
        "id": "fe6254e0-0a02-4b97-bb97-08a2ae42079c",
        "name": "Download Voice File",
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          1408,
          80
        ],
        "webhookId": "c0b376b1-7b63-41b6-8063-0b3096b8333d",
        "credentials": {
          "telegramApi": {
            "id": "b1omZkvG0vnucyaA",
            "name": "prototipal_asistan_bot"
          }
        }
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {}
        },
        "id": "eb496f09-3354-4828-b1bc-4da067076e94",
        "name": "Transcribe Audio",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          1568,
          80
        ],
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.message.voice.file_id }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Voice"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "8c844924-b2ed-48b0-935c-c66a8fd0c778",
                      "leftValue": "={{ $json.message.text }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "exists",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Text"
              }
            ]
          },
          "options": {}
        },
        "id": "e66f1112-d241-45aa-8274-fdfcb336a07d",
        "name": "Switch",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          1232,
          224
        ]
      },
      {
        "parameters": {
          "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
          "text": "={{ $json.output }}",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "id": "0f339eaf-2932-4193-ba9b-76e663fe503a",
        "name": "Response",
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          2304,
          224
        ],
        "webhookId": "682ca5ab-d30c-4ea5-bb25-c2f26206e761",
        "credentials": {
          "telegramApi": {
            "id": "b1omZkvG0vnucyaA",
            "name": "prototipal_asistan_bot"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          1728,
          528
        ],
        "id": "07a93495-badb-4e58-a2c6-6ff4efb2cfd5",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          1568,
          512
        ],
        "id": "09fa3f2d-e3fa-4e34-9df0-12b5835eb376",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      }
    ],
    "pinData": {},
    "connections": {
      "Email Agent": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Contact Agent": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Content Creator Agent": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Tavily": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Calculator": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Calendar Agent": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Think": {
        "ai_tool": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Telegram Trigger": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download Voice File": {
        "main": [
          [
            {
              "node": "Transcribe Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Download Voice File",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set 'Text'",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set 'Text'": {
        "main": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transcribe Audio": {
        "main": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ultimate Assistant": {
        "main": [
          [
            {
              "node": "Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Ultimate Assistant",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "fd0c924e-fc26-4310-970b-acbd41285be0",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "rguqU83R2P7Jm4tR",
    "tags": []
  },
  {
    "name": "Cold Outreach Dm (HazÄ±r)",
    "nodes": [
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          0,
          0
        ],
        "id": "9fb83352-035f-4e7e-9219-8b4fd1bb6209",
        "name": "When clicking â€˜Test workflowâ€™"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Generate a friendly and direct icebreaker for a personalized event invitation email. The message should:\n1. Be written in an engaging, professional tone\n2. Reference specific details from the person's LinkedIn profile and company\n3. End with \"Figured I'd reach out.\"\n4. Invite them to speak at our upcoming industry event\n5. Within 250 words.\n6. Never include this line: I hope this message finds you well! \n\nHere's information about the recipient:\nFirst name: {{ $('Google Sheets').item.json['First Name'] }}\nCompany description: {{ $('Google Sheets').item.json['Company Description'] }}\nCompany name: {{ $json.COMPANY_Name }}\nJob Title: {{ $('Google Sheets').item.json.Title }}\n\nOur event is an exclusive conference focused on AI and automation innovations in business processes. We're bringing together thought leaders and practitioners to share cutting-edge approaches and successful implementation strategies.\n\nYou have access to a LinkedIn Profile tool. Use this tool to gather additional information about the recipient before writing your message. To use the tool, simply indicate that you want to call the LinkedIn profile tool, then incorporate relevant information from their profile into your message.\n\nFormatting instruction:\nReturn ONLY a JSON object with a single \"icebreaker\" key containing the personalized message.",
          "hasOutputParser": true,
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          660,
          0
        ],
        "id": "1df28f8a-700a-4e17-9a48-66f86b9e2670",
        "name": "AI Agent",
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          640,
          240
        ],
        "id": "7ef8fe20-52fc-4d7c-a190-358a976d4d6c",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\"icebreaker\":\"message\"}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          820,
          220
        ],
        "id": "5005a447-ff1d-4bc8-996b-a7a682b10bb2",
        "name": "Structured Output Parser"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "f75c0843-d5a8-4043-be4f-4f5fcb09b456",
                "name": "COMPANY_Name",
                "value": "={{$json['Company Name'].replace(/\\s+Ltd\\.?$/i, '').replace(/(,?\\\\\\\\s*)?(Inc|LLC|Corp|Ltd|Limited|Corporation|Company|Group|Holdings|International|Solutions|Technologies|Enterprises|Partners|Association|PLC|S\\\\\\\\.A\\\\\\\\.|GmbH|Co\\\\\\\\.|Services)\\\\\\\\.?$/i, '').trim()}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          440,
          0
        ],
        "id": "ef172b99-9dc5-4ec6-9c82-2b60ffc77c95",
        "name": "Clean up company"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1jpJ-Cta2g0QI12NNCpSjsEjkdyaPXs0BL9XZ8I-8hT0",
            "mode": "list",
            "cachedResultName": "Cold Outreach DM",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1jpJ-Cta2g0QI12NNCpSjsEjkdyaPXs0BL9XZ8I-8hT0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sheet1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1jpJ-Cta2g0QI12NNCpSjsEjkdyaPXs0BL9XZ8I-8hT0/edit#gid=0"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          220,
          0
        ],
        "id": "56e6fa49-77a3-4b50-8835-3118448f7c93",
        "name": "Google Sheets",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "8cw6xg8w0MZaVeCC",
            "name": "PROTOTIPAL"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1jpJ-Cta2g0QI12NNCpSjsEjkdyaPXs0BL9XZ8I-8hT0",
            "mode": "list",
            "cachedResultName": "Cold Outreach DM",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1jpJ-Cta2g0QI12NNCpSjsEjkdyaPXs0BL9XZ8I-8hT0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sheet1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1jpJ-Cta2g0QI12NNCpSjsEjkdyaPXs0BL9XZ8I-8hT0/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Linkedin Url": "={{ $('Google Sheets').item.json['Linkedin Url'] }}",
              "Icebreaker": "={{ $json.output.icebreaker }}"
            },
            "matchingColumns": [
              "Linkedin Url"
            ],
            "schema": [
              {
                "id": "First Name",
                "displayName": "First Name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Last Name",
                "displayName": "Last Name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Linkedin Url",
                "displayName": "Linkedin Url",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Title",
                "displayName": "Title",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "COMPANY_INDUSTRY",
                "displayName": "COMPANY_INDUSTRY",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "COMPANY_EMPLOYEE_COUNT",
                "displayName": "COMPANY_EMPLOYEE_COUNT",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Company Name",
                "displayName": "Company Name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Company Description",
                "displayName": "Company Description",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Icebreaker",
                "displayName": "Icebreaker",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1040,
          0
        ],
        "id": "1248b5f2-7b42-479f-b61c-c084b2f3d866",
        "name": "Update Google sheet1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "8cw6xg8w0MZaVeCC",
            "name": "PROTOTIPAL"
          }
        }
      }
    ],
    "pinData": {},
    "connections": {
      "When clicking â€˜Test workflowâ€™": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Agent",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "Update Google sheet1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Clean up company": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets": {
        "main": [
          [
            {
              "node": "Clean up company",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "464bfbeb-6037-410c-8ac2-ef260d144ee2",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "F7RLhhl7cNb9G3x4",
    "tags": []
  },
  {
    "name": "Company technology and tech (HazÄ±r)",
    "nodes": [
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          0,
          0
        ],
        "id": "d29df83f-7fa3-4242-9fe1-73c3a06e9096",
        "name": "When clicking â€˜Test workflowâ€™"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "12LgBE2LaNMdgmMhL82D5_GIjMPJLXEoOyXRCXLCR11s",
            "mode": "list",
            "cachedResultName": "Company Domain",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/12LgBE2LaNMdgmMhL82D5_GIjMPJLXEoOyXRCXLCR11s/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sheet1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/12LgBE2LaNMdgmMhL82D5_GIjMPJLXEoOyXRCXLCR11s/edit#gid=0"
          },
          "filtersUI": {
            "values": [
              {
                "lookupColumn": "Analysis & Tracking Tools"
              },
              {
                "lookupColumn": "Security & Performance"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          220,
          0
        ],
        "id": "c9e754e6-e2e8-4415-a936-f7c5ad475232",
        "name": "Google Sheets",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "8cw6xg8w0MZaVeCC",
            "name": "PROTOTIPAL"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          440,
          0
        ],
        "id": "2611520e-5a73-4bfd-8004-f1e54ca47f8b",
        "name": "Loop Over Items"
      },
      {
        "parameters": {
          "url": "=https://r.jina.ai/builtwith.com/{{ $('Google Sheets').item.json['Company Domain'] }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          660,
          0
        ],
        "id": "c97264ff-8ca7-4b6b-82fc-af562f84d699",
        "name": "Tech technologies sourcing"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.data }}",
          "hasOutputParser": true,
          "messages": {
            "messageValues": [
              {
                "message": "Analyze the received content and identify only the technologies used by the company. Ignore all other information. Response format: Present the results as a structured list organized by categories. Each category will group similar technologies. Example classification:  Hosting & Servers: [Technology names] CMS & Content Management: [Technology names] Analysis & Tracking Tools: [Technology names] Security & Performance: [Technology names] Other technologies: [Technology names]  Constraints:  Do not include irrelevant text (advertisements, external sources, etc.). Limit to technologies specific to the analyzed company. Provide a clear and concise response."
              }
            ]
          }
        },
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.6,
        "position": [
          880,
          0
        ],
        "id": "e3ad31e3-c597-4bc3-8da6-2edd6260dd1f",
        "name": "Basic LLM Chain"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          840,
          220
        ],
        "id": "ce093bce-34e7-46a4-b0fd-4af78ccc4459",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n  \"technologies\": {\n    \"Hosting & Servers\": [\n      \"Cloudflare\",\n      \"AWS CloudFront\"\n    ],\n    \"CMS & Content Management\": [\n      \"WordPress\"\n    ],\n    \"Analysis & Tracking Tools\": [\n      \"Google Analytics\",\n      \"Hotjar\"\n    ],\n    \"Security & Performance\": [\n      \"reCAPTCHA\",\n      \"SSL by Let's Encrypt\"\n    ],\n    \"Other technologies\": [\n      \"Google Tag Manager\",\n      \"Facebook Pixel\"\n    ]\n  }\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          1020,
          220
        ],
        "id": "cbe71cff-911c-4cd3-a60b-e73d7e84fbf8",
        "name": "Structured Output Parser"
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "value": "12LgBE2LaNMdgmMhL82D5_GIjMPJLXEoOyXRCXLCR11s",
            "mode": "list",
            "cachedResultName": "Company Domain",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/12LgBE2LaNMdgmMhL82D5_GIjMPJLXEoOyXRCXLCR11s/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sheet1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/12LgBE2LaNMdgmMhL82D5_GIjMPJLXEoOyXRCXLCR11s/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Company Domain": "={{ $('Google Sheets').item.json['Company Domain'] }}",
              "Hosting & Servers": "={{ $json.output.technologies['Hosting & Servers'].join(', ') }}",
              "CMS & Content Management": "={{ $json.output.technologies['CMS & Content Management'].join(', ') }}",
              "Analysis & Tracking Tools": "={{ $json.output.technologies['Analysis & Tracking Tools'].join(',') }}",
              "Security & Performance": "={{ $json.output.technologies['Security & Performance'].join(', ') }}",
              "Other Technologies": "={{ $json.output.technologies['Other technologies'].join(\", \") }}"
            },
            "matchingColumns": [
              "Company Domain"
            ],
            "schema": [
              {
                "id": "Company Domain",
                "displayName": "Company Domain",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Hosting & Servers",
                "displayName": "Hosting & Servers",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "CMS & Content Management",
                "displayName": "CMS & Content Management",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Analysis & Tracking Tools",
                "displayName": "Analysis & Tracking Tools",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Security & Performance",
                "displayName": "Security & Performance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Other Technologies",
                "displayName": "Other Technologies",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1260,
          0
        ],
        "id": "2fa253c7-c578-45d3-bfac-ad9111961d5c",
        "name": "Google Sheets2",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "8cw6xg8w0MZaVeCC",
            "name": "PROTOTIPAL"
          }
        }
      }
    ],
    "pinData": {},
    "connections": {
      "When clicking â€˜Test workflowâ€™": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [],
          [
            {
              "node": "Tech technologies sourcing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tech technologies sourcing": {
        "main": [
          [
            {
              "node": "Basic LLM Chain",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Basic LLM Chain",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "Basic LLM Chain",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Basic LLM Chain": {
        "main": [
          [
            {
              "node": "Google Sheets2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets2": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "147bed94-8166-4f73-bdf0-47def5f4e522",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "tTWkgKy4OXzIRzZy",
    "tags": []
  },
  {
    "name": "Edit Image",
    "nodes": [
      {
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "image"
              },
              {
                "name": "request"
              },
              {
                "name": "chatID"
              },
              {
                "name": "pictureID"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -944,
          208
        ],
        "id": "92ed5928-57c2-4cbd-8f52-c3b23162e9e1",
        "name": "When Executed by Another Workflow"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "10tfLIcw-bnOaiQhlPTE9TGVboqtiX7KPz1mHb9t_zKA",
            "mode": "list",
            "cachedResultName": "Marketing Team",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10tfLIcw-bnOaiQhlPTE9TGVboqtiX7KPz1mHb9t_zKA/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sayfa1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/10tfLIcw-bnOaiQhlPTE9TGVboqtiX7KPz1mHb9t_zKA/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Request": "={{ $('When Executed by Another Workflow').item.json.request }}",
              "ID": "={{ $json.id }}",
              "Link": "={{ $json.webViewLink }}",
              "Title": "={{ $('When Executed by Another Workflow').item.json.image }}",
              "Type": "Edit"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Title",
                "displayName": "Title",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Type",
                "displayName": "Type",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Request",
                "displayName": "Request",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "ID",
                "displayName": "ID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Link",
                "displayName": "Link",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1744,
          352
        ],
        "id": "f59273ca-3354-467f-83c5-5a412eff5daa",
        "name": "Image Log",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "8cw6xg8w0MZaVeCC",
            "name": "PROTOTIPAL"
          }
        }
      },
      {
        "parameters": {
          "name": "={{ $('When Executed by Another Workflow').item.json.image }} (Edited).png",
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "folderId": {
            "__rl": true,
            "value": "1KaKd8b0fmT2ug3PUWZDGbmtH0OKFd9hW",
            "mode": "list",
            "cachedResultName": "Marketing Team",
            "cachedResultUrl": "https://drive.google.com/drive/folders/1KaKd8b0fmT2ug3PUWZDGbmtH0OKFd9hW"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          1504,
          352
        ],
        "id": "fa399421-3cab-4116-aada-39bc202f4e3d",
        "name": "Upload Image",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "YuJeLDU2kzOhnjsq",
            "name": "49 Drive"
          }
        }
      },
      {
        "parameters": {
          "content": "# Send Content",
          "height": 240,
          "width": 300,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1408,
          0
        ],
        "id": "4a80b2d8-bb9b-4f96-96ed-2c6b4dfd7fa8",
        "name": "Sticky Note7"
      },
      {
        "parameters": {
          "content": "# Write to Drive & Sheets",
          "height": 240,
          "width": 540,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1392,
          272
        ],
        "id": "8c3cd61a-a790-47a1-9c87-9905774e93fc",
        "name": "Sticky Note6"
      },
      {
        "parameters": {
          "content": "# Trigger\n",
          "height": 260,
          "width": 260,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1024,
          128
        ],
        "id": "4e4ec594-f49a-4bd5-8c85-10f1dc9bb618",
        "name": "Sticky Note5",
        "disabled": true
      },
      {
        "parameters": {
          "content": "# Download\n",
          "height": 260,
          "width": 220,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -736,
          128
        ],
        "id": "605e772b-ef64-44e8-abdd-6a34cdd3d475",
        "name": "Sticky Note4"
      },
      {
        "parameters": {
          "operation": "sendPhoto",
          "chatId": "={{ $('When Executed by Another Workflow').item.json.chatID }}",
          "binaryData": true,
          "additionalFields": {}
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          1504,
          80
        ],
        "id": "0e27e979-165c-4a65-9951-d1be5b016e1b",
        "name": "Send Photo",
        "webhookId": "85dc0064-e5c5-45a9-91a5-60e5b2bc4f1e",
        "credentials": {
          "telegramApi": {
            "id": "uXHAFQk49G65Euci",
            "name": "marketing_team"
          }
        }
      },
      {
        "parameters": {
          "operation": "download",
          "fileId": {
            "__rl": true,
            "value": "={{ $json.pictureID }}",
            "mode": "id"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          -688,
          208
        ],
        "id": "cb769c81-ad57-44ce-b829-3b1d3a36c31c",
        "name": "Download",
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "YuJeLDU2kzOhnjsq",
            "name": "49 Drive"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "5a719e80-f0ed-4fb9-9d73-244dff5f6a62",
                "leftValue": "={{ $json.status }}",
                "rightValue": "COMPLETED",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          688,
          208
        ],
        "id": "799dc2a0-9994-4119-ba8a-f151fb5d7fbf",
        "name": "If"
      },
      {
        "parameters": {
          "amount": 4
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          320,
          208
        ],
        "id": "8dc6dec4-e44b-4537-8e1b-b39ad9cf8b75",
        "name": "Wait",
        "webhookId": "3b863d29-a179-401b-88a1-1cca8ca9a676"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://queue.fal.run/fal-ai/nano-banana/edit",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n\"prompt\": \"{{ $('When Executed by Another Workflow').item.json.request }}\",\n     \"image_urls\": [\n       \"{{ $json.data }}\"\n     ]\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          112,
          208
        ],
        "id": "5d8d5d46-1c96-4b12-9d6f-31085fdda742",
        "name": "Ä°stek",
        "credentials": {
          "httpHeaderAuth": {
            "id": "HWrf6X4nsntv8BlR",
            "name": "fal.ai"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/nano-banana/requests/{{ $('Ä°stek').item.json.request_id }}/status",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          480,
          208
        ],
        "id": "c4a03faf-66d1-447f-948c-5eb60a67b94a",
        "name": "Kontrol",
        "credentials": {
          "httpHeaderAuth": {
            "id": "HWrf6X4nsntv8BlR",
            "name": "fal.ai"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/nano-banana/requests/{{ $json.request_id }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          896,
          192
        ],
        "id": "93c5f264-b311-4f0e-9f72-3b258c3469d0",
        "name": "SonuÃ§",
        "credentials": {
          "httpHeaderAuth": {
            "id": "HWrf6X4nsntv8BlR",
            "name": "fal.ai"
          }
        }
      },
      {
        "parameters": {
          "url": "={{ $json.images[0].url }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1168,
          192
        ],
        "id": "4f477fc1-d380-4d94-bf26-a1b0e2f1dfc1",
        "name": "Download1"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://litterbox.catbox.moe/resources/internals/api.php",
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "reqtype",
                "value": "fileupload"
              },
              {
                "name": "time",
                "value": "1h"
              },
              {
                "parameterType": "formBinaryData",
                "name": "fileToUpload",
                "inputDataFieldName": "data"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -272,
          208
        ],
        "id": "159348a0-b2e6-4117-962b-ca942f17c2a5",
        "name": "catbox clouda yÃ¼kle"
      }
    ],
    "pinData": {
      "When Executed by Another Workflow": [
        {
          "json": {
            "image": null,
            "request": "havayÄ± karanlÄ±k yap",
            "chatID": "5181466144",
            "pictureID": "1h5d2JsYCW0A5AZtCAn6ockfLePLMw6NH"
          }
        }
      ],
      "catbox clouda yÃ¼kle": [
        {
          "json": {
            "data": "https://litter.catbox.moe/1qvz2w.png"
          }
        }
      ],
      "Ä°stek": [
        {
          "json": {
            "status": "IN_QUEUE",
            "request_id": "904c99da-e774-4da4-a70d-600d450bc79f",
            "response_url": "https://queue.fal.run/fal-ai/nano-banana/requests/904c99da-e774-4da4-a70d-600d450bc79f",
            "status_url": "https://queue.fal.run/fal-ai/nano-banana/requests/904c99da-e774-4da4-a70d-600d450bc79f/status",
            "cancel_url": "https://queue.fal.run/fal-ai/nano-banana/requests/904c99da-e774-4da4-a70d-600d450bc79f/cancel",
            "logs": null,
            "metrics": {},
            "queue_position": 1
          }
        }
      ]
    },
    "connections": {
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "Download",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload Image": {
        "main": [
          [
            {
              "node": "Image Log",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download": {
        "main": [
          [
            {
              "node": "catbox clouda yÃ¼kle",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "SonuÃ§",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Kontrol",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ä°stek": {
        "main": [
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Kontrol": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SonuÃ§": {
        "main": [
          [
            {
              "node": "Download1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download1": {
        "main": [
          [
            {
              "node": "Send Photo",
              "type": "main",
              "index": 0
            },
            {
              "node": "Upload Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "catbox clouda yÃ¼kle": {
        "main": [
          [
            {
              "node": "Ä°stek",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "8f421857-9f45-4816-8c09-219e265cea1c",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "DiMxRX341M6KdK1E",
    "tags": []
  },
  {
    "name": "Generate AI Viral Videos with Seedance and Upload to TikTok, YouTube & Instagram",
    "nodes": [
      {
        "parameters": {
          "content": "## | Step 1: Generate Clips (Wavespeed AI)\n",
          "height": 240,
          "width": 880,
          "color": 2
        },
        "id": "cd0df97c-8e71-4201-9086-c247491c3c48",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          380,
          800
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## | Step 2: Generate Sounds (Fal AI)\n",
          "height": 240,
          "width": 640,
          "color": 2
        },
        "id": "c42e1959-f856-4954-af25-f8eed14a1e5c",
        "name": "Sticky Note13",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1300,
          800
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## | INPUT: Starting Idea Section",
          "height": 540,
          "width": 1560,
          "color": 7
        },
        "id": "567d5588-ca94-43c7-b856-17239da45750",
        "name": "Sticky Note14",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          380,
          240
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## | Step 3: Stitch Video (Fal AI)",
          "height": 260,
          "width": 1560,
          "color": 3
        },
        "id": "9a1c7a82-0dc8-4eef-a815-ed76928530e7",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          380,
          1080
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## | Step 4 â€” Publish Video to Social Media\n",
          "height": 760,
          "width": 1560,
          "color": 4
        },
        "id": "380b91d1-20e7-4d0f-a685-dc5898b11a6c",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          380,
          1380
        ],
        "typeVersion": 1,
        "disabled": true
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {}
            ]
          }
        },
        "id": "b3e014f3-849a-4532-b406-18f3cb6305d9",
        "name": "Trigger: Start Daily Content Generation",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          440,
          340
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "Generate a creative concept involving:\n\n[[\nA solid, hard material or element being sliced cleanly with a sharp blade. Your response must follow this structure:\n\n\"(Color) (Material) shaped like a (random everyday object)\"\n\nFor inspiration, imagine examples like: obsidian shaped like a chess piece, quartz shaped like a coffee mug, sapphire shaped like a seashell, or titanium shaped like a leaf.\n\n]]\n\nReflect carefully before answering to ensure originality and visual appeal.\n\nUse the Think tool to review your output",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=**Role:**  \nYou are an AI designed to generate **one immersive, realistic idea** based on a user-provided topic. Your output must be formatted as a **single-line JSON array** and follow the rules below exactly.\n\n---\n\n### RULES\n\n1. **Number of ideas**  \n   - Return **only one idea**.\n\n2. **Topic**  \n   - The user will provide a keyword (e.g., â€œglass cutting ASMR,â€ â€œwood carving sounds,â€ â€œsatisfying rock splitsâ€).\n\n3. **Idea**  \n   - Maximum 13 words.  \n   - Describe a viral-worthy, original, or surreal moment related to the topic.\n\n4. **Caption**  \n   - Short, punchy, viral-friendly.  \n   - Include **one emoji**.  \n   - Exactly **12 hashtags** in this order:  \n     1. 4 topic-relevant hashtags  \n     2. 4 all-time most popular hashtags  \n     3. 4 currently trending hashtags (based on live research)  \n   - All in lowercase.\n\n5. **Environment**  \n   - Maximum 20 words.  \n   - Must match the action in the Idea exactly.  \n   - Specify location (studio table, natural terrain, lab benchâ€¦), visual details (dust particles, polished surface, subtle reflectionsâ€¦), and style (macro close-up, cinematic slow-motion, minimalistâ€¦).\n\n6. **Sound**  \n   - Maximum 15 words.  \n   - Describe the primary sound for the scene (to feed into an audio model).\n\n7. **Status**  \n   - Always set to `\"for production\"`.\n\n---\n\n### OUTPUT FORMAT (single-line JSON array)\n\n```json\n[\n  {\n    \"Caption\": \"Your short viral title with emoji #4_topic_hashtags #4_all_time_popular_hashtags #4_trending_hashtags\",\n    \"Idea\": \"Your idea under 13 words\",\n    \"Environment\": \"Your vivid setting under 20 words matching the action\",\n    \"Sound\": \"Your primary sound description under 15 words\",\n    \"Status\": \"for production\"\n  }\n]\n"
          }
        },
        "id": "aabf432b-b4d4-4e56-9710-52495f08d007",
        "name": "AI Agent: Generate Creative Video Idea",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          760,
          340
        ],
        "typeVersion": 1.9
      },
      {
        "parameters": {},
        "id": "09e27c25-772b-41e5-8255-723d23398a64",
        "name": "Tool: Inject Creative Perspective (Idea)",
        "type": "@n8n/n8n-nodes-langchain.toolThink",
        "position": [
          880,
          620
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1",
            "cachedResultName": "gpt-4.1"
          },
          "options": {}
        },
        "id": "1f1985b1-d1eb-4c65-9d99-f96542273dc6",
        "name": "LLM: Generate Raw Idea (GPT-4.1)",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          700,
          620
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {
          "jsonSchemaExample": "[\n  {\n    \"Caption\": \"Diver Removes Nets Off Whale ðŸ‹ #whalerescue #marinelife #oceanrescue #seahelpers #love #nature #instagood #explore #viral #savenature #oceanguardians #cleanoceans\",\n    \"Idea\": \"Diver carefully cuts tangled net from distressed whale in open sea\",\n    \"Environment\": \"Open ocean, sunlight beams through water, diver and whale, cinematic realism\",\n    \"Sound\": \"Primary sound description under 15 words\",\n    \"Status\": \"for production\"\n  }\n]\n"
        },
        "id": "a2c57dca-ed2e-4712-a735-8da0c727470f",
        "name": "Parse AI Output (Idea, Environment, Sound)",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "position": [
          1040,
          620
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "columns": {
            "value": {
              "id": "==ROW()-1",
              "idea": "={{ $json.output[0].Idea }}",
              "caption": "={{ $json.output[0].Caption }}",
              "production": "={{ $json.output[0].Status }}",
              "sound_prompt": "={{ $json.output[0].Sound }}",
              "environment_prompt": "={{ $json.output[0].Environment }}"
            },
            "schema": [
              {
                "id": "id",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "id",
                "defaultMatch": true,
                "canBeUsedToMatch": true
              },
              {
                "id": "idea",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "idea",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "caption",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "caption",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "production",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "production",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "environment_prompt",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "environment_prompt",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "sound_prompt",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "sound_prompt",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "final_output",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "final_output",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "id"
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "id": "20db6d62-9db9-4942-a820-b520356f3209",
        "name": "Save Idea & Metadata to Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1220,
          340
        ],
        "typeVersion": 4.5
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Give me 3 video prompts based on the previous idea\n\nUse the Think tool to review your output",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=Role: You are a prompt-generation AI specializing in cinematic, ASMR-style video prompts. Your task is to generate a multi-scene video sequence that vividly shows a sharp knife actively cutting through a specific object in a clean, high-detail setting.\n\nYour writing must follow this style:\n\nSharp, precise cinematic realism.\n\nMacro-level detail with tight focus on the blade interacting with the object.\n\nThe knife must always be in motion â€” slicing, splitting, or gliding through the material. Never idle or static.\n\nCamera terms are allowed (e.g. macro view, tight angle, over-the-blade shot).\n\nEach scene must contain all of the following, expressed through detailed visual language:\n\nâœ… The main object or subject (from the Idea)\n\nâœ… The cutting environment or surface (from the Environment)\n\nâœ… The texture, structure, and behavior of the material as itâ€™s being cut\n\nâœ… A visible, sharp blade actively cutting\n\nDescriptions should show:\n\nThe physical makeup of the material â€” is it translucent, brittle, dense, reflective, granular, fibrous, layered, or fluid-filled?\n\nHow the material responds to the blade â€” resistance, cracking, tearing, smooth separation, tension, vibration.\n\nThe interaction between the blade and the surface â€” light reflection, buildup of particles, contact points, residue or dust.\n\nAny ASMR-relevant sensory cues like particle release, shimmer, or subtle movement, but always shown visually â€” not narrated.\n\nTone:\n\nClean, clinical, visual.\n\nNo poetic metaphors, emotion, or storytelling.\n\nAvoid fantasy or surreal imagery.\n\nAll description must feel physically grounded and logically accurate.\n\nLength:\n\nEach scene must be between 1,000 and 2,000 characters.\n\nNo shallow or repetitive scenes â€” each must be immersive, descriptive, and specific.\n\nEach scene should explore a distinct phase of the cutting process, a different camera perspective, or a new behavior of the material under the blade.\n\nInputs:\n\nIdea: \"{{ $json.idea }}\"\nEnvironment: \"{{ $json.environment_prompt }}\"\nSound: \"{{ $json.sound_prompt }}\"\n\nFormat:\n\nIdea: \"...\"\nEnvironment: \"...\"\nSound: \"...\"\n\nScene 1: \"...\"\nScene 2: \"...\"\nScene 3: \"...\"\nScene 4: \"...\"\nScene 5: \"...\"\nScene 6: \"...\"\nScene 7: \"...\"\nScene 8: \"...\"\nScene 9: \"...\"\nScene 10: \"...\"\nScene 11: \"...\"\nScene 12: \"...\"\nScene 13: \"...\"\n\n"
          }
        },
        "id": "49139fc9-2030-4d10-a9a7-4fd3a3779005",
        "name": "AI Agent: Generate Detailed Video Prompts",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          1560,
          340
        ],
        "typeVersion": 1.9
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1",
            "cachedResultName": "gpt-4.1"
          },
          "options": {}
        },
        "id": "4c34c0b0-5c13-4d37-8b51-a209e598513a",
        "name": "LLM: Draft Video Prompt Details (GPT-4.1)",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          1460,
          620
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {},
        "id": "5a7828fd-629c-45d4-9ff2-4b57be2eca33",
        "name": "Tool: Refine and Validate Prompts1",
        "type": "@n8n/n8n-nodes-langchain.toolThink",
        "position": [
          1640,
          620
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n  \"Idea\": \"An obsidian rock being sliced with a shimmering knife\",\n  \"Environment\": \"Clean studio table, subtle light reflections\",\n  \"Sound\": \"Crisp slicing, deep grinding, and delicate crumbling\",\n  \"Scene 1\": \"Extreme macro shot: a razor-sharp, polished knife blade presses into the dark, granular surface of an obsidian rock, just beginning to indent.\",\n  \"Scene 2\": \"Close-up: fine, iridescent dust particles erupt from the point of contact as the blade cuts deeper into the obsidian, catching the studio light.\",\n  \"Scene 3\": \"Mid-shot: the knife, held perfectly steady, has formed a shallow, clean groove across the obsidian's shimmering surface, revealing a new, smooth texture.\"\n}"
        },
        "id": "bddb974b-e541-4f02-8595-45f76820b38e",
        "name": "Parse Structured Video Prompt Output",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "position": [
          1800,
          620
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {
          "jsCode": "function findSceneEntries(obj) {\n  const scenes = [];\n\n  for (const [key, value] of Object.entries(obj)) {\n    if (key.toLowerCase().startsWith(\"scene\") && typeof value === \"string\") {\n      scenes.push(value);\n    } else if (typeof value === \"object\" && value !== null) {\n      scenes.push(...findSceneEntries(value));\n    }\n  }\n\n  return scenes;\n}\n\nlet output = [];\n\ntry {\n  const inputData = items[0].json;\n  const scenes = findSceneEntries(inputData);\n\n  if (scenes.length === 0) {\n    throw new Error(\"No scene keys found at any level.\");\n  }\n\n  output = scenes.map(scene => ({ description: scene }));\n} catch (e) {\n  throw new Error(\"Could not extract scenes properly. Details: \" + e.message);\n}\n\nreturn output;\n"
        },
        "id": "443d3b99-1e6c-423c-b8ca-1c5a4c3ba180",
        "name": "Extract Individual Scene Descriptions",
        "type": "n8n-nodes-base.code",
        "position": [
          480,
          880
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.wavespeed.ai/api/v3/bytedance/seedance-v1-pro-t2v-480p",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "application/json",
          "body": "={\n  \"aspect_ratio\": \"9:16\",\n  \"duration\": 10,\n  \"prompt\": \"VIDEO THEME: {{ $('Prompts AI Agent').item.json.output.Idea }} | WHAT HAPPENS IN THE VIDEO: {{ $json.description }} | WHERE THE VIDEO IS SHOT: {{ $('Prompts AI Agent').item.json.output.Environment }}\"\n}\n",
          "options": {
            "batching": {
              "batch": {
                "batchSize": 1,
                "batchInterval": 3000
              }
            }
          }
        },
        "id": "78fc7648-9741-48c9-8127-2bdab7070ba7",
        "name": "Generate Video Clips (Wavespeed AI)",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          680,
          880
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "amount": 240
        },
        "id": "62eb02cb-cf85-4cbe-8688-8fd587e9c19a",
        "name": "Wait for Clip Generation (Wavespeed AI)",
        "type": "n8n-nodes-base.wait",
        "position": [
          880,
          880
        ],
        "webhookId": "60604cd4-5d90-48dc-93f4-1335e5f03fdd",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "url": "=https://api.wavespeed.ai/api/v3/predictions/{{ $json.data.id }}/result",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "id": "879f74ba-0e59-43a1-b949-c23bfbcceef0",
        "name": "Retrieve Video Clips",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1080,
          880
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://queue.fal.run/fal-ai/mmaudio-v2 ",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "application/json",
          "body": "= {\n        \"prompt\": \"ASMR Soothing sound effects. {{ $('AI Agent: Generate Detailed Video Prompts').item.json.output.Sound }}\",\n        \"duration\": 10,\n        \"video_url\": \"{{ $json.data.outputs[0] }}\"\n  }\n",
          "options": {
            "batching": {
              "batch": {
                "batchSize": 1,
                "batchInterval": 2000
              }
            }
          }
        },
        "id": "1bc37dc5-fd16-4dc0-a153-11d19d8d4068",
        "name": "Generate ASMR Sound (Fal AI)",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1360,
          880
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "amount": 60
        },
        "id": "f8f1eae5-a74b-49be-81fd-2d13e75441c7",
        "name": "Wait for Sound Generation (Fal AI)",
        "type": "n8n-nodes-base.wait",
        "position": [
          1560,
          880
        ],
        "webhookId": "abac7859-a9f6-46f3-95c2-df43ec32807d",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/mmaudio-v2/requests/{{ $json.request_id }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "id": "4670c2d4-0d66-42e9-891f-1f80508433bb",
        "name": "Retrieve Final Sound Output",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1760,
          880
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "return [\n  {\n    video_urls: items.map(item => item.json.video.url)\n  }\n];"
        },
        "id": "37f9678e-e5cb-444c-ba88-c73cc04f4f39",
        "name": "List Clip URLs for Stitching",
        "type": "n8n-nodes-base.code",
        "position": [
          480,
          1140
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://queue.fal.run/fal-ai/ffmpeg-api/compose",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "application/json",
          "body": "={\n  \"tracks\": [\n    {\n      \"id\": \"1\",\n      \"type\": \"video\",\n      \"keyframes\": [\n        { \"url\": \"{{ $json.video_urls[0] }}\", \"timestamp\": 0, \"duration\": 10 },\n        { \"url\": \"{{ $json.video_urls[1] }}\", \"timestamp\": 10, \"duration\": 10 },\n        { \"url\": \"{{ $json.video_urls[2] }}\", \"timestamp\": 20, \"duration\": 10 }\n      ]\n    }\n  ]\n}",
          "options": {
            "batching": {
              "batch": {
                "batchSize": 1,
                "batchInterval": 2000
              }
            }
          }
        },
        "id": "d472b385-a76f-459a-8cc9-fcbd50db4977",
        "name": "Merge Clips into Final Video (Fal AI)",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          680,
          1140
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "amount": 60
        },
        "id": "277e1e53-68b8-4a75-b525-aebc0213dc1e",
        "name": "Wait for Video Rendering (Fal AI)",
        "type": "n8n-nodes-base.wait",
        "position": [
          880,
          1140
        ],
        "webhookId": "389fcfd1-9337-4334-a54b-4114f36e30bc",
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/ffmpeg-api/requests/{{ $json.request_id }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "id": "f32f4704-8af4-4df4-b3bf-8db839d4e216",
        "name": "Retrieve Final Merged Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1080,
          1140
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "columns": {
            "value": {
              "idea": "{{ $('Save Idea & Metadata to Google Sheets').first().json.idea }}",
              "production": "done",
              "final_output": "={{ $json.video_url }}"
            },
            "schema": [
              {
                "id": "id",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "id",
                "defaultMatch": true,
                "canBeUsedToMatch": true
              },
              {
                "id": "idea",
                "type": "string",
                "display": true,
                "removed": false,
                "required": false,
                "displayName": "idea",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "caption",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "caption",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "production",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "production",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "environment_prompt",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "environment_prompt",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "final_output",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "final_output",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "row_number",
                "type": "string",
                "display": true,
                "removed": true,
                "readOnly": true,
                "required": false,
                "displayName": "row_number",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "idea"
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "id": "f8b31fab-43f2-4cb1-8d7b-6d9fae331e50",
        "name": "URL Final Video",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1760,
          1140
        ],
        "typeVersion": 4.5
      },
      {
        "parameters": {
          "mode": "raw",
          "jsonOutput": "{\n  \"instagram_id\": \"1111\",\n  \"youtube_id\": \"1111\",\n  \"threads_id\": \"1111\",\n  \"tiktok_id\": \"1111\",\n  \"facebook_id\": \"1111\",\n  \"facebook_page_id\": \"1111\",\n  \"twitter_id\": \"1111\",\n  \"linkedin_id\": \"1111\",\n  \"pinterest_id\": \"1111\",\n  \"pinterest_board_id\": \"1111\",\n  \"bluesky_id\": \"1111\"\n}\n",
          "options": {}
        },
        "id": "89155cba-d20f-4d2a-9ea0-1193ef394016",
        "name": "Assign Social Media IDs",
        "type": "n8n-nodes-base.set",
        "position": [
          660,
          1720
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "options": {}
        },
        "id": "503d2982-3d10-4bb1-a560-2539c00c8b4a",
        "name": "Get my video",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          460,
          1720
        ],
        "typeVersion": 4.5
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.blotato.com/v2/media",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "blotato-api-key",
                "value": "YOUR_API_HERE"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "url",
                "value": "={{ $('Get my video').item.json['final_output'] }}"
              }
            ]
          },
          "options": {}
        },
        "id": "85f2509a-9ef3-4e9b-a555-02eba572d443",
        "name": "Upload Video to Blotato",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          900,
          1720
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.blotato.com/v2/posts",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "blotato-api-key",
                "value": "YOUR_API_HERE"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"post\": {\n    \"accountId\": \"{{ $('Assign Social Media IDs').item.json.instagram_id }}\",\n    \"target\": {\n      \"targetType\": \"instagram\"\n    },\n    \"content\": {\n      \"text\": \"{{ $('Get my video').item.json.DESCRIPTION }}\",\n      \"platform\": \"instagram\",\n      \"mediaUrls\": [\n        \"{{ $json.url }}\"\n      ]\n    }\n  }\n}\n\n",
          "options": {}
        },
        "id": "9d229118-b3b8-46fe-9e8d-19f86e9f00a0",
        "name": "INSTAGRAM",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1320,
          1460
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.blotato.com/v2/posts",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "blotato-api-key",
                "value": "YOUR_API_HERE"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"post\": {\n    \"accountId\": \"{{ $('Assign Social Media IDs').item.json.youtube_id }}\",\n    \"target\": {\n      \"targetType\": \"youtube\",\n      \"title\": \"{{ $('Get my video').item.json.Titre }}\",\n      \"privacyStatus\": \"unlisted\",\n      \"shouldNotifySubscribers\": \"false\"\n    },\n    \"content\": {\n      \"text\": \"{{ $('Get my video').item.json.DESCRIPTION }}\",\n      \"platform\": \"youtube\",\n      \"mediaUrls\": [\n        \"{{ $json.url }}\"\n      ]\n    }\n  }\n}\n",
          "options": {}
        },
        "id": "02da82bf-7931-48cb-af1f-3e9d8c1d584b",
        "name": "YOUTUBE",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1540,
          1460
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.blotato.com/v2/posts",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "blotato-api-key",
                "value": "=YOUR_API_HERE"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"post\": {\n    \"accountId\": \"{{ $('Assign Social Media IDs').item.json.tiktok_id }}\",\n    \"target\": {\n      \"targetType\": \"tiktok\",\n      \"isYourBrand\": \"false\", \n      \"disabledDuet\": \"false\",\n      \"privacyLevel\": \"PUBLIC_TO_EVERYONE\",\n      \"isAiGenerated\": \"true\",\n      \"disabledStitch\": \"false\",\n      \"disabledComments\": \"false\",\n      \"isBrandedContent\": \"false\"\n      \n    },\n    \"content\": {\n      \"text\": \"{{ $('Get my video').item.json.DESCRIPTION }}\",\n      \"platform\": \"tiktok\",\n      \"mediaUrls\": [\n        \"{{ $json.url }}\"\n      ]\n    }\n  }\n}\n",
          "options": {}
        },
        "id": "75718ac7-7c63-4be8-a90d-1644515444ca",
        "name": "TIKTOK",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1740,
          1460
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.blotato.com/v2/posts",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "blotato-api-key",
                "value": "=YOUR_API_HERE"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"post\": {\n    \"accountId\": \"{{ $('Assign Social Media IDs').item.json.facebook_id }}\",\n    \"target\": {\n      \"targetType\": \"facebook\",\n      \"pageId\": \"{{ $('Assign Social Media IDs').item.json.facebook_page_id }}\"\n\n      \n    },\n    \"content\": {\n      \"text\": \"{{ $('Get my video').item.json.DESCRIPTION }}\",\n      \"platform\": \"facebook\",\n      \"mediaUrls\": [\n        \"{{ $json.url }}\"\n      ]\n    }\n  }\n}",
          "options": {}
        },
        "id": "32654f5a-e2dc-4d36-983d-d4c4d0e592a9",
        "name": "FACEBOOK",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1320,
          1700
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.blotato.com/v2/posts",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "blotato-api-key",
                "value": "YOUR_API_HERE"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"post\": {\n    \"accountId\": \"{{ $('Assign Social Media IDs').item.json.threads_id }}\",\n    \"target\": {\n      \"targetType\": \"threads\"\n      \n    },\n    \"content\": {\n      \"text\": \"{{ $('Get my video').item.json.DESCRIPTION }}\",\n      \"platform\": \"threads\",\n      \"mediaUrls\": [\n        \"{{ $json.url }}\"\n      ]\n    }\n  }\n}\n",
          "options": {}
        },
        "id": "e0955970-2ccf-4f8f-91d5-6e795ad10c1a",
        "name": "THREADS",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1540,
          1700
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.blotato.com/v2/posts",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "blotato-api-key",
                "value": "YOUR_API_HERE"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"post\": {\n    \"accountId\": \"{{ $('Assign Social Media IDs').item.json.linkedin_id }}\",\n    \"target\": {\n      \"targetType\": \"linkedin\"\n      \n    },\n    \"content\": {\n      \"text\": \"{{ $('Get my video').item.json.DESCRIPTION }}\",\n      \"platform\": \"linkedin\",\n      \"mediaUrls\": [\n        \"{{ $json.url }}\"\n      ]\n    }\n  }\n}\n",
          "options": {}
        },
        "id": "92b8a14a-c13b-45da-8e5a-fb6390c4e819",
        "name": "LINKEDIN",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1320,
          1940
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.blotato.com/v2/posts",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "blotato-api-key",
                "value": "YOUR_API_HERE"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "= {\n  \"post\": {\n    \"accountId\": \"{{ $('Assign Social Media IDs').item.json.bluesky_id }}\",\n    \"target\": {\n      \"targetType\": \"bluesky\"\n      \n    },\n    \"content\": {\n      \"text\": \"{{ $('Get my video').item.json.DESCRIPTION }}\",\n      \"platform\": \"bluesky\",\n      \"mediaUrls\": [\n        \"https://pbs.twimg.com/media/GE8MgIiWEAAfsK3.jpg\"\n      ]\n    }\n  }\n}\n",
          "options": {}
        },
        "id": "682edc00-f41c-442e-80a6-ff707e0ecd8b",
        "name": "BLUESKY",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1540,
          1940
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.blotato.com/v2/posts",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "blotato-api-key",
                "value": "YOUR_API_HERE"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"post\": {\n    \"accountId\": \"{{ $('Assign Social Media IDs').item.json.pinterest_id }}\",\n    \"target\": {\n      \"targetType\": \"pinterest\",\n      \"boardId\": \"{{ $('Assign Social Media IDs').item.json.pinterest_board_id }}\"      \n    },\n    \"content\": {\n      \"text\": \"{{ $('Get my video').item.json.DESCRIPTION }}\",\n      \"platform\": \"pinterest\",\n      \"mediaUrls\": [\n        \"https://pbs.twimg.com/media/GE8MgIiWEAAfsK3.jpg\"\n      ]\n    }\n  }\n}\n\n",
          "options": {}
        },
        "id": "ad4ecbfa-8db8-48f5-b86a-2524fa7dd52d",
        "name": "PINTEREST",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1740,
          1940
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "="
          },
          "columns": {
            "value": {
              "STATUS": "Publish",
              "row_number": "={{ $('Get my video').item.json.row_number }}"
            },
            "schema": [
              {
                "id": "PROMPT",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "PROMPT",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "DESCRIPTION",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "DESCRIPTION",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "URL VIDEO",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "URL VIDEO",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "Titre",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "Titre",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "STATUS",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "STATUS",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "row_number",
                "type": "string",
                "display": true,
                "removed": false,
                "readOnly": true,
                "required": false,
                "displayName": "row_number",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "defineBelow",
            "matchingColumns": [
              "row_number"
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "id": "174013c3-f8bd-4b3e-8171-d8699a95de95",
        "name": "Update Production",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          900,
          1940
        ],
        "typeVersion": 4.5
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.blotato.com/v2/posts",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "blotato-api-key",
                "value": "YOUR_API_HERE"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"post\": {\n    \"accountId\": \"{{ $('Assign Social Media IDs').item.json.twitter_id }}\",\n    \"target\": {\n      \"targetType\": \"twitter\"\n      \n    },\n    \"content\": {\n      \"text\": \"{{ $('Get my video').item.json.DESCRIPTION }}\",\n      \"platform\": \"twitter\",\n      \"mediaUrls\": [\n        \"{{ $json.url }}\"\n      ]\n    }\n  }\n}\n",
          "options": {}
        },
        "id": "d9c1859f-99c3-4cc7-8b65-ebeddba88489",
        "name": "TWITTER",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1740,
          1700
        ],
        "typeVersion": 4.2
      }
    ],
    "pinData": {},
    "connections": {
      "Get my video": {
        "main": [
          [
            {
              "node": "Assign Social Media IDs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "URL Final Video": {
        "main": [
          [
            {
              "node": "Get my video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Retrieve Video Clips": {
        "main": [
          [
            {
              "node": "Generate ASMR Sound (Fal AI)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Assign Social Media IDs": {
        "main": [
          [
            {
              "node": "Upload Video to Blotato",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload Video to Blotato": {
        "main": [
          [
            {
              "node": "INSTAGRAM",
              "type": "main",
              "index": 0
            },
            {
              "node": "YOUTUBE",
              "type": "main",
              "index": 0
            },
            {
              "node": "TIKTOK",
              "type": "main",
              "index": 0
            },
            {
              "node": "FACEBOOK",
              "type": "main",
              "index": 0
            },
            {
              "node": "THREADS",
              "type": "main",
              "index": 0
            },
            {
              "node": "TWITTER",
              "type": "main",
              "index": 0
            },
            {
              "node": "LINKEDIN",
              "type": "main",
              "index": 0
            },
            {
              "node": "BLUESKY",
              "type": "main",
              "index": 0
            },
            {
              "node": "PINTEREST",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Production",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Retrieve Final Merged Video": {
        "main": [
          [
            {
              "node": "URL Final Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Retrieve Final Sound Output": {
        "main": [
          [
            {
              "node": "List Clip URLs for Stitching",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate ASMR Sound (Fal AI)": {
        "main": [
          [
            {
              "node": "Wait for Sound Generation (Fal AI)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "List Clip URLs for Stitching": {
        "main": [
          [
            {
              "node": "Merge Clips into Final Video (Fal AI)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "LLM: Generate Raw Idea (GPT-4.1)": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent: Generate Creative Video Idea",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Wait for Video Rendering (Fal AI)": {
        "main": [
          [
            {
              "node": "Retrieve Final Merged Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tool: Refine and Validate Prompts1": {
        "ai_tool": [
          [
            {
              "node": "AI Agent: Generate Detailed Video Prompts",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Wait for Sound Generation (Fal AI)": {
        "main": [
          [
            {
              "node": "Retrieve Final Sound Output",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Video Clips (Wavespeed AI)": {
        "main": [
          [
            {
              "node": "Wait for Clip Generation (Wavespeed AI)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Structured Video Prompt Output": {
        "ai_outputParser": [
          [
            {
              "node": "AI Agent: Generate Detailed Video Prompts",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Extract Individual Scene Descriptions": {
        "main": [
          [
            {
              "node": "Generate Video Clips (Wavespeed AI)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Clips into Final Video (Fal AI)": {
        "main": [
          [
            {
              "node": "Wait for Video Rendering (Fal AI)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Idea & Metadata to Google Sheets": {
        "main": [
          [
            {
              "node": "AI Agent: Generate Detailed Video Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent: Generate Creative Video Idea": {
        "main": [
          [
            {
              "node": "Save Idea & Metadata to Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Trigger: Start Daily Content Generation": {
        "main": [
          [
            {
              "node": "AI Agent: Generate Creative Video Idea",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait for Clip Generation (Wavespeed AI)": {
        "main": [
          [
            {
              "node": "Retrieve Video Clips",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tool: Inject Creative Perspective (Idea)": {
        "ai_tool": [
          [
            {
              "node": "AI Agent: Generate Creative Video Idea",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent: Generate Detailed Video Prompts": {
        "main": [
          [
            {
              "node": "Extract Individual Scene Descriptions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "LLM: Draft Video Prompt Details (GPT-4.1)": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent: Generate Detailed Video Prompts",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Parse AI Output (Idea, Environment, Sound)": {
        "ai_outputParser": [
          [
            {
              "node": "AI Agent: Generate Creative Video Idea",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "",
    "meta": {
      "templateId": "5338",
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "tags": []
  },
  {
    "name": "Gmail Mail CevaplayÄ±cÄ±",
    "nodes": [
      {
        "parameters": {
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          },
          "simple": false,
          "filters": {
            "readStatus": "unread"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.gmailTrigger",
        "typeVersion": 1.2,
        "position": [
          -2080,
          180
        ],
        "id": "0cfa5fe8-64d5-41e2-b1e3-23699bff6234",
        "name": "Gmail Trigger",
        "credentials": {
          "gmailOAuth2": {
            "id": "XgBYmabQWaFtBPLZ",
            "name": "Gmail account 6"
          }
        }
      },
      {
        "parameters": {
          "text": "={{ $json.from.value[0].name }}",
          "attributes": {
            "attributes": [
              {
                "name": "senderName",
                "description": "Extract the sender's name from the email. If the name is not available, return an empty string.",
                "required": true
              }
            ]
          },
          "options": {
            "systemPromptTemplate": "You are an extraction expert. Identify and extract only the key information from the text. If a required attribute is not present, return an empty string as its value."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.informationExtractor",
        "typeVersion": 1,
        "position": [
          -1860,
          180
        ],
        "id": "3a7859b3-adc1-41a8-9e76-edcc51429436",
        "name": "Information Extractor"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          -1860,
          400
        ],
        "id": "29eff0c7-0f39-4772-a926-8a7c42e8acf8",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "efaf396c-e36b-4369-b904-4726787fa9b7",
                "leftValue": "={{ $json.output.senderName }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -1500,
          180
        ],
        "id": "2b7f9a37-9ed3-4841-b8ee-5199279ded36",
        "name": "If"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9472688f-14a8-415c-864e-1ad245ff0d6d",
                "name": "introduction",
                "value": "Hey,",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1280,
          320
        ],
        "id": "41546393-97a0-4c74-8b4a-1de30785e3a9",
        "name": "No Name"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "2a305a52-3ce0-4586-a900-038a6612178e",
                "name": "introduction",
                "value": "=Dear {{ $json.output.senderName }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1280,
          60
        ],
        "id": "34f3c7bf-d9fc-4d8e-a26d-ea169729abe6",
        "name": "Name Found"
      },
      {
        "parameters": {
          "mode": "combine",
          "fieldsToMatchString": "introduction",
          "joinMode": "keepNonMatches",
          "options": {}
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3,
        "position": [
          -1000,
          200
        ],
        "id": "da95c0c6-cbe7-44e9-b803-406c371e28a6",
        "name": "Merge"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1d374039-a5c3-4047-b19c-4d05f485cceb",
                "name": "introduction",
                "value": "={{ $json.introduction }}",
                "type": "string"
              },
              {
                "id": "eafcf4be-81e1-42af-83e7-1407680585fc",
                "name": "emailBody",
                "value": "={{ $('Gmail Trigger').item.json.text }}",
                "type": "string"
              },
              {
                "id": "0f9e0296-2c71-47d9-a526-b29ca30a41d2",
                "name": "messageId",
                "value": "={{ $('Gmail Trigger').item.json.id }}",
                "type": "string"
              },
              {
                "id": "ea2e0681-abb6-49ae-92f5-aa08f6c1cb79",
                "name": "threadId",
                "value": "={{ $('Gmail Trigger').item.json.threadId }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -780,
          200
        ],
        "id": "00782bb1-e54b-4510-93c2-ffe889843f4a",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "inputText": "={{ $json.emailBody }}",
          "categories": {
            "categories": [
              {
                "category": "Course Requests",
                "description": "This includes inquiries about course services, pricing, availability, or related details."
              },
              {
                "category": "Consultation Requests",
                "description": "This includes scheduling initial consultations or follow-up appointments."
              },
              {
                "category": "Payments",
                "description": "Inquiries about paid collab, payments, or refund requests."
              },
              {
                "category": "Miscellaneous",
                "description": "Emails that don't fall into any of the predefined categories."
              }
            ]
          },
          "options": {
            "systemPromptTemplate": "Please share with me the specific {categories} that you would like to use so I can perform the analysis correctly. Once you have provided the categories, I will deliver the answer in JSON format, without explanations."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1,
        "position": [
          -560,
          200
        ],
        "id": "84ddf0cf-537c-4598-8fc4-5391e8a57fb0",
        "name": "Text Classifier"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          -540,
          420
        ],
        "id": "d3b12a3f-049e-4158-92b1-96c92d6d2546",
        "name": "OpenAI Chat Model1",
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $json.messageId }}",
          "labelIds": [
            "Label_5492508964651339444"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          20,
          0
        ],
        "id": "8c9f11a6-4f72-4032-935f-0e390f9328c6",
        "name": "Gmail",
        "webhookId": "af462a09-091d-4ffa-9c2a-2d9dd1f15f88",
        "credentials": {
          "gmailOAuth2": {
            "id": "XgBYmabQWaFtBPLZ",
            "name": "Gmail account 6"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $json.messageId }}",
          "labelIds": [
            "Label_4977602774886928447"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          40,
          180
        ],
        "id": "42793212-0a36-451c-965e-e3cba007f4ba",
        "name": "Gmail1",
        "webhookId": "af462a09-091d-4ffa-9c2a-2d9dd1f15f88",
        "credentials": {
          "gmailOAuth2": {
            "id": "XgBYmabQWaFtBPLZ",
            "name": "Gmail account 6"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $json.messageId }}",
          "labelIds": [
            "Label_610641191224731602"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          40,
          380
        ],
        "id": "8d63c262-7c33-4bfe-9955-42b112e89868",
        "name": "Gmail2",
        "webhookId": "af462a09-091d-4ffa-9c2a-2d9dd1f15f88",
        "credentials": {
          "gmailOAuth2": {
            "id": "XgBYmabQWaFtBPLZ",
            "name": "Gmail account 6"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $json.messageId }}",
          "labelIds": [
            "Label_4048336606870938677"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          20,
          540
        ],
        "id": "c1cfec4c-bcd3-4490-872a-e722ce1331e7",
        "name": "Gmail3",
        "webhookId": "af462a09-091d-4ffa-9c2a-2d9dd1f15f88",
        "credentials": {
          "gmailOAuth2": {
            "id": "XgBYmabQWaFtBPLZ",
            "name": "Gmail account 6"
          }
        }
      },
      {
        "parameters": {
          "operation": "reply",
          "messageId": "={{ $json.id }}",
          "emailType": "text",
          "message": "={{ $('Text Classifier').item.json.introduction }}\n\nThank you for contacting Prototipal! We're excited to learn more about your needs and discuss how we can help you.\n\nYour request has been received, and a member of our team is reviewing the details. We'll get back to you within 24 hours with more information.\n\nIn the meantime, feel free to visit our website to learn more about our services, or contact us via WhatsApp: burhankocabiyik.com\n\nWe look forward to connecting with you!\n\nBest regards,\nBurhan Kocabiyik",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          260,
          0
        ],
        "id": "8f4ab413-1bb2-41c1-b402-253ec1071d02",
        "name": "Gmail4",
        "webhookId": "b02440bb-d0ae-4f5e-a0f0-bd46c75ffb74",
        "credentials": {
          "gmailOAuth2": {
            "id": "XgBYmabQWaFtBPLZ",
            "name": "Gmail account 6"
          }
        }
      },
      {
        "parameters": {
          "operation": "reply",
          "messageId": "={{ $json.id }}",
          "emailType": "text",
          "message": "={{ $('Text Classifier').item.json.introduction }}\n\nThank you for contacting Prototipal. We're excited to learn more about your needs and discuss how we can help you.\n\nTo schedule your consultation, please reply to this email with your preferred date and time, or use our online booking link here: https://cal.com/prototipal\n\nOnce we receive your preferred time, we'll confirm the appointment or suggest alternative options if needed.\n\nIf you have specific topics you'd like to discuss during the consultation, feel free to mention them in your reply.\n\nWe look forward to connecting with you!\n\nBest regards,\nBurhan\nPrototipal",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          260,
          180
        ],
        "id": "2a76da1d-2322-428a-8509-77a319c9109f",
        "name": "Gmail5",
        "webhookId": "b02440bb-d0ae-4f5e-a0f0-bd46c75ffb74",
        "credentials": {
          "gmailOAuth2": {
            "id": "XgBYmabQWaFtBPLZ",
            "name": "Gmail account 6"
          }
        }
      },
      {
        "parameters": {
          "operation": "reply",
          "messageId": "={{ $json.id }}",
          "emailType": "text",
          "message": "={{ $('Text Classifier').item.json.introduction }}\n\nThank you for contacting us regarding your paid collab/billing inquiry. \n\nA member of our team will reach out to you within 2 business days to provide the necessary information or assistance.\n\nIf this is an urgent matter, please call us directly at +905555555.\n\nThank you for your patience and for choosing Prototipal\n\nBest regards,\nBurhan\nPrototipal",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          280,
          380
        ],
        "id": "5f2b0943-4f9d-494b-8ac4-b465bbd94d57",
        "name": "Gmail6",
        "webhookId": "b02440bb-d0ae-4f5e-a0f0-bd46c75ffb74",
        "credentials": {
          "gmailOAuth2": {
            "id": "XgBYmabQWaFtBPLZ",
            "name": "Gmail account 6"
          }
        }
      }
    ],
    "pinData": {},
    "connections": {
      "Gmail Trigger": {
        "main": [
          [
            {
              "node": "Information Extractor",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Information Extractor",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Information Extractor": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Name Found",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Name",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Name Found": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "No Name": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Text Classifier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "Text Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Text Classifier": {
        "main": [
          [
            {
              "node": "Gmail",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Gmail1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Gmail2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Gmail3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail": {
        "main": [
          [
            {
              "node": "Gmail4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail1": {
        "main": [
          [
            {
              "node": "Gmail5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gmail2": {
        "main": [
          [
            {
              "node": "Gmail6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "e995bf84-6937-4d8d-afc9-996996f0f837",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "RdAO5XbEKnvVFlgt",
    "tags": []
  },
  {
    "name": "Google map scraper (HazÄ±r)",
    "nodes": [
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "typeVersion": 1.1,
        "position": [
          80,
          60
        ],
        "id": "f11f94de-a744-4177-afa9-7619ec0b19f4",
        "name": "When chat message received",
        "webhookId": "6c052871-b965-43bc-a01e-0e3ae9345081"
      },
      {
        "parameters": {
          "options": {
            "systemMessage": "You are a research agent that helps find contact information from Google Maps or websites.\nAfter searching, save your results to Google Sheets.\nWhen doing this, you must use this JSON format in a single call:\n[\n{\n  \"Name\": \"Company name\",\n  \"Address\": \"Company address\",\n  \"Number\": \"Company phone number\",\n  \"Website\": \"Company website\",\n  \"Rating\": \"Company rating\", \n  \"Opening Hours\": \"Company opening hours\",\n  \"Email\": \"Company email address\"\n},\n...\n]\n\nWhen sending the number to \"Add to Google Sheets\", remove the + at the beginning of each number.\n\nWhen going through multiple pages, call \"Add to Google Sheets\" after each \"Map Search\" call to save the data directly, without consolidating it.\n\nIf no email is found, pass it as N/A to \"Add to Google Sheets\".\n\nKeep searching in Map Search until you find no more pages or results.",
            "maxIterations": 10
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.8,
        "position": [
          300,
          60
        ],
        "id": "44e98ca3-fa4f-42e1-9d14-d0e7ecbff6d3",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "gpt-4o"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          240,
          280
        ],
        "id": "9ac52f9f-5496-44ef-9337-c432a276e008",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {},
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          400,
          280
        ],
        "id": "27bddf7a-b471-465c-999d-4be15b0faaf5",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "toolDescription": "=This bot helps you extract all contact information for lead generation from Google Maps.\nInput parameters:\n\"q\" for the search term (e.g., \"Dental Clinic Amsterdam\").\n\"ll\" for geographic coordinates.\n\"page\" for the current search results page.",
          "url": "https://google.serper.dev/maps",
          "sendQuery": true,
          "parametersQuery": {
            "values": [
              {
                "name": "q"
              },
              {
                "name": "ll"
              },
              {
                "name": "page"
              },
              {
                "name": "hl"
              },
              {
                "name": "location"
              },
              {
                "name": "gl"
              }
            ]
          },
          "sendHeaders": true,
          "parametersHeaders": {
            "values": [
              {
                "name": "X-API-KEY",
                "valueProvider": "fieldValue"
              }
            ]
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
        "typeVersion": 1.1,
        "position": [
          560,
          280
        ],
        "id": "ff397846-6d06-40de-9181-214ff831eeb8",
        "name": "Map Search Tool"
      },
      {
        "parameters": {
          "name": "store_to_google_sheets",
          "description": "=This is a tool to analyze the input and store it in Google Sheets columns, including:\n{\n  \"Name\": xxx,\n  \"Address\": xxx,\n  \"Number\": xxx,\n  \"Website\": xxx,\n  \"Rating\": xxx,\n  \"Opening Hours\": xxx,\n  \"Email\": xxx\n}",
          "workflowId": {
            "__rl": true,
            "value": "PSIN4cCPD4lzOl1U",
            "mode": "list",
            "cachedResultName": "Tool"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2,
        "position": [
          760,
          280
        ],
        "id": "9da0fec5-c013-4efd-83c9-b47428d8bec0",
        "name": "Call n8n Workflow Tool"
      },
      {
        "parameters": {
          "content": "Map Search Agent",
          "height": 500,
          "width": 900
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          0,
          0
        ],
        "typeVersion": 1,
        "id": "7f2143a9-3eba-42e1-9df2-011ac65b65df",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          },
          "documentId": {
            "__rl": true,
            "value": "1g0V0kbpr81jgU4KEmeWEL-jphQnQarOUbgcQUeibfpE",
            "mode": "list",
            "cachedResultName": "Leads test 1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0V0kbpr81jgU4KEmeWEL-jphQnQarOUbgcQUeibfpE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sheet1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0V0kbpr81jgU4KEmeWEL-jphQnQarOUbgcQUeibfpE/edit#gid=0"
          },
          "event": "rowAdded",
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheetsTrigger",
        "typeVersion": 1,
        "position": [
          -100,
          760
        ],
        "id": "68693d10-e076-45a5-9c48-abc7eeed637c",
        "name": "Google Sheets Trigger",
        "credentials": {
          "googleSheetsTriggerOAuth2Api": {
            "id": "YNBuVtKHjIM8HhBw",
            "name": "PROTOTIPAL"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "b925ecd9-541f-4d3c-9bc1-0f683bd420cc",
                "leftValue": "={{ $json.Name }}",
                "rightValue": "Name",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              },
              {
                "id": "e241db34-fd92-468e-802d-b4485d260b85",
                "leftValue": "={{ $json.Name }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2.2,
        "position": [
          120,
          760
        ],
        "id": "d75dd3a7-7507-4271-ae36-98179f2d8aa7",
        "name": "Filter"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          340,
          760
        ],
        "id": "a01e7a49-1730-4d65-880e-5eca382e65f0",
        "name": "Loop Over Items"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.perplexity.ai/chat/completions",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"model\": \"sonar\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"You are a research assistant. Get data about a company and return it. If a field doesn't exist, return \\\"N/A\\\" for that field. Return only JSON, without additional information.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"Get the email and background for {{$json.Name}} in {{$json.Address}}, reference website: {{$json.Website}}\"\n    }\n  ],\n  \"response_format\": {\n    \"type\": \"json_schema\",\n    \"json_schema\": {\n      \"schema\": {\n        \"$schema\": \"https://json-schema.org/draft-07/schema#\",\n        \"title\": \"CompanyDetails\",\n        \"type\": \"object\",\n        \"properties\": {\n          \"Email\": {\n            \"type\": \"string\"\n          },\n          \"Background\": {\n            \"type\": \"string\"\n          }\n        },\n        \"required\": [\"Email\", \"Background\"]\n      }\n    }\n  }\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          660,
          780
        ],
        "id": "04dc954c-f8f5-4a29-bed9-77a3de196ada",
        "name": "HTTP Request",
        "credentials": {
          "httpHeaderAuth": {
            "id": "yZajTPDbIgNtf3Us",
            "name": "Perplexity"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const items = $input.all()[0].json.choices[0].message.content;\nconst cleaned = items.replace('```json', '').replace('```', '')\nconst parsed = JSON.parse(cleaned);\n\nreturn { data: parsed }"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          880,
          780
        ],
        "id": "85472771-f1ee-4c6a-9667-67bc04e871df",
        "name": "Code"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1g0V0kbpr81jgU4KEmeWEL-jphQnQarOUbgcQUeibfpE",
            "mode": "list",
            "cachedResultName": "Leads test 1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0V0kbpr81jgU4KEmeWEL-jphQnQarOUbgcQUeibfpE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sheet1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0V0kbpr81jgU4KEmeWEL-jphQnQarOUbgcQUeibfpE/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "UUID": "={{ $('Google Sheets Trigger').item.json.UUID }}",
              "Email": "={{ $json.data.Email }}",
              "Background": "={{ $json.data.Background }}"
            },
            "matchingColumns": [
              "UUID"
            ],
            "schema": [
              {
                "id": "UUID",
                "displayName": "UUID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Email",
                "displayName": "Email",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Background",
                "displayName": "Background",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Name",
                "displayName": "Name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Address",
                "displayName": "Address",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Number",
                "displayName": "Number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Website",
                "displayName": "Website",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Rating",
                "displayName": "Rating",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Opening Hours",
                "displayName": "Opening Hours",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1100,
          780
        ],
        "id": "d3f7ef14-f912-4a23-8c47-194fc5d90ab4",
        "name": "Google Sheets",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "8cw6xg8w0MZaVeCC",
            "name": "PROTOTIPAL"
          }
        }
      }
    ],
    "pinData": {},
    "connections": {
      "When chat message received": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Map Search Tool": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Call n8n Workflow Tool": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets Trigger": {
        "main": [
          [
            {
              "node": "Filter",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [],
          [
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request": {
        "main": [
          [
            {
              "node": "Code",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "bae4b453-aab2-40a0-882b-a8d0ceb0888d",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "73hpymFzmsXkd2Md",
    "tags": []
  },
  {
    "name": "Gorsel + VIDEO otomasyonu PAYLAS",
    "nodes": [
      {
        "parameters": {
          "method": "POST",
          "url": "https://queue.fal.run/fal-ai/gpt-image-1/edit-image/byok",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={  \n  \"image_urls\": [\"{{ $json[\"Urun URLsi\"] }}\"], \n     \"prompt\": \"Bu koltugu bir oturma odasi icerisine yerlestir, urunu bozma\",\n     \"openai_api_key\": \"\"\n   } ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          220,
          -120
        ],
        "id": "009b4acd-5cfe-4f3b-bf3c-1175a635d507",
        "name": "Istek"
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/gpt-image-1/requests/{{ $json.request_id }}/status ",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          440,
          -120
        ],
        "id": "5f3e5878-c59d-408b-8946-a6780901362d",
        "name": "Durum degerlendirmesi"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "736cdddf-657c-46b7-8f88-6c19755eb164",
                "leftValue": "={{ $json.status }}",
                "rightValue": "COMPLETED",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          700,
          -100
        ],
        "id": "93bb71d9-bfdc-4871-a041-dd436d581a51",
        "name": "If"
      },
      {
        "parameters": {
          "amount": 30
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          880,
          60
        ],
        "id": "ae9e653e-5395-496e-af50-51fdb32f9623",
        "name": "Wait",
        "webhookId": "ea096210-5980-4678-aeec-8671eede688f"
      },
      {
        "parameters": {
          "content": "## URUN GORSELI OLUSTURMA\n"
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          40,
          -440
        ],
        "id": "8433cacd-2a40-4410-bfc6-05aca39eba4c",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "## VIDEO OLUSTURMA\n"
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1340,
          -440
        ],
        "id": "0f9e855e-c093-403d-874b-aec89057f9b6",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/gpt-image-1/requests/{{ $json.request_id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          880,
          -240
        ],
        "id": "c9ee7640-d700-424e-9b40-ccc046240645",
        "name": "URUN GORSELI SONUC"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://queue.fal.run/fal-ai/kling-video/v2/master/image-to-video",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n     \"prompt\": \"Camera is moving around the product slowly\",\n     \"image_url\": \"{{ $json.images[0].url }}\"\n   } ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1340,
          -240
        ],
        "id": "b9260c61-e65b-4e9f-b67e-17ca45c100d8",
        "name": "VIDEO ICIN ISTEK"
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/kling-video/requests/{{ $json.request_id }}/status ",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1580,
          -240
        ],
        "id": "7a9fa206-1dd2-485b-906c-44384a0bdbc9",
        "name": "VIDEO DURUM"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "736cdddf-657c-46b7-8f88-6c19755eb164",
                "leftValue": "={{ $json.status }}",
                "rightValue": "COMPLETED",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1900,
          -260
        ],
        "id": "30353317-00ba-4890-b26b-582b22f5b352",
        "name": "If1"
      },
      {
        "parameters": {
          "amount": 1,
          "unit": "minutes"
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          1940,
          -20
        ],
        "id": "9e0647d2-4e4a-4ed2-bf5f-1b0aa58d6d2c",
        "name": "Wait1",
        "webhookId": "5e4e0972-9b9a-45f5-8ae7-32f687215f1b"
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/kling-video/requests/{{ $json.request_id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2120,
          -260
        ],
        "id": "18d48b2b-48f7-4b87-b2dc-281082683f9d",
        "name": "VIDEO SONUC"
      },
      {
        "parameters": {
          "authentication": "serviceAccount",
          "sendTo": "burhan.kocabiyik@coremgnetb2b.com",
          "subject": "Yeni mobilya Videosu",
          "message": "=Merhabalar, \n\nBunu olusturduk, onaylayabilir misiniz? \n\n{{ $json.video.url }}\n\nDonuslerinizi bekliyorum. ",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          2340,
          -260
        ],
        "id": "46909509-ee23-4958-8bf1-df9bba850482",
        "name": "Gmail",
        "webhookId": "5a69a5cd-1f07-46bf-adb7-88353ababd4d",
        "credentials": {
          "googleApi": {
            "id": "oSvTNPjflafrbgti",
            "name": "Gmail account 4"
          }
        }
      },
      {
        "parameters": {
          "formTitle": "VIDEO FORMU",
          "formDescription": "Istediginiz urun gorselini paylasin",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Urun URLsi",
                "requiredField": true
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.formTrigger",
        "typeVersion": 2.2,
        "position": [
          0,
          0
        ],
        "id": "0b252c0e-7716-4809-b448-d2b21951f908",
        "name": "On form submission",
        "webhookId": "2b406af3-ea6f-4bb0-b838-08d2d37bac0c"
      }
    ],
    "pinData": {},
    "connections": {
      "Istek": {
        "main": [
          [
            {
              "node": "Durum degerlendirmesi",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Durum degerlendirmesi": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "URUN GORSELI SONUC",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Durum degerlendirmesi",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "URUN GORSELI SONUC": {
        "main": [
          [
            {
              "node": "VIDEO ICIN ISTEK",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "VIDEO ICIN ISTEK": {
        "main": [
          [
            {
              "node": "VIDEO DURUM",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "VIDEO DURUM": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "VIDEO SONUC",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait1": {
        "main": [
          [
            {
              "node": "VIDEO DURUM",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "VIDEO SONUC": {
        "main": [
          [
            {
              "node": "Gmail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On form submission": {
        "main": [
          [
            {
              "node": "Istek",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "d89f44d0-d946-41f5-89fe-a6e10626d4b5",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "lRFDIgyEWAXV0JMV",
    "tags": []
  },
  {
    "name": "GPT 4.5 - FP",
    "nodes": [
      {
        "parameters": {
          "promptType": "define",
          "text": "=You are an interior-design copywriter.\nTask\nFor the style {{ $json.Style_name }}, {{ $json.Style_category }}, {{ $json.style_description_short }}\n\nWrite **seven separate paragraphs**, 150-200 words each, in this order:\n1. Living room (~300 ftÂ²)\n2. Bedroom   (~180 ftÂ²)\n3. Dining room (~150 ftÂ²)\n4. Kitchen   (~140 ftÂ²)\n5. Bathroom   (~80 ftÂ²)\n6. Hallway   (~60 ftÂ²)\n7. Home office (~120 ftÂ²)\nGuidelines\nâ€¢ Rooms should feel right for a modern American suburban houseâ€”not a mansion, not a tiny city loft.\nâ€¢ Tone: clear, informal, no marketing fluff or superlatives.\nâ€¢ Weave in the styleâ€™s essentials:\n â€“ Core idea: **{style_description_short}**\n â€“ 4-5 signatures (choose from): **{style_characteristic_1}**, **{style_characteristic_2}**, **{style_characteristic_3}**, **{style_characteristic_4}**, **{style_characteristic_5}**, **{style_characteristic_6}**\nâ€¢ Mention layout, surfaces/materials, colour palette, and two or three key furniture or fixture pieces that anchor the space.\nâ€¢ Do **not** repeat the style name inside every paragraph; once is enough.\nâ€¢ Steer clear of clichÃ©s like â€œstunningâ€, â€œbreathtakingâ€, or â€œultimateâ€.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "="
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.8,
        "position": [
          200,
          260
        ],
        "id": "917d6bfd-2492-4c2b-b720-7a3248ea7879",
        "name": "AI Agent",
        "retryOnFail": true,
        "waitBetweenTries": 5000
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          -500,
          -580
        ],
        "id": "67ca565a-020e-47fd-9871-82bd97648a13",
        "name": "When clicking â€˜Execute workflowâ€™"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"array\",\n  \"items\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"Style Name\": {\n        \"type\": \"string\",\n        \"description\": \"Name of the interior design style\"\n      },\n      \"Room description\": {\n        \"type\": \"string\",\n        \"description\": \"Detailed description of the room style\"\n      },\n      \"Color profile\": {\n        \"type\": \"string\",\n        \"description\": \"Comma-separated hex color codes\"\n      },\n      \"Color story\": {\n        \"type\": \"string\",\n        \"description\": \"Narrative description of color usage\"\n      },\n      \"Style1\": {\n        \"type\": \"string\",\n        \"description\": \"Primary style influence\"\n      },\n      \"Likeliness\": {\n        \"type\": \"string\",\n        \"description\": \"Percentage likelihood of Style1\"\n      },\n      \"Style2\": {\n        \"type\": \"string\",\n        \"description\": \"Secondary style influence\"\n      },\n      \"Likeliness_1\": {\n        \"type\": \"string\",\n        \"description\": \"Percentage likelihood of Style2\"\n      },\n      \"Style3\": {\n        \"type\": \"string\",\n        \"description\": \"Tertiary style influence\"\n      },\n      \"Likeliness_2\": {\n        \"type\": \"string\",\n        \"description\": \"Percentage likelihood of Style3\"\n      },\n      \"Characteristics Style1\": {\n        \"type\": \"string\",\n        \"description\": \"Detailed characteristics of primary style\"\n      },\n      \"Characteristics Style2\": {\n        \"type\": \"string\",\n        \"description\": \"Detailed characteristics of secondary style\"\n      },\n      \"Characteristics Style3\": {\n        \"type\": \"string\",\n        \"description\": \"Detailed characteristics of tertiary style\"\n      },\n      \"Overall Atmosphere\": {\n        \"type\": \"string\",\n        \"description\": \"Description of overall room atmosphere\"\n      },\n      \"Comparable designers/brands\": {\n        \"type\": \"string\",\n        \"description\": \"List of comparable designers and brands\"\n      }\n    },\n    \"required\": [\n      \"Style Name\",\n      \"Room description\",\n      \"Color profile\",\n      \"Color story\",\n      \"Style1\",\n      \"Likeliness\",\n      \"Style2\",\n      \"Likeliness_1\",\n      \"Style3\",\n      \"Likeliness_2\",\n      \"Characteristics Style1\",\n      \"Characteristics Style2\",\n      \"Characteristics Style3\",\n      \"Overall Atmosphere\",\n      \"Comparable designers/brands\"\n    ]\n  }\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          -60,
          400
        ],
        "id": "8dcbec8e-fb78-4a22-80da-c564808cc768",
        "name": "Structured Output Parser"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "19wuJHb_0ehxe0QkwG4o4Ag2Ec6Pu7mw_tMA5OdCJB1E",
            "mode": "list",
            "cachedResultName": "STYLES 24 jun",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19wuJHb_0ehxe0QkwG4o4Ag2Ec6Pu7mw_tMA5OdCJB1E/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 117246598,
            "mode": "list",
            "cachedResultName": "OUTPUT",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19wuJHb_0ehxe0QkwG4o4Ag2Ec6Pu7mw_tMA5OdCJB1E/edit#gid=117246598"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Bedroom": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Bedroom', ``, 'string') }}",
              "Dining": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Dining', ``, 'string') }}",
              "Kitchen": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Kitchen', ``, 'string') }}",
              "Bathroom": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Bathroom', ``, 'string') }}",
              "Hallway": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Hallway', ``, 'string') }}",
              "home_office": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('home_office', ``, 'string') }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Bedroom",
                "displayName": "Bedroom",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Dining",
                "displayName": "Dining",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Kitchen",
                "displayName": "Kitchen",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bathroom",
                "displayName": "Bathroom",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Hallway",
                "displayName": "Hallway",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "home_office",
                "displayName": "home_office",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.6,
        "position": [
          380,
          520
        ],
        "id": "d658bb89-6c5d-4279-bab5-640ae9cca6ed",
        "name": "Google Sheets",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "M32X9MdR3aDzj0jE",
            "name": "Google Sheets account 12"
          }
        }
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "claude-opus-4-20250514",
            "mode": "list",
            "cachedResultName": "Claude Opus 4"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
        "typeVersion": 1.3,
        "position": [
          200,
          540
        ],
        "id": "bb5075ba-d282-42c4-98c8-e5f7b3a5d705",
        "name": "Anthropic Chat Model",
        "credentials": {
          "anthropicApi": {
            "id": "NjI4xLsh97XiJNzu",
            "name": "Anthropic account"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE",
            "mode": "list",
            "cachedResultName": "new styles  - Minimalist (2)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1781463620,
            "mode": "list",
            "cachedResultName": "new styles  - Minimalist (2)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE/edit#gid=1781463620"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          -300,
          -580
        ],
        "id": "f6aae27a-e786-4607-a374-d1979614aa88",
        "name": "Google Sheets1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "M32X9MdR3aDzj0jE",
            "name": "Google Sheets account 12"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "736cdddf-657c-46b7-8f88-6c19755eb164",
                "leftValue": "={{ $json.status }}",
                "rightValue": "COMPLETED",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1000,
          -600
        ],
        "id": "01a27822-221a-4070-91ef-bc5e92498464",
        "name": "If"
      },
      {
        "parameters": {
          "amount": 30
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          1320,
          -460
        ],
        "id": "64bcfb59-9bef-44b1-9a0b-1219b9330ca4",
        "name": "Wait",
        "webhookId": "a5b55bd6-4bf1-44a4-9233-507240579e30"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://queue.fal.run/fal-ai/flux-pro/kontext/max/text-to-image",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Key 31acfaa9-c0f1-4318-a6fc-f4667826623f:c6fd2dc6d2ce106938ea916f518016f9"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"prompt\": \"{{ $json['Living room'] }}\",\n  \"guidance_scale\": 3.5,\n  \"num_images\": 4,\n  \"safety_tolerance\": \"2\",\n  \"output_format\": \"jpeg\",\n  \"aspect_ratio\": \"16:9\"\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          400,
          -600
        ],
        "id": "34291a6d-aa79-458d-9796-da053898dd81",
        "name": "request"
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/flux-pro/requests/{{ $json.request_id }}/status ",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Key 31acfaa9-c0f1-4318-a6fc-f4667826623f:c6fd2dc6d2ce106938ea916f518016f9"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          760,
          -600
        ],
        "id": "676a7129-7710-43e9-af60-faf5a78b3856",
        "name": "POST"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE",
            "mode": "list",
            "cachedResultName": "new styles  - Minimalist (2)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1781463620,
            "mode": "list",
            "cachedResultName": "new styles  - Minimalist (2)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE/edit#gid=1781463620"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "living room image 1": "={{ $json.images[0].url }}",
              "living room image 2": "={{ $json.images[1].url }}",
              "living room image 3": "={{ $json.images[2].url }}",
              "living room image 4": "={{ $json.images[3].url }}",
              "Living room": "={{ $json.prompt }}"
            },
            "matchingColumns": [
              "Living room"
            ],
            "schema": [
              {
                "id": "Style_name",
                "displayName": "Style_name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Style_category",
                "displayName": "Style_category",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_description_short",
                "displayName": "style_description_short",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_description_long",
                "displayName": "style_description_long",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_description_extensive",
                "displayName": "style_description_extensive",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_1",
                "displayName": "style_characteristic_1",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_2",
                "displayName": "style_characteristic_2",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_3",
                "displayName": "style_characteristic_3",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_4",
                "displayName": "style_characteristic_4",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_5",
                "displayName": "style_characteristic_5",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_6",
                "displayName": "style_characteristic_6",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_tags",
                "displayName": "style_tags",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_designers",
                "displayName": "style_designers",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Living room",
                "displayName": "Living room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "living room image 1",
                "displayName": "living room image 1",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "living room image 2",
                "displayName": "living room image 2",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "living room image 3",
                "displayName": "living room image 3",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "living room image 4",
                "displayName": "living room image 4",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room",
                "displayName": "Bed room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room image 1",
                "displayName": "Bed room image 1",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room image 2",
                "displayName": "Bed room image 2",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room image 3",
                "displayName": "Bed room image 3",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room image 4",
                "displayName": "Bed room image 4",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Dining room",
                "displayName": "Dining room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Kitchen",
                "displayName": "Kitchen",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bath room",
                "displayName": "Bath room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Hallway",
                "displayName": "Hallway",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Home office",
                "displayName": "Home office",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          1540,
          -660
        ],
        "id": "cd9059af-cdc0-4d0d-a66a-c9184b336deb",
        "name": "Google Sheets2",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "M32X9MdR3aDzj0jE",
            "name": "Google Sheets account 12"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/flux-pro/requests/{{ $json.request_id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Key 31acfaa9-c0f1-4318-a6fc-f4667826623f:c6fd2dc6d2ce106938ea916f518016f9"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1320,
          -660
        ],
        "id": "54028a1f-d356-4ddd-bf21-fe8206d08b03",
        "name": "RESULT"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "736cdddf-657c-46b7-8f88-6c19755eb164",
                "leftValue": "={{ $json.status }}",
                "rightValue": "COMPLETED",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1000,
          -1160
        ],
        "id": "e2b04765-a636-46ca-bcf9-db19256b5906",
        "name": "If1"
      },
      {
        "parameters": {
          "amount": 30
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          1320,
          -1000
        ],
        "id": "7ab9424c-ca4f-4fe1-92aa-6a6d3d433983",
        "name": "Wait1",
        "webhookId": "a5b55bd6-4bf1-44a4-9233-507240579e30"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://queue.fal.run/fal-ai/flux-pro/kontext/max/text-to-image",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Key 31acfaa9-c0f1-4318-a6fc-f4667826623f:c6fd2dc6d2ce106938ea916f518016f9"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"prompt\": \"{{ $json['Bed room'] }}\",\n  \"guidance_scale\": 3.5,\n  \"num_images\": 4,\n  \"safety_tolerance\": \"2\",\n  \"output_format\": \"jpeg\",\n  \"aspect_ratio\": \"16:9\"\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          400,
          -1160
        ],
        "id": "506fed03-1227-4b59-a8e1-1101d06b273c",
        "name": "request1"
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/flux-pro/requests/{{ $json.request_id }}/status ",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Key 31acfaa9-c0f1-4318-a6fc-f4667826623f:c6fd2dc6d2ce106938ea916f518016f9"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          760,
          -1160
        ],
        "id": "08fd5f98-60a9-4420-bb91-3c25cfabf5f0",
        "name": "POST1"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE",
            "mode": "list",
            "cachedResultName": "new styles  - Minimalist (2)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1781463620,
            "mode": "list",
            "cachedResultName": "new styles  - Minimalist (2)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE/edit#gid=1781463620"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "living room image 2": "=",
              "living room image 3": "=",
              "living room image 4": "=",
              "Living room": "=",
              "Bed room": "={{ $json.prompt }}",
              "Bed room image 1": "={{ $json.images[0].url }}",
              "Bed room image 2": "={{ $json.images[1] }}",
              "Bed room image 3": "={{ $json.images[2] }}",
              "Bed room image 4": "={{ $json.images[3] }}"
            },
            "matchingColumns": [
              "Bed room"
            ],
            "schema": [
              {
                "id": "Style_name",
                "displayName": "Style_name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Style_category",
                "displayName": "Style_category",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_description_short",
                "displayName": "style_description_short",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_description_long",
                "displayName": "style_description_long",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_description_extensive",
                "displayName": "style_description_extensive",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_1",
                "displayName": "style_characteristic_1",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_2",
                "displayName": "style_characteristic_2",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_3",
                "displayName": "style_characteristic_3",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_4",
                "displayName": "style_characteristic_4",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_5",
                "displayName": "style_characteristic_5",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_6",
                "displayName": "style_characteristic_6",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_tags",
                "displayName": "style_tags",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_designers",
                "displayName": "style_designers",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Living room",
                "displayName": "Living room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "living room image 1",
                "displayName": "living room image 1",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "living room image 2",
                "displayName": "living room image 2",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "living room image 3",
                "displayName": "living room image 3",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "living room image 4",
                "displayName": "living room image 4",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room",
                "displayName": "Bed room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Bed room image 1",
                "displayName": "Bed room image 1",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room image 2",
                "displayName": "Bed room image 2",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room image 3",
                "displayName": "Bed room image 3",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room image 4",
                "displayName": "Bed room image 4",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Dining room",
                "displayName": "Dining room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Kitchen",
                "displayName": "Kitchen",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bath room",
                "displayName": "Bath room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Hallway",
                "displayName": "Hallway",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Home office",
                "displayName": "Home office",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          1540,
          -1220
        ],
        "id": "5297ca8c-89cd-4eb7-9523-8cd99160963c",
        "name": "Google Sheets3",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "M32X9MdR3aDzj0jE",
            "name": "Google Sheets account 12"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/flux-pro/requests/{{ $json.request_id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Key 31acfaa9-c0f1-4318-a6fc-f4667826623f:c6fd2dc6d2ce106938ea916f518016f9"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1320,
          -1220
        ],
        "id": "a3a9e570-451b-4e0f-b349-9753e41bdbe3",
        "name": "RESULT1"
      },
      {
        "parameters": {
          "content": "## Bedroom",
          "height": 600,
          "width": 1660
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          160,
          -1380
        ],
        "id": "a68af58e-f5c0-4239-a977-73fe00961b52",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "736cdddf-657c-46b7-8f88-6c19755eb164",
                "leftValue": "={{ $json.status }}",
                "rightValue": "COMPLETED",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          900,
          -1860
        ],
        "id": "00251f42-8e0e-4e82-9b0c-6c36dca3b89f",
        "name": "If2"
      },
      {
        "parameters": {
          "amount": 30
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          1220,
          -1700
        ],
        "id": "4abd2246-9900-46ca-97b2-253e643fc30d",
        "name": "Wait2",
        "webhookId": "a5b55bd6-4bf1-44a4-9233-507240579e30"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://queue.fal.run/fal-ai/flux-pro/kontext/max/text-to-image",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Key 31acfaa9-c0f1-4318-a6fc-f4667826623f:c6fd2dc6d2ce106938ea916f518016f9"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"prompt\": \"{{ $json['Dining room'] }}\",\n  \"guidance_scale\": 3.5,\n  \"num_images\": 4,\n  \"safety_tolerance\": \"2\",\n  \"output_format\": \"jpeg\",\n  \"aspect_ratio\": \"16:9\"\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          300,
          -1860
        ],
        "id": "1cdfa1b4-221f-4326-bd88-4cb12f145726",
        "name": "request2"
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/flux-pro/requests/{{ $json.request_id }}/status ",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Key 31acfaa9-c0f1-4318-a6fc-f4667826623f:c6fd2dc6d2ce106938ea916f518016f9"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          660,
          -1860
        ],
        "id": "88e28c43-e54c-4c8f-b50b-afecdb80d91a",
        "name": "POST2"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE",
            "mode": "list",
            "cachedResultName": "new styles  - Minimalist (2)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1781463620,
            "mode": "list",
            "cachedResultName": "new styles  - Minimalist (2)",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1vBLAB2KhD5ub55GsRp22vPSkpYdNOirqB7R_W2JdrQE/edit#gid=1781463620"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "living room image 2": "=",
              "living room image 3": "=",
              "living room image 4": "=",
              "Living room": "=",
              "Bed room": "=",
              "Bed room image 1": "=",
              "Bed room image 2": "={{ $json.images[1] }}",
              "Bed room image 3": "={{ $json.images[2] }}",
              "Bed room image 4": "={{ $json.images[3] }}"
            },
            "matchingColumns": [
              "Dining room"
            ],
            "schema": [
              {
                "id": "Style_name",
                "displayName": "Style_name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Style_category",
                "displayName": "Style_category",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_description_short",
                "displayName": "style_description_short",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_description_long",
                "displayName": "style_description_long",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_description_extensive",
                "displayName": "style_description_extensive",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_1",
                "displayName": "style_characteristic_1",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_2",
                "displayName": "style_characteristic_2",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_3",
                "displayName": "style_characteristic_3",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_4",
                "displayName": "style_characteristic_4",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_5",
                "displayName": "style_characteristic_5",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_characteristic_6",
                "displayName": "style_characteristic_6",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_tags",
                "displayName": "style_tags",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "style_designers",
                "displayName": "style_designers",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Living room",
                "displayName": "Living room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "living room image 1",
                "displayName": "living room image 1",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "living room image 2",
                "displayName": "living room image 2",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "living room image 3",
                "displayName": "living room image 3",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "living room image 4",
                "displayName": "living room image 4",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room",
                "displayName": "Bed room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Bed room image 1",
                "displayName": "Bed room image 1",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room image 2",
                "displayName": "Bed room image 2",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room image 3",
                "displayName": "Bed room image 3",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bed room image 4",
                "displayName": "Bed room image 4",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Dining room",
                "displayName": "Dining room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Kitchen",
                "displayName": "Kitchen",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Bath room",
                "displayName": "Bath room",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Hallway",
                "displayName": "Hallway",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Home office",
                "displayName": "Home office",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          1440,
          -1920
        ],
        "id": "e0736c84-2024-4025-b0d4-068fa3e570c0",
        "name": "Google Sheets4",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "M32X9MdR3aDzj0jE",
            "name": "Google Sheets account 12"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://queue.fal.run/fal-ai/flux-pro/requests/{{ $json.request_id }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Key 31acfaa9-c0f1-4318-a6fc-f4667826623f:c6fd2dc6d2ce106938ea916f518016f9"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1220,
          -1920
        ],
        "id": "ba16e031-2734-4bcc-b137-3ad9ecf80f08",
        "name": "RESULT2"
      },
      {
        "parameters": {
          "content": "## Dining room",
          "height": 600,
          "width": 1660
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          160,
          -2040
        ],
        "id": "2648d113-9ff3-4b5c-93a1-c961316e3673",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "content": "## Living room\n",
          "height": 600,
          "width": 1660
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          160,
          -740
        ],
        "id": "16d44a23-affc-46b1-97c0-2b4f97916711",
        "name": "Sticky Note2"
      }
    ],
    "pinData": {},
    "connections": {
      "AI Agent": {
        "main": [
          []
        ]
      },
      "When clicking â€˜Execute workflowâ€™": {
        "main": [
          [
            {
              "node": "Google Sheets1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Anthropic Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets1": {
        "main": [
          [
            {
              "node": "request",
              "type": "main",
              "index": 0
            },
            {
              "node": "request1",
              "type": "main",
              "index": 0
            },
            {
              "node": "request2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "RESULT",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "POST",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "request": {
        "main": [
          [
            {
              "node": "POST",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "POST": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "RESULT": {
        "main": [
          [
            {
              "node": "Google Sheets2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets2": {
        "main": [
          []
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "RESULT1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait1": {
        "main": [
          [
            {
              "node": "POST1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "request1": {
        "main": [
          [
            {
              "node": "POST1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "POST1": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "RESULT1": {
        "main": [
          [
            {
              "node": "Google Sheets3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If2": {
        "main": [
          [
            {
              "node": "RESULT2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait2": {
        "main": [
          [
            {
              "node": "POST2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "request2": {
        "main": [
          [
            {
              "node": "POST2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "POST2": {
        "main": [
          [
            {
              "node": "If2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "RESULT2": {
        "main": [
          [
            {
              "node": "Google Sheets4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "467ebf3e-ff3a-4cb7-9db2-080313a5e4f0",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "mfvoX89hgo4NoQAv",
    "tags": []
  },
  {
    "name": "Grain A/B Testing Engine v1",
    "nodes": [
      {
        "parameters": {},
        "id": "webhook-create-test",
        "name": "Create Test Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          300
        ],
        "webhookId": "ab-test-create"
      },
      {
        "parameters": {},
        "id": "webhook-track-event",
        "name": "Track Event Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          500
        ],
        "webhookId": "ab-test-track"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 */6 * * *"
              }
            ]
          }
        },
        "id": "scheduled-analysis",
        "name": "Scheduled Analysis",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          700
        ]
      },
      {
        "parameters": {
          "jsCode": "// A/B Test Configuration & Variant Assignment\nconst input = $input.first().json;\n\n// Test configuration\nconst testConfig = {\n  testId: input.testId || `test-${Date.now()}`,\n  testName: input.testName || 'Unnamed Test',\n  testType: input.testType || 'ab', // ab, multivariate, bandit\n  status: 'active',\n  createdAt: new Date().toISOString(),\n  \n  // Traffic allocation\n  trafficAllocation: input.trafficAllocation || 100, // percentage of users in test\n  \n  // Variants\n  variants: input.variants || [\n    { id: 'control', name: 'Control', weight: 50 },\n    { id: 'variant_a', name: 'Variant A', weight: 50 }\n  ],\n  \n  // Success metrics\n  primaryMetric: input.primaryMetric || 'conversion_rate',\n  secondaryMetrics: input.secondaryMetrics || ['click_rate', 'engagement_time'],\n  \n  // Statistical settings\n  confidenceLevel: input.confidenceLevel || 95,\n  minimumSampleSize: input.minimumSampleSize || 1000,\n  minimumDetectableEffect: input.mde || 5, // 5% minimum detectable effect\n  \n  // Test duration\n  maxDuration: input.maxDurationDays || 30,\n  autoStop: input.autoStop !== false, // Auto-stop when significant\n  \n  // Segmentation\n  segments: input.segments || ['all'],\n  \n  // Current stats\n  stats: {\n    totalVisitors: 0,\n    variantStats: {}\n  }\n};\n\n// Initialize variant stats\ntestConfig.variants.forEach(v => {\n  testConfig.stats.variantStats[v.id] = {\n    visitors: 0,\n    conversions: 0,\n    revenue: 0,\n    bounces: 0,\n    engagementTime: 0\n  };\n});\n\n// Weighted random assignment function\nfunction assignVariant(variants, userId) {\n  // Deterministic assignment based on userId hash\n  const hash = userId.split('').reduce((a, b) => {\n    a = ((a << 5) - a) + b.charCodeAt(0);\n    return a & a;\n  }, 0);\n  \n  const normalizedHash = Math.abs(hash) % 100;\n  let cumulative = 0;\n  \n  for (const variant of variants) {\n    cumulative += variant.weight;\n    if (normalizedHash < cumulative) {\n      return variant.id;\n    }\n  }\n  \n  return variants[0].id; // Fallback to control\n}\n\nreturn [{ json: testConfig }];"
        },
        "id": "test-config",
        "name": "Test Configuration",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an A/B Test Variant Generator. Given a control version and test goals, generate compelling test variants.\n\nFor each variant, provide:\n- Clear hypothesis\n- What's being changed\n- Expected impact\n- Risk assessment\n\nReturn JSON:\n{\n  \"variants\": [\n    {\n      \"id\": \"variant_id\",\n      \"name\": \"Variant Name\",\n      \"hypothesis\": \"If we change X, then Y will improve because Z\",\n      \"changes\": [\"change 1\", \"change 2\"],\n      \"expectedImpact\": \"percentage or description\",\n      \"riskLevel\": \"low|medium|high\",\n      \"content\": {\n        \"headline\": \"\",\n        \"subheadline\": \"\",\n        \"cta\": \"\",\n        \"image\": \"\"\n      }\n    }\n  ],\n  \"testDuration\": \"recommended days\",\n  \"sampleSizeNeeded\": 0,\n  \"successCriteria\": \"\"\n}"
              },
              {
                "role": "user",
                "content": "=Generate A/B test variants for:\n\nTest Name: {{ $json.testName }}\nTest Type: {{ $json.testType }}\nPrimary Metric: {{ $json.primaryMetric }}\n\nControl Content:\n{{ JSON.stringify($json.control || { headline: 'Original headline', cta: 'Sign Up' }, null, 2) }}\n\nGoals:\n{{ $json.goals || 'Increase conversion rate' }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-variant-generator",
        "name": "AI Variant Generator",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "// Event Tracking & Data Collection\nconst event = $input.first().json;\n\n// Validate event structure\nconst trackedEvent = {\n  eventId: `evt-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n  testId: event.testId,\n  variantId: event.variantId,\n  userId: event.userId || event.sessionId,\n  eventType: event.eventType || 'pageview', // pageview, click, conversion, bounce\n  timestamp: new Date().toISOString(),\n  \n  // Event details\n  details: {\n    page: event.page,\n    element: event.element,\n    value: event.value || 0, // For revenue events\n    duration: event.duration || 0, // For engagement events\n    referrer: event.referrer,\n    device: event.device,\n    browser: event.browser,\n    country: event.country\n  },\n  \n  // Session info\n  session: {\n    id: event.sessionId,\n    isNew: event.isNewSession || false,\n    pageViews: event.pageViews || 1\n  }\n};\n\n// Determine if this is a conversion event\nconst conversionEvents = ['purchase', 'signup', 'lead', 'subscription'];\ntrackedEvent.isConversion = conversionEvents.includes(event.eventType?.toLowerCase());\n\n// Calculate event weight for Bayesian analysis\ntrackedEvent.weight = trackedEvent.isConversion ? 1 : \n  (event.eventType === 'click' ? 0.3 : 0.1);\n\nreturn [{ json: trackedEvent }];"
        },
        "id": "event-tracker",
        "name": "Event Tracker",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.AB_TEST_DATA_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Events",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "event_id": "={{ $json.eventId }}",
              "test_id": "={{ $json.testId }}",
              "variant_id": "={{ $json.variantId }}",
              "user_id": "={{ $json.userId }}",
              "event_type": "={{ $json.eventType }}",
              "is_conversion": "={{ $json.isConversion }}",
              "value": "={{ $json.details.value }}",
              "timestamp": "={{ $json.timestamp }}",
              "device": "={{ $json.details.device }}",
              "country": "={{ $json.details.country }}"
            }
          }
        },
        "id": "store-event",
        "name": "Store Event Data",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          700,
          500
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.AB_TEST_DATA_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Events",
            "mode": "list"
          },
          "options": {}
        },
        "id": "fetch-test-data",
        "name": "Fetch Test Data",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          450,
          700
        ]
      },
      {
        "parameters": {
          "jsCode": "// Statistical Analysis Engine\n// Calculates significance, confidence intervals, and winner determination\n\nconst events = $input.all().map(i => i.json);\n\n// Group events by test and variant\nconst testResults = {};\n\nevents.forEach(event => {\n  if (!testResults[event.test_id]) {\n    testResults[event.test_id] = {\n      testId: event.test_id,\n      variants: {},\n      totalVisitors: 0,\n      totalConversions: 0,\n      startDate: event.timestamp,\n      endDate: event.timestamp\n    };\n  }\n  \n  const test = testResults[event.test_id];\n  \n  if (!test.variants[event.variant_id]) {\n    test.variants[event.variant_id] = {\n      variantId: event.variant_id,\n      visitors: new Set(),\n      conversions: 0,\n      revenue: 0,\n      clicks: 0,\n      bounces: 0\n    };\n  }\n  \n  const variant = test.variants[event.variant_id];\n  variant.visitors.add(event.user_id);\n  \n  if (event.is_conversion === 'true' || event.is_conversion === true) {\n    variant.conversions++;\n    variant.revenue += parseFloat(event.value) || 0;\n  }\n  \n  if (event.event_type === 'click') variant.clicks++;\n  if (event.event_type === 'bounce') variant.bounces++;\n  \n  // Update date range\n  if (event.timestamp < test.startDate) test.startDate = event.timestamp;\n  if (event.timestamp > test.endDate) test.endDate = event.timestamp;\n});\n\n// Calculate statistics for each test\nconst analysisResults = Object.values(testResults).map(test => {\n  const variants = Object.values(test.variants).map(v => ({\n    ...v,\n    visitorCount: v.visitors.size,\n    conversionRate: v.visitors.size > 0 ? (v.conversions / v.visitors.size * 100) : 0,\n    clickRate: v.visitors.size > 0 ? (v.clicks / v.visitors.size * 100) : 0,\n    bounceRate: v.visitors.size > 0 ? (v.bounces / v.visitors.size * 100) : 0,\n    avgRevenue: v.conversions > 0 ? (v.revenue / v.conversions) : 0\n  }));\n  \n  // Find control and treatment\n  const control = variants.find(v => v.variantId === 'control') || variants[0];\n  const treatments = variants.filter(v => v.variantId !== control.variantId);\n  \n  // Calculate statistical significance using Z-test\n  function calculateZScore(control, treatment) {\n    const p1 = control.conversionRate / 100;\n    const p2 = treatment.conversionRate / 100;\n    const n1 = control.visitorCount;\n    const n2 = treatment.visitorCount;\n    \n    if (n1 === 0 || n2 === 0) return 0;\n    \n    const pooledP = (p1 * n1 + p2 * n2) / (n1 + n2);\n    const se = Math.sqrt(pooledP * (1 - pooledP) * (1/n1 + 1/n2));\n    \n    if (se === 0) return 0;\n    return (p2 - p1) / se;\n  }\n  \n  function getConfidenceLevel(zScore) {\n    const absZ = Math.abs(zScore);\n    if (absZ >= 2.576) return { level: 99, significant: true };\n    if (absZ >= 1.96) return { level: 95, significant: true };\n    if (absZ >= 1.645) return { level: 90, significant: true };\n    return { level: Math.round((1 - 2 * (1 - normalCDF(absZ))) * 100), significant: false };\n  }\n  \n  function normalCDF(x) {\n    const a1 =  0.254829592;\n    const a2 = -0.284496736;\n    const a3 =  1.421413741;\n    const a4 = -1.453152027;\n    const a5 =  1.061405429;\n    const p  =  0.3275911;\n    \n    const sign = x < 0 ? -1 : 1;\n    x = Math.abs(x) / Math.sqrt(2);\n    \n    const t = 1.0 / (1.0 + p * x);\n    const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);\n    \n    return 0.5 * (1.0 + sign * y);\n  }\n  \n  // Analyze each treatment vs control\n  const comparisons = treatments.map(treatment => {\n    const zScore = calculateZScore(control, treatment);\n    const confidence = getConfidenceLevel(zScore);\n    const lift = control.conversionRate > 0 ? \n      ((treatment.conversionRate - control.conversionRate) / control.conversionRate * 100) : 0;\n    \n    return {\n      treatmentId: treatment.variantId,\n      controlRate: control.conversionRate.toFixed(2),\n      treatmentRate: treatment.conversionRate.toFixed(2),\n      lift: lift.toFixed(2),\n      zScore: zScore.toFixed(3),\n      confidenceLevel: confidence.level,\n      isSignificant: confidence.significant,\n      status: confidence.significant ? \n        (lift > 0 ? 'winner' : 'loser') : \n        'inconclusive',\n      sampleSize: control.visitorCount + treatment.visitorCount\n    };\n  });\n  \n  // Determine overall winner\n  const significantWinners = comparisons.filter(c => c.status === 'winner');\n  const overallWinner = significantWinners.length > 0 ?\n    significantWinners.sort((a, b) => parseFloat(b.lift) - parseFloat(a.lift))[0] :\n    null;\n  \n  return {\n    testId: test.testId,\n    variants,\n    comparisons,\n    summary: {\n      totalVisitors: variants.reduce((sum, v) => sum + v.visitorCount, 0),\n      totalConversions: variants.reduce((sum, v) => sum + v.conversions, 0),\n      testDuration: Math.ceil((new Date(test.endDate) - new Date(test.startDate)) / (1000 * 60 * 60 * 24)),\n      overallWinner: overallWinner?.treatmentId || 'no_winner_yet',\n      winnerLift: overallWinner?.lift || '0',\n      recommendation: overallWinner ? \n        `Implement ${overallWinner.treatmentId} (${overallWinner.lift}% lift, ${overallWinner.confidenceLevel}% confidence)` :\n        'Continue testing - no significant winner yet'\n    },\n    analyzedAt: new Date().toISOString()\n  };\n});\n\nreturn [{ json: { tests: analysisResults } }];"
        },
        "id": "statistical-analysis",
        "name": "Statistical Analysis",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          700,
          700
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an A/B Testing Analyst AI. Analyze test results and provide actionable insights.\n\nReview the statistical analysis and provide:\n1. Plain-language interpretation of results\n2. Business impact assessment\n3. Confidence in the results\n4. Recommendations for next steps\n5. Potential follow-up tests\n\nReturn JSON:\n{\n  \"interpretation\": \"Plain language summary\",\n  \"businessImpact\": {\n    \"revenueImpact\": \"$X per month\",\n    \"conversionImpact\": \"X% improvement\",\n    \"confidenceStatement\": \"\"\n  },\n  \"keyFindings\": [],\n  \"recommendations\": [],\n  \"followUpTests\": [\n    {\"hypothesis\": \"\", \"expectedImpact\": \"\"}\n  ],\n  \"riskFactors\": [],\n  \"confidenceScore\": 0\n}"
              },
              {
                "role": "user",
                "content": "=Analyze these A/B test results:\n\n{{ JSON.stringify($json.tests, null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.3
          }
        },
        "id": "ai-analysis",
        "name": "AI Result Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          950,
          700
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-winner",
                "leftValue": "={{ $json.tests[0]?.summary?.overallWinner }}",
                "rightValue": "no_winner_yet",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              }
            ]
          }
        },
        "id": "winner-check",
        "name": "Has Winner?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          1200,
          600
        ]
      },
      {
        "parameters": {
          "channel": "#ab-testing",
          "text": "=ðŸ† *A/B Test Winner Found!*\n\n{{ $('Statistical Analysis').first().json.tests.map(test => {\n  return `*Test:* ${test.testId}\\n` +\n    `*Winner:* ${test.summary.overallWinner}\\n` +\n    `*Lift:* +${test.summary.winnerLift}%\\n` +\n    `*Sample Size:* ${test.summary.totalVisitors}\\n` +\n    `*Test Duration:* ${test.summary.testDuration} days\\n\\n` +\n    `*Recommendation:* ${test.summary.recommendation}\\n\\n` +\n    `*AI Analysis:*\\n${$('AI Result Analysis').first().json.interpretation}`;\n}).join('\\n\\n---\\n\\n') }}",
          "otherOptions": {}
        },
        "id": "slack-winner-alert",
        "name": "Slack Winner Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1450,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#ab-testing",
          "text": "=ðŸ“Š *A/B Test Progress Update*\n\n{{ $('Statistical Analysis').first().json.tests.map(test => {\n  return `*Test:* ${test.testId}\\n` +\n    `*Status:* Still collecting data\\n` +\n    `*Visitors:* ${test.summary.totalVisitors}\\n` +\n    `*Conversions:* ${test.summary.totalConversions}\\n` +\n    `*Duration:* ${test.summary.testDuration} days\\n\\n` +\n    `*Current Results:*\\n` +\n    test.comparisons.map(c => `â€¢ ${c.treatmentId}: ${c.treatmentRate}% (${c.lift > 0 ? '+' : ''}${c.lift}% vs control)`).join('\\n');\n}).join('\\n\\n---\\n\\n') }}\\n\\n_Confidence not yet reached. Continue testing._",
          "otherOptions": {}
        },
        "id": "slack-progress-update",
        "name": "Slack Progress Update",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1450,
          700
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.AB_TEST_DATA_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Analysis History",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ new Date().toISOString() }}",
              "test_id": "={{ $('Statistical Analysis').first().json.tests[0]?.testId }}",
              "total_visitors": "={{ $('Statistical Analysis').first().json.tests[0]?.summary?.totalVisitors }}",
              "winner": "={{ $('Statistical Analysis').first().json.tests[0]?.summary?.overallWinner }}",
              "lift": "={{ $('Statistical Analysis').first().json.tests[0]?.summary?.winnerLift }}",
              "ai_confidence": "={{ $('AI Result Analysis').first().json.confidenceScore }}",
              "recommendation": "={{ $('Statistical Analysis').first().json.tests[0]?.summary?.recommendation }}"
            }
          }
        },
        "id": "log-analysis",
        "name": "Log Analysis Results",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1450,
          900
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"status\": \"success\",\n  \"testId\": \"{{ $json.testId }}\",\n  \"variants\": {{ JSON.stringify($json.variants || []) }},\n  \"message\": \"Test created successfully\",\n  \"createdAt\": \"{{ $json.createdAt }}\"\n}"
        },
        "id": "webhook-response-create",
        "name": "Create Test Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          950,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"status\": \"tracked\",\n  \"eventId\": \"{{ $json.eventId }}\",\n  \"testId\": \"{{ $json.testId }}\",\n  \"variantId\": \"{{ $json.variantId }}\",\n  \"timestamp\": \"{{ $json.timestamp }}\"\n}"
        },
        "id": "webhook-response-track",
        "name": "Track Event Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          950,
          500
        ]
      }
    ],
    "connections": {
      "Create Test Webhook": {
        "main": [
          [
            {
              "node": "Test Configuration",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Track Event Webhook": {
        "main": [
          [
            {
              "node": "Event Tracker",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Scheduled Analysis": {
        "main": [
          [
            {
              "node": "Fetch Test Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Test Configuration": {
        "main": [
          [
            {
              "node": "AI Variant Generator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Variant Generator": {
        "main": [
          [
            {
              "node": "Create Test Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Event Tracker": {
        "main": [
          [
            {
              "node": "Store Event Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Store Event Data": {
        "main": [
          [
            {
              "node": "Track Event Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Test Data": {
        "main": [
          [
            {
              "node": "Statistical Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Statistical Analysis": {
        "main": [
          [
            {
              "node": "AI Result Analysis",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has Winner?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Result Analysis": {
        "main": [
          [
            {
              "node": "Log Analysis Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Winner?": {
        "main": [
          [
            {
              "node": "Slack Winner Alert",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Slack Progress Update",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-saas-ab-testing"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 3,
    "tags": [
      {
        "name": "A/B Testing",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Experimentation",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Analytics",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "AI",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain AI Copywriting Studio v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "copywriting-request",
          "options": {}
        },
        "id": "request-webhook",
        "name": "Copy Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "ai-copywriting"
      },
      {
        "parameters": {
          "jsCode": "// Parse and validate copy request\nconst request = $input.first().json.body;\n\nconst copyRequest = {\n  requestId: `COPY-${Date.now().toString(36).toUpperCase()}`,\n  type: request.copyType || 'ad_copy',\n  platform: request.platform || 'general',\n  product: request.product,\n  audience: request.targetAudience || 'general',\n  tone: request.tone || 'professional',\n  goals: request.goals || [],\n  constraints: {\n    characterLimit: request.characterLimit || null,\n    wordLimit: request.wordLimit || null,\n    hashtags: request.includeHashtags || false,\n    emoji: request.includeEmoji || false,\n    cta: request.ctaRequired || true\n  },\n  brand: request.brand || {},\n  competitors: request.competitors || [],\n  existingCopy: request.existingCopy || null,\n  variations: request.variationsCount || 3,\n  createdAt: new Date().toISOString()\n};\n\n// Map copy types to specific requirements\nconst typeConfigs = {\n  ad_copy: { maxLength: 150, variations: 5, focusOn: 'conversion' },\n  social_post: { maxLength: 280, variations: 3, focusOn: 'engagement' },\n  email_subject: { maxLength: 60, variations: 10, focusOn: 'open_rate' },\n  email_body: { maxLength: 500, variations: 3, focusOn: 'click_rate' },\n  landing_page: { maxLength: null, variations: 2, focusOn: 'conversion' },\n  tagline: { maxLength: 10, variations: 10, focusOn: 'memorability' },\n  product_description: { maxLength: 200, variations: 3, focusOn: 'benefits' },\n  video_script: { maxLength: null, variations: 2, focusOn: 'engagement' },\n  push_notification: { maxLength: 50, variations: 5, focusOn: 'urgency' }\n};\n\ncopyRequest.config = typeConfigs[copyRequest.type] || typeConfigs.ad_copy;\n\nreturn [{ json: copyRequest }];"
        },
        "id": "parse-request",
        "name": "Parse Request",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "=You are an elite copywriter AI with expertise in {{ $json.type.replace('_', ' ') }}.\n\nBrand Guidelines:\n{{ JSON.stringify($json.brand, null, 2) || 'None specified - use best practices' }}\n\nTone: {{ $json.tone }}\nTarget Audience: {{ $json.audience }}\nPlatform: {{ $json.platform }}\n\nCopywriting Principles:\n1. Lead with benefits, not features\n2. Use power words that trigger emotion\n3. Create urgency without being pushy\n4. Speak directly to the reader (use \"you\")\n5. Keep it simple and scannable\n6. Include a clear call-to-action\n7. Test different angles and hooks\n\nGenerate {{ $json.variations }} unique variations.",
                "role": "system"
              },
              {
                "content": "=Create {{ $json.type.replace('_', ' ') }} copy for:\n\n**Product/Service:** {{ $json.product }}\n\n**Goals:** {{ $json.goals.join(', ') || 'Drive conversions' }}\n\n**Constraints:**\n{{ $json.constraints.characterLimit ? `- Character limit: ${$json.constraints.characterLimit}` : '' }}\n{{ $json.constraints.wordLimit ? `- Word limit: ${$json.constraints.wordLimit}` : '' }}\n{{ $json.constraints.hashtags ? '- Include relevant hashtags' : '' }}\n{{ $json.constraints.emoji ? '- Use appropriate emojis' : '' }}\n{{ $json.constraints.cta ? '- Must include call-to-action' : '' }}\n\n{{ $json.existingCopy ? `**Existing copy to improve:** ${$json.existingCopy}` : '' }}\n\nGenerate {{ $json.variations }} distinct variations with different hooks and angles.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.8,
            "maxTokens": 2500
          }
        },
        "id": "generate-copy",
        "name": "Generate Copy Variations",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          750,
          300
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Copy Editor and Quality Analyst. Review the generated copy and score each variation on:\n\n1. Clarity (1-10): Is the message clear and easy to understand?\n2. Persuasion (1-10): How compelling is the copy?\n3. Relevance (1-10): How well does it match the target audience?\n4. Brand Fit (1-10): Does it align with brand guidelines?\n5. CTA Strength (1-10): Is the call-to-action effective?\n\nProvide specific improvement suggestions for each variation.\nSelect the top performing variation based on total score.",
                "role": "system"
              },
              {
                "content": "=Review these copy variations:\n\n**Original Request:**\n- Type: {{ $('Parse Request').first().json.type }}\n- Audience: {{ $('Parse Request').first().json.audience }}\n- Tone: {{ $('Parse Request').first().json.tone }}\n\n**Generated Variations:**\n{{ JSON.stringify($json, null, 2) }}\n\nScore each variation and provide improvement suggestions.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.3,
            "maxTokens": 2000
          }
        },
        "id": "review-copy",
        "name": "Review & Score",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1000,
          300
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are an A/B Testing Specialist. Based on the copy variations and scores, design an A/B testing strategy.\n\nProvide:\n1. Which variations to test first (control vs challenger)\n2. Sample size recommendations\n3. Test duration estimates\n4. Key metrics to track\n5. Statistical significance thresholds\n6. Expected performance hypotheses",
                "role": "system"
              },
              {
                "content": "=Design A/B test strategy for:\n\n**Copy Type:** {{ $('Parse Request').first().json.type }}\n**Platform:** {{ $('Parse Request').first().json.platform }}\n\n**Scored Variations:**\n{{ JSON.stringify($json, null, 2) }}\n\nProvide a structured A/B testing plan.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.4,
            "maxTokens": 1500
          }
        },
        "id": "ab-test-plan",
        "name": "Create A/B Test Plan",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1000,
          500
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Compile final copy package\nconst request = $('Parse Request').first().json;\nconst generated = $('Generate Copy Variations').first().json;\nconst reviewed = $('Review & Score').first().json;\nconst abPlan = $('Create A/B Test Plan').first().json;\n\nconst copyPackage = {\n  requestId: request.requestId,\n  type: request.type,\n  platform: request.platform,\n  variations: [],\n  topPick: null,\n  abTestPlan: abPlan,\n  metadata: {\n    product: request.product,\n    audience: request.audience,\n    tone: request.tone,\n    createdAt: request.createdAt,\n    completedAt: new Date().toISOString()\n  }\n};\n\n// Combine variations with scores\nconst variations = generated.variations || generated.copy || [];\nconst scores = reviewed.scores || reviewed.variations || [];\n\n(Array.isArray(variations) ? variations : [variations]).forEach((variation, index) => {\n  const score = scores[index] || {};\n  const totalScore = (score.clarity || 7) + (score.persuasion || 7) + \n    (score.relevance || 7) + (score.brandFit || 7) + (score.ctaStrength || 7);\n  \n  copyPackage.variations.push({\n    id: `V${index + 1}`,\n    copy: typeof variation === 'string' ? variation : variation.copy || variation.text || variation,\n    scores: score,\n    totalScore,\n    improvements: score.suggestions || score.improvements || []\n  });\n});\n\n// Sort by total score and pick winner\ncopyPackage.variations.sort((a, b) => b.totalScore - a.totalScore);\ncopyPackage.topPick = copyPackage.variations[0];\n\nreturn [{ json: copyPackage }];"
        },
        "id": "compile-package",
        "name": "Compile Package",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CONTENT_DB_URL }}/copy",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-copy",
        "name": "Save to Database",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "content-db-api",
            "name": "Content DB API"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.CONTENT_SLACK_CHANNEL }}",
          "text": "=âœï¸ *Copy Generated - {{ $json.type.replace('_', ' ').toUpperCase() }}*\n\n*Request ID:* {{ $json.requestId }}\n*Platform:* {{ $json.platform }}\n*Product:* {{ $json.metadata.product }}\n\nâ­ *Top Performing Variation:*\n```\n{{ typeof $json.topPick.copy === 'string' ? $json.topPick.copy : JSON.stringify($json.topPick.copy) }}\n```\n*Score:* {{ $json.topPick.totalScore }}/50\n\nðŸ“Š *All Variations:* {{ $json.variations.length }} generated\nðŸ§ª *A/B Test Plan:* Ready\n\n_View all variations in the content database_",
          "otherOptions": {}
        },
        "id": "notify-complete",
        "name": "Notify Completion",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1500,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "respond-webhook",
        "name": "Respond to Request",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1750,
          400
        ]
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.COPYWRITING_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Generation Log",
            "mode": "list",
            "cachedResultName": "Generation Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Request ID": "={{ $json.requestId }}",
              "Type": "={{ $json.type }}",
              "Platform": "={{ $json.platform }}",
              "Product": "={{ $json.metadata.product }}",
              "Variations": "={{ $json.variations.length }}",
              "Top Score": "={{ $json.topPick.totalScore }}",
              "Created At": "={{ $json.metadata.completedAt }}"
            }
          },
          "options": {}
        },
        "id": "log-generation",
        "name": "Log Generation",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1750,
          600
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Copy Request": {
        "main": [
          [
            {
              "node": "Parse Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Request": {
        "main": [
          [
            {
              "node": "Generate Copy Variations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Copy Variations": {
        "main": [
          [
            {
              "node": "Review & Score",
              "type": "main",
              "index": 0
            },
            {
              "node": "Create A/B Test Plan",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Review & Score": {
        "main": [
          [
            {
              "node": "Compile Package",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create A/B Test Plan": {
        "main": [
          [
            {
              "node": "Compile Package",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compile Package": {
        "main": [
          [
            {
              "node": "Save to Database",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Completion",
              "type": "main",
              "index": 0
            },
            {
              "node": "Respond to Request",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Generation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "copywriting",
        "name": "copywriting"
      },
      {
        "id": "ai",
        "name": "ai"
      },
      {
        "id": "content",
        "name": "content"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 1,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain AI Visual Content Generator v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "generate-content",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Generate Content Request",
        "type": "n8n-nodes-base.webhook",
        "position": [
          250,
          300
        ],
        "typeVersion": 2,
        "webhookId": "generate-content"
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Content_Requests"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-requests",
        "name": "Get Pending Requests",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          250,
          500
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 15
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Check Queue (15 min)",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          50,
          500
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "pending",
                "leftValue": "={{ $json.status }}",
                "rightValue": "pending",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-pending",
        "name": "Filter Pending",
        "type": "n8n-nodes-base.filter",
        "position": [
          450,
          500
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "// Normalize request from webhook or sheet\nconst input = $input.item.json;\n\nconst request = {\n  request_id: input.request_id || `REQ-${Date.now()}`,\n  prompt: input.prompt,\n  content_type: input.content_type || 'image', // image, video, image_to_video\n  style: input.style || 'realistic',\n  aspect_ratio: input.aspect_ratio || '1:1',\n  duration: input.duration || 5, // for video, in seconds\n  provider: input.provider || 'auto', // auto, flux, kling, runway, pika, luma, higgsfield, veo\n  source_image_url: input.source_image_url || null, // for image-to-video\n  client_name: input.client_name || 'Unknown',\n  priority: input.priority || 'normal'\n};\n\nreturn { json: request };"
        },
        "id": "normalize-request",
        "name": "Normalize Request",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir AI gorsel/video uretimi icin prompt muhendisisin. Kullanicinin talebini analiz et ve en uygun provider'i sec.\n\nPROVIDER'LAR:\n- FLUX: En iyi text-to-image, photorealistic, hizli\n- KLING: Image-to-video, motion control, 5-10s video\n- RUNWAY: Text-to-video, cinematic, uzun video\n- PIKA: Cartoon/animated style, kisa video\n- LUMA: 3D, dreamlike, artistic\n- HIGGSFIELD: Realistic human video, lip-sync\n- VEO: Google, en kaliteli video, yavas\n\nJSON dondur:\n{\n  \"recommended_provider\": \"provider_name\",\n  \"reasoning\": \"neden bu provider\",\n  \"optimized_prompt\": \"provider icin optimize edilmis prompt\",\n  \"negative_prompt\": \"kacinilacak seyler\",\n  \"style_tags\": [\"tag1\", \"tag2\"],\n  \"estimated_quality\": \"1-10\",\n  \"estimated_time_seconds\": 30\n}"
              },
              {
                "role": "user",
                "content": "Talep: {{ $json.prompt }}\nIcerik tipi: {{ $json.content_type }}\nStil: {{ $json.style }}\nEn-boy: {{ $json.aspect_ratio }}\nSure: {{ $json.duration }}s\nTercih edilen provider: {{ $json.provider }}\nKaynak gorsel: {{ $json.source_image_url ? 'VAR' : 'YOK' }}"
              }
            ]
          },
          "options": {
            "temperature": 0.3
          }
        },
        "id": "ai-prompt-optimizer",
        "name": "AI Prompt Optimizer",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          850,
          400
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiResponse = $input.item.json.message?.content || $input.item.json.content;\nlet optimization;\n\ntry {\n  optimization = JSON.parse(aiResponse);\n} catch (e) {\n  optimization = {\n    recommended_provider: $input.item.json.provider === 'auto' ? 'flux' : $input.item.json.provider,\n    optimized_prompt: $input.item.json.prompt,\n    negative_prompt: 'blurry, low quality, distorted',\n    style_tags: [],\n    estimated_quality: 7,\n    estimated_time_seconds: 30\n  };\n}\n\n// Override if user specified provider\nconst finalProvider = $input.item.json.provider !== 'auto' \n  ? $input.item.json.provider \n  : optimization.recommended_provider;\n\nreturn {\n  json: {\n    ...$input.item.json,\n    provider: finalProvider,\n    optimized_prompt: optimization.optimized_prompt,\n    negative_prompt: optimization.negative_prompt,\n    style_tags: optimization.style_tags,\n    estimated_quality: optimization.estimated_quality,\n    reasoning: optimization.reasoning\n  }\n};"
        },
        "id": "parse-optimization",
        "name": "Parse Optimization",
        "type": "n8n-nodes-base.code",
        "position": [
          1050,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "rules": {
            "rules": [
              {
                "outputKey": "flux",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.provider }}",
                      "rightValue": "flux",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "kling",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.provider }}",
                      "rightValue": "kling",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "runway",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.provider }}",
                      "rightValue": "runway",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "pika",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.provider }}",
                      "rightValue": "pika",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "luma",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.provider }}",
                      "rightValue": "luma",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "higgsfield",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.provider }}",
                      "rightValue": "higgsfield",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "veo",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.provider }}",
                      "rightValue": "veo",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "options": {}
        },
        "id": "route-provider",
        "name": "Route to Provider",
        "type": "n8n-nodes-base.switch",
        "position": [
          1250,
          400
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.piapi.ai/api/flux/v1/generate",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-Key",
                "value": "={{ $env.PIAPI_KEY }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"model\": \"flux-1.1-pro\",\n  \"prompt\": \"{{ $json.optimized_prompt }}\",\n  \"negative_prompt\": \"{{ $json.negative_prompt }}\",\n  \"width\": {{ $json.aspect_ratio === '16:9' ? 1920 : ($json.aspect_ratio === '9:16' ? 1080 : 1024) }},\n  \"height\": {{ $json.aspect_ratio === '16:9' ? 1080 : ($json.aspect_ratio === '9:16' ? 1920 : 1024) }},\n  \"num_inference_steps\": 30,\n  \"guidance_scale\": 7.5\n}",
          "options": {}
        },
        "id": "flux-generate",
        "name": "FLUX Generate Image",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1450,
          0
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.piapi.ai/api/kling/v1/video/generate",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-Key",
                "value": "={{ $env.PIAPI_KEY }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"model\": \"kling-v1\",\n  \"prompt\": \"{{ $json.optimized_prompt }}\",\n  \"image_url\": \"{{ $json.source_image_url || '' }}\",\n  \"duration\": {{ $json.duration }},\n  \"aspect_ratio\": \"{{ $json.aspect_ratio }}\",\n  \"mode\": \"{{ $json.source_image_url ? 'image_to_video' : 'text_to_video' }}\"\n}",
          "options": {}
        },
        "id": "kling-generate",
        "name": "KLING Generate Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1450,
          150
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.runwayml.com/v1/generate",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $env.RUNWAY_API_KEY }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"model\": \"gen-3-alpha\",\n  \"prompt\": \"{{ $json.optimized_prompt }}\",\n  \"duration\": {{ $json.duration }},\n  \"aspect_ratio\": \"{{ $json.aspect_ratio }}\",\n  \"watermark\": false\n}",
          "options": {}
        },
        "id": "runway-generate",
        "name": "RUNWAY Generate Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1450,
          300
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.pika.art/v1/generate",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $env.PIKA_API_KEY }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"prompt\": \"{{ $json.optimized_prompt }}\",\n  \"style\": \"{{ $json.style }}\",\n  \"duration\": {{ $json.duration }},\n  \"aspect_ratio\": \"{{ $json.aspect_ratio }}\"\n}",
          "options": {}
        },
        "id": "pika-generate",
        "name": "PIKA Generate Video",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1450,
          450
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.lumalabs.ai/dream-machine/v1/generations",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $env.LUMA_API_KEY }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"prompt\": \"{{ $json.optimized_prompt }}\",\n  \"aspect_ratio\": \"{{ $json.aspect_ratio }}\",\n  \"keyframes\": {\n    \"frame0\": {\n      \"type\": \"{{ $json.source_image_url ? 'image' : 'generation' }}\",\n      \"url\": \"{{ $json.source_image_url || '' }}\"\n    }\n  }\n}",
          "options": {}
        },
        "id": "luma-generate",
        "name": "LUMA Dream Machine",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1450,
          600
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.higgsfield.ai/v1/generate",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $env.HIGGSFIELD_API_KEY }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"prompt\": \"{{ $json.optimized_prompt }}\",\n  \"mode\": \"{{ $json.source_image_url ? 'animate' : 'generate' }}\",\n  \"source_image\": \"{{ $json.source_image_url || '' }}\",\n  \"duration\": {{ $json.duration }},\n  \"style\": \"realistic\",\n  \"aspect_ratio\": \"{{ $json.aspect_ratio }}\"\n}",
          "options": {}
        },
        "id": "higgsfield-generate",
        "name": "HIGGSFIELD Generate",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1450,
          750
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://generativelanguage.googleapis.com/v1beta/models/veo-001:generateVideo",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "key",
                "value": "={{ $env.GOOGLE_AI_API_KEY }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"prompt\": \"{{ $json.optimized_prompt }}\",\n  \"aspectRatio\": \"{{ $json.aspect_ratio }}\",\n  \"durationSeconds\": {{ $json.duration }},\n  \"personGeneration\": \"allow\"\n}",
          "options": {}
        },
        "id": "veo-generate",
        "name": "VEO (Google) Generate",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1450,
          900
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "// Normalize response from different providers\nconst input = $input.item.json;\nconst provider = $input.item.json.provider || 'unknown';\n\nlet result = {\n  request_id: input.request_id,\n  provider: provider,\n  status: 'processing',\n  media_url: null,\n  task_id: null,\n  error: null\n};\n\n// Parse based on provider response structure\ntry {\n  if (provider === 'flux') {\n    result.media_url = input.data?.image_url || input.output?.url;\n    result.status = result.media_url ? 'completed' : 'processing';\n  } else if (provider === 'kling' || provider === 'runway' || provider === 'pika' || provider === 'luma' || provider === 'higgsfield' || provider === 'veo') {\n    result.task_id = input.id || input.task_id || input.generation_id;\n    result.status = input.status || 'processing';\n    result.media_url = input.video_url || input.output_url || input.result?.url;\n  }\n} catch (e) {\n  result.error = e.message;\n  result.status = 'error';\n}\n\nreturn {\n  json: {\n    ...input,\n    result: result\n  }\n};"
        },
        "id": "parse-result",
        "name": "Parse Generation Result",
        "type": "n8n-nodes-base.code",
        "position": [
          1650,
          450
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-processing",
                "leftValue": "={{ $json.result.status }}",
                "rightValue": "processing",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-processing",
        "name": "If Still Processing",
        "type": "n8n-nodes-base.if",
        "position": [
          1850,
          450
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "amount": 30,
          "unit": "seconds"
        },
        "id": "wait-polling",
        "name": "Wait 30s",
        "type": "n8n-nodes-base.wait",
        "position": [
          2050,
          350
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $json.provider === 'kling' ? 'https://api.piapi.ai/api/kling/v1/video/' + $json.result.task_id : ($json.provider === 'runway' ? 'https://api.runwayml.com/v1/tasks/' + $json.result.task_id : ($json.provider === 'luma' ? 'https://api.lumalabs.ai/dream-machine/v1/generations/' + $json.result.task_id : '')) }}",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "=Bearer {{ $env[$json.provider.toUpperCase() + '_API_KEY'] || $env.PIAPI_KEY }}"
              }
            ]
          },
          "options": {}
        },
        "id": "poll-status",
        "name": "Poll Generation Status",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2250,
          350
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Content_Requests"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "status": "={{ $json.result.status }}",
              "provider_used": "={{ $json.provider }}",
              "media_url": "={{ $json.result.media_url || '' }}",
              "task_id": "={{ $json.result.task_id || '' }}",
              "completed_at": "={{ $json.result.status === 'completed' ? $now.format('YYYY-MM-DD HH:mm:ss') : '' }}",
              "error": "={{ $json.result.error || '' }}"
            }
          },
          "options": {}
        },
        "id": "update-request-status",
        "name": "Update Request Status",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2050,
          550
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-completed",
                "leftValue": "={{ $json.result.status }}",
                "rightValue": "completed",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-completed",
        "name": "If Completed",
        "type": "n8n-nodes-base.if",
        "position": [
          2250,
          550
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#content-generated",
          "text": "=*AI Icerik Uretildi!*\n\n*Request ID:* {{ $json.request_id }}\n*Musteri:* {{ $json.client_name }}\n*Provider:* {{ $json.provider }}\n*Icerik Tipi:* {{ $json.content_type }}\n\n*Prompt:* {{ $json.optimized_prompt.substring(0, 200) }}...\n\n*Media URL:* {{ $json.result.media_url }}\n\n*Kalite Tahmini:* {{ $json.estimated_quality }}/10",
          "otherOptions": {}
        },
        "id": "slack-notify-complete",
        "name": "Notify Complete",
        "type": "n8n-nodes-base.slack",
        "position": [
          2450,
          450
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "channel": "#content-errors",
          "text": "=*AI Icerik Uretim Hatasi*\n\n*Request ID:* {{ $json.request_id }}\n*Provider:* {{ $json.provider }}\n*Hata:* {{ $json.result.error || 'Bilinmeyen hata' }}\n\n*Prompt:* {{ $json.prompt }}",
          "otherOptions": {}
        },
        "id": "slack-notify-error",
        "name": "Notify Error",
        "type": "n8n-nodes-base.slack",
        "position": [
          2450,
          650
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      }
    ],
    "connections": {
      "Generate Content Request": {
        "main": [
          [
            {
              "node": "Normalize Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Queue (15 min)": {
        "main": [
          [
            {
              "node": "Get Pending Requests",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Pending Requests": {
        "main": [
          [
            {
              "node": "Filter Pending",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Pending": {
        "main": [
          [
            {
              "node": "Normalize Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize Request": {
        "main": [
          [
            {
              "node": "AI Prompt Optimizer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Prompt Optimizer": {
        "main": [
          [
            {
              "node": "Parse Optimization",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Optimization": {
        "main": [
          [
            {
              "node": "Route to Provider",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route to Provider": {
        "main": [
          [
            {
              "node": "FLUX Generate Image",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "KLING Generate Video",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "RUNWAY Generate Video",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "PIKA Generate Video",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "LUMA Dream Machine",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "HIGGSFIELD Generate",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "VEO (Google) Generate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "FLUX Generate Image": {
        "main": [
          [
            {
              "node": "Parse Generation Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "KLING Generate Video": {
        "main": [
          [
            {
              "node": "Parse Generation Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "RUNWAY Generate Video": {
        "main": [
          [
            {
              "node": "Parse Generation Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "PIKA Generate Video": {
        "main": [
          [
            {
              "node": "Parse Generation Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "LUMA Dream Machine": {
        "main": [
          [
            {
              "node": "Parse Generation Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HIGGSFIELD Generate": {
        "main": [
          [
            {
              "node": "Parse Generation Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "VEO (Google) Generate": {
        "main": [
          [
            {
              "node": "Parse Generation Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Generation Result": {
        "main": [
          [
            {
              "node": "If Still Processing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Still Processing": {
        "main": [
          [
            {
              "node": "Wait 30s",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Update Request Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 30s": {
        "main": [
          [
            {
              "node": "Poll Generation Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Poll Generation Status": {
        "main": [
          [
            {
              "node": "Parse Generation Result",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Request Status": {
        "main": [
          [
            {
              "node": "If Completed",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Completed": {
        "main": [
          [
            {
              "node": "Notify Complete",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Notify Error",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "grain-automation"
      },
      {
        "name": "ai-content"
      },
      {
        "name": "video-generation"
      }
    ],
    "meta": {
      "templateId": "grain-avcg-v1",
      "version": "1.0.0",
      "description": "Multi-provider AI visual content generator. Supports FLUX, Kling, Runway, Pika, Luma, Higgsfield, Veo. Auto-selects best provider based on prompt.",
      "requiredCredentials": [
        "Google Sheets OAuth2",
        "OpenAI API",
        "Slack"
      ],
      "requiredEnvVars": [
        "PIAPI_KEY",
        "RUNWAY_API_KEY",
        "PIKA_API_KEY",
        "LUMA_API_KEY",
        "HIGGSFIELD_API_KEY",
        "GOOGLE_AI_API_KEY"
      ],
      "supportedProviders": {
        "flux": {
          "type": "image",
          "api": "PiAPI",
          "speed": "fast",
          "quality": "high"
        },
        "kling": {
          "type": "video",
          "api": "PiAPI",
          "speed": "medium",
          "quality": "high",
          "features": [
            "image-to-video"
          ]
        },
        "runway": {
          "type": "video",
          "api": "RunwayML",
          "speed": "slow",
          "quality": "cinematic"
        },
        "pika": {
          "type": "video",
          "api": "Pika",
          "speed": "fast",
          "quality": "stylized"
        },
        "luma": {
          "type": "video",
          "api": "Luma Labs",
          "speed": "medium",
          "quality": "artistic",
          "features": [
            "3D",
            "dreamlike"
          ]
        },
        "higgsfield": {
          "type": "video",
          "api": "Higgsfield",
          "speed": "medium",
          "quality": "realistic",
          "features": [
            "human-video",
            "lip-sync"
          ]
        },
        "veo": {
          "type": "video",
          "api": "Google AI",
          "speed": "slow",
          "quality": "best"
        }
      }
    }
  },
  {
    "name": "Grain Backlink Monitor v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 4 * * *"
              }
            ]
          }
        },
        "id": "daily-monitor",
        "name": "Daily Backlink Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "backlink-check",
          "options": {}
        },
        "id": "manual-check",
        "name": "Manual Check Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          600
        ],
        "webhookId": "backlink-check"
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.BACKLINK_DB_URL }}/domains/monitored",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-domains",
        "name": "Fetch Monitored Domains",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "backlink-db-api",
            "name": "Backlink DB API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Prepare monitoring jobs\nconst domains = $input.first().json.domains || [];\n\nconst monitoringJobs = domains.map(domain => ({\n  monitorId: `BL-${Date.now().toString(36).toUpperCase()}-${domain.id}`,\n  domainId: domain.id,\n  domain: domain.domain,\n  competitors: domain.competitors || [],\n  checkDate: new Date().toISOString().split('T')[0],\n  timestamp: new Date().toISOString(),\n  previousMetrics: domain.lastMetrics || null\n}));\n\nreturn monitoringJobs.map(job => ({ json: job }));"
        },
        "id": "prepare-jobs",
        "name": "Prepare Monitor Jobs",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.BACKLINK_API_URL }}/backlinks",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "domain",
                "value": "={{ $json.domain }}"
              },
              {
                "name": "limit",
                "value": "1000"
              },
              {
                "name": "includeMetrics",
                "value": "true"
              }
            ]
          },
          "options": {
            "timeout": 60000
          }
        },
        "id": "fetch-backlinks",
        "name": "Fetch Backlinks",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "backlink-api-key",
            "name": "Backlink API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.BACKLINK_API_URL }}/new-lost",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "domain",
                "value": "={{ $json.domain }}"
              },
              {
                "name": "days",
                "value": "7"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-changes",
        "name": "Fetch New/Lost Links",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "backlink-api-key",
            "name": "Backlink API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Analyze backlink profile\nconst job = $('Prepare Monitor Jobs').first().json;\nconst backlinks = $('Fetch Backlinks').first().json;\nconst changes = $('Fetch New/Lost Links').first().json;\n\nconst links = backlinks.backlinks || [];\nconst newLinks = changes.new || [];\nconst lostLinks = changes.lost || [];\n\n// Calculate metrics\nconst metrics = {\n  totalBacklinks: links.length,\n  referringDomains: [...new Set(links.map(l => l.sourceDomain))].length,\n  dofollow: links.filter(l => !l.nofollow).length,\n  nofollow: links.filter(l => l.nofollow).length,\n  dofollowRatio: links.length > 0 \n    ? Math.round(links.filter(l => !l.nofollow).length / links.length * 100) \n    : 0,\n  avgDomainRating: links.length > 0\n    ? Math.round(links.reduce((a, b) => a + (b.domainRating || 0), 0) / links.length)\n    : 0,\n  newLinks7d: newLinks.length,\n  lostLinks7d: lostLinks.length,\n  netGrowth7d: newLinks.length - lostLinks.length\n};\n\n// Anchor text distribution\nconst anchorCounts = {};\nlinks.forEach(link => {\n  const anchor = link.anchorText?.toLowerCase() || '[no anchor]';\n  anchorCounts[anchor] = (anchorCounts[anchor] || 0) + 1;\n});\n\nconst topAnchors = Object.entries(anchorCounts)\n  .sort((a, b) => b[1] - a[1])\n  .slice(0, 10)\n  .map(([anchor, count]) => ({\n    anchor,\n    count,\n    percentage: Math.round(count / links.length * 100)\n  }));\n\n// Domain rating distribution\nconst drDistribution = {\n  high: links.filter(l => l.domainRating >= 70).length,\n  medium: links.filter(l => l.domainRating >= 40 && l.domainRating < 70).length,\n  low: links.filter(l => l.domainRating < 40).length\n};\n\n// Link type distribution\nconst linkTypes = {\n  text: links.filter(l => l.linkType === 'text').length,\n  image: links.filter(l => l.linkType === 'image').length,\n  redirect: links.filter(l => l.linkType === 'redirect').length,\n  other: links.filter(l => !['text', 'image', 'redirect'].includes(l.linkType)).length\n};\n\n// High-value new links\nconst highValueNew = newLinks\n  .filter(l => l.domainRating >= 50)\n  .slice(0, 10);\n\n// Lost links to recover\nconst toRecover = lostLinks\n  .filter(l => l.domainRating >= 40)\n  .slice(0, 10);\n\n// Toxic/spam detection\nconst potentiallyToxic = links.filter(l => {\n  const toxicIndicators = [\n    l.domainRating < 10,\n    /porn|casino|pills|viagra|pharma/i.test(l.sourceDomain),\n    l.outboundLinks > 1000,\n    /\\d{5,}/.test(l.sourceDomain)\n  ];\n  return toxicIndicators.filter(Boolean).length >= 2;\n});\n\n// Compare with previous\nconst previous = job.previousMetrics;\nlet metricsChange = null;\nif (previous) {\n  metricsChange = {\n    totalBacklinks: metrics.totalBacklinks - (previous.totalBacklinks || 0),\n    referringDomains: metrics.referringDomains - (previous.referringDomains || 0),\n    avgDomainRating: metrics.avgDomainRating - (previous.avgDomainRating || 0)\n  };\n}\n\nreturn [{ json: {\n  monitorId: job.monitorId,\n  domain: job.domain,\n  checkDate: job.checkDate,\n  metrics,\n  metricsChange,\n  drDistribution,\n  linkTypes,\n  topAnchors,\n  newLinks: newLinks.slice(0, 50),\n  lostLinks: lostLinks.slice(0, 50),\n  highValueNew,\n  toRecover,\n  potentiallyToxic: potentiallyToxic.slice(0, 20),\n  alerts: []\n}}];"
        },
        "id": "analyze-profile",
        "name": "Analyze Profile",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1250,
          500
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Link Building Strategist. Analyze the backlink profile and provide actionable recommendations.\n\nFocus on:\n1. Profile health assessment\n2. Opportunities from new high-value links\n3. Recovery priorities for lost links\n4. Toxic link cleanup recommendations\n5. Link building opportunities based on anchor distribution\n6. Competitive gap analysis suggestions",
                "role": "system"
              },
              {
                "content": "=Analyze backlink profile for {{ $json.domain }}:\n\n**Current Metrics:**\nâ€¢ Total Backlinks: {{ $json.metrics.totalBacklinks }}\nâ€¢ Referring Domains: {{ $json.metrics.referringDomains }}\nâ€¢ Dofollow Ratio: {{ $json.metrics.dofollowRatio }}%\nâ€¢ Avg Domain Rating: {{ $json.metrics.avgDomainRating }}\nâ€¢ New Links (7d): {{ $json.metrics.newLinks7d }}\nâ€¢ Lost Links (7d): {{ $json.metrics.lostLinks7d }}\n\n**DR Distribution:**\nâ€¢ High (70+): {{ $json.drDistribution.high }}\nâ€¢ Medium (40-69): {{ $json.drDistribution.medium }}\nâ€¢ Low (<40): {{ $json.drDistribution.low }}\n\n**Top Anchors:**\n{{ $json.topAnchors.map(a => `â€¢ \"${a.anchor}\": ${a.count} (${a.percentage}%)`).join('\\n') }}\n\n**High-Value New Links:**\n{{ $json.highValueNew.map(l => `â€¢ ${l.sourceDomain} (DR: ${l.domainRating})`).join('\\n') || 'None' }}\n\n**Lost Links to Recover:**\n{{ $json.toRecover.map(l => `â€¢ ${l.sourceDomain} (DR: ${l.domainRating})`).join('\\n') || 'None' }}\n\n**Potentially Toxic:** {{ $json.potentiallyToxic.length }} links detected\n\nProvide strategic recommendations.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.4,
            "maxTokens": 2000
          }
        },
        "id": "ai-analysis",
        "name": "AI Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1500,
          400
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Generate outreach list for lost links recovery\nconst profileData = $('Analyze Profile').first().json;\nconst toRecover = profileData.toRecover || [];\n\n// Create outreach tasks\nconst outreachTasks = toRecover.map(link => ({\n  id: `OUT-${Date.now().toString(36)}-${Math.random().toString(36).substr(2, 4)}`,\n  type: 'link_recovery',\n  domain: link.sourceDomain,\n  originalUrl: link.sourceUrl,\n  targetUrl: link.targetUrl,\n  anchorText: link.anchorText,\n  domainRating: link.domainRating,\n  lostDate: link.lostDate,\n  priority: link.domainRating >= 60 ? 'high' : link.domainRating >= 40 ? 'medium' : 'low',\n  status: 'pending',\n  suggestedSubject: `Quick question about your link to ${profileData.domain}`,\n  suggestedTemplate: 'link_recovery'\n}));\n\nreturn [{ json: {\n  ...profileData,\n  outreachTasks\n}}];"
        },
        "id": "generate-outreach",
        "name": "Generate Outreach Tasks",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1500,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "// Compile final report\nconst profileData = $('Generate Outreach Tasks').first().json;\nconst aiAnalysis = $('AI Analysis').first().json;\n\nconst report = {\n  ...profileData,\n  analysis: aiAnalysis,\n  generatedAt: new Date().toISOString(),\n  exportUrls: {\n    csv: `{{ $vars.EXPORT_BASE_URL }}/backlinks/${profileData.monitorId}/csv`,\n    disavow: `{{ $vars.EXPORT_BASE_URL }}/backlinks/${profileData.monitorId}/disavow`\n  }\n};\n\n// Generate alerts\nif (profileData.metrics.lostLinks7d > 10) {\n  report.alerts.push({\n    type: 'high_link_loss',\n    severity: 'warning',\n    message: `Lost ${profileData.metrics.lostLinks7d} backlinks in the last 7 days`\n  });\n}\n\nif (profileData.potentiallyToxic.length > 20) {\n  report.alerts.push({\n    type: 'toxic_links',\n    severity: 'warning',\n    message: `${profileData.potentiallyToxic.length} potentially toxic links detected`\n  });\n}\n\nif (profileData.metrics.netGrowth7d < -5) {\n  report.alerts.push({\n    type: 'negative_growth',\n    severity: 'critical',\n    message: `Negative link growth: ${profileData.metrics.netGrowth7d} net change`\n  });\n}\n\nreturn [{ json: report }];"
        },
        "id": "compile-report",
        "name": "Compile Report",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1750,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.BACKLINK_DB_URL }}/reports",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-report",
        "name": "Save Report",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2000,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "backlink-db-api",
            "name": "Backlink DB API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-alerts",
                "leftValue": "={{ $json.alerts.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-alerts",
        "name": "Has Alerts?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          2000,
          600
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.SEO_SLACK_CHANNEL }}",
          "text": "=ðŸ”— *Backlink Monitor Alert - {{ $json.domain }}*\n\n{{ $json.alerts.map(a => `${a.severity === 'critical' ? 'ðŸ”´' : 'ðŸŸ¡'} ${a.message}`).join('\\n') }}\n\nðŸ“Š *Current Metrics:*\nâ€¢ Total Backlinks: {{ $json.metrics.totalBacklinks }}\nâ€¢ Referring Domains: {{ $json.metrics.referringDomains }}\nâ€¢ Avg DR: {{ $json.metrics.avgDomainRating }}\nâ€¢ New (7d): +{{ $json.metrics.newLinks7d }} | Lost: -{{ $json.metrics.lostLinks7d }}\n\nðŸŽ¯ *Actions Needed:*\nâ€¢ {{ $json.toRecover.length }} links to recover\nâ€¢ {{ $json.potentiallyToxic.length }} toxic links to review\n\n<{{ $json.exportUrls.csv }}|Download Report>",
          "otherOptions": {}
        },
        "id": "alert-slack",
        "name": "Send Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          2250,
          550
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.BACKLINK_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Daily Metrics",
            "mode": "list",
            "cachedResultName": "Daily Metrics"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Date": "={{ $json.checkDate }}",
              "Domain": "={{ $json.domain }}",
              "Total Backlinks": "={{ $json.metrics.totalBacklinks }}",
              "Referring Domains": "={{ $json.metrics.referringDomains }}",
              "Avg DR": "={{ $json.metrics.avgDomainRating }}",
              "Dofollow %": "={{ $json.metrics.dofollowRatio }}",
              "New (7d)": "={{ $json.metrics.newLinks7d }}",
              "Lost (7d)": "={{ $json.metrics.lostLinks7d }}",
              "Net Growth": "={{ $json.metrics.netGrowth7d }}"
            }
          },
          "options": {}
        },
        "id": "log-sheets",
        "name": "Log to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          2250,
          750
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Daily Backlink Check": {
        "main": [
          [
            {
              "node": "Fetch Monitored Domains",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Check Trigger": {
        "main": [
          [
            {
              "node": "Fetch Monitored Domains",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Monitored Domains": {
        "main": [
          [
            {
              "node": "Prepare Monitor Jobs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Monitor Jobs": {
        "main": [
          [
            {
              "node": "Fetch Backlinks",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch New/Lost Links",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Backlinks": {
        "main": [
          [
            {
              "node": "Analyze Profile",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch New/Lost Links": {
        "main": [
          [
            {
              "node": "Analyze Profile",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Profile": {
        "main": [
          [
            {
              "node": "AI Analysis",
              "type": "main",
              "index": 0
            },
            {
              "node": "Generate Outreach Tasks",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Analysis": {
        "main": [
          [
            {
              "node": "Compile Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Outreach Tasks": {
        "main": [
          [
            {
              "node": "Compile Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compile Report": {
        "main": [
          [
            {
              "node": "Save Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has Alerts?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Alerts?": {
        "main": [
          [
            {
              "node": "Send Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "seo",
        "name": "seo"
      },
      {
        "id": "backlinks",
        "name": "backlinks"
      },
      {
        "id": "monitoring",
        "name": "monitoring"
      },
      {
        "id": "outreach",
        "name": "outreach"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Booking Channel Sync v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "booking-webhook",
          "options": {
            "rawBody": true
          }
        },
        "id": "booking-webhook",
        "name": "Booking Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "booking-channel-webhook"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 15
              }
            ]
          }
        },
        "id": "schedule-sync",
        "name": "Every 15 Minutes",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "// Parse incoming booking webhook\nconst body = $input.first().json.body;\nconst headers = $input.first().json.headers;\n\n// Detect source channel from webhook signature/headers\nlet source = 'unknown';\nlet bookingData = {};\n\nif (headers['x-booking-signature']) {\n  source = 'booking.com';\n  bookingData = {\n    id: body.reservation_id,\n    guestName: body.guest_name,\n    email: body.guest_email,\n    phone: body.guest_phone,\n    checkIn: body.checkin,\n    checkOut: body.checkout,\n    roomType: body.room_type,\n    rateCode: body.rate_code,\n    totalAmount: body.total_price?.amount,\n    currency: body.total_price?.currency || 'USD',\n    status: body.status,\n    specialRequests: body.remarks,\n    numberOfGuests: body.number_of_guests,\n    paymentStatus: body.payment_status\n  };\n} else if (headers['x-expedia-signature']) {\n  source = 'expedia';\n  bookingData = {\n    id: body.confirmationNumber,\n    guestName: `${body.primaryGuest?.firstName} ${body.primaryGuest?.lastName}`,\n    email: body.primaryGuest?.email,\n    phone: body.primaryGuest?.phone,\n    checkIn: body.stayDates?.checkIn,\n    checkOut: body.stayDates?.checkOut,\n    roomType: body.roomStay?.roomType,\n    rateCode: body.roomStay?.ratePlan,\n    totalAmount: body.totalPrice,\n    currency: body.currencyCode || 'USD',\n    status: body.reservationStatus,\n    specialRequests: body.specialRequests?.join(', '),\n    numberOfGuests: body.guestCount,\n    paymentStatus: body.paymentInfo?.status\n  };\n} else if (headers['x-airbnb-signature']) {\n  source = 'airbnb';\n  bookingData = {\n    id: body.confirmation_code,\n    guestName: body.guest?.full_name,\n    email: body.guest?.email,\n    phone: body.guest?.phone,\n    checkIn: body.start_date,\n    checkOut: body.end_date,\n    roomType: body.listing?.room_type,\n    rateCode: 'AIRBNB',\n    totalAmount: body.expected_payout_amount_accurate,\n    currency: body.listing_base_price_currency || 'USD',\n    status: body.status,\n    specialRequests: body.guest_details?.special_requests,\n    numberOfGuests: body.number_of_guests,\n    paymentStatus: 'prepaid'\n  };\n} else if (headers['x-vrbo-signature']) {\n  source = 'vrbo';\n  bookingData = {\n    id: body.reservationId,\n    guestName: body.guestName,\n    email: body.guestEmail,\n    phone: body.guestPhone,\n    checkIn: body.arrivalDate,\n    checkOut: body.departureDate,\n    roomType: body.unitType,\n    rateCode: 'VRBO',\n    totalAmount: body.totalRent,\n    currency: 'USD',\n    status: body.status,\n    specialRequests: body.notes,\n    numberOfGuests: body.numberOfGuests,\n    paymentStatus: body.paymentStatus\n  };\n} else {\n  // Direct booking or unknown source\n  source = body.source || 'direct';\n  bookingData = body;\n}\n\nreturn [{\n  json: {\n    source,\n    action: 'webhook',\n    booking: bookingData,\n    rawPayload: body,\n    receivedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "parse-webhook",
        "name": "Parse Booking Webhook",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CHANNEL_MANAGER_URL }}/reservations/recent",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "since",
                "value": "={{ $now.minus({ minutes: 20 }).toISO() }}"
              },
              {
                "name": "channels",
                "value": "booking.com,expedia,airbnb,vrbo,google,tripadvisor"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-recent-bookings",
        "name": "Fetch Recent Bookings",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "channel-manager-api",
            "name": "Channel Manager API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.PMS_API_URL }}/reservations",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "modified_since",
                "value": "={{ $now.minus({ minutes: 20 }).toISO() }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-pms-reservations",
        "name": "Fetch PMS Reservations",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          700
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Reconcile bookings across all channels\nconst channelBookings = $('Fetch Recent Bookings').first().json.reservations || [];\nconst pmsReservations = $('Fetch PMS Reservations').first().json.reservations || [];\n\nconst results = {\n  newBookings: [],\n  modifications: [],\n  cancellations: [],\n  conflicts: [],\n  synced: []\n};\n\n// Index PMS reservations by external ID\nconst pmsIndex = {};\npmsReservations.forEach(res => {\n  if (res.externalIds) {\n    Object.entries(res.externalIds).forEach(([channel, id]) => {\n      pmsIndex[`${channel}:${id}`] = res;\n    });\n  }\n  pmsIndex[`pms:${res.id}`] = res;\n});\n\n// Process channel bookings\nfor (const booking of channelBookings) {\n  const key = `${booking.channel}:${booking.externalId}`;\n  const pmsMatch = pmsIndex[key];\n  \n  if (!pmsMatch) {\n    // New booking - needs to be created in PMS\n    results.newBookings.push({\n      ...booking,\n      action: 'create',\n      priority: booking.status === 'confirmed' ? 'high' : 'normal'\n    });\n  } else {\n    // Check for modifications\n    const hasChanges = \n      booking.checkIn !== pmsMatch.checkIn ||\n      booking.checkOut !== pmsMatch.checkOut ||\n      booking.roomType !== pmsMatch.roomType ||\n      booking.status !== pmsMatch.status ||\n      booking.totalAmount !== pmsMatch.totalAmount;\n    \n    if (hasChanges) {\n      if (booking.status === 'cancelled' || booking.status === 'canceled') {\n        results.cancellations.push({\n          channelBooking: booking,\n          pmsReservation: pmsMatch,\n          action: 'cancel'\n        });\n      } else {\n        results.modifications.push({\n          channelBooking: booking,\n          pmsReservation: pmsMatch,\n          changes: {\n            checkIn: booking.checkIn !== pmsMatch.checkIn,\n            checkOut: booking.checkOut !== pmsMatch.checkOut,\n            roomType: booking.roomType !== pmsMatch.roomType,\n            totalAmount: booking.totalAmount !== pmsMatch.totalAmount\n          },\n          action: 'update'\n        });\n      }\n    } else {\n      results.synced.push({\n        channelBooking: booking,\n        pmsReservation: pmsMatch,\n        status: 'in_sync'\n      });\n    }\n  }\n}\n\n// Check for overbookings/conflicts\nconst inventoryByDate = {};\nconst allActiveBookings = [...results.synced, ...results.newBookings];\n\nfor (const item of allActiveBookings) {\n  const booking = item.channelBooking || item;\n  if (booking.status === 'confirmed') {\n    const checkIn = new Date(booking.checkIn);\n    const checkOut = new Date(booking.checkOut);\n    \n    for (let d = new Date(checkIn); d < checkOut; d.setDate(d.getDate() + 1)) {\n      const dateKey = d.toISOString().split('T')[0];\n      const roomKey = `${dateKey}:${booking.roomType}`;\n      \n      if (!inventoryByDate[roomKey]) {\n        inventoryByDate[roomKey] = [];\n      }\n      inventoryByDate[roomKey].push(booking);\n    }\n  }\n}\n\n// Detect overbookings (simplified - would need actual inventory data)\nfor (const [key, bookings] of Object.entries(inventoryByDate)) {\n  if (bookings.length > 1) {\n    // Potential conflict - mark for review\n    results.conflicts.push({\n      dateRoomKey: key,\n      bookings: bookings,\n      severity: 'high'\n    });\n  }\n}\n\nreturn [{\n  json: {\n    ...results,\n    summary: {\n      newBookings: results.newBookings.length,\n      modifications: results.modifications.length,\n      cancellations: results.cancellations.length,\n      conflicts: results.conflicts.length,\n      synced: results.synced.length\n    },\n    processedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "reconcile-bookings",
        "name": "Reconcile Bookings",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          800,
          600
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-conflicts",
                "leftValue": "={{ $json.conflicts.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-conflicts",
        "name": "Has Conflicts?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1050,
          400
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.OPERATIONS_SLACK_CHANNEL }}",
          "text": "=ðŸš¨ *URGENT: Booking Conflict Detected!*\n\n*{{ $json.conflicts.length }} potential overbookings found:*\n\n{{ $json.conflicts.map(c => `âš ï¸ *${c.dateRoomKey}*\n   Conflicting bookings: ${c.bookings.length}\n   ${c.bookings.map(b => `â€¢ ${b.guestName || 'Guest'} via ${b.channel || 'Direct'}`).join('\\n   ')}`).join('\\n\\n') }}\n\n*Immediate action required!*\nPlease review and resolve conflicts in the PMS.",
          "otherOptions": {
            "mrkdwn": true
          }
        },
        "id": "alert-conflicts",
        "name": "Alert Conflicts",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1300,
          300
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-new-bookings",
                "leftValue": "={{ $json.newBookings.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-new-bookings",
        "name": "Has New Bookings?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1050,
          600
        ]
      },
      {
        "parameters": {
          "batchSize": 5,
          "options": {}
        },
        "id": "split-new-bookings",
        "name": "Split New Bookings",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          1300,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.PMS_API_URL }}/reservations",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"externalId\": \"{{ $json.externalId }}\",\n  \"channel\": \"{{ $json.channel }}\",\n  \"guestName\": \"{{ $json.guestName }}\",\n  \"email\": \"{{ $json.email }}\",\n  \"phone\": \"{{ $json.phone }}\",\n  \"checkIn\": \"{{ $json.checkIn }}\",\n  \"checkOut\": \"{{ $json.checkOut }}\",\n  \"roomType\": \"{{ $json.roomType }}\",\n  \"rateCode\": \"{{ $json.rateCode }}\",\n  \"totalAmount\": {{ $json.totalAmount }},\n  \"currency\": \"{{ $json.currency }}\",\n  \"status\": \"{{ $json.status }}\",\n  \"specialRequests\": \"{{ $json.specialRequests }}\",\n  \"numberOfGuests\": {{ $json.numberOfGuests }},\n  \"source\": \"channel_sync\"\n}",
          "options": {}
        },
        "id": "create-pms-reservation",
        "name": "Create PMS Reservation",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1550,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-modifications",
                "leftValue": "={{ $json.modifications.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-modifications",
        "name": "Has Modifications?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1050,
          800
        ]
      },
      {
        "parameters": {
          "batchSize": 5,
          "options": {}
        },
        "id": "split-modifications",
        "name": "Split Modifications",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          1300,
          800
        ]
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "={{ $vars.PMS_API_URL }}/reservations/{{ $json.pmsReservation.id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"checkIn\": \"{{ $json.channelBooking.checkIn }}\",\n  \"checkOut\": \"{{ $json.channelBooking.checkOut }}\",\n  \"roomType\": \"{{ $json.channelBooking.roomType }}\",\n  \"totalAmount\": {{ $json.channelBooking.totalAmount }},\n  \"status\": \"{{ $json.channelBooking.status }}\",\n  \"modifiedAt\": \"{{ $now.toISO() }}\",\n  \"modifiedBy\": \"channel_sync\"\n}",
          "options": {}
        },
        "id": "update-pms-reservation",
        "name": "Update PMS Reservation",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1550,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-cancellations",
                "leftValue": "={{ $json.cancellations.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-cancellations",
        "name": "Has Cancellations?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1050,
          1000
        ]
      },
      {
        "parameters": {
          "batchSize": 5,
          "options": {}
        },
        "id": "split-cancellations",
        "name": "Split Cancellations",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          1300,
          1000
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.PMS_API_URL }}/reservations/{{ $json.pmsReservation.id }}/cancel",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"reason\": \"Cancelled via {{ $json.channelBooking.channel }}\",\n  \"cancelledAt\": \"{{ $now.toISO() }}\",\n  \"cancelledBy\": \"channel_sync\"\n}",
          "options": {}
        },
        "id": "cancel-pms-reservation",
        "name": "Cancel PMS Reservation",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1550,
          1000
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CHANNEL_MANAGER_URL }}/inventory/sync",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"property_id\": \"{{ $vars.PROPERTY_ID }}\",\n  \"sync_type\": \"full\",\n  \"channels\": [\"booking.com\", \"expedia\", \"airbnb\", \"vrbo\", \"google\"]\n}",
          "options": {}
        },
        "id": "sync-inventory",
        "name": "Sync Inventory to Channels",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1800,
          700
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "channel-manager-api",
            "name": "Channel Manager API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.BOOKING_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Sync Log",
            "mode": "list",
            "cachedResultName": "Sync Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Timestamp": "={{ $now.toISO() }}",
              "New Bookings": "={{ $('Reconcile Bookings').first().json.summary.newBookings }}",
              "Modifications": "={{ $('Reconcile Bookings').first().json.summary.modifications }}",
              "Cancellations": "={{ $('Reconcile Bookings').first().json.summary.cancellations }}",
              "Conflicts": "={{ $('Reconcile Bookings').first().json.summary.conflicts }}",
              "Inventory Sync": "={{ $json.status || 'success' }}"
            }
          },
          "options": {}
        },
        "id": "log-sync",
        "name": "Log Sync Activity",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          2050,
          700
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-changes",
                "leftValue": "={{ $('Reconcile Bookings').first().json.summary.newBookings + $('Reconcile Bookings').first().json.summary.modifications + $('Reconcile Bookings').first().json.summary.cancellations }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-notify",
        "name": "Should Notify?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          2050,
          500
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.RESERVATIONS_SLACK_CHANNEL }}",
          "text": "=ðŸ“Š *Channel Sync Summary*\n\n*Activity in the last 15 minutes:*\n\n{{ $('Reconcile Bookings').first().json.summary.newBookings > 0 ? `âœ… *New Bookings:* ${$('Reconcile Bookings').first().json.summary.newBookings}` : '' }}\n{{ $('Reconcile Bookings').first().json.summary.modifications > 0 ? `ðŸ“ *Modifications:* ${$('Reconcile Bookings').first().json.summary.modifications}` : '' }}\n{{ $('Reconcile Bookings').first().json.summary.cancellations > 0 ? `âŒ *Cancellations:* ${$('Reconcile Bookings').first().json.summary.cancellations}` : '' }}\n{{ $('Reconcile Bookings').first().json.summary.conflicts > 0 ? `âš ï¸ *Conflicts:* ${$('Reconcile Bookings').first().json.summary.conflicts}` : '' }}\n\n_Inventory synced across all channels_",
          "otherOptions": {}
        },
        "id": "notify-summary",
        "name": "Notify Summary",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          2300,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Process webhook booking and merge with workflow\nconst webhookData = $input.first().json;\n\nif (webhookData.action === 'webhook') {\n  // Single booking from webhook\n  return [{\n    json: {\n      newBookings: [webhookData.booking],\n      modifications: [],\n      cancellations: [],\n      conflicts: [],\n      synced: [],\n      summary: {\n        newBookings: 1,\n        modifications: 0,\n        cancellations: 0,\n        conflicts: 0,\n        synced: 0\n      },\n      source: 'webhook',\n      processedAt: new Date().toISOString()\n    }\n  }];\n}\n\nreturn $input.all();"
        },
        "id": "process-webhook",
        "name": "Process Webhook Booking",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          300
        ]
      }
    ],
    "connections": {
      "Booking Webhook": {
        "main": [
          [
            {
              "node": "Parse Booking Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Booking Webhook": {
        "main": [
          [
            {
              "node": "Process Webhook Booking",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Webhook Booking": {
        "main": [
          [
            {
              "node": "Check Conflicts?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has New Bookings?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Every 15 Minutes": {
        "main": [
          [
            {
              "node": "Fetch Recent Bookings",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch PMS Reservations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Recent Bookings": {
        "main": [
          [
            {
              "node": "Reconcile Bookings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch PMS Reservations": {
        "main": [
          [
            {
              "node": "Reconcile Bookings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Reconcile Bookings": {
        "main": [
          [
            {
              "node": "Has Conflicts?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has New Bookings?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has Modifications?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has Cancellations?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Conflicts?": {
        "main": [
          [
            {
              "node": "Alert Conflicts",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Has New Bookings?": {
        "main": [
          [
            {
              "node": "Split New Bookings",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Split New Bookings": {
        "main": [
          [
            {
              "node": "Create PMS Reservation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create PMS Reservation": {
        "main": [
          [
            {
              "node": "Sync Inventory to Channels",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Modifications?": {
        "main": [
          [
            {
              "node": "Split Modifications",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Split Modifications": {
        "main": [
          [
            {
              "node": "Update PMS Reservation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update PMS Reservation": {
        "main": [
          [
            {
              "node": "Sync Inventory to Channels",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Cancellations?": {
        "main": [
          [
            {
              "node": "Split Cancellations",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Split Cancellations": {
        "main": [
          [
            {
              "node": "Cancel PMS Reservation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cancel PMS Reservation": {
        "main": [
          [
            {
              "node": "Sync Inventory to Channels",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sync Inventory to Channels": {
        "main": [
          [
            {
              "node": "Log Sync Activity",
              "type": "main",
              "index": 0
            },
            {
              "node": "Should Notify?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Should Notify?": {
        "main": [
          [
            {
              "node": "Notify Summary",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "hospitality",
        "name": "hospitality"
      },
      {
        "id": "channel-management",
        "name": "channel-management"
      },
      {
        "id": "ota",
        "name": "ota"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Campaign Performance Monitor v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 4
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Every 4 Hours",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://analyticsdata.googleapis.com/v1beta/properties/{{ $vars.GA4_PROPERTY_ID }}:runReport",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "{\n  \"dateRanges\": [\n    { \"startDate\": \"7daysAgo\", \"endDate\": \"today\" },\n    { \"startDate\": \"14daysAgo\", \"endDate\": \"8daysAgo\" }\n  ],\n  \"metrics\": [\n    { \"name\": \"sessions\" },\n    { \"name\": \"totalUsers\" },\n    { \"name\": \"newUsers\" },\n    { \"name\": \"engagementRate\" },\n    { \"name\": \"conversions\" },\n    { \"name\": \"purchaseRevenue\" },\n    { \"name\": \"averageSessionDuration\" }\n  ],\n  \"dimensions\": [\n    { \"name\": \"sessionDefaultChannelGroup\" },\n    { \"name\": \"sessionCampaignName\" }\n  ]\n}",
          "options": {}
        },
        "id": "fetch-ga4-data",
        "name": "Fetch GA4 Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          200
        ],
        "credentials": {
          "googleApi": {
            "id": "google-analytics-credential",
            "name": "Google Analytics OAuth2"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://googleads.googleapis.com/v17/customers/{{ $vars.GOOGLE_ADS_CUSTOMER_ID }}/googleAds:search",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleAdsOAuth2Api",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "query",
                "value": "SELECT campaign.name, campaign.id, campaign.status, metrics.impressions, metrics.clicks, metrics.cost_micros, metrics.conversions, metrics.conversions_value, metrics.ctr, metrics.average_cpc FROM campaign WHERE segments.date DURING LAST_7_DAYS"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-google-ads",
        "name": "Fetch Google Ads",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ],
        "credentials": {
          "googleAdsOAuth2Api": {
            "id": "google-ads-credential",
            "name": "Google Ads OAuth2"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://graph.facebook.com/v19.0/act_{{ $vars.META_AD_ACCOUNT_ID }}/insights",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "facebookGraphApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "fields",
                "value": "campaign_name,campaign_id,impressions,clicks,spend,reach,cpm,cpc,ctr,actions,cost_per_action_type,purchase_roas"
              },
              {
                "name": "date_preset",
                "value": "last_7d"
              },
              {
                "name": "level",
                "value": "campaign"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-meta-ads",
        "name": "Fetch Meta Ads",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ],
        "credentials": {
          "facebookGraphApi": {
            "id": "meta-ads-credential",
            "name": "Meta Ads API"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.linkedin.com/v2/adAnalyticsV2",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "linkedInOAuth2Api",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "q",
                "value": "analytics"
              },
              {
                "name": "dateRange.start.day",
                "value": "={{ $now.minus({ days: 7 }).day }}"
              },
              {
                "name": "dateRange.start.month",
                "value": "={{ $now.minus({ days: 7 }).month }}"
              },
              {
                "name": "dateRange.start.year",
                "value": "={{ $now.minus({ days: 7 }).year }}"
              },
              {
                "name": "dateRange.end.day",
                "value": "={{ $now.day }}"
              },
              {
                "name": "dateRange.end.month",
                "value": "={{ $now.month }}"
              },
              {
                "name": "dateRange.end.year",
                "value": "={{ $now.year }}"
              },
              {
                "name": "campaigns",
                "value": "={{ $vars.LINKEDIN_CAMPAIGNS }}"
              },
              {
                "name": "fields",
                "value": "impressions,clicks,costInLocalCurrency,conversions,conversionValueInLocalCurrency"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-linkedin-ads",
        "name": "Fetch LinkedIn Ads",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          800
        ],
        "credentials": {
          "linkedInOAuth2Api": {
            "id": "linkedin-ads-credential",
            "name": "LinkedIn Ads OAuth2"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Aggregate and normalize campaign data from all platforms\nconst ga4Data = $('Fetch GA4 Data').first().json;\nconst googleAds = $('Fetch Google Ads').first().json;\nconst metaAds = $('Fetch Meta Ads').first().json;\nconst linkedInAds = $('Fetch LinkedIn Ads').first().json;\n\nconst campaigns = [];\n\n// Process Google Ads\nif (googleAds.results) {\n  googleAds.results.forEach(row => {\n    const campaign = row.campaign;\n    const metrics = row.metrics;\n    campaigns.push({\n      platform: 'Google Ads',\n      campaignId: campaign.id,\n      campaignName: campaign.name,\n      status: campaign.status,\n      impressions: parseInt(metrics.impressions) || 0,\n      clicks: parseInt(metrics.clicks) || 0,\n      spend: (parseInt(metrics.cost_micros) || 0) / 1000000,\n      conversions: parseFloat(metrics.conversions) || 0,\n      revenue: parseFloat(metrics.conversions_value) || 0,\n      ctr: parseFloat(metrics.ctr) || 0,\n      cpc: (parseInt(metrics.average_cpc) || 0) / 1000000,\n      roas: metrics.conversions_value && metrics.cost_micros ? \n        (metrics.conversions_value / (metrics.cost_micros / 1000000)).toFixed(2) : 0\n    });\n  });\n}\n\n// Process Meta Ads\nif (metaAds.data) {\n  metaAds.data.forEach(row => {\n    const conversions = row.actions?.find(a => a.action_type === 'purchase')?.value || 0;\n    const revenue = row.actions?.find(a => a.action_type === 'omni_purchase')?.value || 0;\n    campaigns.push({\n      platform: 'Meta Ads',\n      campaignId: row.campaign_id,\n      campaignName: row.campaign_name,\n      status: 'ENABLED',\n      impressions: parseInt(row.impressions) || 0,\n      clicks: parseInt(row.clicks) || 0,\n      spend: parseFloat(row.spend) || 0,\n      conversions: parseInt(conversions),\n      revenue: parseFloat(revenue) || 0,\n      ctr: parseFloat(row.ctr) || 0,\n      cpc: parseFloat(row.cpc) || 0,\n      roas: row.purchase_roas?.[0]?.value || 0,\n      reach: parseInt(row.reach) || 0,\n      cpm: parseFloat(row.cpm) || 0\n    });\n  });\n}\n\n// Process LinkedIn Ads\nif (linkedInAds.elements) {\n  linkedInAds.elements.forEach(row => {\n    campaigns.push({\n      platform: 'LinkedIn Ads',\n      campaignId: row.pivotValue,\n      campaignName: row.campaignName || `Campaign ${row.pivotValue}`,\n      status: 'ENABLED',\n      impressions: parseInt(row.impressions) || 0,\n      clicks: parseInt(row.clicks) || 0,\n      spend: parseFloat(row.costInLocalCurrency) || 0,\n      conversions: parseInt(row.conversions) || 0,\n      revenue: parseFloat(row.conversionValueInLocalCurrency) || 0,\n      ctr: row.impressions > 0 ? ((row.clicks / row.impressions) * 100).toFixed(2) : 0,\n      cpc: row.clicks > 0 ? (row.costInLocalCurrency / row.clicks).toFixed(2) : 0,\n      roas: row.costInLocalCurrency > 0 ? \n        (row.conversionValueInLocalCurrency / row.costInLocalCurrency).toFixed(2) : 0\n    });\n  });\n}\n\n// Calculate platform totals\nconst platformTotals = {};\ncampaigns.forEach(c => {\n  if (!platformTotals[c.platform]) {\n    platformTotals[c.platform] = {\n      campaigns: 0,\n      impressions: 0,\n      clicks: 0,\n      spend: 0,\n      conversions: 0,\n      revenue: 0\n    };\n  }\n  platformTotals[c.platform].campaigns++;\n  platformTotals[c.platform].impressions += c.impressions;\n  platformTotals[c.platform].clicks += c.clicks;\n  platformTotals[c.platform].spend += c.spend;\n  platformTotals[c.platform].conversions += c.conversions;\n  platformTotals[c.platform].revenue += c.revenue;\n});\n\n// Calculate derived metrics for totals\nObject.keys(platformTotals).forEach(platform => {\n  const p = platformTotals[platform];\n  p.ctr = p.impressions > 0 ? ((p.clicks / p.impressions) * 100).toFixed(2) : 0;\n  p.cpc = p.clicks > 0 ? (p.spend / p.clicks).toFixed(2) : 0;\n  p.cpa = p.conversions > 0 ? (p.spend / p.conversions).toFixed(2) : 0;\n  p.roas = p.spend > 0 ? (p.revenue / p.spend).toFixed(2) : 0;\n});\n\n// Overall totals\nconst overall = {\n  totalSpend: campaigns.reduce((sum, c) => sum + c.spend, 0),\n  totalRevenue: campaigns.reduce((sum, c) => sum + c.revenue, 0),\n  totalConversions: campaigns.reduce((sum, c) => sum + c.conversions, 0),\n  totalImpressions: campaigns.reduce((sum, c) => sum + c.impressions, 0),\n  totalClicks: campaigns.reduce((sum, c) => sum + c.clicks, 0),\n  activeCampaigns: campaigns.filter(c => c.status === 'ENABLED').length\n};\noverall.blendedRoas = overall.totalSpend > 0 ? (overall.totalRevenue / overall.totalSpend).toFixed(2) : 0;\noverall.blendedCpa = overall.totalConversions > 0 ? (overall.totalSpend / overall.totalConversions).toFixed(2) : 0;\n\nreturn [{\n  json: {\n    campaigns,\n    platformTotals,\n    overall,\n    reportDate: new Date().toISOString(),\n    period: 'Last 7 Days'\n  }\n}];"
        },
        "id": "aggregate-campaigns",
        "name": "Aggregate Campaign Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          800,
          500
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a digital marketing analyst AI. Analyze campaign performance data and provide actionable insights.\n\nFocus on:\n1. Performance trends and anomalies\n2. Budget optimization opportunities\n3. Underperforming campaigns that need attention\n4. High-performing campaigns to scale\n5. Platform-specific recommendations\n6. ROAS optimization strategies\n\nProvide specific, data-driven recommendations.",
                "role": "system"
              },
              {
                "content": "=Analyze this campaign performance data:\n\n**Overall Summary:**\n- Total Spend: ${{ $json.overall.totalSpend.toFixed(2) }}\n- Total Revenue: ${{ $json.overall.totalRevenue.toFixed(2) }}\n- Total Conversions: {{ $json.overall.totalConversions }}\n- Blended ROAS: {{ $json.overall.blendedRoas }}x\n- Blended CPA: ${{ $json.overall.blendedCpa }}\n\n**Platform Breakdown:**\n{{ JSON.stringify($json.platformTotals, null, 2) }}\n\n**Campaign Details:**\n{{ JSON.stringify($json.campaigns.slice(0, 20), null, 2) }}\n\nProvide:\n1. Executive summary (2-3 sentences)\n2. Top 3 opportunities to improve ROAS\n3. Top 3 concerns/risks\n4. Specific campaign recommendations\n5. Budget reallocation suggestions",
                "role": "user"
              }
            ]
          },
          "options": {
            "temperature": 0.4,
            "maxTokens": 2000
          }
        },
        "id": "ai-analysis",
        "name": "AI Performance Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1050,
          400
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Identify campaigns needing immediate attention\nconst data = $('Aggregate Campaign Data').first().json;\nconst campaigns = data.campaigns;\n\n// Define thresholds for alerts\nconst alerts = [];\n\ncampaigns.forEach(c => {\n  // High spend, low ROAS\n  if (c.spend > 500 && parseFloat(c.roas) < 1) {\n    alerts.push({\n      type: 'low_roas',\n      severity: 'high',\n      platform: c.platform,\n      campaign: c.campaignName,\n      message: `ROAS ${c.roas}x with $${c.spend.toFixed(2)} spend`,\n      recommendation: 'Consider pausing or optimizing targeting'\n    });\n  }\n  \n  // High CPA compared to benchmark\n  const cpaBenchmark = 50; // Adjust based on client\n  if (c.conversions > 0 && (c.spend / c.conversions) > cpaBenchmark * 1.5) {\n    alerts.push({\n      type: 'high_cpa',\n      severity: 'medium',\n      platform: c.platform,\n      campaign: c.campaignName,\n      message: `CPA $${(c.spend / c.conversions).toFixed(2)} exceeds benchmark`,\n      recommendation: 'Review audience targeting and creative performance'\n    });\n  }\n  \n  // Low CTR (potential ad fatigue)\n  if (c.impressions > 10000 && parseFloat(c.ctr) < 0.5) {\n    alerts.push({\n      type: 'low_ctr',\n      severity: 'medium',\n      platform: c.platform,\n      campaign: c.campaignName,\n      message: `CTR ${c.ctr}% indicates potential ad fatigue`,\n      recommendation: 'Refresh creative or adjust targeting'\n    });\n  }\n  \n  // No conversions with significant spend\n  if (c.spend > 200 && c.conversions === 0) {\n    alerts.push({\n      type: 'no_conversions',\n      severity: 'high',\n      platform: c.platform,\n      campaign: c.campaignName,\n      message: `$${c.spend.toFixed(2)} spent with zero conversions`,\n      recommendation: 'Pause campaign and investigate tracking/funnel'\n    });\n  }\n});\n\n// Sort by severity\nalerts.sort((a, b) => {\n  const severityOrder = { high: 0, medium: 1, low: 2 };\n  return severityOrder[a.severity] - severityOrder[b.severity];\n});\n\nreturn [{ json: { alerts, count: alerts.length } }];"
        },
        "id": "identify-alerts",
        "name": "Identify Alerts",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1050,
          600
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-high-alerts",
                "leftValue": "={{ $json.alerts.filter(a => a.severity === 'high').length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-urgent-alerts",
        "name": "Has Urgent Alerts?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1300,
          600
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.MARKETING_SLACK_CHANNEL }}",
          "text": "=ðŸš¨ *URGENT: Campaign Performance Alert*\n\n{{ $json.alerts.filter(a => a.severity === 'high').map(a => `*${a.platform} - ${a.campaign}*\nâš ï¸ ${a.message}\nðŸ’¡ ${a.recommendation}`).join('\\n\\n') }}\n\n_Immediate attention required_",
          "otherOptions": {
            "mrkdwn": true
          }
        },
        "id": "alert-urgent",
        "name": "Send Urgent Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1550,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.MARKETING_SLACK_CHANNEL }}",
          "text": "=ðŸ“Š *Campaign Performance Report - {{ $now.format('MMMM d, yyyy') }}*\n\n*Overall Performance (Last 7 Days):*\nâ€¢ Total Spend: ${{ $('Aggregate Campaign Data').first().json.overall.totalSpend.toFixed(2) }}\nâ€¢ Total Revenue: ${{ $('Aggregate Campaign Data').first().json.overall.totalRevenue.toFixed(2) }}\nâ€¢ Blended ROAS: {{ $('Aggregate Campaign Data').first().json.overall.blendedRoas }}x\nâ€¢ Total Conversions: {{ $('Aggregate Campaign Data').first().json.overall.totalConversions }}\nâ€¢ Blended CPA: ${{ $('Aggregate Campaign Data').first().json.overall.blendedCpa }}\n\n*Platform Summary:*\n{{ Object.entries($('Aggregate Campaign Data').first().json.platformTotals).map(([platform, data]) => `â€¢ *${platform}*: $${data.spend.toFixed(2)} spend | ${data.conversions} conv | ${data.roas}x ROAS`).join('\\n') }}\n\n*AI Analysis:*\n{{ $('AI Performance Analysis').first().json.message?.content || $('AI Performance Analysis').first().json.choices?.[0]?.message?.content || 'Analysis pending' }}\n\n{{ $('Identify Alerts').first().json.count > 0 ? `âš ï¸ *${$('Identify Alerts').first().json.count} alerts require attention*` : 'âœ… No critical alerts' }}",
          "otherOptions": {}
        },
        "id": "send-report",
        "name": "Send Daily Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1550,
          700
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.CAMPAIGN_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Performance Log",
            "mode": "list",
            "cachedResultName": "Performance Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Date": "={{ $now.format('yyyy-MM-dd HH:mm') }}",
              "Total Spend": "={{ $('Aggregate Campaign Data').first().json.overall.totalSpend.toFixed(2) }}",
              "Total Revenue": "={{ $('Aggregate Campaign Data').first().json.overall.totalRevenue.toFixed(2) }}",
              "Blended ROAS": "={{ $('Aggregate Campaign Data').first().json.overall.blendedRoas }}",
              "Total Conversions": "={{ $('Aggregate Campaign Data').first().json.overall.totalConversions }}",
              "Blended CPA": "={{ $('Aggregate Campaign Data').first().json.overall.blendedCpa }}",
              "Active Campaigns": "={{ $('Aggregate Campaign Data').first().json.overall.activeCampaigns }}",
              "Alerts": "={{ $('Identify Alerts').first().json.count }}"
            }
          },
          "options": {}
        },
        "id": "log-performance",
        "name": "Log Performance Data",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1550,
          900
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Every 4 Hours": {
        "main": [
          [
            {
              "node": "Fetch GA4 Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Google Ads",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Meta Ads",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch LinkedIn Ads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch GA4 Data": {
        "main": [
          [
            {
              "node": "Aggregate Campaign Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Google Ads": {
        "main": [
          [
            {
              "node": "Aggregate Campaign Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Meta Ads": {
        "main": [
          [
            {
              "node": "Aggregate Campaign Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch LinkedIn Ads": {
        "main": [
          [
            {
              "node": "Aggregate Campaign Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Campaign Data": {
        "main": [
          [
            {
              "node": "AI Performance Analysis",
              "type": "main",
              "index": 0
            },
            {
              "node": "Identify Alerts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Performance Analysis": {
        "main": [
          [
            {
              "node": "Send Daily Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Identify Alerts": {
        "main": [
          [
            {
              "node": "Has Urgent Alerts?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Urgent Alerts?": {
        "main": [
          [
            {
              "node": "Send Urgent Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Send Urgent Alert": {
        "main": [
          [
            {
              "node": "Send Daily Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Daily Report": {
        "main": [
          [
            {
              "node": "Log Performance Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "agency",
        "name": "agency"
      },
      {
        "id": "marketing",
        "name": "marketing"
      },
      {
        "id": "analytics",
        "name": "analytics"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 1,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Churn Prediction & Prevention v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 6 * * *"
              }
            ]
          }
        },
        "id": "daily-trigger",
        "name": "Daily Analysis",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CRM_API_URL }}/customers",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "status",
                "value": "active"
              },
              {
                "name": "include",
                "value": "usage,billing,support_tickets,login_history"
              }
            ]
          },
          "options": {
            "timeout": 60000
          }
        },
        "id": "fetch-customers",
        "name": "Fetch Active Customers",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "crm-api-key",
            "name": "CRM API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Calculate churn risk scores for all customers\nconst customers = $input.first().json.customers || [];\nconst today = new Date();\n\nconst riskAssessments = customers.map(customer => {\n  let riskScore = 0;\n  const riskFactors = [];\n  \n  // 1. Login frequency (max 25 points)\n  const lastLogin = customer.last_login ? new Date(customer.last_login) : null;\n  const daysSinceLogin = lastLogin ? Math.floor((today - lastLogin) / (1000 * 60 * 60 * 24)) : 999;\n  \n  if (daysSinceLogin > 30) {\n    riskScore += 25;\n    riskFactors.push({ factor: 'No login in 30+ days', impact: 'high', days: daysSinceLogin });\n  } else if (daysSinceLogin > 14) {\n    riskScore += 15;\n    riskFactors.push({ factor: 'No login in 14+ days', impact: 'medium', days: daysSinceLogin });\n  } else if (daysSinceLogin > 7) {\n    riskScore += 5;\n    riskFactors.push({ factor: 'No login in 7+ days', impact: 'low', days: daysSinceLogin });\n  }\n  \n  // 2. Usage decline (max 25 points)\n  const usage = customer.usage || {};\n  const currentUsage = usage.current_month || 0;\n  const previousUsage = usage.previous_month || currentUsage;\n  const usageChange = previousUsage > 0 ? ((currentUsage - previousUsage) / previousUsage) * 100 : 0;\n  \n  if (usageChange < -50) {\n    riskScore += 25;\n    riskFactors.push({ factor: 'Usage dropped 50%+', impact: 'high', change: `${usageChange.toFixed(1)}%` });\n  } else if (usageChange < -25) {\n    riskScore += 15;\n    riskFactors.push({ factor: 'Usage dropped 25%+', impact: 'medium', change: `${usageChange.toFixed(1)}%` });\n  } else if (usageChange < -10) {\n    riskScore += 5;\n    riskFactors.push({ factor: 'Usage declining', impact: 'low', change: `${usageChange.toFixed(1)}%` });\n  }\n  \n  // 3. Support tickets (max 15 points)\n  const recentTickets = customer.support_tickets?.filter(t => {\n    const created = new Date(t.created_at);\n    return (today - created) < (30 * 24 * 60 * 60 * 1000);\n  }) || [];\n  const unresolvedTickets = recentTickets.filter(t => t.status !== 'resolved');\n  \n  if (unresolvedTickets.length > 3) {\n    riskScore += 15;\n    riskFactors.push({ factor: 'Multiple unresolved tickets', impact: 'high', count: unresolvedTickets.length });\n  } else if (unresolvedTickets.length > 0) {\n    riskScore += 8;\n    riskFactors.push({ factor: 'Has unresolved tickets', impact: 'medium', count: unresolvedTickets.length });\n  }\n  \n  // 4. Payment issues (max 20 points)\n  const billing = customer.billing || {};\n  if (billing.failed_payments > 0) {\n    riskScore += 20;\n    riskFactors.push({ factor: 'Payment failures', impact: 'high', count: billing.failed_payments });\n  }\n  if (billing.past_due) {\n    riskScore += 15;\n    riskFactors.push({ factor: 'Account past due', impact: 'high', amount: billing.amount_due });\n  }\n  \n  // 5. Contract/subscription signals (max 15 points)\n  const subscription = customer.subscription || {};\n  const renewalDate = subscription.renewal_date ? new Date(subscription.renewal_date) : null;\n  const daysUntilRenewal = renewalDate ? Math.floor((renewalDate - today) / (1000 * 60 * 60 * 24)) : 999;\n  \n  if (daysUntilRenewal <= 30 && daysUntilRenewal > 0) {\n    riskScore += 10;\n    riskFactors.push({ factor: 'Renewal approaching', impact: 'medium', days: daysUntilRenewal });\n  }\n  if (subscription.plan_downgraded) {\n    riskScore += 15;\n    riskFactors.push({ factor: 'Recently downgraded', impact: 'high' });\n  }\n  \n  // Determine risk level\n  let riskLevel = 'low';\n  if (riskScore >= 60) riskLevel = 'critical';\n  else if (riskScore >= 40) riskLevel = 'high';\n  else if (riskScore >= 20) riskLevel = 'medium';\n  \n  return {\n    customerId: customer.id,\n    customerName: customer.name,\n    email: customer.email,\n    accountManager: customer.account_manager,\n    mrr: customer.mrr || 0,\n    plan: subscription.plan_name,\n    customerSince: customer.created_at,\n    riskScore,\n    riskLevel,\n    riskFactors,\n    daysSinceLogin,\n    usageChange: usageChange.toFixed(1),\n    unresolvedTickets: unresolvedTickets.length,\n    daysUntilRenewal,\n    lifetimeValue: customer.ltv || 0\n  };\n});\n\n// Sort by risk score descending\nriskAssessments.sort((a, b) => b.riskScore - a.riskScore);\n\n// Summary statistics\nconst summary = {\n  totalCustomers: customers.length,\n  criticalRisk: riskAssessments.filter(r => r.riskLevel === 'critical').length,\n  highRisk: riskAssessments.filter(r => r.riskLevel === 'high').length,\n  mediumRisk: riskAssessments.filter(r => r.riskLevel === 'medium').length,\n  lowRisk: riskAssessments.filter(r => r.riskLevel === 'low').length,\n  mrrAtRisk: riskAssessments.filter(r => r.riskLevel === 'critical' || r.riskLevel === 'high')\n    .reduce((sum, r) => sum + r.mrr, 0),\n  avgRiskScore: Math.round(riskAssessments.reduce((a, b) => a + b.riskScore, 0) / riskAssessments.length)\n};\n\nreturn [{ json: { assessments: riskAssessments, summary, analyzedAt: new Date().toISOString() } }];"
        },
        "id": "calculate-risk",
        "name": "Calculate Churn Risk",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Customer Success AI specializing in churn prevention. Analyze at-risk customers and recommend personalized retention strategies.\n\nFor each customer, consider:\n1. Primary churn indicators\n2. Customer value (MRR, LTV)\n3. Historical behavior patterns\n4. Industry-specific factors\n\nProvide actionable retention strategies including:\n- Immediate actions (within 24 hours)\n- Short-term interventions (1 week)\n- Long-term engagement plans\n- Personalized outreach messaging\n- Potential offers or incentives",
                "role": "system"
              },
              {
                "content": "=Analyze these at-risk customers and recommend retention strategies:\n\n**Summary:**\n{{ JSON.stringify($json.summary, null, 2) }}\n\n**Critical & High Risk Customers:**\n{{ JSON.stringify($json.assessments.filter(a => a.riskLevel === 'critical' || a.riskLevel === 'high').slice(0, 10), null, 2) }}\n\nProvide specific, personalized retention recommendations for each customer.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.4,
            "maxTokens": 3000
          }
        },
        "id": "ai-retention-strategy",
        "name": "AI Retention Strategy",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1000,
          200
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Filter critical risk customers for immediate intervention\nconst assessments = $('Calculate Churn Risk').first().json.assessments;\nconst aiStrategies = $('AI Retention Strategy').first().json;\n\nconst criticalCustomers = assessments.filter(a => a.riskLevel === 'critical');\n\n// Merge AI recommendations with customer data\nconst interventions = criticalCustomers.map(customer => {\n  const strategy = aiStrategies.strategies?.find(s => s.customerId === customer.customerId) ||\n    aiStrategies.recommendations?.find(r => r.customerId === customer.customerId) ||\n    {};\n  \n  return {\n    ...customer,\n    interventionType: 'critical',\n    recommendedActions: strategy.immediateActions || [\n      'Personal call from account manager',\n      'Offer extended trial/discount',\n      'Schedule product training'\n    ],\n    outreachMessage: strategy.personalizedMessage || null,\n    offerSuggested: strategy.offer || null,\n    assignedTo: customer.accountManager || 'unassigned'\n  };\n});\n\nreturn interventions.map(i => ({ json: i }));"
        },
        "id": "prepare-interventions",
        "name": "Prepare Interventions",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1250,
          200
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CRM_API_URL }}/tasks",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"title\": \"URGENT: Churn Risk - {{ $json.customerName }}\",\n  \"description\": \"Customer at critical risk of churning.\\n\\nRisk Score: {{ $json.riskScore }}/100\\nMRR at Risk: ${{ $json.mrr }}\\n\\nRisk Factors:\\n{{ $json.riskFactors.map(f => '- ' + f.factor).join('\\n') }}\\n\\nRecommended Actions:\\n{{ $json.recommendedActions.map(a => '- ' + a).join('\\n') }}\",\n  \"customer_id\": \"{{ $json.customerId }}\",\n  \"assigned_to\": \"{{ $json.assignedTo }}\",\n  \"due_date\": \"{{ $now.plus({ days: 1 }).format('yyyy-MM-dd') }}\",\n  \"priority\": \"urgent\",\n  \"type\": \"churn_intervention\"\n}",
          "options": {}
        },
        "id": "create-crm-task",
        "name": "Create CRM Task",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          200
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "crm-api-key",
            "name": "CRM API Key"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $json.assignedTo ? `@${$json.assignedTo}` : $vars.CS_SLACK_CHANNEL }}",
          "text": "=ðŸš¨ *Critical Churn Alert*\n\n*Customer:* {{ $json.customerName }}\n*Risk Score:* {{ $json.riskScore }}/100\n*MRR at Risk:* ${{ $json.mrr.toLocaleString() }}\n\nâš ï¸ *Risk Factors:*\n{{ $json.riskFactors.map(f => `â€¢ ${f.factor} (${f.impact})`).join('\\n') }}\n\nðŸ’¡ *Recommended Actions:*\n{{ $json.recommendedActions.map(a => `â€¢ ${a}`).join('\\n') }}\n\n_Please take action within 24 hours_",
          "otherOptions": {}
        },
        "id": "alert-critical",
        "name": "Alert Account Manager",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1500,
          400
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-critical",
                "leftValue": "={{ $json.summary.criticalRisk }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-critical",
        "name": "Has Critical?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.CS_SLACK_CHANNEL }}",
          "text": "=ðŸ“Š *Daily Churn Risk Report - {{ $now.format('MMMM d, yyyy') }}*\n\n*Risk Distribution:*\nðŸ”´ Critical: {{ $json.summary.criticalRisk }} customers\nðŸŸ  High: {{ $json.summary.highRisk }} customers\nðŸŸ¡ Medium: {{ $json.summary.mediumRisk }} customers\nðŸŸ¢ Low: {{ $json.summary.lowRisk }} customers\n\nðŸ’° *MRR at Risk (Critical + High):* ${{ $json.summary.mrrAtRisk.toLocaleString() }}\n\nðŸ“ˆ *Metrics:*\nâ€¢ Total Active Customers: {{ $json.summary.totalCustomers }}\nâ€¢ Average Risk Score: {{ $json.summary.avgRiskScore }}/100\n\n{{ $json.summary.criticalRisk > 0 ? `\\nâš ï¸ *${$json.summary.criticalRisk} critical accounts require immediate attention*` : '\\nâœ… No critical risks detected' }}",
          "otherOptions": {}
        },
        "id": "daily-summary",
        "name": "Daily Summary",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1250,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.CHURN_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Daily Risk Log",
            "mode": "list",
            "cachedResultName": "Daily Risk Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Date": "={{ $now.format('yyyy-MM-dd') }}",
              "Total Customers": "={{ $json.summary.totalCustomers }}",
              "Critical Risk": "={{ $json.summary.criticalRisk }}",
              "High Risk": "={{ $json.summary.highRisk }}",
              "Medium Risk": "={{ $json.summary.mediumRisk }}",
              "Low Risk": "={{ $json.summary.lowRisk }}",
              "MRR at Risk": "={{ $json.summary.mrrAtRisk }}",
              "Avg Risk Score": "={{ $json.summary.avgRiskScore }}"
            }
          },
          "options": {}
        },
        "id": "log-daily",
        "name": "Log Daily Risk",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1500,
          600
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "churn-win-back",
          "options": {}
        },
        "id": "winback-webhook",
        "name": "Win-Back Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          700
        ],
        "webhookId": "churn-winback"
      },
      {
        "parameters": {
          "jsCode": "// Process churned customer for win-back campaign\nconst customer = $input.first().json.body;\n\nconst winBackCandidate = {\n  customerId: customer.id,\n  customerName: customer.name,\n  email: customer.email,\n  churned_date: customer.churned_date || new Date().toISOString(),\n  reason: customer.churn_reason || 'unknown',\n  previousPlan: customer.previous_plan,\n  previousMrr: customer.previous_mrr,\n  lifetimeValue: customer.ltv,\n  tenure: customer.tenure_months,\n  lastInteraction: customer.last_interaction\n};\n\nreturn [{ json: winBackCandidate }];"
        },
        "id": "process-churned",
        "name": "Process Churned Customer",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          700
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Win-Back Campaign Specialist AI. Create personalized win-back strategies for churned customers.\n\nConsider:\n1. Churn reason\n2. Customer value (LTV, previous MRR)\n3. Tenure with company\n4. Time since churn\n\nCreate:\n1. Personalized win-back email (subject + body)\n2. Special offer recommendation\n3. Best timing for outreach\n4. Follow-up sequence plan",
                "role": "system"
              },
              {
                "content": "=Create a win-back strategy for this churned customer:\n\n{{ JSON.stringify($json, null, 2) }}\n\nProvide a comprehensive, personalized win-back approach.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.6,
            "maxTokens": 1500
          }
        },
        "id": "ai-winback",
        "name": "AI Win-Back Strategy",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          750,
          700
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.EMAIL_API_URL }}/sequences/enroll",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"email\": \"{{ $('Process Churned Customer').first().json.email }}\",\n  \"sequence_id\": \"{{ $vars.WINBACK_SEQUENCE_ID }}\",\n  \"custom_data\": {\n    \"customer_name\": \"{{ $('Process Churned Customer').first().json.customerName }}\",\n    \"offer\": {{ JSON.stringify($json.offer || $json.recommendedOffer) }},\n    \"personalized_message\": {{ JSON.stringify($json.email?.body || $json.personalizedMessage) }}\n  }\n}",
          "options": {}
        },
        "id": "enroll-winback",
        "name": "Enroll in Win-Back",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          700
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "email-api-key",
            "name": "Email API Key"
          }
        }
      }
    ],
    "connections": {
      "Daily Analysis": {
        "main": [
          [
            {
              "node": "Fetch Active Customers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Active Customers": {
        "main": [
          [
            {
              "node": "Calculate Churn Risk",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Churn Risk": {
        "main": [
          [
            {
              "node": "AI Retention Strategy",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has Critical?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Retention Strategy": {
        "main": [
          [
            {
              "node": "Prepare Interventions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Interventions": {
        "main": [
          [
            {
              "node": "Create CRM Task",
              "type": "main",
              "index": 0
            },
            {
              "node": "Alert Account Manager",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Critical?": {
        "main": [
          [
            {
              "node": "Daily Summary",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Daily Summary",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Summary": {
        "main": [
          [
            {
              "node": "Log Daily Risk",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Win-Back Webhook": {
        "main": [
          [
            {
              "node": "Process Churned Customer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Churned Customer": {
        "main": [
          [
            {
              "node": "AI Win-Back Strategy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Win-Back Strategy": {
        "main": [
          [
            {
              "node": "Enroll in Win-Back",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "customer-success",
        "name": "customer-success"
      },
      {
        "id": "churn",
        "name": "churn"
      },
      {
        "id": "retention",
        "name": "retention"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Client Onboarding Automation v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "new-client",
          "options": {}
        },
        "id": "new-client-webhook",
        "name": "New Client Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "new-client-onboarding"
      },
      {
        "parameters": {
          "triggerOn": "newDeal",
          "filters": {
            "pipeline_id": "={{ $vars.SALES_PIPELINE_ID }}",
            "stage_id": "={{ $vars.WON_STAGE_ID }}"
          }
        },
        "id": "hubspot-deal-trigger",
        "name": "HubSpot Deal Won",
        "type": "n8n-nodes-base.hubspotTrigger",
        "typeVersion": 1,
        "position": [
          250,
          500
        ],
        "credentials": {
          "hubspotDeveloperApi": {
            "id": "hubspot-credential",
            "name": "HubSpot Developer API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Normalize client data from different sources\nconst input = $input.first().json;\nlet clientData = {};\n\n// Check if from webhook or HubSpot\nif (input.body) {\n  // From webhook\n  const body = input.body;\n  clientData = {\n    source: 'webhook',\n    companyName: body.companyName || body.company_name,\n    contactName: body.contactName || body.contact_name,\n    email: body.email,\n    phone: body.phone,\n    industry: body.industry,\n    website: body.website,\n    services: body.services || [],\n    monthlyBudget: body.monthlyBudget || body.monthly_budget,\n    startDate: body.startDate || body.start_date || new Date().toISOString(),\n    notes: body.notes,\n    dealId: body.dealId || body.deal_id,\n    accountManager: body.accountManager || body.account_manager\n  };\n} else if (input.properties) {\n  // From HubSpot\n  const props = input.properties;\n  clientData = {\n    source: 'hubspot',\n    companyName: props.dealname?.value || props.company?.value,\n    contactName: props.contact_name?.value,\n    email: props.contact_email?.value,\n    phone: props.contact_phone?.value,\n    industry: props.industry?.value,\n    website: props.website?.value,\n    services: props.services?.value?.split(';') || [],\n    monthlyBudget: parseFloat(props.amount?.value) || 0,\n    startDate: props.closedate?.value || new Date().toISOString(),\n    notes: props.description?.value,\n    dealId: input.dealId || input.objectId,\n    accountManager: props.hubspot_owner_id?.value\n  };\n}\n\n// Generate unique client ID\nclientData.clientId = `CLT-${Date.now().toString(36).toUpperCase()}`;\nclientData.createdAt = new Date().toISOString();\nclientData.status = 'onboarding';\n\nreturn [{ json: clientData }];"
        },
        "id": "normalize-client-data",
        "name": "Normalize Client Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CRM_API_URL }}/clients",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "create-client-record",
        "name": "Create Client Record",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "crm-api-key",
            "name": "CRM API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.clickup.com/api/v2/list/{{ $vars.ONBOARDING_LIST_ID }}/task",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "clickUpApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"name\": \"Onboarding: {{ $json.companyName }}\",\n  \"description\": \"New client onboarding checklist for {{ $json.companyName }}\\n\\nContact: {{ $json.contactName }}\\nEmail: {{ $json.email }}\\nServices: {{ $json.services.join(', ') }}\\nMonthly Budget: ${{ $json.monthlyBudget }}\\nStart Date: {{ $json.startDate }}\",\n  \"assignees\": [{{ $vars.DEFAULT_ONBOARDING_ASSIGNEE }}],\n  \"due_date\": {{ Date.now() + (7 * 24 * 60 * 60 * 1000) }},\n  \"priority\": 2,\n  \"custom_fields\": [\n    { \"id\": \"{{ $vars.CLIENT_ID_FIELD }}\", \"value\": \"{{ $json.clientId }}\" },\n    { \"id\": \"{{ $vars.BUDGET_FIELD }}\", \"value\": {{ $json.monthlyBudget }} }\n  ]\n}",
          "options": {}
        },
        "id": "create-clickup-task",
        "name": "Create ClickUp Task",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          500
        ],
        "credentials": {
          "clickUpApi": {
            "id": "clickup-credential",
            "name": "ClickUp API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Generate onboarding checklist based on services\nconst client = $input.first().json;\nconst services = client.services || [];\n\nconst subtasks = [\n  // Standard onboarding tasks\n  { name: 'Send welcome email', priority: 'high', dueOffset: 0 },\n  { name: 'Schedule kickoff call', priority: 'high', dueOffset: 1 },\n  { name: 'Collect brand assets and guidelines', priority: 'high', dueOffset: 3 },\n  { name: 'Set up client folder in Drive', priority: 'medium', dueOffset: 1 },\n  { name: 'Create Slack channel for client', priority: 'medium', dueOffset: 1 },\n  { name: 'Set up billing and invoicing', priority: 'high', dueOffset: 2 },\n  { name: 'Complete onboarding questionnaire review', priority: 'high', dueOffset: 3 }\n];\n\n// Service-specific tasks\nif (services.includes('SEO') || services.includes('seo')) {\n  subtasks.push(\n    { name: 'Conduct initial SEO audit', priority: 'high', dueOffset: 5 },\n    { name: 'Set up Google Search Console access', priority: 'high', dueOffset: 2 },\n    { name: 'Create keyword research document', priority: 'medium', dueOffset: 7 },\n    { name: 'Set up rank tracking', priority: 'medium', dueOffset: 5 }\n  );\n}\n\nif (services.includes('PPC') || services.includes('Google Ads') || services.includes('ppc')) {\n  subtasks.push(\n    { name: 'Get Google Ads account access', priority: 'high', dueOffset: 2 },\n    { name: 'Conduct initial account audit', priority: 'high', dueOffset: 5 },\n    { name: 'Set up conversion tracking', priority: 'high', dueOffset: 3 },\n    { name: 'Create campaign strategy document', priority: 'medium', dueOffset: 7 }\n  );\n}\n\nif (services.includes('Social Media') || services.includes('social')) {\n  subtasks.push(\n    { name: 'Get social media account access', priority: 'high', dueOffset: 2 },\n    { name: 'Audit current social presence', priority: 'medium', dueOffset: 5 },\n    { name: 'Create content calendar template', priority: 'medium', dueOffset: 7 },\n    { name: 'Set up social scheduling tool', priority: 'low', dueOffset: 5 }\n  );\n}\n\nif (services.includes('Content') || services.includes('content')) {\n  subtasks.push(\n    { name: 'Conduct content audit', priority: 'medium', dueOffset: 5 },\n    { name: 'Create content strategy document', priority: 'high', dueOffset: 10 },\n    { name: 'Set up editorial calendar', priority: 'medium', dueOffset: 7 }\n  );\n}\n\nif (services.includes('Email Marketing') || services.includes('email')) {\n  subtasks.push(\n    { name: 'Get ESP account access', priority: 'high', dueOffset: 2 },\n    { name: 'Audit email list and segments', priority: 'medium', dueOffset: 5 },\n    { name: 'Review email templates', priority: 'low', dueOffset: 7 }\n  );\n}\n\nif (services.includes('Analytics') || services.includes('analytics')) {\n  subtasks.push(\n    { name: 'Set up GA4 access', priority: 'high', dueOffset: 2 },\n    { name: 'Configure analytics dashboard', priority: 'medium', dueOffset: 7 },\n    { name: 'Set up goal/conversion tracking', priority: 'high', dueOffset: 5 }\n  );\n}\n\n// Sort by due date and priority\nsubtasks.sort((a, b) => {\n  if (a.dueOffset !== b.dueOffset) return a.dueOffset - b.dueOffset;\n  const priorityOrder = { high: 0, medium: 1, low: 2 };\n  return priorityOrder[a.priority] - priorityOrder[b.priority];\n});\n\nreturn [{ \n  json: { \n    client,\n    subtasks,\n    totalTasks: subtasks.length\n  } \n}];"
        },
        "id": "generate-checklist",
        "name": "Generate Onboarding Checklist",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://www.googleapis.com/drive/v3/files",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleDriveOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"name\": \"{{ $json.client.companyName }} - {{ $json.client.clientId }}\",\n  \"mimeType\": \"application/vnd.google-apps.folder\",\n  \"parents\": [\"{{ $vars.CLIENTS_DRIVE_FOLDER }}\"]\n}",
          "options": {}
        },
        "id": "create-drive-folder",
        "name": "Create Drive Folder",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          300
        ],
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "google-drive-credential",
            "name": "Google Drive OAuth2"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.NEW_CLIENTS_SLACK_CHANNEL }}",
          "text": "=ðŸŽ‰ *New Client Onboarding Started!*\n\n*Company:* {{ $json.client.companyName }}\n*Contact:* {{ $json.client.contactName }} ({{ $json.client.email }})\n*Services:* {{ $json.client.services.join(', ') || 'TBD' }}\n*Monthly Budget:* ${{ $json.client.monthlyBudget?.toLocaleString() || 'TBD' }}\n*Start Date:* {{ $json.client.startDate }}\n*Client ID:* {{ $json.client.clientId }}\n\nðŸ“‹ *Onboarding Tasks:* {{ $json.totalTasks }} tasks generated\n\n_Please complete the onboarding checklist within 7 days_",
          "otherOptions": {}
        },
        "id": "notify-team",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1250,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "operation": "create",
          "name": "={{ $json.client.companyName }}",
          "isPrivate": false,
          "options": {}
        },
        "id": "create-slack-channel",
        "name": "Create Slack Channel",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1250,
          700
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $json.client.email }}",
          "subject": "=Welcome to {{ $vars.AGENCY_NAME }}! - Getting Started",
          "message": "=Dear {{ $json.client.contactName }},\n\nWelcome to {{ $vars.AGENCY_NAME }}! We're thrilled to have {{ $json.client.companyName }} as our newest client.\n\nYour dedicated account manager will be reaching out within the next 24 hours to schedule our kickoff call. In the meantime, here's what you can expect:\n\nðŸ“‹ **Next Steps:**\n1. Kickoff call to discuss goals and strategy\n2. Access setup for relevant platforms\n3. Brand asset collection\n4. Initial audit and recommendations\n\nðŸ“ **Client Portal:**\nYou'll receive an invitation to your client portal where you can:\n- View project status and timelines\n- Access reports and analytics\n- Communicate with your team\n- Review and approve content\n\nðŸ—“ï¸ **Timeline:**\nOnboarding typically takes 5-7 business days, after which we'll begin active campaign management.\n\n**Your Client ID:** {{ $json.client.clientId }}\n\nIf you have any questions, don't hesitate to reach out to your account manager or reply to this email.\n\nWe're excited to help {{ $json.client.companyName }} achieve its marketing goals!\n\nBest regards,\nThe {{ $vars.AGENCY_NAME }} Team",
          "options": {
            "replyTo": "={{ $vars.AGENCY_EMAIL }}"
          }
        },
        "id": "send-welcome-email",
        "name": "Send Welcome Email",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1500,
          400
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.PROJECT_MGMT_URL }}/projects",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"name\": \"{{ $json.client.companyName }} - Monthly Retainer\",\n  \"client_id\": \"{{ $json.client.clientId }}\",\n  \"start_date\": \"{{ $json.client.startDate }}\",\n  \"budget\": {{ $json.client.monthlyBudget }},\n  \"services\": {{ JSON.stringify($json.client.services) }},\n  \"status\": \"onboarding\"\n}",
          "options": {}
        },
        "id": "create-project",
        "name": "Create Project",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "project-mgmt-api",
            "name": "Project Management API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.CLIENT_ONBOARDING_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Clients",
            "mode": "list",
            "cachedResultName": "Clients"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Client ID": "={{ $json.client.clientId }}",
              "Company Name": "={{ $json.client.companyName }}",
              "Contact Name": "={{ $json.client.contactName }}",
              "Email": "={{ $json.client.email }}",
              "Phone": "={{ $json.client.phone }}",
              "Services": "={{ $json.client.services.join(', ') }}",
              "Monthly Budget": "={{ $json.client.monthlyBudget }}",
              "Start Date": "={{ $json.client.startDate }}",
              "Status": "=Onboarding",
              "Created At": "={{ $now.toISO() }}"
            }
          },
          "options": {}
        },
        "id": "log-to-sheets",
        "name": "Log to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1500,
          800
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 * * 1"
              }
            ]
          }
        },
        "id": "weekly-check",
        "name": "Weekly Monday Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          800
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CRM_API_URL }}/clients",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "status",
                "value": "onboarding"
              },
              {
                "name": "created_before",
                "value": "={{ $now.minus({ days: 7 }).toISO() }}"
              }
            ]
          },
          "options": {}
        },
        "id": "check-overdue-onboarding",
        "name": "Check Overdue Onboarding",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "crm-api-key",
            "name": "CRM API Key"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-overdue",
                "leftValue": "={{ $json.clients?.length || 0 }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-has-overdue",
        "name": "Has Overdue?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          750,
          800
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.OPERATIONS_SLACK_CHANNEL }}",
          "text": "=âš ï¸ *Overdue Onboarding Alert*\n\n{{ $json.clients?.length || 0 }} clients have been in onboarding for more than 7 days:\n\n{{ $json.clients?.map(c => `â€¢ *${c.companyName}* (${c.clientId}) - Started ${c.startDate}`).join('\\n') || 'None' }}\n\n_Please prioritize completing these onboardings_",
          "otherOptions": {}
        },
        "id": "alert-overdue",
        "name": "Alert Overdue Onboarding",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1000,
          800
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      }
    ],
    "connections": {
      "New Client Webhook": {
        "main": [
          [
            {
              "node": "Normalize Client Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HubSpot Deal Won": {
        "main": [
          [
            {
              "node": "Normalize Client Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize Client Data": {
        "main": [
          [
            {
              "node": "Create Client Record",
              "type": "main",
              "index": 0
            },
            {
              "node": "Create ClickUp Task",
              "type": "main",
              "index": 0
            },
            {
              "node": "Generate Onboarding Checklist",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Onboarding Checklist": {
        "main": [
          [
            {
              "node": "Create Drive Folder",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Create Slack Channel",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send Welcome Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Create Project",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Weekly Monday Check": {
        "main": [
          [
            {
              "node": "Check Overdue Onboarding",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Overdue Onboarding": {
        "main": [
          [
            {
              "node": "Has Overdue?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Overdue?": {
        "main": [
          [
            {
              "node": "Alert Overdue Onboarding",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "agency",
        "name": "agency"
      },
      {
        "id": "onboarding",
        "name": "onboarding"
      },
      {
        "id": "client-management",
        "name": "client-management"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 3,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Client Reporting Dashboard v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 6 * * 1"
              }
            ]
          }
        },
        "id": "weekly-report-trigger",
        "name": "Weekly Report Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          300
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 7 1 * *"
              }
            ]
          }
        },
        "id": "monthly-report-trigger",
        "name": "Monthly Report Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          500
        ]
      },
      {
        "parameters": {},
        "id": "webhook-report-request",
        "name": "On-Demand Report Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          700
        ],
        "webhookId": "client-report-request"
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.CLIENT_DATABASE_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Clients",
            "mode": "list"
          },
          "options": {}
        },
        "id": "get-client-list",
        "name": "Get Client List",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          450,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://analyticsdata.googleapis.com/v1beta/properties/{{ $json.ga4_property_id }}:runReport",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleAnalyticsOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"dateRanges\": [\n    {\"startDate\": \"{{ $json.reportPeriod?.start || '30daysAgo' }}\", \"endDate\": \"{{ $json.reportPeriod?.end || 'yesterday' }}\"},\n    {\"startDate\": \"{{ $json.comparePeriod?.start || '60daysAgo' }}\", \"endDate\": \"{{ $json.comparePeriod?.end || '31daysAgo' }}\"}\n  ],\n  \"dimensions\": [\n    {\"name\": \"date\"},\n    {\"name\": \"sessionSource\"},\n    {\"name\": \"sessionMedium\"},\n    {\"name\": \"deviceCategory\"}\n  ],\n  \"metrics\": [\n    {\"name\": \"sessions\"},\n    {\"name\": \"totalUsers\"},\n    {\"name\": \"newUsers\"},\n    {\"name\": \"bounceRate\"},\n    {\"name\": \"averageSessionDuration\"},\n    {\"name\": \"screenPageViews\"},\n    {\"name\": \"conversions\"},\n    {\"name\": \"totalRevenue\"}\n  ]\n}",
          "options": {}
        },
        "id": "fetch-ga4-data",
        "name": "Fetch GA4 Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://googleads.googleapis.com/v15/customers/{{ $json.google_ads_id }}/googleAds:searchStream",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleAdsOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"query\": \"SELECT campaign.name, metrics.impressions, metrics.clicks, metrics.cost_micros, metrics.conversions, metrics.conversions_value, metrics.ctr, metrics.average_cpc FROM campaign WHERE segments.date DURING LAST_30_DAYS\"\n}",
          "options": {}
        },
        "id": "fetch-google-ads",
        "name": "Fetch Google Ads Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          700,
          500
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://graph.facebook.com/v18.0/act_{{ $json.meta_ad_account_id }}/insights",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "facebookGraphApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "fields",
                "value": "campaign_name,impressions,clicks,spend,reach,cpc,cpm,ctr,conversions,cost_per_conversion,purchase_roas"
              },
              {
                "name": "date_preset",
                "value": "last_30d"
              },
              {
                "name": "level",
                "value": "campaign"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-meta-ads",
        "name": "Fetch Meta Ads Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          700,
          700
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.linkedin.com/rest/adAnalytics",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "linkedInOAuth2Api",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "q",
                "value": "analytics"
              },
              {
                "name": "pivot",
                "value": "CAMPAIGN"
              },
              {
                "name": "dateRange.start.day",
                "value": "1"
              },
              {
                "name": "dateRange.start.month",
                "value": "={{ new Date().getMonth() }}"
              },
              {
                "name": "dateRange.start.year",
                "value": "={{ new Date().getFullYear() }}"
              },
              {
                "name": "accounts",
                "value": "urn:li:sponsoredAccount:{{ $json.linkedin_ad_account_id }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-linkedin-ads",
        "name": "Fetch LinkedIn Ads Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          700,
          900
        ]
      },
      {
        "parameters": {
          "jsCode": "// Client Report Data Aggregator\n// Combines all marketing data into unified dashboard metrics\n\nconst clientData = $('Get Client List').first().json;\nconst ga4Data = $('Fetch GA4 Data').first()?.json || {};\nconst googleAdsData = $('Fetch Google Ads Data').first()?.json || {};\nconst metaAdsData = $('Fetch Meta Ads Data').first()?.json || {};\nconst linkedInAdsData = $('Fetch LinkedIn Ads Data').first()?.json || {};\n\n// Parse GA4 metrics\nconst ga4Metrics = {\n  sessions: 0,\n  users: 0,\n  newUsers: 0,\n  bounceRate: 0,\n  avgSessionDuration: 0,\n  pageviews: 0,\n  conversions: 0,\n  revenue: 0\n};\n\nif (ga4Data.rows) {\n  ga4Data.rows.forEach(row => {\n    ga4Metrics.sessions += parseInt(row.metricValues?.[0]?.value || 0);\n    ga4Metrics.users += parseInt(row.metricValues?.[1]?.value || 0);\n    ga4Metrics.newUsers += parseInt(row.metricValues?.[2]?.value || 0);\n    ga4Metrics.pageviews += parseInt(row.metricValues?.[5]?.value || 0);\n    ga4Metrics.conversions += parseInt(row.metricValues?.[6]?.value || 0);\n    ga4Metrics.revenue += parseFloat(row.metricValues?.[7]?.value || 0);\n  });\n  ga4Metrics.bounceRate = (parseFloat(ga4Data.rows[0]?.metricValues?.[3]?.value || 0) * 100).toFixed(2);\n  ga4Metrics.avgSessionDuration = parseFloat(ga4Data.rows[0]?.metricValues?.[4]?.value || 0).toFixed(0);\n}\n\n// Parse Google Ads metrics\nconst googleAdsMetrics = {\n  impressions: 0,\n  clicks: 0,\n  spend: 0,\n  conversions: 0,\n  conversionValue: 0,\n  ctr: 0,\n  cpc: 0,\n  roas: 0,\n  campaigns: []\n};\n\nif (googleAdsData.results) {\n  googleAdsData.results.forEach(result => {\n    const metrics = result.metrics || {};\n    googleAdsMetrics.impressions += parseInt(metrics.impressions || 0);\n    googleAdsMetrics.clicks += parseInt(metrics.clicks || 0);\n    googleAdsMetrics.spend += (parseInt(metrics.costMicros || 0) / 1000000);\n    googleAdsMetrics.conversions += parseFloat(metrics.conversions || 0);\n    googleAdsMetrics.conversionValue += parseFloat(metrics.conversionsValue || 0);\n    \n    googleAdsMetrics.campaigns.push({\n      name: result.campaign?.name,\n      spend: (parseInt(metrics.costMicros || 0) / 1000000).toFixed(2),\n      conversions: parseFloat(metrics.conversions || 0).toFixed(1),\n      ctr: (parseFloat(metrics.ctr || 0) * 100).toFixed(2)\n    });\n  });\n  googleAdsMetrics.ctr = googleAdsMetrics.impressions > 0 \n    ? (googleAdsMetrics.clicks / googleAdsMetrics.impressions * 100).toFixed(2) : 0;\n  googleAdsMetrics.cpc = googleAdsMetrics.clicks > 0 \n    ? (googleAdsMetrics.spend / googleAdsMetrics.clicks).toFixed(2) : 0;\n  googleAdsMetrics.roas = googleAdsMetrics.spend > 0 \n    ? (googleAdsMetrics.conversionValue / googleAdsMetrics.spend).toFixed(2) : 0;\n}\n\n// Parse Meta Ads metrics\nconst metaAdsMetrics = {\n  impressions: 0,\n  clicks: 0,\n  spend: 0,\n  reach: 0,\n  conversions: 0,\n  cpc: 0,\n  cpm: 0,\n  ctr: 0,\n  roas: 0,\n  campaigns: []\n};\n\nif (metaAdsData.data) {\n  metaAdsData.data.forEach(campaign => {\n    metaAdsMetrics.impressions += parseInt(campaign.impressions || 0);\n    metaAdsMetrics.clicks += parseInt(campaign.clicks || 0);\n    metaAdsMetrics.spend += parseFloat(campaign.spend || 0);\n    metaAdsMetrics.reach += parseInt(campaign.reach || 0);\n    metaAdsMetrics.conversions += parseInt(campaign.conversions || 0);\n    \n    metaAdsMetrics.campaigns.push({\n      name: campaign.campaign_name,\n      spend: parseFloat(campaign.spend || 0).toFixed(2),\n      roas: campaign.purchase_roas?.[0]?.value || 'N/A'\n    });\n  });\n  metaAdsMetrics.cpc = metaAdsMetrics.clicks > 0 \n    ? (metaAdsMetrics.spend / metaAdsMetrics.clicks).toFixed(2) : 0;\n  metaAdsMetrics.ctr = metaAdsMetrics.impressions > 0 \n    ? (metaAdsMetrics.clicks / metaAdsMetrics.impressions * 100).toFixed(2) : 0;\n}\n\n// Unified report structure\nconst report = {\n  client: {\n    name: clientData.client_name,\n    id: clientData.client_id,\n    industry: clientData.industry,\n    reportPeriod: {\n      start: clientData.reportPeriod?.start || new Date(Date.now() - 30*24*60*60*1000).toISOString().split('T')[0],\n      end: clientData.reportPeriod?.end || new Date().toISOString().split('T')[0]\n    }\n  },\n  \n  summary: {\n    totalSpend: (googleAdsMetrics.spend + metaAdsMetrics.spend).toFixed(2),\n    totalConversions: googleAdsMetrics.conversions + metaAdsMetrics.conversions + ga4Metrics.conversions,\n    totalRevenue: (googleAdsMetrics.conversionValue + ga4Metrics.revenue).toFixed(2),\n    blendedROAS: googleAdsMetrics.spend + metaAdsMetrics.spend > 0 \n      ? ((googleAdsMetrics.conversionValue + ga4Metrics.revenue) / (googleAdsMetrics.spend + metaAdsMetrics.spend)).toFixed(2) \n      : 'N/A',\n    blendedCPA: googleAdsMetrics.conversions + metaAdsMetrics.conversions > 0\n      ? ((googleAdsMetrics.spend + metaAdsMetrics.spend) / (googleAdsMetrics.conversions + metaAdsMetrics.conversions)).toFixed(2)\n      : 'N/A'\n  },\n  \n  website: ga4Metrics,\n  \n  advertising: {\n    google: googleAdsMetrics,\n    meta: metaAdsMetrics,\n    linkedin: linkedInAdsData\n  },\n  \n  channelBreakdown: [\n    { channel: 'Google Ads', spend: googleAdsMetrics.spend, conversions: googleAdsMetrics.conversions, roas: googleAdsMetrics.roas },\n    { channel: 'Meta Ads', spend: metaAdsMetrics.spend, conversions: metaAdsMetrics.conversions, roas: metaAdsMetrics.roas }\n  ],\n  \n  generatedAt: new Date().toISOString()\n};\n\nreturn [{ json: report }];"
        },
        "id": "aggregate-report-data",
        "name": "Aggregate Report Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a digital marketing analyst preparing executive reports for agency clients. Generate clear, actionable insights from the marketing data.\n\nProvide:\n1. Executive summary (3-4 sentences highlighting key wins and areas of focus)\n2. Top 3 achievements this period\n3. Top 3 areas for improvement\n4. Strategic recommendations for next period\n5. Key metrics interpretation for non-technical stakeholders\n\nTone: Professional, confident, solution-oriented. Avoid jargon.\n\nReturn JSON:\n{\n  \"executiveSummary\": \"narrative summary\",\n  \"achievements\": [\"achievement 1\", \"achievement 2\", \"achievement 3\"],\n  \"improvements\": [\"improvement area 1\", \"improvement area 2\", \"improvement area 3\"],\n  \"recommendations\": [{\"action\": \"\", \"expectedImpact\": \"\", \"priority\": \"high|medium|low\"}],\n  \"metricsNarrative\": {\n    \"traffic\": \"interpretation\",\n    \"conversions\": \"interpretation\",\n    \"advertising\": \"interpretation\",\n    \"roi\": \"interpretation\"\n  },\n  \"nextPeriodFocus\": [\"focus 1\", \"focus 2\"]\n}"
              },
              {
                "role": "user",
                "content": "=Generate insights for {{ $json.client.name }}:\n\nReport Period: {{ $json.client.reportPeriod.start }} to {{ $json.client.reportPeriod.end }}\n\nSummary:\n- Total Spend: ${{ $json.summary.totalSpend }}\n- Total Conversions: {{ $json.summary.totalConversions }}\n- Total Revenue: ${{ $json.summary.totalRevenue }}\n- Blended ROAS: {{ $json.summary.blendedROAS }}x\n- Blended CPA: ${{ $json.summary.blendedCPA }}\n\nWebsite:\n- Sessions: {{ $json.website.sessions }}\n- Users: {{ $json.website.users }}\n- Bounce Rate: {{ $json.website.bounceRate }}%\n- Conversions: {{ $json.website.conversions }}\n\nGoogle Ads:\n- Spend: ${{ $json.advertising.google.spend.toFixed(2) }}\n- Conversions: {{ $json.advertising.google.conversions }}\n- ROAS: {{ $json.advertising.google.roas }}x\n- CPC: ${{ $json.advertising.google.cpc }}\n\nMeta Ads:\n- Spend: ${{ $json.advertising.meta.spend.toFixed(2) }}\n- Conversions: {{ $json.advertising.meta.conversions }}\n- Reach: {{ $json.advertising.meta.reach }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.5
          }
        },
        "id": "ai-insights-generator",
        "name": "AI Insights Generator",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          1250,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "// Generate White-Label PDF Report HTML\n// Creates professional report format for client delivery\n\nconst reportData = $('Aggregate Report Data').first().json;\nconst insights = $('AI Insights Generator').first().json;\n\nconst reportHTML = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 40px; color: #333; }\n    .header { border-bottom: 3px solid #2c3e50; padding-bottom: 20px; margin-bottom: 30px; }\n    .logo { max-height: 60px; }\n    .client-name { font-size: 28px; color: #2c3e50; margin: 10px 0; }\n    .period { color: #7f8c8d; font-size: 14px; }\n    .section { margin: 30px 0; }\n    .section-title { font-size: 20px; color: #2c3e50; border-bottom: 1px solid #eee; padding-bottom: 10px; }\n    .metric-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0; }\n    .metric-card { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; }\n    .metric-value { font-size: 32px; font-weight: bold; color: #2c3e50; }\n    .metric-label { font-size: 12px; color: #7f8c8d; text-transform: uppercase; margin-top: 5px; }\n    .metric-change { font-size: 14px; margin-top: 5px; }\n    .positive { color: #27ae60; }\n    .negative { color: #e74c3c; }\n    .executive-summary { background: #2c3e50; color: white; padding: 25px; border-radius: 8px; margin: 20px 0; }\n    .achievements { background: #e8f5e9; padding: 20px; border-radius: 8px; }\n    .improvements { background: #fff3e0; padding: 20px; border-radius: 8px; }\n    .table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n    .table th, .table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }\n    .table th { background: #f8f9fa; font-weight: 600; }\n    .recommendations { background: #e3f2fd; padding: 20px; border-radius: 8px; }\n    .footer { margin-top: 50px; text-align: center; color: #7f8c8d; font-size: 12px; border-top: 1px solid #eee; padding-top: 20px; }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <img src=\"{{AGENCY_LOGO_URL}}\" alt=\"Agency Logo\" class=\"logo\">\n    <h1 class=\"client-name\">Marketing Performance Report</h1>\n    <p class=\"period\">${reportData.client.name} | ${reportData.client.reportPeriod.start} to ${reportData.client.reportPeriod.end}</p>\n  </div>\n  \n  <div class=\"executive-summary\">\n    <h2 style=\"margin-top: 0;\">Executive Summary</h2>\n    <p>${insights.executiveSummary}</p>\n  </div>\n  \n  <div class=\"section\">\n    <h2 class=\"section-title\">Key Performance Metrics</h2>\n    <div class=\"metric-grid\">\n      <div class=\"metric-card\">\n        <div class=\"metric-value\">$${reportData.summary.totalSpend}</div>\n        <div class=\"metric-label\">Total Ad Spend</div>\n      </div>\n      <div class=\"metric-card\">\n        <div class=\"metric-value\">${reportData.summary.totalConversions}</div>\n        <div class=\"metric-label\">Conversions</div>\n      </div>\n      <div class=\"metric-card\">\n        <div class=\"metric-value\">$${reportData.summary.totalRevenue}</div>\n        <div class=\"metric-label\">Revenue</div>\n      </div>\n      <div class=\"metric-card\">\n        <div class=\"metric-value\">${reportData.summary.blendedROAS}x</div>\n        <div class=\"metric-label\">ROAS</div>\n      </div>\n    </div>\n  </div>\n  \n  <div class=\"section\">\n    <h2 class=\"section-title\">Website Performance</h2>\n    <div class=\"metric-grid\">\n      <div class=\"metric-card\">\n        <div class=\"metric-value\">${reportData.website.sessions.toLocaleString()}</div>\n        <div class=\"metric-label\">Sessions</div>\n      </div>\n      <div class=\"metric-card\">\n        <div class=\"metric-value\">${reportData.website.users.toLocaleString()}</div>\n        <div class=\"metric-label\">Users</div>\n      </div>\n      <div class=\"metric-card\">\n        <div class=\"metric-value\">${reportData.website.bounceRate}%</div>\n        <div class=\"metric-label\">Bounce Rate</div>\n      </div>\n      <div class=\"metric-card\">\n        <div class=\"metric-value\">${reportData.website.conversions}</div>\n        <div class=\"metric-label\">Conversions</div>\n      </div>\n    </div>\n    <p>${insights.metricsNarrative?.traffic || ''}</p>\n  </div>\n  \n  <div class=\"section\">\n    <h2 class=\"section-title\">Advertising Performance by Channel</h2>\n    <table class=\"table\">\n      <tr>\n        <th>Channel</th>\n        <th>Spend</th>\n        <th>Conversions</th>\n        <th>ROAS</th>\n        <th>CPC</th>\n      </tr>\n      <tr>\n        <td>Google Ads</td>\n        <td>$${reportData.advertising.google.spend.toFixed(2)}</td>\n        <td>${reportData.advertising.google.conversions}</td>\n        <td>${reportData.advertising.google.roas}x</td>\n        <td>$${reportData.advertising.google.cpc}</td>\n      </tr>\n      <tr>\n        <td>Meta Ads</td>\n        <td>$${reportData.advertising.meta.spend.toFixed(2)}</td>\n        <td>${reportData.advertising.meta.conversions}</td>\n        <td>${reportData.advertising.meta.roas || 'N/A'}</td>\n        <td>$${reportData.advertising.meta.cpc}</td>\n      </tr>\n    </table>\n    <p>${insights.metricsNarrative?.advertising || ''}</p>\n  </div>\n  \n  <div class=\"section\">\n    <div class=\"achievements\">\n      <h3 style=\"margin-top: 0; color: #27ae60;\">âœ“ Key Achievements</h3>\n      <ul>\n        ${insights.achievements?.map(a => `<li>${a}</li>`).join('') || ''}\n      </ul>\n    </div>\n  </div>\n  \n  <div class=\"section\">\n    <div class=\"improvements\">\n      <h3 style=\"margin-top: 0; color: #f39c12;\">â†‘ Areas for Improvement</h3>\n      <ul>\n        ${insights.improvements?.map(i => `<li>${i}</li>`).join('') || ''}\n      </ul>\n    </div>\n  </div>\n  \n  <div class=\"section\">\n    <div class=\"recommendations\">\n      <h3 style=\"margin-top: 0; color: #2196f3;\">â†’ Strategic Recommendations</h3>\n      ${insights.recommendations?.map(r => `<p><strong>${r.action}</strong><br><em>Expected Impact: ${r.expectedImpact}</em></p>`).join('') || ''}\n    </div>\n  </div>\n  \n  <div class=\"footer\">\n    <p>Report generated on ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>\n    <p>Â© ${new Date().getFullYear()} {{AGENCY_NAME}} - All Rights Reserved</p>\n  </div>\n</body>\n</html>\n`;\n\nreturn [{\n  json: {\n    reportData,\n    insights,\n    reportHTML,\n    reportType: 'weekly',\n    generatedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "generate-report-html",
        "name": "Generate Report HTML",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.pdfshift.io/v3/convert/pdf",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpBasicAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"source\": {{ JSON.stringify($json.reportHTML) }},\n  \"landscape\": false,\n  \"use_print\": true,\n  \"format\": \"A4\",\n  \"margin\": \"20mm\"\n}",
          "options": {
            "response": {
              "response": {
                "fullResponse": false,
                "responseFormat": "file"
              }
            }
          }
        },
        "id": "generate-pdf",
        "name": "Generate PDF Report",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1750,
          400
        ]
      },
      {
        "parameters": {
          "to": "={{ $json.reportData.client.email || $env.CLIENT_EMAIL }}",
          "subject": "=Your {{ $json.reportType === 'monthly' ? 'Monthly' : 'Weekly' }} Marketing Report - {{ $json.reportData.client.name }}",
          "emailType": "html",
          "html": "=<div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n  <h2>Hi {{ $json.reportData.client.name.split(' ')[0] }},</h2>\n  <p>Your {{ $json.reportType }} marketing performance report is ready!</p>\n  \n  <div style=\"background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n    <h3 style=\"margin-top: 0;\">Quick Highlights</h3>\n    <ul>\n      <li><strong>Total Spend:</strong> ${{ $json.reportData.summary.totalSpend }}</li>\n      <li><strong>Conversions:</strong> {{ $json.reportData.summary.totalConversions }}</li>\n      <li><strong>Revenue:</strong> ${{ $json.reportData.summary.totalRevenue }}</li>\n      <li><strong>ROAS:</strong> {{ $json.reportData.summary.blendedROAS }}x</li>\n    </ul>\n  </div>\n  \n  <p><strong>Executive Summary:</strong></p>\n  <p>{{ $json.insights.executiveSummary }}</p>\n  \n  <p>The full detailed report is attached as a PDF.</p>\n  \n  <p>Questions? Reply to this email or schedule a call to discuss.</p>\n  \n  <p>Best regards,<br>Your Marketing Team</p>\n</div>",
          "options": {
            "attachments": "={{ $('Generate PDF Report').first().binary }}"
          }
        },
        "id": "send-report-email",
        "name": "Send Report Email",
        "type": "n8n-nodes-base.sendEmail",
        "typeVersion": 2.1,
        "position": [
          2000,
          400
        ]
      },
      {
        "parameters": {
          "channel": "={{ $json.reportData.client.slack_channel || '#client-reports' }}",
          "text": "=ðŸ“Š *{{ $json.reportType === 'monthly' ? 'Monthly' : 'Weekly' }} Report Sent: {{ $json.reportData.client.name }}*\n\n*Period:* {{ $json.reportData.client.reportPeriod.start }} to {{ $json.reportData.client.reportPeriod.end }}\n\n*Key Metrics:*\nâ€¢ Spend: ${{ $json.reportData.summary.totalSpend }}\nâ€¢ Conversions: {{ $json.reportData.summary.totalConversions }}\nâ€¢ Revenue: ${{ $json.reportData.summary.totalRevenue }}\nâ€¢ ROAS: {{ $json.reportData.summary.blendedROAS }}x\n\n*AI Summary:*\n{{ $json.insights.executiveSummary }}\n\nâœ… Report delivered to client at {{ new Date().toLocaleTimeString() }}",
          "otherOptions": {}
        },
        "id": "slack-notification",
        "name": "Slack Notification",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          2000,
          600
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.REPORT_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Report Log",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ $json.generatedAt }}",
              "client": "={{ $json.reportData.client.name }}",
              "report_type": "={{ $json.reportType }}",
              "period_start": "={{ $json.reportData.client.reportPeriod.start }}",
              "period_end": "={{ $json.reportData.client.reportPeriod.end }}",
              "total_spend": "={{ $json.reportData.summary.totalSpend }}",
              "total_revenue": "={{ $json.reportData.summary.totalRevenue }}",
              "roas": "={{ $json.reportData.summary.blendedROAS }}",
              "status": "=sent"
            }
          }
        },
        "id": "log-report",
        "name": "Log Report Delivery",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          2000,
          800
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"status\": \"success\",\n  \"client\": \"{{ $json.reportData.client.name }}\",\n  \"reportType\": \"{{ $json.reportType }}\",\n  \"metrics\": {\n    \"spend\": {{ $json.reportData.summary.totalSpend }},\n    \"revenue\": {{ $json.reportData.summary.totalRevenue }},\n    \"roas\": {{ $json.reportData.summary.blendedROAS }}\n  },\n  \"generatedAt\": \"{{ $json.generatedAt }}\"\n}"
        },
        "id": "webhook-response",
        "name": "Webhook Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          2000,
          1000
        ]
      }
    ],
    "connections": {
      "Weekly Report Trigger": {
        "main": [
          [
            {
              "node": "Get Client List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Monthly Report Trigger": {
        "main": [
          [
            {
              "node": "Get Client List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On-Demand Report Request": {
        "main": [
          [
            {
              "node": "Get Client List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Client List": {
        "main": [
          [
            {
              "node": "Fetch GA4 Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Google Ads Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Meta Ads Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch LinkedIn Ads Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch GA4 Data": {
        "main": [
          [
            {
              "node": "Aggregate Report Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Google Ads Data": {
        "main": [
          [
            {
              "node": "Aggregate Report Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Meta Ads Data": {
        "main": [
          [
            {
              "node": "Aggregate Report Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch LinkedIn Ads Data": {
        "main": [
          [
            {
              "node": "Aggregate Report Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Report Data": {
        "main": [
          [
            {
              "node": "AI Insights Generator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Insights Generator": {
        "main": [
          [
            {
              "node": "Generate Report HTML",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Report HTML": {
        "main": [
          [
            {
              "node": "Generate PDF Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate PDF Report": {
        "main": [
          [
            {
              "node": "Send Report Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Slack Notification",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Report Delivery",
              "type": "main",
              "index": 0
            },
            {
              "node": "Webhook Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-agency-client-reporting"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 3,
    "tags": [
      {
        "name": "Agency",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Reporting",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "White-Label",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "AI",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain Competitive Intelligence v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "days",
                "daysInterval": 1
              }
            ]
          }
        },
        "id": "daily-trigger",
        "name": "Daily Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          300
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Competitors"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-competitors",
        "name": "Get Competitor List",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "batchSize": 1,
          "options": {}
        },
        "id": "loop-competitors",
        "name": "Process Each Competitor",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          650,
          300
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://r.jina.ai/{{ $json.website }}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true
              }
            }
          }
        },
        "id": "scrape-website",
        "name": "Scrape Competitor Website",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          850,
          200
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.serper.dev/search",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-KEY",
                "value": "={{ $env.SERPER_API_KEY }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"q\": \"{{ $json.company_name }} news\",\n  \"gl\": \"tr\",\n  \"hl\": \"tr\",\n  \"num\": 10,\n  \"tbs\": \"qdr:w\"\n}",
          "options": {}
        },
        "id": "search-news",
        "name": "Search Competitor News",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          850,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://graph.facebook.com/v18.0/{{ $json.facebook_page_id }}",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "fields",
                "value": "fan_count,posts.limit(5){message,created_time,shares,reactions.summary(true),comments.summary(true)}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.META_ACCESS_TOKEN }}"
              }
            ]
          },
          "options": {}
        },
        "id": "get-facebook-data",
        "name": "Get Facebook Data",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          850,
          600
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "// Combine all competitor data\nconst competitor = $input.item.json;\nconst websiteData = $('Scrape Competitor Website').item?.json || {};\nconst newsData = $('Search Competitor News').item?.json || {};\nconst facebookData = $('Get Facebook Data').item?.json || {};\n\n// Parse website content\nconst websiteText = websiteData.body || '';\nconst wordCount = websiteText.split(/\\s+/).length;\n\n// Parse news\nconst newsItems = newsData.organic || [];\nconst recentNews = newsItems.slice(0, 5).map(n => ({\n  title: n.title,\n  link: n.link,\n  snippet: n.snippet,\n  date: n.date\n}));\n\n// Parse Facebook\nconst fbFollowers = facebookData.fan_count || 0;\nconst fbPosts = facebookData.posts?.data || [];\nconst avgEngagement = fbPosts.length > 0 \n  ? fbPosts.reduce((sum, p) => sum + (p.reactions?.summary?.total_count || 0) + (p.comments?.summary?.total_count || 0), 0) / fbPosts.length \n  : 0;\n\nreturn {\n  json: {\n    ...competitor,\n    website_word_count: wordCount,\n    recent_news: recentNews,\n    news_count: newsItems.length,\n    facebook_followers: fbFollowers,\n    facebook_avg_engagement: avgEngagement.toFixed(0),\n    facebook_recent_posts: fbPosts.slice(0, 3).map(p => p.message?.substring(0, 100)),\n    scraped_at: new Date().toISOString()\n  }\n};"
        },
        "id": "combine-data",
        "name": "Combine Competitor Data",
        "type": "n8n-nodes-base.code",
        "position": [
          1050,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir rekabet analisti olarak calismaktasin. Rakip verilerini analiz et ve stratejik ongorular sun.\n\nJSON formatinda dondur:\n{\n  \"threat_level\": \"LOW\" | \"MEDIUM\" | \"HIGH\" | \"CRITICAL\",\n  \"key_activities\": [\"son donem aktiviteleri\"],\n  \"strengths\": [\"guclu yonleri\"],\n  \"weaknesses\": [\"zayif yonleri\"],\n  \"opportunities\": [\"bizim icin firsatlar\"],\n  \"threats\": [\"bizim icin tehditler\"],\n  \"recommended_response\": \"onerilen strateji\",\n  \"watch_items\": [\"takip edilmesi gerekenler\"]\n}"
              },
              {
                "role": "user",
                "content": "Rakip: {{ $json.company_name }}\nSektor: {{ $json.industry }}\nWebsite kelime sayisi: {{ $json.website_word_count }}\nSon haberler sayisi: {{ $json.news_count }}\nFacebook takipci: {{ $json.facebook_followers }}\nFacebook ort. etkilesim: {{ $json.facebook_avg_engagement }}\nSon haberler: {{ JSON.stringify($json.recent_news) }}\nSon Facebook postlari: {{ JSON.stringify($json.facebook_recent_posts) }}"
              }
            ]
          },
          "options": {
            "temperature": 0.4
          }
        },
        "id": "ai-analysis",
        "name": "AI Competitor Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1250,
          400
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse AI analysis\nconst aiResponse = $input.item.json.message?.content || $input.item.json.content;\nlet analysis;\n\ntry {\n  analysis = JSON.parse(aiResponse);\n} catch (e) {\n  analysis = {\n    threat_level: 'MEDIUM',\n    key_activities: [],\n    strengths: [],\n    weaknesses: [],\n    opportunities: [],\n    threats: [],\n    recommended_response: 'Analiz yapilamadi',\n    watch_items: []\n  };\n}\n\nreturn {\n  json: {\n    ...$input.item.json,\n    threat_level: analysis.threat_level,\n    key_activities: analysis.key_activities?.join(', ') || '',\n    ai_strengths: analysis.strengths?.join(', ') || '',\n    ai_weaknesses: analysis.weaknesses?.join(', ') || '',\n    ai_opportunities: analysis.opportunities?.join(', ') || '',\n    ai_threats: analysis.threats?.join(', ') || '',\n    recommended_response: analysis.recommended_response,\n    watch_items: analysis.watch_items?.join(', ') || ''\n  }\n};"
        },
        "id": "parse-analysis",
        "name": "Parse AI Analysis",
        "type": "n8n-nodes-base.code",
        "position": [
          1450,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Competitor_Intel_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "company_name": "={{ $json.company_name }}",
              "threat_level": "={{ $json.threat_level }}",
              "facebook_followers": "={{ $json.facebook_followers }}",
              "facebook_engagement": "={{ $json.facebook_avg_engagement }}",
              "news_count": "={{ $json.news_count }}",
              "key_activities": "={{ $json.key_activities }}",
              "opportunities": "={{ $json.ai_opportunities }}",
              "threats": "={{ $json.ai_threats }}",
              "recommended_response": "={{ $json.recommended_response }}",
              "scraped_at": "={{ $json.scraped_at }}"
            }
          }
        },
        "id": "log-intel",
        "name": "Log Intelligence",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1650,
          400
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "high-threat",
                "leftValue": "={{ $json.threat_level }}",
                "rightValue": "HIGH",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          }
        },
        "id": "if-high-threat",
        "name": "If High Threat",
        "type": "n8n-nodes-base.if",
        "position": [
          1850,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#competitive-intel",
          "text": "=*RAKIP UYARISI - {{ $json.threat_level }}*\n\n*Rakip:* {{ $json.company_name }}\n\n*Son Aktiviteler:*\n{{ $json.key_activities }}\n\n*Tehditler:*\n{{ $json.ai_threats }}\n\n*Firsatlar:*\n{{ $json.ai_opportunities }}\n\n*Onerilen Aksiyon:*\n{{ $json.recommended_response }}\n\n*Takip Edilecekler:*\n{{ $json.watch_items }}",
          "otherOptions": {}
        },
        "id": "slack-threat-alert",
        "name": "Slack Threat Alert",
        "type": "n8n-nodes-base.slack",
        "position": [
          2050,
          300
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.serper.dev/search",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-KEY",
                "value": "={{ $env.SERPER_API_KEY }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"q\": \"{{ $json.industry }} trends 2025\",\n  \"gl\": \"tr\",\n  \"hl\": \"tr\",\n  \"num\": 10\n}",
          "options": {}
        },
        "id": "search-trends",
        "name": "Search Industry Trends",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          850,
          800
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sektor trendlerini analiz et ve onemli gelismeleri ozetle.\n\nJSON formatinda dondur:\n{\n  \"top_trends\": [\"en onemli 5 trend\"],\n  \"emerging_technologies\": [\"yukselen teknolojiler\"],\n  \"market_shifts\": [\"pazar degisimleri\"],\n  \"consumer_behavior_changes\": [\"tuketici davranis degisiklikleri\"],\n  \"recommendations\": [\"bizim icin oneriler\"]\n}"
              },
              {
                "role": "user",
                "content": "Sektor: {{ $json.industry }}\nArama sonuclari: {{ JSON.stringify($json.organic) }}"
              }
            ]
          },
          "options": {
            "temperature": 0.4
          }
        },
        "id": "ai-trend-analysis",
        "name": "AI Trend Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1050,
          800
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "weeks",
                "weeksInterval": 1
              }
            ]
          }
        },
        "id": "weekly-report-trigger",
        "name": "Weekly Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          1000
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Competitor_Intel_Log"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-weekly-intel",
        "name": "Get Weekly Intel",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          1000
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Aggregate weekly competitor intelligence\nconst data = $input.all();\nconst oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n\nconst weeklyData = data.filter(item => {\n  const scrapedDate = new Date(item.json.scraped_at);\n  return scrapedDate >= oneWeekAgo;\n});\n\nconst threatCounts = {\n  CRITICAL: weeklyData.filter(d => d.json.threat_level === 'CRITICAL').length,\n  HIGH: weeklyData.filter(d => d.json.threat_level === 'HIGH').length,\n  MEDIUM: weeklyData.filter(d => d.json.threat_level === 'MEDIUM').length,\n  LOW: weeklyData.filter(d => d.json.threat_level === 'LOW').length\n};\n\nconst allOpportunities = weeklyData.map(d => d.json.opportunities).filter(Boolean);\nconst allThreats = weeklyData.map(d => d.json.threats).filter(Boolean);\n\nreturn {\n  json: {\n    total_competitors_tracked: new Set(weeklyData.map(d => d.json.company_name)).size,\n    threat_distribution: threatCounts,\n    high_priority_count: threatCounts.CRITICAL + threatCounts.HIGH,\n    all_opportunities: allOpportunities.join(' | '),\n    all_threats: allThreats.join(' | '),\n    week_start: oneWeekAgo.toISOString().split('T')[0],\n    week_end: new Date().toISOString().split('T')[0]\n  }\n};"
        },
        "id": "aggregate-weekly",
        "name": "Aggregate Weekly Intel",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          1000
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#weekly-reports",
          "text": "=*HAFTALIK REKABET ISTIHBARATI RAPORU*\n*{{ $json.week_start }} - {{ $json.week_end }}*\n\n*Takip Edilen Rakip Sayisi:* {{ $json.total_competitors_tracked }}\n\n*Tehdit Dagilimi:*\n- CRITICAL: {{ $json.threat_distribution.CRITICAL }}\n- HIGH: {{ $json.threat_distribution.HIGH }}\n- MEDIUM: {{ $json.threat_distribution.MEDIUM }}\n- LOW: {{ $json.threat_distribution.LOW }}\n\n*Yuksek Oncelikli Uyari:* {{ $json.high_priority_count }} rakip\n\n*Tespit Edilen Firsatlar:*\n{{ $json.all_opportunities }}\n\n*Tespit Edilen Tehditler:*\n{{ $json.all_threats }}",
          "otherOptions": {}
        },
        "id": "slack-weekly-report",
        "name": "Send Weekly Intel Report",
        "type": "n8n-nodes-base.slack",
        "position": [
          850,
          1000
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      }
    ],
    "connections": {
      "Daily Check": {
        "main": [
          [
            {
              "node": "Get Competitor List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Competitor List": {
        "main": [
          [
            {
              "node": "Process Each Competitor",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Each Competitor": {
        "main": [
          [
            {
              "node": "Scrape Competitor Website",
              "type": "main",
              "index": 0
            },
            {
              "node": "Search Competitor News",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Facebook Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Scrape Competitor Website": {
        "main": [
          [
            {
              "node": "Combine Competitor Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Search Competitor News": {
        "main": [
          [
            {
              "node": "Combine Competitor Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Facebook Data": {
        "main": [
          [
            {
              "node": "Combine Competitor Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Combine Competitor Data": {
        "main": [
          [
            {
              "node": "AI Competitor Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Competitor Analysis": {
        "main": [
          [
            {
              "node": "Parse AI Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse AI Analysis": {
        "main": [
          [
            {
              "node": "Log Intelligence",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Intelligence": {
        "main": [
          [
            {
              "node": "If High Threat",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If High Threat": {
        "main": [
          [
            {
              "node": "Slack Threat Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Search Industry Trends": {
        "main": [
          [
            {
              "node": "AI Trend Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Weekly Report": {
        "main": [
          [
            {
              "node": "Get Weekly Intel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Weekly Intel": {
        "main": [
          [
            {
              "node": "Aggregate Weekly Intel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Weekly Intel": {
        "main": [
          [
            {
              "node": "Send Weekly Intel Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "grain-automation"
      },
      {
        "name": "competitive-intel"
      },
      {
        "name": "strategy"
      }
    ],
    "meta": {
      "templateId": "grain-ci-v1",
      "version": "1.0.0",
      "description": "Monitor competitors: website changes, news, social media. AI-powered threat analysis, weekly reports.",
      "requiredCredentials": [
        "Google Sheets OAuth2",
        "OpenAI API",
        "Serper API",
        "Meta Access Token",
        "Slack"
      ],
      "requiredEnvVars": [
        "SERPER_API_KEY",
        "META_ACCESS_TOKEN"
      ]
    }
  },
  {
    "name": "Grain Content Performance Analyzer v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 5 * * 1"
              }
            ]
          }
        },
        "id": "weekly-analysis",
        "name": "Weekly Analysis",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "content-analysis",
          "options": {}
        },
        "id": "manual-analysis",
        "name": "Manual Analysis Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          600
        ],
        "webhookId": "content-analysis"
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.ANALYTICS_API_URL }}/content/pages",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "dateRange",
                "value": "30d"
              },
              {
                "name": "metrics",
                "value": "pageviews,sessions,bounceRate,avgTimeOnPage,entrances,exits,conversions"
              },
              {
                "name": "limit",
                "value": "500"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-analytics",
        "name": "Fetch Analytics Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "analytics-api-key",
            "name": "Analytics API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.SEARCH_CONSOLE_API_URL }}/query",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "startDate",
                "value": "={{ new Date(Date.now() - 30*24*60*60*1000).toISOString().split('T')[0] }}"
              },
              {
                "name": "endDate",
                "value": "={{ new Date().toISOString().split('T')[0] }}"
              },
              {
                "name": "dimensions",
                "value": "page,query"
              },
              {
                "name": "rowLimit",
                "value": "1000"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-gsc",
        "name": "Fetch Search Console Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "gsc-api-key",
            "name": "Search Console API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.SOCIAL_API_URL }}/shares",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "domain",
                "value": "={{ $vars.DOMAIN }}"
              },
              {
                "name": "days",
                "value": "30"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-social",
        "name": "Fetch Social Shares",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "social-api-key",
            "name": "Social API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Merge and analyze content performance\nconst analyticsData = $('Fetch Analytics Data').first().json;\nconst gscData = $('Fetch Search Console Data').first().json;\nconst socialData = $('Fetch Social Shares').first().json;\n\nconst pages = analyticsData.pages || [];\nconst searchData = gscData.rows || [];\nconst socialShares = socialData.shares || [];\n\n// Create page performance map\nconst pagePerformance = new Map();\n\n// Add analytics data\npages.forEach(page => {\n  pagePerformance.set(page.path, {\n    url: page.path,\n    title: page.title,\n    traffic: {\n      pageviews: page.pageviews || 0,\n      sessions: page.sessions || 0,\n      bounceRate: page.bounceRate || 0,\n      avgTimeOnPage: page.avgTimeOnPage || 0,\n      entrances: page.entrances || 0,\n      exits: page.exits || 0\n    },\n    conversions: page.conversions || 0,\n    conversionRate: page.sessions > 0 \n      ? Math.round(page.conversions / page.sessions * 10000) / 100 \n      : 0,\n    search: { impressions: 0, clicks: 0, ctr: 0, position: null, keywords: [] },\n    social: { total: 0, facebook: 0, twitter: 0, linkedin: 0, pinterest: 0 }\n  });\n});\n\n// Add search data\nconst pageSearchData = {};\nsearchData.forEach(row => {\n  const page = row.keys[0];\n  const query = row.keys[1];\n  \n  if (!pageSearchData[page]) {\n    pageSearchData[page] = {\n      impressions: 0,\n      clicks: 0,\n      keywords: [],\n      positions: []\n    };\n  }\n  \n  pageSearchData[page].impressions += row.impressions;\n  pageSearchData[page].clicks += row.clicks;\n  pageSearchData[page].keywords.push({\n    keyword: query,\n    impressions: row.impressions,\n    clicks: row.clicks,\n    position: row.position\n  });\n  pageSearchData[page].positions.push(row.position);\n});\n\nObject.entries(pageSearchData).forEach(([page, data]) => {\n  const urlPath = new URL(page).pathname;\n  if (pagePerformance.has(urlPath)) {\n    const perf = pagePerformance.get(urlPath);\n    perf.search = {\n      impressions: data.impressions,\n      clicks: data.clicks,\n      ctr: data.impressions > 0 \n        ? Math.round(data.clicks / data.impressions * 10000) / 100 \n        : 0,\n      position: data.positions.length > 0 \n        ? Math.round(data.positions.reduce((a, b) => a + b, 0) / data.positions.length * 10) / 10\n        : null,\n      keywords: data.keywords.sort((a, b) => b.clicks - a.clicks).slice(0, 10)\n    };\n  }\n});\n\n// Add social data\nsocialShares.forEach(share => {\n  const urlPath = new URL(share.url).pathname;\n  if (pagePerformance.has(urlPath)) {\n    pagePerformance.get(urlPath).social = {\n      total: (share.facebook || 0) + (share.twitter || 0) + (share.linkedin || 0) + (share.pinterest || 0),\n      facebook: share.facebook || 0,\n      twitter: share.twitter || 0,\n      linkedin: share.linkedin || 0,\n      pinterest: share.pinterest || 0\n    };\n  }\n});\n\n// Calculate content scores\nconst scoredPages = Array.from(pagePerformance.values()).map(page => {\n  // Traffic score (0-25)\n  const trafficScore = Math.min(25, Math.round(page.traffic.pageviews / 100));\n  \n  // Engagement score (0-25) based on time on page and bounce rate\n  const engagementScore = Math.min(25, \n    Math.round((page.traffic.avgTimeOnPage / 60) * 5) + \n    Math.round((100 - page.traffic.bounceRate) / 10)\n  );\n  \n  // SEO score (0-25) based on search performance\n  const seoScore = Math.min(25,\n    Math.round(page.search.clicks / 10) +\n    (page.search.position && page.search.position < 20 ? Math.round(25 - page.search.position) : 0)\n  );\n  \n  // Social score (0-25)\n  const socialScore = Math.min(25, Math.round(page.social.total / 10));\n  \n  page.scores = {\n    traffic: trafficScore,\n    engagement: engagementScore,\n    seo: seoScore,\n    social: socialScore,\n    total: trafficScore + engagementScore + seoScore + socialScore\n  };\n  \n  // Determine content status\n  if (page.scores.total >= 70) page.status = 'top_performer';\n  else if (page.scores.total >= 50) page.status = 'good';\n  else if (page.scores.total >= 30) page.status = 'needs_improvement';\n  else page.status = 'underperforming';\n  \n  return page;\n});\n\n// Sort by total score\nscoredPages.sort((a, b) => b.scores.total - a.scores.total);\n\nreturn [{ json: {\n  analysisId: `CPA-${Date.now().toString(36).toUpperCase()}`,\n  analyzedAt: new Date().toISOString(),\n  totalPages: scoredPages.length,\n  pages: scoredPages\n}}];"
        },
        "id": "analyze-content",
        "name": "Analyze Content",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "// Generate insights and recommendations\nconst analysis = $input.first().json;\nconst pages = analysis.pages;\n\n// Categorize pages\nconst topPerformers = pages.filter(p => p.status === 'top_performer');\nconst goodPages = pages.filter(p => p.status === 'good');\nconst needsImprovement = pages.filter(p => p.status === 'needs_improvement');\nconst underperforming = pages.filter(p => p.status === 'underperforming');\n\n// Calculate averages\nconst avgPageviews = Math.round(pages.reduce((a, b) => a + b.traffic.pageviews, 0) / pages.length);\nconst avgBounceRate = Math.round(pages.reduce((a, b) => a + b.traffic.bounceRate, 0) / pages.length * 10) / 10;\nconst avgTimeOnPage = Math.round(pages.reduce((a, b) => a + b.traffic.avgTimeOnPage, 0) / pages.length);\nconst totalConversions = pages.reduce((a, b) => a + b.conversions, 0);\n\n// Identify opportunities\nconst opportunities = [];\n\n// High traffic, low conversion\nconst highTrafficLowConversion = pages.filter(p => \n  p.traffic.pageviews > avgPageviews * 2 && p.conversionRate < 1\n);\nif (highTrafficLowConversion.length > 0) {\n  opportunities.push({\n    type: 'conversion_optimization',\n    priority: 'high',\n    pages: highTrafficLowConversion.slice(0, 5).map(p => p.url),\n    insight: 'These pages get good traffic but low conversions. Add CTAs or improve offer.',\n    potentialImpact: 'Could increase conversions by 50-100%'\n  });\n}\n\n// High impressions, low CTR\nconst lowCTR = pages.filter(p => \n  p.search.impressions > 1000 && p.search.ctr < 2\n);\nif (lowCTR.length > 0) {\n  opportunities.push({\n    type: 'title_meta_optimization',\n    priority: 'high',\n    pages: lowCTR.slice(0, 5).map(p => p.url),\n    insight: 'These pages appear in search but don\\'t get clicks. Improve titles and meta descriptions.',\n    potentialImpact: 'Could double organic traffic'\n  });\n}\n\n// High bounce rate, good traffic\nconst highBounce = pages.filter(p => \n  p.traffic.bounceRate > 70 && p.traffic.pageviews > avgPageviews\n);\nif (highBounce.length > 0) {\n  opportunities.push({\n    type: 'engagement_improvement',\n    priority: 'medium',\n    pages: highBounce.slice(0, 5).map(p => p.url),\n    insight: 'High bounce rate indicates content mismatch or poor UX. Review content relevance.',\n    potentialImpact: 'Reduce bounce rate by 20-30%'\n  });\n}\n\n// Good position, low traffic\nconst rankingNoTraffic = pages.filter(p => \n  p.search.position && p.search.position < 20 && p.traffic.pageviews < avgPageviews / 2\n);\nif (rankingNoTraffic.length > 0) {\n  opportunities.push({\n    type: 'ranking_leverage',\n    priority: 'medium',\n    pages: rankingNoTraffic.slice(0, 5).map(p => p.url),\n    insight: 'These pages rank well but get little traffic. Optimize for higher-volume keywords.',\n    potentialImpact: 'Could 3-5x organic traffic'\n  });\n}\n\n// Content refresh candidates (older content, declining traffic)\nconst refreshCandidates = pages.filter(p => \n  p.status === 'underperforming' && p.search.keywords.length > 3\n);\nif (refreshCandidates.length > 0) {\n  opportunities.push({\n    type: 'content_refresh',\n    priority: 'medium',\n    pages: refreshCandidates.slice(0, 10).map(p => p.url),\n    insight: 'These pages have keyword potential but underperform. Update and refresh content.',\n    potentialImpact: 'Could revive traffic by 100-200%'\n  });\n}\n\n// Social amplification candidates\nconst lowSocial = pages.filter(p => \n  p.scores.total >= 50 && p.social.total < 10\n);\nif (lowSocial.length > 0) {\n  opportunities.push({\n    type: 'social_amplification',\n    priority: 'low',\n    pages: lowSocial.slice(0, 5).map(p => p.url),\n    insight: 'Good content with low social shares. Promote on social channels.',\n    potentialImpact: 'Could increase reach by 50%'\n  });\n}\n\nconst insights = {\n  analysisId: analysis.analysisId,\n  analyzedAt: analysis.analyzedAt,\n  summary: {\n    totalPages: pages.length,\n    topPerformers: topPerformers.length,\n    good: goodPages.length,\n    needsImprovement: needsImprovement.length,\n    underperforming: underperforming.length,\n    avgPageviews,\n    avgBounceRate,\n    avgTimeOnPage,\n    totalConversions,\n    totalSocialShares: pages.reduce((a, b) => a + b.social.total, 0)\n  },\n  topContent: topPerformers.slice(0, 10),\n  opportunities,\n  actionItems: opportunities.filter(o => o.priority === 'high').length,\n  pages: pages\n};\n\nreturn [{ json: insights }];"
        },
        "id": "generate-insights",
        "name": "Generate Insights",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          600
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Content Marketing Strategist. Analyze the content performance data and provide strategic recommendations.\n\nFocus on:\n1. Content strategy improvements\n2. Quick wins for traffic growth\n3. Conversion optimization tactics\n4. Content repurposing opportunities\n5. Content calendar priorities",
                "role": "system"
              },
              {
                "content": "=Analyze this content performance report:\n\n**Summary:**\nâ€¢ Total Pages: {{ $json.summary.totalPages }}\nâ€¢ Top Performers: {{ $json.summary.topPerformers }}\nâ€¢ Underperforming: {{ $json.summary.underperforming }}\nâ€¢ Avg Pageviews: {{ $json.summary.avgPageviews }}\nâ€¢ Avg Bounce Rate: {{ $json.summary.avgBounceRate }}%\nâ€¢ Total Conversions: {{ $json.summary.totalConversions }}\n\n**Top Content:**\n{{ $json.topContent.slice(0, 5).map(p => `â€¢ ${p.url} (Score: ${p.scores.total}, Views: ${p.traffic.pageviews})`).join('\\n') }}\n\n**Opportunities Identified:**\n{{ $json.opportunities.map(o => `â€¢ [${o.priority.toUpperCase()}] ${o.type}: ${o.insight}`).join('\\n') }}\n\n**Action Items Needed:** {{ $json.actionItems }}\n\nProvide a strategic content plan with prioritized actions.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.5,
            "maxTokens": 2500
          }
        },
        "id": "ai-strategy",
        "name": "AI Strategy",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1250,
          500
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Compile final report\nconst insights = $('Generate Insights').first().json;\nconst strategy = $('AI Strategy').first().json;\n\nconst report = {\n  ...insights,\n  strategy,\n  generatedAt: new Date().toISOString(),\n  exportUrls: {\n    pdf: `{{ $vars.REPORT_BASE_URL }}/content/${insights.analysisId}/pdf`,\n    csv: `{{ $vars.REPORT_BASE_URL }}/content/${insights.analysisId}/csv`\n  }\n};\n\nreturn [{ json: report }];"
        },
        "id": "compile-report",
        "name": "Compile Report",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1500,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CONTENT_DB_URL }}/reports",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-report",
        "name": "Save Report",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1750,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "content-db-api",
            "name": "Content DB API"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.CONTENT_SLACK_CHANNEL }}",
          "text": "=ðŸ“Š *Weekly Content Performance Report*\n\n*Summary:*\nâ€¢ Total Pages Analyzed: {{ $json.summary.totalPages }}\nâ€¢ Top Performers: {{ $json.summary.topPerformers }}\nâ€¢ Need Improvement: {{ $json.summary.needsImprovement }}\nâ€¢ Underperforming: {{ $json.summary.underperforming }}\n\nðŸ“ˆ *Key Metrics:*\nâ€¢ Avg Pageviews: {{ $json.summary.avgPageviews }}\nâ€¢ Avg Bounce Rate: {{ $json.summary.avgBounceRate }}%\nâ€¢ Total Conversions: {{ $json.summary.totalConversions }}\nâ€¢ Social Shares: {{ $json.summary.totalSocialShares }}\n\nðŸ† *Top Content This Week:*\n{{ $json.topContent.slice(0, 3).map(p => `â€¢ ${p.url.split('/').pop() || p.url} (Score: ${p.scores.total})`).join('\\n') }}\n\nâš¡ *High Priority Actions:* {{ $json.actionItems }}\n{{ $json.opportunities.filter(o => o.priority === 'high').map(o => `â€¢ ${o.insight}`).join('\\n') }}\n\n<{{ $json.exportUrls.pdf }}|Download Full Report>",
          "otherOptions": {}
        },
        "id": "notify-slack",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1750,
          700
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "respond-webhook",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1750,
          900
        ]
      }
    ],
    "connections": {
      "Weekly Analysis": {
        "main": [
          [
            {
              "node": "Fetch Analytics Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Search Console Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Social Shares",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Analysis Trigger": {
        "main": [
          [
            {
              "node": "Fetch Analytics Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Search Console Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Social Shares",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Analytics Data": {
        "main": [
          [
            {
              "node": "Analyze Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Search Console Data": {
        "main": [
          [
            {
              "node": "Analyze Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Social Shares": {
        "main": [
          [
            {
              "node": "Analyze Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Content": {
        "main": [
          [
            {
              "node": "Generate Insights",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Insights": {
        "main": [
          [
            {
              "node": "AI Strategy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Strategy": {
        "main": [
          [
            {
              "node": "Compile Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compile Report": {
        "main": [
          [
            {
              "node": "Save Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "content",
        "name": "content"
      },
      {
        "id": "analytics",
        "name": "analytics"
      },
      {
        "id": "seo",
        "name": "seo"
      },
      {
        "id": "performance",
        "name": "performance"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Customer Support Automation v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "support-ticket",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "New Support Ticket",
        "type": "n8n-nodes-base.webhook",
        "position": [
          250,
          300
        ],
        "typeVersion": 2,
        "webhookId": "support-ticket"
      },
      {
        "parameters": {
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          },
          "filters": {
            "includeSpamTrash": false,
            "readStatus": "unread"
          }
        },
        "id": "gmail-trigger",
        "name": "New Support Email",
        "type": "n8n-nodes-base.gmailTrigger",
        "position": [
          250,
          500
        ],
        "typeVersion": 1.1,
        "credentials": {
          "gmailOAuth2": {
            "id": "",
            "name": "Gmail Support"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Normalize input from different sources\nconst input = $input.item.json;\n\nlet ticket = {};\n\nif (input.subject) {\n  // From Gmail\n  ticket = {\n    source: 'email',\n    customer_email: input.from?.value?.[0]?.address || input.from,\n    customer_name: input.from?.value?.[0]?.name || 'Unknown',\n    subject: input.subject,\n    message: input.text || input.snippet,\n    received_at: input.date || new Date().toISOString(),\n    message_id: input.id\n  };\n} else {\n  // From Webhook\n  ticket = {\n    source: 'webhook',\n    customer_email: input.email,\n    customer_name: input.name || 'Unknown',\n    subject: input.subject || 'Support Request',\n    message: input.message,\n    received_at: new Date().toISOString(),\n    message_id: input.ticket_id || `TKT-${Date.now()}`\n  };\n}\n\nreturn { json: ticket };"
        },
        "id": "normalize-input",
        "name": "Normalize Ticket Data",
        "type": "n8n-nodes-base.code",
        "position": [
          450,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir musteri destek taleplerini siniflandiran AI'sin. Verilen talepleri analiz et.\n\nKATEGORILER:\n- BILLING: Odeme, fatura, abonelik\n- TECHNICAL: Teknik sorun, bug, hata\n- FEATURE: Ozellik istegi, oneri\n- COMPLAINT: Sikayet, memnuniyetsizlik\n- INQUIRY: Genel soru, bilgi talebi\n- URGENT: Acil durum, kritik sorun\n\nONCELIK:\n- P1: Kritik - Sistem calismiyorsanir (2 saat SLA)\n- P2: Yuksek - Onemli sorun (4 saat SLA)\n- P3: Normal - Standart talep (24 saat SLA)\n- P4: Dusuk - Bilgi talebi (48 saat SLA)\n\nJSON formatinda dondur:\n{\n  \"category\": \"KATEGORI\",\n  \"priority\": \"P1-P4\",\n  \"sentiment\": \"positive\" | \"neutral\" | \"negative\" | \"angry\",\n  \"key_issues\": [\"tespit edilen sorunlar\"],\n  \"suggested_response_type\": \"auto\" | \"template\" | \"human\",\n  \"escalate_to\": \"none\" | \"technical\" | \"billing\" | \"manager\",\n  \"summary\": \"1 cumle ozet\"\n}"
              },
              {
                "role": "user",
                "content": "Konu: {{ $json.subject }}\nMesaj: {{ $json.message }}"
              }
            ]
          },
          "options": {
            "temperature": 0.2
          }
        },
        "id": "classify-ticket",
        "name": "AI Classify Ticket",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          650,
          400
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse AI classification\nconst aiResponse = $input.item.json.message?.content || $input.item.json.content;\nlet classification;\n\ntry {\n  classification = JSON.parse(aiResponse);\n} catch (e) {\n  classification = {\n    category: 'INQUIRY',\n    priority: 'P3',\n    sentiment: 'neutral',\n    key_issues: [],\n    suggested_response_type: 'template',\n    escalate_to: 'none',\n    summary: 'Siniflandirma yapilamadi'\n  };\n}\n\nreturn {\n  json: {\n    ...$input.item.json,\n    category: classification.category,\n    priority: classification.priority,\n    sentiment: classification.sentiment,\n    key_issues: classification.key_issues?.join(', ') || '',\n    suggested_response_type: classification.suggested_response_type,\n    escalate_to: classification.escalate_to,\n    ai_summary: classification.summary,\n    ticket_id: `TKT-${Date.now()}`\n  }\n};"
        },
        "id": "parse-classification",
        "name": "Parse Classification",
        "type": "n8n-nodes-base.code",
        "position": [
          850,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Support_Tickets"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "ticket_id": "={{ $json.ticket_id }}",
              "source": "={{ $json.source }}",
              "customer_email": "={{ $json.customer_email }}",
              "customer_name": "={{ $json.customer_name }}",
              "subject": "={{ $json.subject }}",
              "category": "={{ $json.category }}",
              "priority": "={{ $json.priority }}",
              "sentiment": "={{ $json.sentiment }}",
              "key_issues": "={{ $json.key_issues }}",
              "ai_summary": "={{ $json.ai_summary }}",
              "escalate_to": "={{ $json.escalate_to }}",
              "status": "open",
              "created_at": "={{ $json.received_at }}",
              "assigned_to": "",
              "resolved_at": ""
            }
          }
        },
        "id": "log-ticket",
        "name": "Log Ticket",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1050,
          400
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "rules": [
              {
                "outputKey": "auto_respond",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.suggested_response_type }}",
                      "rightValue": "auto",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "template_respond",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.suggested_response_type }}",
                      "rightValue": "template",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "human_required",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.suggested_response_type }}",
                      "rightValue": "human",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "options": {}
        },
        "id": "route-response",
        "name": "Route by Response Type",
        "type": "n8n-nodes-base.switch",
        "position": [
          1250,
          400
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir musteri destek temsilcisisin. Samimi, profesyonel ve cozum odakli bir yanit yaz.\n\nKURALLAR:\n- Kisa ve net ol (max 200 kelime)\n- Empati goster\n- Sorunu anladigini belirt\n- Somut cozum veya sonraki adim sun\n- Gerekirse ozur dile\n- Yardimci kaynaklar veya linkler ekle\n\nJSON formatinda dondur:\n{\n  \"subject\": \"Re: [orijinal konu]\",\n  \"body\": \"Email icerik\",\n  \"include_resources\": [\"yardimci linkler\"]\n}"
              },
              {
                "role": "user",
                "content": "Musteri: {{ $json.customer_name }}\nKategori: {{ $json.category }}\nOncelik: {{ $json.priority }}\nSorun: {{ $json.message }}\nAI Ozet: {{ $json.ai_summary }}"
              }
            ]
          },
          "options": {
            "temperature": 0.6
          }
        },
        "id": "generate-auto-response",
        "name": "Generate Auto Response",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1450,
          200
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Select template based on category\nconst templates = {\n  BILLING: {\n    subject: 'Re: Odeme/Fatura Sorununuz Hakkinda',\n    body: `Merhaba {{ $json.customer_name }},\\n\\nOdeme/fatura konusundaki mesajiniz icin tesekkur ederiz.\\n\\nTalebiniz finans ekibimize iletilmistir. En kisa surede sizinle iletisime gececegiz.\\n\\nAcil durumlar icin: destek@sirket.com\\n\\nSaygilarimizla,\\nDestek Ekibi`\n  },\n  TECHNICAL: {\n    subject: 'Re: Teknik Destek Talebiniz',\n    body: `Merhaba {{ $json.customer_name }},\\n\\nTeknik sorununuzu aldik ve inceliyoruz.\\n\\nBu arada asagidaki adimlari deneyebilirsiniz:\\n1. Sayfayi yenileyin\\n2. Cache temizleyin\\n3. Farkli bir tarayici deneyin\\n\\nSorun devam ederse detayli bilgi verin.\\n\\nSaygilarimizla,\\nTeknik Destek`\n  },\n  FEATURE: {\n    subject: 'Re: Ozellik Oneriniz Icin Tesekkurler',\n    body: `Merhaba {{ $json.customer_name }},\\n\\nDegerli oneriniz icin tesekkur ederiz!\\n\\nOneriniz urun ekibimize iletilmistir. Kullanici geri bildirimleri bizim icin cok onemli.\\n\\nGelismeler icin bizi takip edin.\\n\\nSaygilarimizla,\\nUrun Ekibi`\n  },\n  INQUIRY: {\n    subject: 'Re: Sorunuz Hakkinda',\n    body: `Merhaba {{ $json.customer_name }},\\n\\nBize ulastiginiz icin tesekkur ederiz.\\n\\nSorunuzu inceliyoruz ve en kisa surede detayli bilgi verecegiz.\\n\\nSikca Sorulan Sorular: [link]\\n\\nSaygilarimizla,\\nDestek Ekibi`\n  }\n};\n\nconst category = $input.item.json.category;\nconst template = templates[category] || templates.INQUIRY;\n\nreturn {\n  json: {\n    ...$input.item.json,\n    response_subject: template.subject,\n    response_body: template.body.replace(/{{ \\$json\\.customer_name }}/g, $input.item.json.customer_name)\n  }\n};"
        },
        "id": "select-template",
        "name": "Select Response Template",
        "type": "n8n-nodes-base.code",
        "position": [
          1450,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#support-escalation",
          "text": "=*INSAN MUDAHALESI GEREKLI*\n\n*Ticket:* {{ $json.ticket_id }}\n*Musteri:* {{ $json.customer_name }} ({{ $json.customer_email }})\n*Oncelik:* {{ $json.priority }}\n*Kategori:* {{ $json.category }}\n*Sentiment:* {{ $json.sentiment }}\n\n*Konu:* {{ $json.subject }}\n\n*Ozet:* {{ $json.ai_summary }}\n\n*Tespit Edilen Sorunlar:* {{ $json.key_issues }}\n\n*Yonlendirme:* {{ $json.escalate_to }}\n\n---\n*Orijinal Mesaj:*\n{{ $json.message }}",
          "otherOptions": {}
        },
        "id": "slack-escalate",
        "name": "Escalate to Human",
        "type": "n8n-nodes-base.slack",
        "position": [
          1450,
          600
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse auto-generated response\nconst aiResponse = $input.item.json.message?.content || $input.item.json.content;\nlet response;\n\ntry {\n  response = JSON.parse(aiResponse);\n} catch (e) {\n  response = {\n    subject: 'Re: ' + $input.item.json.subject,\n    body: 'Mesajiniz icin tesekkurler. En kisa surede size donecegiz.',\n    include_resources: []\n  };\n}\n\nreturn {\n  json: {\n    ...$input.item.json,\n    response_subject: response.subject,\n    response_body: response.body,\n    response_resources: response.include_resources?.join('\\n') || ''\n  }\n};"
        },
        "id": "parse-auto-response",
        "name": "Parse Auto Response",
        "type": "n8n-nodes-base.code",
        "position": [
          1650,
          200
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "sendTo": "={{ $json.customer_email }}",
          "subject": "={{ $json.response_subject }}",
          "emailType": "text",
          "message": "={{ $json.response_body }}",
          "options": {
            "appendAttribution": false,
            "replyTo": "destek@sirket.com"
          }
        },
        "id": "send-response-email",
        "name": "Send Response Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1850,
          300
        ],
        "typeVersion": 2.1,
        "credentials": {
          "gmailOAuth2": {
            "id": "",
            "name": "Gmail Support"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Support_Tickets"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "status": "responded",
              "responded_at": "={{ $now.format('YYYY-MM-DD HH:mm:ss') }}",
              "response_type": "auto"
            }
          },
          "options": {}
        },
        "id": "update-ticket-status",
        "name": "Update Ticket Status",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2050,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "p1-check",
                "leftValue": "={{ $json.priority }}",
                "rightValue": "P1",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          }
        },
        "id": "if-urgent",
        "name": "If Urgent (P1)",
        "type": "n8n-nodes-base.if",
        "position": [
          2250,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#urgent-support",
          "text": "=*ACIL DESTEK TALEBI - P1*\n\n*Ticket:* {{ $json.ticket_id }}\n*Musteri:* {{ $json.customer_name }}\n*Email:* {{ $json.customer_email }}\n\n*Sorun:* {{ $json.ai_summary }}\n\n*SLA:* 2 saat icinde cozum gerekli!\n\ncc: @destek-yoneticisi",
          "otherOptions": {}
        },
        "id": "slack-urgent-alert",
        "name": "Urgent Alert",
        "type": "n8n-nodes-base.slack",
        "position": [
          2450,
          200
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 4
              }
            ]
          }
        },
        "id": "sla-check-trigger",
        "name": "SLA Check (4 Hours)",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          800
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Support_Tickets"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-open-tickets",
        "name": "Get Open Tickets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          800
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Check for SLA breaches\nconst tickets = $input.all();\nconst now = new Date();\n\nconst slaLimits = {\n  'P1': 2 * 60 * 60 * 1000,   // 2 hours\n  'P2': 4 * 60 * 60 * 1000,   // 4 hours\n  'P3': 24 * 60 * 60 * 1000,  // 24 hours\n  'P4': 48 * 60 * 60 * 1000   // 48 hours\n};\n\nconst breached = tickets.filter(ticket => {\n  if (ticket.json.status !== 'open') return false;\n  \n  const created = new Date(ticket.json.created_at);\n  const elapsed = now - created;\n  const limit = slaLimits[ticket.json.priority] || slaLimits.P3;\n  \n  return elapsed > limit;\n});\n\nreturn breached.map(t => ({\n  json: {\n    ...t.json,\n    sla_breached: true,\n    hours_overdue: Math.round((now - new Date(t.json.created_at)) / (60 * 60 * 1000))\n  }\n}));"
        },
        "id": "check-sla-breach",
        "name": "Check SLA Breaches",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          800
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#support-alerts",
          "text": "=*SLA IHLALI*\n\n*Ticket:* {{ $json.ticket_id }}\n*Oncelik:* {{ $json.priority }}\n*Musteri:* {{ $json.customer_name }}\n*Gecikme:* {{ $json.hours_overdue }} saat\n\n*Konu:* {{ $json.subject }}\n\n*Acil aksiyon gerekli!*",
          "otherOptions": {}
        },
        "id": "slack-sla-alert",
        "name": "SLA Breach Alert",
        "type": "n8n-nodes-base.slack",
        "position": [
          850,
          800
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "days",
                "daysInterval": 1
              }
            ]
          }
        },
        "id": "daily-report-trigger",
        "name": "Daily Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          1000
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Support_Tickets"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-daily-tickets",
        "name": "Get Daily Tickets",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          1000
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Generate daily support metrics\nconst tickets = $input.all();\nconst today = new Date();\nconst yesterday = new Date(today - 24 * 60 * 60 * 1000);\n\nconst todayTickets = tickets.filter(t => new Date(t.json.created_at) >= yesterday);\n\nconst metrics = {\n  total_tickets: todayTickets.length,\n  open_tickets: todayTickets.filter(t => t.json.status === 'open').length,\n  responded: todayTickets.filter(t => t.json.status === 'responded').length,\n  resolved: todayTickets.filter(t => t.json.status === 'resolved').length,\n  \n  by_priority: {\n    P1: todayTickets.filter(t => t.json.priority === 'P1').length,\n    P2: todayTickets.filter(t => t.json.priority === 'P2').length,\n    P3: todayTickets.filter(t => t.json.priority === 'P3').length,\n    P4: todayTickets.filter(t => t.json.priority === 'P4').length\n  },\n  \n  by_category: {\n    BILLING: todayTickets.filter(t => t.json.category === 'BILLING').length,\n    TECHNICAL: todayTickets.filter(t => t.json.category === 'TECHNICAL').length,\n    FEATURE: todayTickets.filter(t => t.json.category === 'FEATURE').length,\n    COMPLAINT: todayTickets.filter(t => t.json.category === 'COMPLAINT').length,\n    INQUIRY: todayTickets.filter(t => t.json.category === 'INQUIRY').length\n  },\n  \n  sentiment: {\n    positive: todayTickets.filter(t => t.json.sentiment === 'positive').length,\n    neutral: todayTickets.filter(t => t.json.sentiment === 'neutral').length,\n    negative: todayTickets.filter(t => t.json.sentiment === 'negative').length,\n    angry: todayTickets.filter(t => t.json.sentiment === 'angry').length\n  }\n};\n\nreturn { json: metrics };"
        },
        "id": "calculate-metrics",
        "name": "Calculate Daily Metrics",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          1000
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#daily-reports",
          "text": "=*GUNLUK DESTEK RAPORU*\n\n*Genel Bakis:*\n- Toplam Ticket: {{ $json.total_tickets }}\n- Acik: {{ $json.open_tickets }}\n- Cevaplanan: {{ $json.responded }}\n- Cozulen: {{ $json.resolved }}\n\n*Oncelik Dagilimi:*\n- P1 (Kritik): {{ $json.by_priority.P1 }}\n- P2 (Yuksek): {{ $json.by_priority.P2 }}\n- P3 (Normal): {{ $json.by_priority.P3 }}\n- P4 (Dusuk): {{ $json.by_priority.P4 }}\n\n*Kategori Dagilimi:*\n- Teknik: {{ $json.by_category.TECHNICAL }}\n- Fatura: {{ $json.by_category.BILLING }}\n- Sikayet: {{ $json.by_category.COMPLAINT }}\n- Ozellik: {{ $json.by_category.FEATURE }}\n- Soru: {{ $json.by_category.INQUIRY }}\n\n*Musteri Duygu Durumu:*\n- Pozitif: {{ $json.sentiment.positive }}\n- Notr: {{ $json.sentiment.neutral }}\n- Negatif: {{ $json.sentiment.negative }}\n- Kizgin: {{ $json.sentiment.angry }}",
          "otherOptions": {}
        },
        "id": "slack-daily-report",
        "name": "Send Daily Report",
        "type": "n8n-nodes-base.slack",
        "position": [
          850,
          1000
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      }
    ],
    "connections": {
      "New Support Ticket": {
        "main": [
          [
            {
              "node": "Normalize Ticket Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "New Support Email": {
        "main": [
          [
            {
              "node": "Normalize Ticket Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize Ticket Data": {
        "main": [
          [
            {
              "node": "AI Classify Ticket",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Classify Ticket": {
        "main": [
          [
            {
              "node": "Parse Classification",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Classification": {
        "main": [
          [
            {
              "node": "Log Ticket",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Ticket": {
        "main": [
          [
            {
              "node": "Route by Response Type",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Response Type": {
        "main": [
          [
            {
              "node": "Generate Auto Response",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Select Response Template",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Escalate to Human",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Auto Response": {
        "main": [
          [
            {
              "node": "Parse Auto Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Auto Response": {
        "main": [
          [
            {
              "node": "Send Response Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Select Response Template": {
        "main": [
          [
            {
              "node": "Send Response Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Response Email": {
        "main": [
          [
            {
              "node": "Update Ticket Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Ticket Status": {
        "main": [
          [
            {
              "node": "If Urgent (P1)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Urgent (P1)": {
        "main": [
          [
            {
              "node": "Urgent Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "SLA Check (4 Hours)": {
        "main": [
          [
            {
              "node": "Get Open Tickets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Open Tickets": {
        "main": [
          [
            {
              "node": "Check SLA Breaches",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check SLA Breaches": {
        "main": [
          [
            {
              "node": "SLA Breach Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Report": {
        "main": [
          [
            {
              "node": "Get Daily Tickets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Daily Tickets": {
        "main": [
          [
            {
              "node": "Calculate Daily Metrics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Daily Metrics": {
        "main": [
          [
            {
              "node": "Send Daily Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "grain-automation"
      },
      {
        "name": "customer-support"
      },
      {
        "name": "helpdesk"
      }
    ],
    "meta": {
      "templateId": "grain-csa-v1",
      "version": "1.0.0",
      "description": "Automated customer support: AI classification, auto-responses, SLA monitoring, escalation, daily reports.",
      "requiredCredentials": [
        "Google Sheets OAuth2",
        "OpenAI API",
        "Gmail OAuth2",
        "Slack"
      ],
      "requiredEnvVars": []
    }
  },
  {
    "name": "Grain Dynamic Pricing Engine v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 2
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Every 2 Hours",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.PMS_API_URL }}/inventory/availability",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {
            "timeout": 30000
          }
        },
        "id": "fetch-inventory",
        "name": "Fetch Current Inventory",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          470,
          200
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.PMS_API_URL }}/bookings/pace",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {
            "timeout": 30000
          }
        },
        "id": "fetch-booking-pace",
        "name": "Fetch Booking Pace",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          470,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.ratecomparison.io/v1/competitors",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "location",
                "value": "={{ $vars.PROPERTY_LOCATION }}"
              },
              {
                "name": "check_in",
                "value": "={{ $now.format('yyyy-MM-dd') }}"
              },
              {
                "name": "days_ahead",
                "value": "90"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-competitor-rates",
        "name": "Fetch Competitor Rates",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          470,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "rate-comparison-api",
            "name": "Rate Comparison API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.predicthq.com/v1/events",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "location_around.origin",
                "value": "={{ $vars.PROPERTY_COORDINATES }}"
              },
              {
                "name": "location_around.radius",
                "value": "50km"
              },
              {
                "name": "active.gte",
                "value": "={{ $now.format('yyyy-MM-dd') }}"
              },
              {
                "name": "active.lte",
                "value": "={{ $now.plus({ days: 90 }).format('yyyy-MM-dd') }}"
              },
              {
                "name": "category",
                "value": "concerts,conferences,sports,festivals"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-local-events",
        "name": "Fetch Local Events",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          470,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "predicthq-api",
            "name": "PredictHQ API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.weatherapi.com/v1/forecast.json",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpQueryAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "q",
                "value": "={{ $vars.PROPERTY_LOCATION }}"
              },
              {
                "name": "days",
                "value": "14"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-weather",
        "name": "Fetch Weather Forecast",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          470,
          1000
        ],
        "credentials": {
          "httpQueryAuth": {
            "id": "weather-api",
            "name": "Weather API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Aggregate all market intelligence data\nconst inventory = $('Fetch Current Inventory').first().json;\nconst bookingPace = $('Fetch Booking Pace').first().json;\nconst competitors = $('Fetch Competitor Rates').first().json;\nconst events = $('Fetch Local Events').first().json;\nconst weather = $('Fetch Weather Forecast').first().json;\n\n// Calculate demand signals for next 90 days\nconst demandSignals = [];\nconst today = new Date();\n\nfor (let i = 0; i < 90; i++) {\n  const targetDate = new Date(today);\n  targetDate.setDate(today.getDate() + i);\n  const dateStr = targetDate.toISOString().split('T')[0];\n  const dayOfWeek = targetDate.getDay();\n  \n  // Base demand factors\n  let demandScore = 50; // Base score\n  \n  // Weekend boost\n  if (dayOfWeek === 5 || dayOfWeek === 6) {\n    demandScore += 15;\n  }\n  \n  // Booking pace analysis\n  const paceData = bookingPace.dates?.find(d => d.date === dateStr);\n  if (paceData) {\n    const paceRatio = paceData.booked / paceData.historical_avg;\n    demandScore += Math.round((paceRatio - 1) * 30);\n  }\n  \n  // Event impact\n  const dayEvents = events.results?.filter(e => {\n    const eventStart = new Date(e.start);\n    const eventEnd = new Date(e.end);\n    return targetDate >= eventStart && targetDate <= eventEnd;\n  }) || [];\n  \n  let eventImpact = 0;\n  dayEvents.forEach(event => {\n    const attendance = event.phq_attendance || 1000;\n    if (attendance > 50000) eventImpact += 30;\n    else if (attendance > 10000) eventImpact += 20;\n    else if (attendance > 1000) eventImpact += 10;\n    else eventImpact += 5;\n  });\n  demandScore += Math.min(eventImpact, 40);\n  \n  // Competitor pricing analysis\n  const compData = competitors.rates?.find(r => r.date === dateStr);\n  const avgCompRate = compData?.average_rate || 100;\n  const compOccupancy = compData?.average_occupancy || 0.7;\n  \n  // Weather impact (for leisure destinations)\n  const weatherDay = weather.forecast?.forecastday?.find(d => d.date === dateStr);\n  if (weatherDay) {\n    const condition = weatherDay.day?.condition?.text?.toLowerCase() || '';\n    if (condition.includes('sunny') || condition.includes('clear')) {\n      demandScore += 5;\n    } else if (condition.includes('rain') || condition.includes('storm')) {\n      demandScore -= 10;\n    }\n  }\n  \n  // Get current inventory for date\n  const invData = inventory.dates?.find(d => d.date === dateStr) || {};\n  const totalRooms = invData.total_rooms || 100;\n  const available = invData.available || totalRooms;\n  const occupancy = 1 - (available / totalRooms);\n  \n  // Occupancy-based adjustment\n  if (occupancy > 0.9) demandScore += 25;\n  else if (occupancy > 0.8) demandScore += 15;\n  else if (occupancy > 0.7) demandScore += 5;\n  else if (occupancy < 0.3) demandScore -= 20;\n  else if (occupancy < 0.5) demandScore -= 10;\n  \n  // Clamp score\n  demandScore = Math.max(0, Math.min(100, demandScore));\n  \n  demandSignals.push({\n    date: dateStr,\n    dayOfWeek: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][dayOfWeek],\n    demandScore,\n    occupancy: Math.round(occupancy * 100),\n    availableRooms: available,\n    totalRooms,\n    competitorAvgRate: avgCompRate,\n    competitorOccupancy: Math.round(compOccupancy * 100),\n    events: dayEvents.map(e => ({ name: e.title, attendance: e.phq_attendance })),\n    weatherCondition: weatherDay?.day?.condition?.text || 'Unknown'\n  });\n}\n\nreturn [{ json: { demandSignals, propertyId: inventory.property_id } }];"
        },
        "id": "aggregate-signals",
        "name": "Aggregate Market Signals",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are an expert Revenue Manager AI for hospitality. Analyze market demand signals and recommend optimal pricing strategies.\n\nPricing Strategy Guidelines:\n1. Base Rate Multipliers by Demand Score:\n   - 0-20: 0.75x (Deep discount to drive occupancy)\n   - 21-40: 0.90x (Moderate discount)\n   - 41-60: 1.00x (Standard BAR rate)\n   - 61-80: 1.15x (Premium pricing)\n   - 81-100: 1.35x (Peak demand pricing)\n\n2. Length of Stay (LOS) Incentives:\n   - 2-night minimum during high demand\n   - Discounts for 3+ night stays during low demand\n\n3. Channel-Specific Pricing:\n   - Direct bookings: Best rate guaranteed\n   - OTAs: +5-10% markup to cover commissions\n   - Wholesale: Negotiate based on volume\n\n4. Room Type Differential:\n   - Maintain 15-25% spread between categories\n   - Premium rooms get higher multiplier during peak\n\nAnalyze the demand signals and provide specific pricing recommendations.",
                "role": "system"
              },
              {
                "content": "=Analyze these demand signals for the next 90 days and recommend pricing:\n\n{{ JSON.stringify($json.demandSignals, null, 2) }}\n\nFor each date, provide:\n1. Recommended BAR multiplier\n2. Minimum LOS requirement (if any)\n3. Channel pricing strategy\n4. Key reasoning (events, occupancy, competition)\n\nReturn as JSON array with pricing recommendations.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.3,
            "maxTokens": 4000
          }
        },
        "id": "ai-pricing-analysis",
        "name": "AI Pricing Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1000,
          400
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Transform AI recommendations into PMS-compatible rate updates\nconst aiRecommendations = $input.first().json;\nconst baseRates = {\n  standard: 150,\n  deluxe: 195,\n  suite: 280,\n  premium_suite: 380\n};\n\nconst rateUpdates = [];\n\n// Parse recommendations\nconst recommendations = aiRecommendations.recommendations || aiRecommendations;\n\nfor (const rec of recommendations) {\n  const multiplier = rec.barMultiplier || rec.multiplier || 1.0;\n  const minLOS = rec.minLOS || rec.minimumStay || 1;\n  \n  // Calculate rates for each room type\n  const roomRates = {};\n  for (const [roomType, baseRate] of Object.entries(baseRates)) {\n    const calculatedRate = Math.round(baseRate * multiplier);\n    roomRates[roomType] = {\n      bar: calculatedRate,\n      directBooking: calculatedRate,\n      ota: Math.round(calculatedRate * 1.08), // 8% OTA markup\n      wholesale: Math.round(calculatedRate * 0.85) // 15% wholesale discount\n    };\n  }\n  \n  rateUpdates.push({\n    date: rec.date,\n    demandScore: rec.demandScore,\n    multiplier,\n    minLOS,\n    rates: roomRates,\n    closedToArrival: rec.closedToArrival || false,\n    closedToDeparture: rec.closedToDeparture || false,\n    reasoning: rec.reasoning || rec.keyReasons,\n    events: rec.events || [],\n    confidence: rec.confidence || 0.85\n  });\n}\n\n// Identify significant changes requiring approval\nconst significantChanges = rateUpdates.filter(r => \n  r.multiplier > 1.25 || r.multiplier < 0.8 || r.minLOS > 2\n);\n\nreturn [\n  { json: { rateUpdates, significantChanges, totalDates: rateUpdates.length } }\n];"
        },
        "id": "transform-rates",
        "name": "Transform to PMS Format",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "significant-changes",
                "leftValue": "={{ $json.significantChanges.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-approval-needed",
        "name": "Significant Changes?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1500,
          400
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.REVENUE_SLACK_CHANNEL }}",
          "text": "=ðŸ·ï¸ *Dynamic Pricing Alert - Significant Changes Detected*\n\n*{{ $json.significantChanges.length }} dates require review:*\n\n{{ $json.significantChanges.slice(0, 10).map(c => `ðŸ“… *${c.date}*\n   Multiplier: ${c.multiplier}x | Min LOS: ${c.minLOS} nights\n   Reason: ${c.reasoning || 'High demand signals'}\n   Events: ${c.events?.map(e => e.name).join(', ') || 'None'}`).join('\\n\\n') }}\n\n{{ $json.significantChanges.length > 10 ? `_...and ${$json.significantChanges.length - 10} more dates_` : '' }}\n\nReact with âœ… to approve all, or reply with specific dates to exclude.",
          "otherOptions": {
            "includeLinkToWorkflow": false
          }
        },
        "id": "notify-revenue-team",
        "name": "Notify Revenue Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1750,
          300
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "formTitle": "Rate Change Approval",
          "formDescription": "Review and approve significant rate changes",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Approval Decision",
                "fieldType": "dropdown",
                "fieldOptions": {
                  "values": [
                    {
                      "option": "Approve All"
                    },
                    {
                      "option": "Approve with Modifications"
                    },
                    {
                      "option": "Reject All"
                    }
                  ]
                },
                "requiredField": true
              },
              {
                "fieldLabel": "Excluded Dates (comma-separated)",
                "fieldType": "text",
                "placeholder": "2026-03-15, 2026-03-16"
              },
              {
                "fieldLabel": "Maximum Multiplier Override",
                "fieldType": "number",
                "placeholder": "1.35"
              },
              {
                "fieldLabel": "Notes",
                "fieldType": "textarea"
              }
            ]
          },
          "options": {
            "respondWithData": true
          }
        },
        "id": "approval-form",
        "name": "Manager Approval Form",
        "type": "n8n-nodes-base.formTrigger",
        "typeVersion": 2.2,
        "position": [
          1750,
          500
        ],
        "webhookId": "rate-approval-form"
      },
      {
        "parameters": {
          "jsCode": "// Process approval and filter rate updates\nconst originalData = $('Transform to PMS Format').first().json;\nconst approval = $input.first().json;\n\nlet rateUpdates = originalData.rateUpdates;\nconst decision = approval['Approval Decision'];\n\nif (decision === 'Reject All') {\n  return [{ json: { action: 'rejected', message: 'All rate changes rejected by manager' } }];\n}\n\n// Filter excluded dates\nif (approval['Excluded Dates (comma-separated)']) {\n  const excludedDates = approval['Excluded Dates (comma-separated)']\n    .split(',')\n    .map(d => d.trim());\n  rateUpdates = rateUpdates.filter(r => !excludedDates.includes(r.date));\n}\n\n// Apply multiplier cap if specified\nif (approval['Maximum Multiplier Override']) {\n  const maxMultiplier = parseFloat(approval['Maximum Multiplier Override']);\n  rateUpdates = rateUpdates.map(r => ({\n    ...r,\n    multiplier: Math.min(r.multiplier, maxMultiplier),\n    rates: Object.fromEntries(\n      Object.entries(r.rates).map(([type, rates]) => [\n        type,\n        Object.fromEntries(\n          Object.entries(rates).map(([channel, rate]) => [\n            channel,\n            Math.round(rate * Math.min(1, maxMultiplier / r.multiplier))\n          ])\n        )\n      ])\n    )\n  }));\n}\n\nreturn [{ \n  json: { \n    action: 'approved',\n    rateUpdates,\n    approvalNotes: approval.Notes,\n    approvedCount: rateUpdates.length\n  } \n}];"
        },
        "id": "process-approval",
        "name": "Process Approval",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2000,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.PMS_API_URL }}/rates/bulk-update",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ updates: $json.rateUpdates }) }}",
          "options": {
            "timeout": 60000
          }
        },
        "id": "update-pms-rates",
        "name": "Update PMS Rates",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2250,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CHANNEL_MANAGER_URL }}/rates/sync",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ property_id: $vars.PROPERTY_ID, rate_updates: $json.rateUpdates }) }}",
          "options": {}
        },
        "id": "sync-channel-manager",
        "name": "Sync Channel Manager",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2500,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "channel-manager-api",
            "name": "Channel Manager API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.PRICING_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Rate Updates",
            "mode": "list",
            "cachedResultName": "Rate Updates"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Timestamp": "={{ $now.toISO() }}",
              "Dates Updated": "={{ $('Transform to PMS Format').first().json.totalDates }}",
              "Significant Changes": "={{ $('Transform to PMS Format').first().json.significantChanges.length }}",
              "Approval Status": "={{ $json.action || 'auto-approved' }}",
              "PMS Update Status": "={{ $('Update PMS Rates').first().json.status || 'success' }}",
              "Channel Sync Status": "={{ $json.status || 'success' }}",
              "Average Multiplier": "={{ ($('Transform to PMS Format').first().json.rateUpdates.reduce((a, b) => a + b.multiplier, 0) / $('Transform to PMS Format').first().json.totalDates).toFixed(2) }}"
            }
          },
          "options": {}
        },
        "id": "log-to-sheets",
        "name": "Log Rate Updates",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          2750,
          400
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.REVENUE_SLACK_CHANNEL }}",
          "text": "=âœ… *Dynamic Pricing Update Complete*\n\nðŸ“Š *Summary:*\nâ€¢ Dates Updated: {{ $('Transform to PMS Format').first().json.totalDates }}\nâ€¢ Significant Changes: {{ $('Transform to PMS Format').first().json.significantChanges.length }}\nâ€¢ Avg Multiplier: {{ ($('Transform to PMS Format').first().json.rateUpdates.reduce((a, b) => a + b.multiplier, 0) / $('Transform to PMS Format').first().json.totalDates).toFixed(2) }}x\n\nðŸ”„ *Sync Status:*\nâ€¢ PMS: {{ $('Update PMS Rates').first().json.status || 'Success' }}\nâ€¢ Channel Manager: {{ $json.status || 'Success' }}\n\n_Next update in 2 hours_",
          "otherOptions": {}
        },
        "id": "notify-complete",
        "name": "Notify Completion",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          3000,
          400
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "auto-approve",
                "leftValue": "={{ $json.significantChanges.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "auto-approve-check",
        "name": "Auto-Approve Minor?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1500,
          600
        ]
      }
    ],
    "connections": {
      "Every 2 Hours": {
        "main": [
          [
            {
              "node": "Fetch Current Inventory",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Booking Pace",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Competitor Rates",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Local Events",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Weather Forecast",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Current Inventory": {
        "main": [
          [
            {
              "node": "Aggregate Market Signals",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Booking Pace": {
        "main": [
          [
            {
              "node": "Aggregate Market Signals",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Competitor Rates": {
        "main": [
          [
            {
              "node": "Aggregate Market Signals",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Local Events": {
        "main": [
          [
            {
              "node": "Aggregate Market Signals",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Weather Forecast": {
        "main": [
          [
            {
              "node": "Aggregate Market Signals",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Market Signals": {
        "main": [
          [
            {
              "node": "AI Pricing Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Pricing Analysis": {
        "main": [
          [
            {
              "node": "Transform to PMS Format",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transform to PMS Format": {
        "main": [
          [
            {
              "node": "Significant Changes?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Auto-Approve Minor?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Significant Changes?": {
        "main": [
          [
            {
              "node": "Notify Revenue Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Manager Approval Form",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Auto-Approve Minor?": {
        "main": [
          [
            {
              "node": "Update PMS Rates",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Manager Approval Form": {
        "main": [
          [
            {
              "node": "Process Approval",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Approval": {
        "main": [
          [
            {
              "node": "Update PMS Rates",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update PMS Rates": {
        "main": [
          [
            {
              "node": "Sync Channel Manager",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sync Channel Manager": {
        "main": [
          [
            {
              "node": "Log Rate Updates",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Rate Updates": {
        "main": [
          [
            {
              "node": "Notify Completion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "hospitality",
        "name": "hospitality"
      },
      {
        "id": "revenue-management",
        "name": "revenue-management"
      },
      {
        "id": "ai-pricing",
        "name": "ai-pricing"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 1,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Email Marketing Automation v1",
    "nodes": [
      {
        "parameters": {},
        "id": "webhook-new-lead",
        "name": "New Lead Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          300
        ],
        "webhookId": "email-marketing-trigger"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 */4 * * *"
              }
            ]
          }
        },
        "id": "behavioral-check",
        "name": "Behavioral Trigger Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          500
        ]
      },
      {
        "parameters": {
          "operation": "search",
          "base": {
            "__rl": true,
            "value": "={{ $env.AIRTABLE_EMAIL_BASE_ID }}",
            "mode": "id"
          },
          "table": {
            "__rl": true,
            "value": "Contacts",
            "mode": "list"
          },
          "filterByFormula": "AND({email_status} = 'active', {last_email_sent} < DATEADD(NOW(), -3, 'days'))",
          "options": {
            "fields": [
              "email",
              "first_name",
              "last_name",
              "company",
              "lead_score",
              "last_activity",
              "journey_stage",
              "interests",
              "engagement_score"
            ]
          }
        },
        "id": "get-active-contacts",
        "name": "Get Active Contacts",
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "// Lead Segmentation & Journey Mapping\nconst lead = $input.first().json;\n\n// Define journey stages and their email sequences\nconst journeyMap = {\n  'new_lead': {\n    stage: 1,\n    sequences: ['welcome', 'value_prop', 'case_study'],\n    delayDays: [0, 2, 5]\n  },\n  'engaged': {\n    stage: 2,\n    sequences: ['deep_dive', 'comparison', 'demo_invite'],\n    delayDays: [0, 3, 7]\n  },\n  'considering': {\n    stage: 3,\n    sequences: ['social_proof', 'roi_calculator', 'consultation'],\n    delayDays: [0, 2, 4]\n  },\n  'trial': {\n    stage: 4,\n    sequences: ['onboarding', 'feature_tips', 'upgrade_offer'],\n    delayDays: [0, 3, 7]\n  },\n  'customer': {\n    stage: 5,\n    sequences: ['success_check', 'referral_ask', 'upsell'],\n    delayDays: [30, 60, 90]\n  },\n  'churned': {\n    stage: 0,\n    sequences: ['win_back_1', 'win_back_2', 'final_offer'],\n    delayDays: [0, 7, 14]\n  }\n};\n\n// Calculate engagement tier\nfunction getEngagementTier(score) {\n  if (score >= 80) return 'highly_engaged';\n  if (score >= 50) return 'moderately_engaged';\n  if (score >= 20) return 'low_engagement';\n  return 'cold';\n}\n\n// Determine optimal send time based on past behavior\nfunction getOptimalSendTime(timezone, pastOpens) {\n  // Default optimal times by engagement\n  const defaultTimes = {\n    'highly_engaged': '09:00',\n    'moderately_engaged': '10:30',\n    'low_engagement': '14:00',\n    'cold': '11:00'\n  };\n  \n  // Would analyze pastOpens to find best time\n  return defaultTimes[getEngagementTier(pastOpens?.engagementScore || 50)];\n}\n\nconst journeyStage = lead.journey_stage || 'new_lead';\nconst journey = journeyMap[journeyStage];\nconst engagementTier = getEngagementTier(lead.engagement_score || 0);\n\nreturn [{\n  json: {\n    ...lead,\n    segmentation: {\n      journeyStage,\n      journeyInfo: journey,\n      engagementTier,\n      nextEmailSequence: journey.sequences[0],\n      optimalSendTime: getOptimalSendTime(lead.timezone, lead),\n      personalizationLevel: engagementTier === 'highly_engaged' ? 'high' : 'standard'\n    }\n  }\n}];"
        },
        "id": "segment-leads",
        "name": "Segment Leads",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an expert email copywriter specializing in SaaS B2B marketing. Generate personalized email content that:\n1. Uses the recipient's name and company naturally\n2. References their specific interests or pain points\n3. Includes a clear, compelling CTA\n4. Has an attention-grabbing subject line\n5. Is concise (under 200 words for body)\n\nReturn JSON format:\n{\n  \"subject\": \"subject line (under 60 chars, personalized)\",\n  \"preheader\": \"preview text (under 100 chars)\",\n  \"greeting\": \"personalized greeting\",\n  \"body\": \"main email content with {{first_name}} placeholders\",\n  \"cta_text\": \"button text\",\n  \"cta_url\": \"relevant URL\",\n  \"ps_line\": \"optional PS line for extra engagement\",\n  \"tone\": \"professional|friendly|urgent\",\n  \"abVariant\": \"A\"\n}"
              },
              {
                "role": "user",
                "content": "=Generate email for:\n\nRecipient: {{ $json.first_name }} {{ $json.last_name }}\nCompany: {{ $json.company }}\nJourney Stage: {{ $json.segmentation.journeyStage }}\nEmail Sequence: {{ $json.segmentation.nextEmailSequence }}\nEngagement Tier: {{ $json.segmentation.engagementTier }}\nInterests: {{ $json.interests || 'not specified' }}\n\nPersonalization Level: {{ $json.segmentation.personalizationLevel }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-email-generator",
        "name": "AI Email Generator",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Generate an A/B variant of the given email. Create a meaningfully different version that tests a different:\n- Subject line approach (curiosity vs benefit vs urgency)\n- CTA style (action-oriented vs benefit-oriented)\n- Tone (more casual vs more professional)\n\nReturn the same JSON structure but with variant 'B'."
              },
              {
                "role": "user",
                "content": "=Create B variant for this email:\n{{ JSON.stringify($json) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.8
          }
        },
        "id": "generate-ab-variant",
        "name": "Generate A/B Variant",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          700,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "// A/B Test Assignment & Email Preparation\nconst leadData = $('Segment Leads').first().json;\nconst emailA = $('AI Email Generator').first().json;\nconst emailB = $('Generate A/B Variant').first().json;\n\n// Assign A/B variant (50/50 split)\nconst variant = Math.random() < 0.5 ? 'A' : 'B';\nconst selectedEmail = variant === 'A' ? emailA : emailB;\n\n// Replace placeholders\nconst personalizedBody = selectedEmail.body\n  .replace(/\\{\\{first_name\\}\\}/g, leadData.first_name)\n  .replace(/\\{\\{company\\}\\}/g, leadData.company);\n\n// Generate tracking pixels and links\nconst trackingId = `${leadData.email}-${Date.now()}`;\nconst baseTrackingUrl = `https://track.yourdomain.com`;\n\nreturn [{\n  json: {\n    to: leadData.email,\n    from: {\n      email: 'hello@yourdomain.com',\n      name: 'Your Company'\n    },\n    subject: selectedEmail.subject,\n    preheader: selectedEmail.preheader,\n    html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <p>${selectedEmail.greeting}</p>\n        <div>${personalizedBody.replace(/\\n/g, '<br>')}</div>\n        <div style=\"text-align: center; margin: 30px 0;\">\n          <a href=\"${selectedEmail.cta_url}?utm_campaign=email&utm_content=${variant}&track_id=${trackingId}\" \n             style=\"background-color: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; display: inline-block;\">\n            ${selectedEmail.cta_text}\n          </a>\n        </div>\n        ${selectedEmail.ps_line ? `<p style=\"font-style: italic;\">P.S. ${selectedEmail.ps_line}</p>` : ''}\n        <img src=\"${baseTrackingUrl}/open/${trackingId}\" width=\"1\" height=\"1\" />\n      </div>\n    `,\n    tracking: {\n      id: trackingId,\n      variant,\n      journeyStage: leadData.segmentation.journeyStage,\n      sequence: leadData.segmentation.nextEmailSequence,\n      sentAt: new Date().toISOString()\n    },\n    metadata: {\n      leadEmail: leadData.email,\n      leadScore: leadData.lead_score,\n      engagementTier: leadData.segmentation.engagementTier\n    }\n  }\n}];"
        },
        "id": "prepare-email",
        "name": "Prepare Email for Send",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          950,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.resend.com/emails",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.RESEND_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"from\": \"{{ $json.from.name }} <{{ $json.from.email }}>\",\n  \"to\": [\"{{ $json.to }}\"],\n  \"subject\": \"{{ $json.subject }}\",\n  \"html\": {{ JSON.stringify($json.html) }},\n  \"headers\": {\n    \"X-Entity-Ref-ID\": \"{{ $json.tracking.id }}\"\n  },\n  \"tags\": [\n    { \"name\": \"variant\", \"value\": \"{{ $json.tracking.variant }}\" },\n    { \"name\": \"journey_stage\", \"value\": \"{{ $json.tracking.journeyStage }}\" },\n    { \"name\": \"sequence\", \"value\": \"{{ $json.tracking.sequence }}\" }\n  ]\n}",
          "options": {}
        },
        "id": "send-via-resend",
        "name": "Send via Resend",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1200,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.customer.io/v1/send/email",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpBasicAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"transactional_message_id\": \"{{ $json.tracking.sequence }}\",\n  \"to\": \"{{ $json.to }}\",\n  \"identifiers\": {\n    \"email\": \"{{ $json.to }}\"\n  },\n  \"message_data\": {\n    \"subject\": \"{{ $json.subject }}\",\n    \"preheader\": \"{{ $json.preheader }}\",\n    \"body\": {{ JSON.stringify($json.html) }},\n    \"variant\": \"{{ $json.tracking.variant }}\",\n    \"cta_url\": \"{{ $json.cta_url }}\"\n  },\n  \"disable_message_retention\": false,\n  \"send_to_unsubscribed\": false\n}",
          "options": {}
        },
        "id": "send-via-customerio",
        "name": "Send via Customer.io",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1200,
          500
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "base": {
            "__rl": true,
            "value": "={{ $env.AIRTABLE_EMAIL_BASE_ID }}",
            "mode": "id"
          },
          "table": {
            "__rl": true,
            "value": "Contacts",
            "mode": "list"
          },
          "id": "={{ $json.metadata.recordId }}",
          "fields": {
            "last_email_sent": "={{ $json.tracking.sentAt }}",
            "last_email_sequence": "={{ $json.tracking.sequence }}",
            "last_ab_variant": "={{ $json.tracking.variant }}",
            "total_emails_sent": "={{ ($json.metadata.totalEmailsSent || 0) + 1 }}"
          }
        },
        "id": "update-contact-record",
        "name": "Update Contact Record",
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          1450,
          400
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.EMAIL_ANALYTICS_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Email Log",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ $json.tracking.sentAt }}",
              "recipient": "={{ $json.to }}",
              "subject": "={{ $json.subject }}",
              "variant": "={{ $json.tracking.variant }}",
              "journey_stage": "={{ $json.tracking.journeyStage }}",
              "sequence": "={{ $json.tracking.sequence }}",
              "tracking_id": "={{ $json.tracking.id }}",
              "lead_score": "={{ $json.metadata.leadScore }}",
              "engagement_tier": "={{ $json.metadata.engagementTier }}"
            }
          }
        },
        "id": "log-email-analytics",
        "name": "Log Email Analytics",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1450,
          600
        ]
      },
      {
        "parameters": {},
        "id": "webhook-email-events",
        "name": "Email Event Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          800
        ],
        "webhookId": "email-events-hook"
      },
      {
        "parameters": {
          "jsCode": "// Process email events (opens, clicks, bounces, unsubscribes)\nconst event = $input.first().json;\n\nconst eventType = event.type || event.event;\nconst trackingId = event.data?.tags?.find(t => t.name === 'tracking_id')?.value || event.tracking_id;\n\nconst eventData = {\n  eventType,\n  trackingId,\n  email: event.data?.email || event.email,\n  timestamp: event.created_at || new Date().toISOString(),\n  metadata: {}\n};\n\nswitch (eventType) {\n  case 'email.opened':\n  case 'opened':\n    eventData.metadata.openCount = (event.data?.open_count || 1);\n    eventData.metadata.device = event.data?.device_type || 'unknown';\n    eventData.engagementDelta = 5;\n    break;\n    \n  case 'email.clicked':\n  case 'clicked':\n    eventData.metadata.link = event.data?.link || event.link;\n    eventData.engagementDelta = 10;\n    break;\n    \n  case 'email.bounced':\n  case 'bounced':\n    eventData.metadata.bounceType = event.data?.bounce_type || 'unknown';\n    eventData.shouldUpdateStatus = true;\n    eventData.newStatus = 'bounced';\n    break;\n    \n  case 'email.complained':\n  case 'unsubscribed':\n    eventData.shouldUpdateStatus = true;\n    eventData.newStatus = 'unsubscribed';\n    break;\n}\n\nreturn [{ json: eventData }];"
        },
        "id": "process-email-events",
        "name": "Process Email Events",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          800
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "engagement-event",
                "leftValue": "={{ $json.engagementDelta }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ]
          }
        },
        "id": "check-engagement-event",
        "name": "Is Engagement Event?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          700,
          800
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.hubspot.com/crm/v3/objects/contacts/{{ $json.email }}/timeline",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "hubSpotApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"eventTemplateId\": \"email_engagement\",\n  \"tokens\": {\n    \"eventType\": \"{{ $json.eventType }}\",\n    \"trackingId\": \"{{ $json.trackingId }}\",\n    \"timestamp\": \"{{ $json.timestamp }}\"\n  }\n}",
          "options": {}
        },
        "id": "update-hubspot-engagement",
        "name": "Update HubSpot Engagement",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          950,
          750
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "base": {
            "__rl": true,
            "value": "={{ $env.AIRTABLE_EMAIL_BASE_ID }}",
            "mode": "id"
          },
          "table": {
            "__rl": true,
            "value": "Contacts",
            "mode": "list"
          },
          "filterByFormula": "{email} = '{{ $json.email }}'",
          "fields": {
            "engagement_score": "={{ ($json.currentEngagement || 0) + $json.engagementDelta }}",
            "last_engagement": "={{ $json.timestamp }}"
          }
        },
        "id": "update-engagement-score",
        "name": "Update Engagement Score",
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          950,
          900
        ]
      },
      {
        "parameters": {
          "jsCode": "// Optimal Send Time Calculator\n// Analyzes past email engagement to find best send times\n\nconst contacts = $input.all();\nconst sendTimeRecommendations = [];\n\ncontacts.forEach(contact => {\n  const data = contact.json;\n  \n  // Default time slots\n  const timeSlots = [\n    { slot: '08:00-10:00', score: 0 },\n    { slot: '10:00-12:00', score: 0 },\n    { slot: '12:00-14:00', score: 0 },\n    { slot: '14:00-16:00', score: 0 },\n    { slot: '16:00-18:00', score: 0 }\n  ];\n  \n  // Analyze past engagement times (would use real data)\n  const engagementHistory = data.engagement_history || [];\n  engagementHistory.forEach(engagement => {\n    const hour = new Date(engagement.timestamp).getHours();\n    if (hour >= 8 && hour < 10) timeSlots[0].score += engagement.weight || 1;\n    else if (hour >= 10 && hour < 12) timeSlots[1].score += engagement.weight || 1;\n    else if (hour >= 12 && hour < 14) timeSlots[2].score += engagement.weight || 1;\n    else if (hour >= 14 && hour < 16) timeSlots[3].score += engagement.weight || 1;\n    else if (hour >= 16 && hour < 18) timeSlots[4].score += engagement.weight || 1;\n  });\n  \n  // Find optimal slot\n  const optimalSlot = timeSlots.reduce((best, current) => \n    current.score > best.score ? current : best, timeSlots[1]);\n  \n  sendTimeRecommendations.push({\n    email: data.email,\n    optimalSendTime: optimalSlot.slot,\n    confidence: optimalSlot.score > 5 ? 'high' : optimalSlot.score > 2 ? 'medium' : 'low',\n    timezone: data.timezone || 'UTC'\n  });\n});\n\nreturn sendTimeRecommendations.map(rec => ({ json: rec }));"
        },
        "id": "calculate-send-times",
        "name": "Calculate Optimal Send Times",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1200,
          800
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 0 * * 0"
              }
            ]
          }
        },
        "id": "weekly-ab-analysis",
        "name": "Weekly A/B Analysis",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          1100
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.EMAIL_ANALYTICS_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Email Log",
            "mode": "list"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-ab-data",
        "name": "Get A/B Test Data",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          450,
          1100
        ]
      },
      {
        "parameters": {
          "jsCode": "// A/B Test Statistical Analysis\nconst emailData = $input.all();\n\n// Group by variant\nconst variantA = { sent: 0, opened: 0, clicked: 0 };\nconst variantB = { sent: 0, opened: 0, clicked: 0 };\n\nemailData.forEach(row => {\n  const data = row.json;\n  const variant = data.variant;\n  \n  if (variant === 'A') {\n    variantA.sent++;\n    if (data.opened) variantA.opened++;\n    if (data.clicked) variantA.clicked++;\n  } else if (variant === 'B') {\n    variantB.sent++;\n    if (data.opened) variantB.opened++;\n    if (data.clicked) variantB.clicked++;\n  }\n});\n\n// Calculate rates\nvariantA.openRate = variantA.sent > 0 ? (variantA.opened / variantA.sent * 100).toFixed(2) : 0;\nvariantA.clickRate = variantA.sent > 0 ? (variantA.clicked / variantA.sent * 100).toFixed(2) : 0;\nvariantB.openRate = variantB.sent > 0 ? (variantB.opened / variantB.sent * 100).toFixed(2) : 0;\nvariantB.clickRate = variantB.sent > 0 ? (variantB.clicked / variantB.sent * 100).toFixed(2) : 0;\n\n// Statistical significance calculation (simplified chi-square)\nfunction calculateSignificance(a, b) {\n  const total = a.sent + b.sent;\n  if (total < 100) return { significant: false, confidence: 'insufficient_data' };\n  \n  const pooledRate = (a.opened + b.opened) / total;\n  const se = Math.sqrt(pooledRate * (1 - pooledRate) * (1/a.sent + 1/b.sent));\n  const z = Math.abs((a.openRate/100 - b.openRate/100) / se);\n  \n  if (z > 2.576) return { significant: true, confidence: '99%' };\n  if (z > 1.96) return { significant: true, confidence: '95%' };\n  if (z > 1.645) return { significant: true, confidence: '90%' };\n  return { significant: false, confidence: 'not_significant' };\n}\n\nconst significance = calculateSignificance(variantA, variantB);\nconst winner = parseFloat(variantA.openRate) > parseFloat(variantB.openRate) ? 'A' : 'B';\n\nreturn [{\n  json: {\n    variantA,\n    variantB,\n    analysis: {\n      winner: significance.significant ? winner : 'no_winner',\n      significance: significance.confidence,\n      openRateDiff: Math.abs(variantA.openRate - variantB.openRate).toFixed(2) + '%',\n      clickRateDiff: Math.abs(variantA.clickRate - variantB.clickRate).toFixed(2) + '%',\n      recommendation: significance.significant \n        ? `Use variant ${winner} - ${significance.confidence} confident`\n        : 'Continue testing - not enough data for significance'\n    },\n    generatedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "analyze-ab-results",
        "name": "Analyze A/B Results",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          700,
          1100
        ]
      },
      {
        "parameters": {
          "channel": "#email-marketing",
          "text": "=ðŸ“§ *Weekly Email A/B Test Report*\n\n*Variant A:*\nâ€¢ Sent: {{ $json.variantA.sent }}\nâ€¢ Open Rate: {{ $json.variantA.openRate }}%\nâ€¢ Click Rate: {{ $json.variantA.clickRate }}%\n\n*Variant B:*\nâ€¢ Sent: {{ $json.variantB.sent }}\nâ€¢ Open Rate: {{ $json.variantB.openRate }}%\nâ€¢ Click Rate: {{ $json.variantB.clickRate }}%\n\n*Analysis:*\nâ€¢ Winner: {{ $json.analysis.winner }}\nâ€¢ Significance: {{ $json.analysis.significance }}\nâ€¢ Open Rate Difference: {{ $json.analysis.openRateDiff }}\n\n*Recommendation:*\n{{ $json.analysis.recommendation }}",
          "otherOptions": {}
        },
        "id": "slack-ab-report",
        "name": "Slack A/B Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          950,
          1100
        ]
      }
    ],
    "connections": {
      "New Lead Webhook": {
        "main": [
          [
            {
              "node": "Segment Leads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Behavioral Trigger Check": {
        "main": [
          [
            {
              "node": "Get Active Contacts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Active Contacts": {
        "main": [
          [
            {
              "node": "Segment Leads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Segment Leads": {
        "main": [
          [
            {
              "node": "AI Email Generator",
              "type": "main",
              "index": 0
            },
            {
              "node": "Generate A/B Variant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Email Generator": {
        "main": [
          [
            {
              "node": "Prepare Email for Send",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate A/B Variant": {
        "main": [
          [
            {
              "node": "Prepare Email for Send",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Email for Send": {
        "main": [
          [
            {
              "node": "Send via Resend",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send via Customer.io",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send via Resend": {
        "main": [
          [
            {
              "node": "Update Contact Record",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Email Analytics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Email Event Webhook": {
        "main": [
          [
            {
              "node": "Process Email Events",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Email Events": {
        "main": [
          [
            {
              "node": "Is Engagement Event?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Engagement Event?": {
        "main": [
          [
            {
              "node": "Update HubSpot Engagement",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Engagement Score",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Calculate Optimal Send Times",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Weekly A/B Analysis": {
        "main": [
          [
            {
              "node": "Get A/B Test Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get A/B Test Data": {
        "main": [
          [
            {
              "node": "Analyze A/B Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze A/B Results": {
        "main": [
          [
            {
              "node": "Slack A/B Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-saas-email-marketing"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 4,
    "tags": [
      {
        "name": "Email",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Marketing",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "AI",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "A/B Testing",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain Guest Communication Journey v1",
    "nodes": [
      {
        "parameters": {},
        "id": "webhook-booking",
        "name": "New Booking Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          300
        ],
        "webhookId": "guest-booking-trigger"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 * * *"
              }
            ]
          }
        },
        "id": "daily-journey-check",
        "name": "Daily Journey Processor",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          500
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.cloudbeds.com/api/v1.1/getReservations",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "status",
                "value": "confirmed,checked_in"
              },
              {
                "name": "propertyID",
                "value": "={{ $env.CLOUDBEDS_PROPERTY_ID }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-pms-reservations",
        "name": "Fetch PMS Reservations",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "// Guest Journey Stage Calculator\n// Determines which communication to send based on reservation timeline\n\nconst reservations = $input.all().flatMap(i => i.json.data || [i.json]);\nconst today = new Date();\ntoday.setHours(0, 0, 0, 0);\n\nconst journeyActions = [];\n\nreservations.forEach(reservation => {\n  const checkIn = new Date(reservation.checkInDate || reservation.arrival_date);\n  const checkOut = new Date(reservation.checkOutDate || reservation.departure_date);\n  checkIn.setHours(0, 0, 0, 0);\n  checkOut.setHours(0, 0, 0, 0);\n  \n  const daysUntilCheckIn = Math.ceil((checkIn - today) / (1000 * 60 * 60 * 24));\n  const daysUntilCheckOut = Math.ceil((checkOut - today) / (1000 * 60 * 60 * 24));\n  const daysSinceCheckOut = Math.ceil((today - checkOut) / (1000 * 60 * 60 * 24));\n  const stayLength = Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24));\n  const currentDayOfStay = Math.ceil((today - checkIn) / (1000 * 60 * 60 * 24)) + 1;\n  \n  const guest = {\n    id: reservation.reservationID || reservation.id,\n    firstName: reservation.guestFirstName || reservation.guest?.first_name,\n    lastName: reservation.guestLastName || reservation.guest?.last_name,\n    email: reservation.guestEmail || reservation.guest?.email,\n    phone: reservation.guestPhone || reservation.guest?.phone,\n    roomType: reservation.roomTypeName || reservation.room_type,\n    roomNumber: reservation.roomNumber || reservation.room,\n    checkIn: checkIn.toISOString().split('T')[0],\n    checkOut: checkOut.toISOString().split('T')[0],\n    totalAmount: reservation.total || reservation.grandTotal,\n    specialRequests: reservation.specialRequests || reservation.notes,\n    language: reservation.language || 'en',\n    source: reservation.source || 'direct'\n  };\n  \n  // Journey Stage Logic\n  let action = null;\n  \n  // Pre-arrival: 7 days before\n  if (daysUntilCheckIn === 7) {\n    action = {\n      stage: 'pre_arrival_7days',\n      type: 'email',\n      template: 'pre_arrival_welcome',\n      subject: `Your stay at ${$env.HOTEL_NAME} is coming up!`,\n      includeUpsells: true,\n      upsellTypes: ['room_upgrade', 'airport_transfer', 'early_checkin']\n    };\n  }\n  // Pre-arrival: 3 days before\n  else if (daysUntilCheckIn === 3) {\n    action = {\n      stage: 'pre_arrival_3days',\n      type: 'email',\n      template: 'pre_arrival_details',\n      subject: `Getting ready for your arrival - Important information`,\n      includeUpsells: true,\n      upsellTypes: ['spa_package', 'dining_reservation', 'late_checkout']\n    };\n  }\n  // Day before: Online check-in invitation\n  else if (daysUntilCheckIn === 1) {\n    action = {\n      stage: 'day_before',\n      type: 'both', // email + SMS\n      template: 'online_checkin',\n      subject: `Check in online for faster arrival tomorrow!`,\n      smsText: `Hi ${guest.firstName}! Check in online for your stay tomorrow: [LINK]. Reply HELP for assistance.`\n    };\n  }\n  // Check-in day\n  else if (daysUntilCheckIn === 0 && currentDayOfStay === 1) {\n    action = {\n      stage: 'checkin_day',\n      type: 'sms',\n      template: 'welcome_arrival',\n      smsText: `Welcome to ${$env.HOTEL_NAME}, ${guest.firstName}! Your room ${guest.roomNumber} is ready. WiFi: ${$env.HOTEL_WIFI}. Need anything? Reply to this message!`\n    };\n  }\n  // Mid-stay satisfaction check (day 2 for stays 3+ nights)\n  else if (currentDayOfStay === 2 && stayLength >= 3 && daysUntilCheckOut > 0) {\n    action = {\n      stage: 'mid_stay_check',\n      type: 'sms',\n      template: 'satisfaction_check',\n      smsText: `Hi ${guest.firstName}, how is your stay so far? Rate 1-5 or reply with any feedback. We want to make sure everything is perfect!`\n    };\n  }\n  // Check-out day\n  else if (daysUntilCheckOut === 0) {\n    action = {\n      stage: 'checkout_day',\n      type: 'email',\n      template: 'checkout_thankyou',\n      subject: `Thank you for staying with us, ${guest.firstName}!`,\n      includeReviewRequest: false // Wait 1 day\n    };\n  }\n  // Post-stay: 1 day after (review request)\n  else if (daysSinceCheckOut === 1) {\n    action = {\n      stage: 'post_stay_review',\n      type: 'email',\n      template: 'review_request',\n      subject: `${guest.firstName}, how was your stay? We'd love your feedback!`,\n      reviewLinks: {\n        google: `${$env.GOOGLE_REVIEW_LINK}`,\n        tripadvisor: `${$env.TRIPADVISOR_LINK}`,\n        booking: `${$env.BOOKING_REVIEW_LINK}`\n      }\n    };\n  }\n  // Post-stay: 7 days after (loyalty offer)\n  else if (daysSinceCheckOut === 7) {\n    action = {\n      stage: 'post_stay_loyalty',\n      type: 'email',\n      template: 'loyalty_offer',\n      subject: `Come back soon! Exclusive 15% off your next stay`,\n      discountCode: `RETURN${guest.id.substring(0, 6).toUpperCase()}`\n    };\n  }\n  \n  if (action) {\n    journeyActions.push({\n      guest,\n      action,\n      processedAt: new Date().toISOString()\n    });\n  }\n});\n\nreturn journeyActions.map(item => ({ json: item }));"
        },
        "id": "journey-calculator",
        "name": "Journey Stage Calculator",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          700,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a luxury hotel concierge AI. Generate warm, personalized guest communications that feel genuine and helpful, not robotic.\n\nGuidelines:\n- Use the guest's first name naturally\n- Reference their specific room type and dates\n- Include relevant upsell suggestions seamlessly\n- Match tone to the journey stage (excited for pre-arrival, warm for mid-stay, grateful for post-stay)\n- Keep emails under 200 words\n- Include clear CTAs\n\nReturn JSON:\n{\n  \"subject\": \"personalized subject line\",\n  \"preheader\": \"email preview text\",\n  \"greeting\": \"personalized greeting\",\n  \"body\": \"main message with {{placeholders}} for dynamic content\",\n  \"upsellSection\": \"optional upsell content if applicable\",\n  \"cta\": {\"text\": \"button text\", \"url\": \"action URL\"},\n  \"closing\": \"warm closing\",\n  \"smsVersion\": \"condensed SMS version under 160 chars\"\n}"
              },
              {
                "role": "user",
                "content": "=Generate communication for:\n\nGuest: {{ $json.guest.firstName }} {{ $json.guest.lastName }}\nRoom Type: {{ $json.guest.roomType }}\nCheck-in: {{ $json.guest.checkIn }}\nCheck-out: {{ $json.guest.checkOut }}\nSpecial Requests: {{ $json.guest.specialRequests || 'None' }}\n\nJourney Stage: {{ $json.action.stage }}\nTemplate: {{ $json.action.template }}\nInclude Upsells: {{ $json.action.includeUpsells || false }}\nUpsell Types: {{ JSON.stringify($json.action.upsellTypes || []) }}\n\nHotel Name: {{ $env.HOTEL_NAME || 'Our Hotel' }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-message-generator",
        "name": "AI Message Generator",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          950,
          300
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "is-email",
                "leftValue": "={{ $json.action.type }}",
                "rightValue": "email",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "is-both",
                "leftValue": "={{ $json.action.type }}",
                "rightValue": "both",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          }
        },
        "id": "route-by-channel",
        "name": "Route by Channel",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          950,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.resend.com/emails",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.RESEND_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"from\": \"{{ $env.HOTEL_NAME }} <concierge@{{ $env.HOTEL_DOMAIN }}>\",\n  \"to\": [\"{{ $json.guest.email }}\"],\n  \"subject\": \"{{ $('AI Message Generator').first().json.subject }}\",\n  \"html\": \"<div style='font-family: Georgia, serif; max-width: 600px; margin: 0 auto; padding: 20px;'><h2 style='color: #2c3e50;'>{{ $('AI Message Generator').first().json.greeting }}</h2><div style='line-height: 1.8; color: #333;'>{{ $('AI Message Generator').first().json.body }}</div>{{ $('AI Message Generator').first().json.upsellSection ? '<div style=\\\"background: #f8f9fa; padding: 15px; margin: 20px 0; border-radius: 8px;\\\">' + $('AI Message Generator').first().json.upsellSection + '</div>' : '' }}<div style='text-align: center; margin: 30px 0;'><a href='{{ $('AI Message Generator').first().json.cta.url }}' style='background: #2c3e50; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px;'>{{ $('AI Message Generator').first().json.cta.text }}</a></div><p style='color: #666;'>{{ $('AI Message Generator').first().json.closing }}</p></div>\",\n  \"tags\": [\n    {\"name\": \"journey_stage\", \"value\": \"{{ $json.action.stage }}\"},\n    {\"name\": \"reservation_id\", \"value\": \"{{ $json.guest.id }}\"}\n  ]\n}",
          "options": {}
        },
        "id": "send-email",
        "name": "Send Email",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1200,
          350
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.twilio.com/2010-04-01/Accounts/{{ $env.TWILIO_ACCOUNT_SID }}/Messages.json",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpBasicAuth",
          "sendBody": true,
          "contentType": "form-urlencoded",
          "bodyParameters": {
            "parameters": [
              {
                "name": "To",
                "value": "={{ $json.guest.phone }}"
              },
              {
                "name": "From",
                "value": "={{ $env.TWILIO_PHONE_NUMBER }}"
              },
              {
                "name": "Body",
                "value": "={{ $('AI Message Generator').first().json.smsVersion || $json.action.smsText }}"
              }
            ]
          },
          "options": {}
        },
        "id": "send-sms",
        "name": "Send SMS",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1200,
          550
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://graph.facebook.com/v18.0/{{ $env.WHATSAPP_PHONE_ID }}/messages",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.guest.phone.replace(/[^0-9]/g, '') }}\",\n  \"type\": \"template\",\n  \"template\": {\n    \"name\": \"guest_{{ $json.action.stage }}\",\n    \"language\": {\"code\": \"{{ $json.guest.language || 'en' }}\"},\n    \"components\": [\n      {\n        \"type\": \"body\",\n        \"parameters\": [\n          {\"type\": \"text\", \"text\": \"{{ $json.guest.firstName }}\"},\n          {\"type\": \"text\", \"text\": \"{{ $json.guest.checkIn }}\"},\n          {\"type\": \"text\", \"text\": \"{{ $json.guest.roomType }}\"}\n        ]\n      }\n    ]\n  }\n}",
          "options": {}
        },
        "id": "send-whatsapp",
        "name": "Send WhatsApp",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1200,
          750
        ]
      },
      {
        "parameters": {
          "jsCode": "// Upsell Offer Processor\n// Tracks upsell responses and updates PMS\n\nconst messageData = $input.first().json;\nconst guest = messageData.guest || $('Journey Stage Calculator').first().json.guest;\nconst action = messageData.action || $('Journey Stage Calculator').first().json.action;\n\nconst upsellTracking = {\n  reservationId: guest.id,\n  guestEmail: guest.email,\n  journeyStage: action.stage,\n  offeredUpsells: action.upsellTypes || [],\n  sentAt: new Date().toISOString(),\n  channel: action.type,\n  status: 'sent',\n  potentialRevenue: calculatePotentialRevenue(action.upsellTypes || [])\n};\n\nfunction calculatePotentialRevenue(upsellTypes) {\n  const prices = {\n    'room_upgrade': 75,\n    'airport_transfer': 45,\n    'early_checkin': 30,\n    'late_checkout': 30,\n    'spa_package': 120,\n    'dining_reservation': 80,\n    'breakfast_package': 25\n  };\n  return upsellTypes.reduce((sum, type) => sum + (prices[type] || 0), 0);\n}\n\nreturn [{ json: upsellTracking }];"
        },
        "id": "upsell-tracker",
        "name": "Upsell Tracker",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1450,
          450
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.GUEST_JOURNEY_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Communications Log",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ $json.sentAt }}",
              "reservation_id": "={{ $json.reservationId }}",
              "guest_email": "={{ $json.guestEmail }}",
              "journey_stage": "={{ $json.journeyStage }}",
              "channel": "={{ $json.channel }}",
              "upsells_offered": "={{ $json.offeredUpsells.join(', ') }}",
              "potential_revenue": "={{ $json.potentialRevenue }}",
              "status": "={{ $json.status }}"
            }
          }
        },
        "id": "log-communication",
        "name": "Log Communication",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1700,
          450
        ]
      },
      {
        "parameters": {},
        "id": "webhook-guest-response",
        "name": "Guest Response Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          800
        ],
        "webhookId": "guest-response-handler"
      },
      {
        "parameters": {
          "jsCode": "// Guest Response Handler\n// Processes satisfaction scores and feedback\n\nconst response = $input.first().json;\n\nconst feedback = {\n  reservationId: response.reservation_id || response.reservationId,\n  responseType: response.type || 'feedback',\n  channel: response.channel || 'sms',\n  message: response.Body || response.message || response.text,\n  timestamp: new Date().toISOString()\n};\n\n// Parse satisfaction score if it's a rating\nconst messageText = feedback.message?.toString() || '';\nconst scoreMatch = messageText.match(/^[1-5]$/);\n\nif (scoreMatch) {\n  feedback.satisfactionScore = parseInt(scoreMatch[0]);\n  feedback.responseType = 'rating';\n  \n  if (feedback.satisfactionScore <= 2) {\n    feedback.alertLevel = 'urgent';\n    feedback.action = 'immediate_followup';\n  } else if (feedback.satisfactionScore <= 3) {\n    feedback.alertLevel = 'warning';\n    feedback.action = 'manager_review';\n  } else {\n    feedback.alertLevel = 'positive';\n    feedback.action = 'thank_guest';\n  }\n} else {\n  feedback.responseType = 'text_feedback';\n  feedback.action = 'analyze_sentiment';\n}\n\nreturn [{ json: feedback }];"
        },
        "id": "process-response",
        "name": "Process Guest Response",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          800
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "low-score",
                "leftValue": "={{ $json.alertLevel }}",
                "rightValue": "urgent",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ]
          }
        },
        "id": "check-alert-level",
        "name": "Needs Urgent Action?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          700,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#guest-alerts",
          "text": "=ðŸš¨ *URGENT: Low Guest Satisfaction Score*\n\n*Reservation:* {{ $json.reservationId }}\n*Score:* {{ $json.satisfactionScore }}/5 â­\n*Message:* {{ $json.message }}\n*Channel:* {{ $json.channel }}\n*Time:* {{ $json.timestamp }}\n\n*Required Action:* Immediate manager follow-up\n\n_Guest is currently on property. Please contact them within 15 minutes._",
          "otherOptions": {}
        },
        "id": "slack-urgent-alert",
        "name": "Slack Urgent Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          950,
          750
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"status\": \"success\",\n  \"message\": \"Communications scheduled for {{ $('Journey Stage Calculator').all().length }} guests\",\n  \"stages\": {{ JSON.stringify([...new Set($('Journey Stage Calculator').all().map(i => i.json.action.stage))]) }},\n  \"processedAt\": \"{{ new Date().toISOString() }}\"\n}"
        },
        "id": "webhook-response",
        "name": "Webhook Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1700,
          300
        ]
      }
    ],
    "connections": {
      "New Booking Webhook": {
        "main": [
          [
            {
              "node": "Fetch PMS Reservations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Journey Processor": {
        "main": [
          [
            {
              "node": "Fetch PMS Reservations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch PMS Reservations": {
        "main": [
          [
            {
              "node": "Journey Stage Calculator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Journey Stage Calculator": {
        "main": [
          [
            {
              "node": "AI Message Generator",
              "type": "main",
              "index": 0
            },
            {
              "node": "Route by Channel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Message Generator": {
        "main": [
          [
            {
              "node": "Send Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Channel": {
        "main": [
          [
            {
              "node": "Send Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send WhatsApp",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send SMS",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Email": {
        "main": [
          [
            {
              "node": "Upsell Tracker",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send SMS": {
        "main": [
          [
            {
              "node": "Upsell Tracker",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send WhatsApp": {
        "main": [
          [
            {
              "node": "Upsell Tracker",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upsell Tracker": {
        "main": [
          [
            {
              "node": "Log Communication",
              "type": "main",
              "index": 0
            },
            {
              "node": "Webhook Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Guest Response Webhook": {
        "main": [
          [
            {
              "node": "Process Guest Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Guest Response": {
        "main": [
          [
            {
              "node": "Needs Urgent Action?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Needs Urgent Action?": {
        "main": [
          [
            {
              "node": "Slack Urgent Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-hospitality-guest-journey"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 3,
    "tags": [
      {
        "name": "Hospitality",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Guest Experience",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Upselling",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "AI",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain Guest Feedback & Review v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "guest-feedback",
          "options": {}
        },
        "id": "feedback-webhook",
        "name": "Feedback Received",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "guest-feedback"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 10 * * *"
              }
            ]
          }
        },
        "id": "daily-survey",
        "name": "Daily Survey Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          600
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "*/30 * * * *"
              }
            ]
          }
        },
        "id": "review-monitor",
        "name": "Review Monitor (30min)",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          800
        ]
      },
      {
        "parameters": {
          "jsCode": "// Process incoming feedback\nconst feedback = $input.first().json.body;\n\nconst feedbackData = {\n  feedbackId: `FB-${Date.now().toString(36).toUpperCase()}`,\n  guestId: feedback.guestId || feedback.customerId,\n  guestName: feedback.guestName,\n  guestEmail: feedback.guestEmail,\n  guestPhone: feedback.guestPhone,\n  restaurantId: feedback.restaurantId || feedback.locationId,\n  visitDate: feedback.visitDate || new Date().toISOString().split('T')[0],\n  visitType: feedback.visitType || 'dine_in', // dine_in, takeout, delivery\n  source: feedback.source || 'email_survey',\n  ratings: {\n    overall: feedback.overallRating || feedback.rating,\n    food: feedback.foodRating,\n    service: feedback.serviceRating,\n    ambiance: feedback.ambianceRating,\n    value: feedback.valueRating,\n    cleanliness: feedback.cleanlinessRating\n  },\n  nps: feedback.nps,\n  comment: feedback.comment || feedback.feedback,\n  wouldRecommend: feedback.wouldRecommend,\n  serverName: feedback.serverName,\n  orderDetails: feedback.orderDetails,\n  receivedAt: new Date().toISOString()\n};\n\n// Calculate sentiment\nconst avgRating = Object.values(feedbackData.ratings).filter(Boolean).reduce((a, b) => a + b, 0) / \n  Object.values(feedbackData.ratings).filter(Boolean).length;\n\nfeedbackData.sentiment = avgRating >= 4 ? 'positive' : avgRating >= 3 ? 'neutral' : 'negative';\nfeedbackData.avgRating = Math.round(avgRating * 10) / 10;\n\n// Determine if review request should be sent\nfeedbackData.eligibleForReviewRequest = avgRating >= 4 && feedbackData.nps >= 8;\n\n// Flag critical issues\nfeedbackData.criticalIssue = avgRating <= 2 || \n  (feedbackData.ratings.cleanliness && feedbackData.ratings.cleanliness <= 2) ||\n  (feedbackData.comment && /sick|ill|food poisoning|bug|hair|dirty|rude|worst/i.test(feedbackData.comment));\n\nreturn [{ json: feedbackData }];"
        },
        "id": "process-feedback",
        "name": "Process Feedback",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.RESTAURANT_DB_URL }}/visits/yesterday",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "hasFeedback",
                "value": "false"
              },
              {
                "name": "hasEmail",
                "value": "true"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-guests",
        "name": "Fetch Guests for Survey",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "restaurant-db-api",
            "name": "Restaurant DB API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.REVIEW_API_URL }}/reviews/new",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "platforms",
                "value": "google,yelp,tripadvisor,facebook"
              },
              {
                "name": "since",
                "value": "30m"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-reviews",
        "name": "Fetch New Reviews",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "review-api-key",
            "name": "Review API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.FEEDBACK_DB_URL }}/feedback",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-feedback",
        "name": "Save Feedback",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "feedback-db-api",
            "name": "Feedback DB API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "critical",
                "leftValue": "={{ $json.criticalIssue }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-critical",
        "name": "Critical Issue?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.URGENT_SLACK_CHANNEL }}",
          "text": "=ðŸš¨ *URGENT: Critical Guest Feedback*\n\n*Guest:* {{ $json.guestName || 'Anonymous' }}\n*Restaurant:* {{ $json.restaurantId }}\n*Visit Date:* {{ $json.visitDate }}\n\nâ­ *Ratings:*\nâ€¢ Overall: {{ $json.ratings.overall || 'N/A' }}/5\nâ€¢ Food: {{ $json.ratings.food || 'N/A' }}/5\nâ€¢ Service: {{ $json.ratings.service || 'N/A' }}/5\nâ€¢ Cleanliness: {{ $json.ratings.cleanliness || 'N/A' }}/5\n\nðŸ’¬ *Comment:*\n```\n{{ $json.comment || 'No comment provided' }}\n```\n\nðŸ“§ *Contact:* {{ $json.guestEmail || $json.guestPhone || 'Not provided' }}\n\n_This requires immediate attention!_",
          "otherOptions": {}
        },
        "id": "alert-critical",
        "name": "Alert Critical Issue",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1000,
          300
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "eligible",
                "leftValue": "={{ $json.eligibleForReviewRequest }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-review-eligible",
        "name": "Eligible for Review?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {
          "fromEmail": "={{ $vars.RESTAURANT_EMAIL }}",
          "toEmail": "={{ $json.guestEmail }}",
          "subject": "=We'd love your review, {{ $json.guestName }}! ðŸŒŸ",
          "emailType": "html",
          "html": "=<h2>Thank you for your feedback, {{ $json.guestName }}!</h2>\n<p>We're thrilled to hear you had a great experience with us!</p>\n<p>Would you mind sharing your experience with others? Your review helps us reach more food lovers like you!</p>\n<p style=\"text-align: center;\">\n<a href=\"{{ $vars.GOOGLE_REVIEW_LINK }}\" style=\"display: inline-block; background: #4285F4; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; margin: 10px;\">Review on Google</a>\n<a href=\"{{ $vars.YELP_REVIEW_LINK }}\" style=\"display: inline-block; background: #D32323; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; margin: 10px;\">Review on Yelp</a>\n</p>\n<p>As a thank you, here's a special offer for your next visit:</p>\n<p style=\"text-align: center; font-size: 24px; color: #e74c3c;\"><strong>10% OFF</strong> your next order</p>\n<p style=\"text-align: center;\">Use code: <strong>THANKYOU10</strong></p>\n<p>Thank you for being part of our family!</p>",
          "options": {}
        },
        "id": "send-review-request",
        "name": "Send Review Request",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1250,
          450
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Prepare survey emails for yesterday's guests\nconst guests = $input.first().json.guests || [];\n\nconst surveyEmails = guests.map(guest => ({\n  guestId: guest.id,\n  guestName: guest.firstName,\n  guestEmail: guest.email,\n  restaurantId: guest.restaurantId,\n  visitDate: guest.visitDate,\n  visitType: guest.visitType,\n  orderId: guest.orderId,\n  serverName: guest.serverName,\n  surveyLink: `{{ $vars.SURVEY_BASE_URL }}?guest=${guest.id}&visit=${guest.visitDate}`\n}));\n\nreturn surveyEmails.map(s => ({ json: s }));"
        },
        "id": "prepare-surveys",
        "name": "Prepare Survey Emails",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          600
        ]
      },
      {
        "parameters": {
          "fromEmail": "={{ $vars.RESTAURANT_EMAIL }}",
          "toEmail": "={{ $json.guestEmail }}",
          "subject": "=How was your visit, {{ $json.guestName }}? Quick feedback (30 sec)",
          "emailType": "html",
          "html": "=<h2>Hi {{ $json.guestName }},</h2>\n<p>Thank you for dining with us{{ $json.serverName ? ` (served by ${$json.serverName})` : '' }}!</p>\n<p>We'd love to hear about your experience. It takes just 30 seconds:</p>\n<p style=\"text-align: center;\">\n<a href=\"{{ $json.surveyLink }}&rating=5\" style=\"font-size: 36px; text-decoration: none;\">â­â­â­â­â­</a><br/>\n<a href=\"{{ $json.surveyLink }}&rating=4\" style=\"font-size: 36px; text-decoration: none;\">â­â­â­â­</a><br/>\n<a href=\"{{ $json.surveyLink }}&rating=3\" style=\"font-size: 36px; text-decoration: none;\">â­â­â­</a><br/>\n<a href=\"{{ $json.surveyLink }}&rating=2\" style=\"font-size: 36px; text-decoration: none;\">â­â­</a><br/>\n<a href=\"{{ $json.surveyLink }}&rating=1\" style=\"font-size: 36px; text-decoration: none;\">â­</a>\n</p>\n<p style=\"text-align: center;\"><em>Click a rating or <a href=\"{{ $json.surveyLink }}\">share detailed feedback</a></em></p>\n<p>Your feedback helps us serve you better!</p>",
          "options": {}
        },
        "id": "send-survey",
        "name": "Send Survey Email",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1000,
          600
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Process new reviews from platforms\nconst reviews = $input.first().json.reviews || [];\n\nconst processedReviews = reviews.map(review => {\n  // Determine sentiment\n  let sentiment = 'neutral';\n  if (review.rating >= 4) sentiment = 'positive';\n  else if (review.rating <= 2) sentiment = 'negative';\n\n  // Check if response needed\n  const needsResponse = !review.ownerResponse;\n  const urgentResponse = review.rating <= 2 && !review.ownerResponse;\n\n  return {\n    reviewId: review.id,\n    platform: review.platform,\n    reviewerName: review.reviewerName,\n    rating: review.rating,\n    text: review.text,\n    date: review.date,\n    restaurantId: review.restaurantId || review.locationId,\n    sentiment,\n    needsResponse,\n    urgentResponse,\n    hasOwnerResponse: !!review.ownerResponse\n  };\n});\n\n// Filter reviews needing response\nconst needResponse = processedReviews.filter(r => r.needsResponse);\nconst urgent = processedReviews.filter(r => r.urgentResponse);\n\nreturn [{ json: {\n  totalNew: processedReviews.length,\n  needResponse: needResponse.length,\n  urgent: urgent.length,\n  reviews: processedReviews\n}}];"
        },
        "id": "process-reviews",
        "name": "Process Reviews",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          800
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-reviews",
                "leftValue": "={{ $json.totalNew }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-has-reviews",
        "name": "Has New Reviews?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          800
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Restaurant Review Response Specialist. Generate professional, warm, and personalized responses to customer reviews.\n\nGuidelines:\n1. Thank the reviewer by name if possible\n2. Address specific points mentioned in their review\n3. For negative reviews: apologize sincerely, don't make excuses, offer to make it right\n4. For positive reviews: express genuine gratitude, highlight what they enjoyed\n5. Keep responses concise (2-4 sentences)\n6. Include a call to action (visit again, contact us, etc.)\n7. Match the tone of the review",
                "role": "system"
              },
              {
                "content": "=Generate responses for these reviews:\n\n{{ $json.reviews.filter(r => r.needsResponse).slice(0, 5).map(r => `\n**Platform:** ${r.platform}\n**Reviewer:** ${r.reviewerName}\n**Rating:** ${r.rating}/5\n**Review:** \"${r.text}\"\n`).join('\\n---\\n') }}\n\nGenerate an appropriate response for each review.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.7,
            "maxTokens": 2000
          }
        },
        "id": "generate-responses",
        "name": "Generate AI Responses",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1250,
          750
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.REVIEWS_SLACK_CHANNEL }}",
          "text": "=ðŸ“ *New Reviews Alert*\n\n*Summary:*\nâ€¢ New Reviews: {{ $json.totalNew }}\nâ€¢ Need Response: {{ $json.needResponse }}\nâ€¢ Urgent (Negative): {{ $json.urgent }}\n\n{{ $json.reviews.slice(0, 5).map(r => \n  `${r.rating >= 4 ? 'ðŸŒŸ' : r.rating >= 3 ? 'â­' : 'âš ï¸'} *${r.platform}* - ${r.rating}/5 by ${r.reviewerName}\\n\"${r.text.substring(0, 100)}...\"${r.needsResponse ? '\\n_Response needed_' : ''}`\n).join('\\n\\n') }}\n\n<{{ $vars.REVIEW_DASHBOARD_URL }}|View All Reviews>",
          "otherOptions": {}
        },
        "id": "notify-reviews",
        "name": "Notify New Reviews",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1250,
          900
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"success\": true,\n  \"feedbackId\": \"{{ $json.feedbackId }}\",\n  \"sentiment\": \"{{ $json.sentiment }}\",\n  \"reviewRequestSent\": {{ $json.eligibleForReviewRequest }}\n}",
          "options": {}
        },
        "id": "respond-feedback",
        "name": "Respond Feedback",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1500,
          400
        ]
      }
    ],
    "connections": {
      "Feedback Received": {
        "main": [
          [
            {
              "node": "Process Feedback",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Survey Trigger": {
        "main": [
          [
            {
              "node": "Fetch Guests for Survey",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Review Monitor (30min)": {
        "main": [
          [
            {
              "node": "Fetch New Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Feedback": {
        "main": [
          [
            {
              "node": "Save Feedback",
              "type": "main",
              "index": 0
            },
            {
              "node": "Critical Issue?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Feedback": {
        "main": [
          [
            {
              "node": "Respond Feedback",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Critical Issue?": {
        "main": [
          [
            {
              "node": "Alert Critical Issue",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Eligible for Review?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Eligible for Review?": {
        "main": [
          [
            {
              "node": "Send Review Request",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Fetch Guests for Survey": {
        "main": [
          [
            {
              "node": "Prepare Survey Emails",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Survey Emails": {
        "main": [
          [
            {
              "node": "Send Survey Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch New Reviews": {
        "main": [
          [
            {
              "node": "Process Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Reviews": {
        "main": [
          [
            {
              "node": "Has New Reviews?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has New Reviews?": {
        "main": [
          [
            {
              "node": "Generate AI Responses",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify New Reviews",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "restaurant",
        "name": "restaurant"
      },
      {
        "id": "feedback",
        "name": "feedback"
      },
      {
        "id": "reviews",
        "name": "reviews"
      },
      {
        "id": "ai",
        "name": "ai"
      }
    ],
    "triggerCount": 3,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Housekeeping Operations v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 6 * * *"
              }
            ]
          }
        },
        "id": "morning-schedule",
        "name": "Daily 6 AM",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "housekeeping-update",
          "options": {}
        },
        "id": "status-webhook",
        "name": "Status Update Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          600
        ],
        "webhookId": "housekeeping-status"
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.PMS_API_URL }}/rooms/status",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "date",
                "value": "={{ $now.format('yyyy-MM-dd') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-room-status",
        "name": "Fetch Room Status",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          200
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.PMS_API_URL }}/reservations/today",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-arrivals-departures",
        "name": "Fetch Arrivals & Departures",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.PMS_API_URL }}/staff/housekeeping",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-staff",
        "name": "Fetch Available Staff",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Generate optimized housekeeping task list\nconst rooms = $('Fetch Room Status').first().json.rooms || [];\nconst reservations = $('Fetch Arrivals & Departures').first().json;\nconst staff = $('Fetch Available Staff').first().json.staff || [];\n\nconst arrivals = reservations.arrivals || [];\nconst departures = reservations.departures || [];\nconst stayovers = reservations.stayovers || [];\n\n// Categorize rooms by priority\nconst tasks = [];\n\n// Priority 1: Departures with same-day arrivals (turnovers)\nconst turnovers = departures.filter(d => \n  arrivals.some(a => a.roomNumber === d.roomNumber)\n);\n\nturnovers.forEach(t => {\n  const arrival = arrivals.find(a => a.roomNumber === t.roomNumber);\n  tasks.push({\n    roomNumber: t.roomNumber,\n    roomType: t.roomType,\n    floor: Math.floor(t.roomNumber / 100),\n    priority: 1,\n    taskType: 'turnover',\n    checkoutTime: t.checkoutTime || '11:00',\n    checkinTime: arrival?.checkinTime || '15:00',\n    guestName: arrival?.guestName,\n    vipStatus: arrival?.vipStatus || false,\n    specialRequests: arrival?.specialRequests || [],\n    estimatedMinutes: 45,\n    status: 'pending'\n  });\n});\n\n// Priority 2: VIP arrivals (non-turnover)\nconst vipArrivals = arrivals.filter(a => \n  a.vipStatus && !turnovers.some(t => t.roomNumber === a.roomNumber)\n);\n\nvipArrivals.forEach(a => {\n  const room = rooms.find(r => r.number === a.roomNumber);\n  tasks.push({\n    roomNumber: a.roomNumber,\n    roomType: a.roomType,\n    floor: Math.floor(a.roomNumber / 100),\n    priority: 2,\n    taskType: room?.status === 'dirty' ? 'departure_clean' : 'vip_prep',\n    checkinTime: a.checkinTime || '15:00',\n    guestName: a.guestName,\n    vipStatus: true,\n    specialRequests: a.specialRequests || [],\n    estimatedMinutes: room?.status === 'dirty' ? 40 : 20,\n    status: 'pending'\n  });\n});\n\n// Priority 3: Regular departures\nconst regularDepartures = departures.filter(d => \n  !turnovers.some(t => t.roomNumber === d.roomNumber)\n);\n\nregularDepartures.forEach(d => {\n  tasks.push({\n    roomNumber: d.roomNumber,\n    roomType: d.roomType,\n    floor: Math.floor(d.roomNumber / 100),\n    priority: 3,\n    taskType: 'departure_clean',\n    checkoutTime: d.checkoutTime || '11:00',\n    estimatedMinutes: 35,\n    status: 'pending'\n  });\n});\n\n// Priority 4: Stayovers\nstayovers.forEach(s => {\n  const room = rooms.find(r => r.number === s.roomNumber);\n  if (room?.cleaningSchedule !== 'declined') {\n    tasks.push({\n      roomNumber: s.roomNumber,\n      roomType: s.roomType,\n      floor: Math.floor(s.roomNumber / 100),\n      priority: 4,\n      taskType: s.cleaningPreference === 'full' ? 'stayover_full' : 'stayover_light',\n      guestName: s.guestName,\n      estimatedMinutes: s.cleaningPreference === 'full' ? 25 : 15,\n      status: 'pending'\n    });\n  }\n});\n\n// Sort tasks by priority and floor for efficiency\ntasks.sort((a, b) => {\n  if (a.priority !== b.priority) return a.priority - b.priority;\n  return a.floor - b.floor;\n});\n\n// Assign tasks to staff based on availability and workload\nconst availableStaff = staff.filter(s => s.status === 'available');\nconst assignments = {};\nlet currentStaffIndex = 0;\n\ntasks.forEach(task => {\n  if (availableStaff.length > 0) {\n    const assignedStaff = availableStaff[currentStaffIndex % availableStaff.length];\n    task.assignedTo = assignedStaff.id;\n    task.assignedName = assignedStaff.name;\n    \n    if (!assignments[assignedStaff.id]) {\n      assignments[assignedStaff.id] = {\n        staffId: assignedStaff.id,\n        staffName: assignedStaff.name,\n        tasks: [],\n        totalMinutes: 0\n      };\n    }\n    assignments[assignedStaff.id].tasks.push(task);\n    assignments[assignedStaff.id].totalMinutes += task.estimatedMinutes;\n    \n    currentStaffIndex++;\n  }\n});\n\nreturn [{\n  json: {\n    date: new Date().toISOString().split('T')[0],\n    summary: {\n      turnovers: turnovers.length,\n      vipArrivals: vipArrivals.length,\n      departures: regularDepartures.length,\n      stayovers: tasks.filter(t => t.taskType.includes('stayover')).length,\n      totalTasks: tasks.length,\n      staffAssigned: Object.keys(assignments).length\n    },\n    tasks,\n    staffAssignments: Object.values(assignments)\n  }\n}];"
        },
        "id": "generate-task-list",
        "name": "Generate Task List",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          800,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.PMS_API_URL }}/housekeeping/tasks/bulk",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ tasks: $json.tasks }) }}",
          "options": {}
        },
        "id": "create-tasks-pms",
        "name": "Create Tasks in PMS",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1050,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.HOUSEKEEPING_SLACK_CHANNEL }}",
          "text": "=ðŸ§¹ *Daily Housekeeping Schedule - {{ $now.format('MMMM d, yyyy') }}*\n\nðŸ“Š *Today's Summary:*\nâ€¢ Turnovers (Priority 1): {{ $json.summary.turnovers }}\nâ€¢ VIP Arrivals: {{ $json.summary.vipArrivals }}\nâ€¢ Departures: {{ $json.summary.departures }}\nâ€¢ Stayovers: {{ $json.summary.stayovers }}\nâ€¢ *Total Tasks: {{ $json.summary.totalTasks }}*\nâ€¢ Staff Assigned: {{ $json.summary.staffAssigned }}\n\nðŸ‘¥ *Staff Assignments:*\n{{ $json.staffAssignments.map(s => `â€¢ *${s.staffName}*: ${s.tasks.length} rooms (~${s.totalMinutes} min)`).join('\\n') }}\n\nâš ï¸ *VIP Arrivals to prioritize:*\n{{ $json.tasks.filter(t => t.vipStatus).map(t => `â€¢ Room ${t.roomNumber}: ${t.guestName} (${t.checkinTime})`).join('\\n') || 'None today' }}\n\n_Update room status via the housekeeping app_",
          "otherOptions": {}
        },
        "id": "notify-schedule",
        "name": "Post Daily Schedule",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1050,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Send individual task notifications to staff\nconst assignments = $input.first().json.staffAssignments;\nconst notifications = [];\n\nfor (const assignment of assignments) {\n  // Group tasks by floor for efficiency\n  const tasksByFloor = {};\n  assignment.tasks.forEach(task => {\n    if (!tasksByFloor[task.floor]) {\n      tasksByFloor[task.floor] = [];\n    }\n    tasksByFloor[task.floor].push(task);\n  });\n  \n  notifications.push({\n    staffId: assignment.staffId,\n    staffName: assignment.staffName,\n    totalTasks: assignment.tasks.length,\n    totalMinutes: assignment.totalMinutes,\n    tasksByFloor,\n    tasks: assignment.tasks\n  });\n}\n\nreturn notifications.map(n => ({ json: n }));"
        },
        "id": "prepare-staff-notifications",
        "name": "Prepare Staff Notifications",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1300,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.STAFF_APP_URL }}/notifications",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"staffId\": \"{{ $json.staffId }}\",\n  \"title\": \"Your Housekeeping Tasks for Today\",\n  \"message\": \"You have {{ $json.totalTasks }} rooms assigned (~{{ $json.totalMinutes }} min estimated)\",\n  \"tasks\": {{ JSON.stringify($json.tasks) }},\n  \"type\": \"task_assignment\"\n}",
          "options": {}
        },
        "id": "send-staff-notification",
        "name": "Send to Staff App",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1550,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "staff-app-api",
            "name": "Staff App API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Process status update from housekeeping staff\nconst update = $input.first().json.body;\n\nconst statusUpdate = {\n  roomNumber: update.roomNumber,\n  taskId: update.taskId,\n  staffId: update.staffId,\n  newStatus: update.status, // 'in_progress', 'completed', 'blocked'\n  notes: update.notes,\n  issues: update.issues || [],\n  completedAt: update.status === 'completed' ? new Date().toISOString() : null,\n  photosUploaded: update.photos?.length || 0,\n  maintenanceRequired: update.maintenanceRequired || false\n};\n\nreturn [{ json: statusUpdate }];"
        },
        "id": "process-status-update",
        "name": "Process Status Update",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          750
        ]
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "={{ $vars.PMS_API_URL }}/housekeeping/tasks/{{ $json.taskId }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"status\": \"{{ $json.newStatus }}\",\n  \"notes\": \"{{ $json.notes }}\",\n  \"completedAt\": \"{{ $json.completedAt }}\",\n  \"updatedBy\": \"{{ $json.staffId }}\"\n}",
          "options": {}
        },
        "id": "update-task-pms",
        "name": "Update Task in PMS",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          750
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "room-completed",
                "leftValue": "={{ $json.newStatus }}",
                "rightValue": "completed",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-completed",
        "name": "Task Completed?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          750
        ]
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "={{ $vars.PMS_API_URL }}/rooms/{{ $json.roomNumber }}/status",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"status\": \"clean\",\n  \"inspectionRequired\": true,\n  \"cleanedBy\": \"{{ $json.staffId }}\",\n  \"cleanedAt\": \"{{ $now.toISO() }}\"\n}",
          "options": {}
        },
        "id": "update-room-status",
        "name": "Update Room Status",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          650
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "maintenance-needed",
                "leftValue": "={{ $json.maintenanceRequired }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-maintenance",
        "name": "Maintenance Needed?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          900
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.PMS_API_URL }}/maintenance/tickets",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"roomNumber\": \"{{ $json.roomNumber }}\",\n  \"reportedBy\": \"{{ $json.staffId }}\",\n  \"issues\": {{ JSON.stringify($json.issues) }},\n  \"notes\": \"{{ $json.notes }}\",\n  \"priority\": \"normal\",\n  \"source\": \"housekeeping\"\n}",
          "options": {}
        },
        "id": "create-maintenance-ticket",
        "name": "Create Maintenance Ticket",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          900
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.MAINTENANCE_SLACK_CHANNEL }}",
          "text": "=ðŸ”§ *Maintenance Request from Housekeeping*\n\nðŸ“ *Room:* {{ $json.roomNumber }}\nðŸ‘¤ *Reported by:* Staff ID {{ $json.staffId }}\n\nâš ï¸ *Issues:*\n{{ $json.issues.map(i => `â€¢ ${i}`).join('\\n') || 'â€¢ See notes' }}\n\nðŸ“ *Notes:* {{ $json.notes || 'No additional notes' }}\n\n_Please assign and resolve_",
          "otherOptions": {}
        },
        "id": "notify-maintenance",
        "name": "Notify Maintenance Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1500,
          900
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 14 * * *"
              }
            ]
          }
        },
        "id": "afternoon-check",
        "name": "Daily 2 PM Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          1100
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.PMS_API_URL }}/housekeeping/tasks/status",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "date",
                "value": "={{ $now.format('yyyy-MM-dd') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-task-progress",
        "name": "Fetch Task Progress",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          1100
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pms-api-key",
            "name": "PMS API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Analyze progress and identify at-risk rooms\nconst tasks = $input.first().json.tasks || [];\nconst now = new Date();\n\nconst completed = tasks.filter(t => t.status === 'completed');\nconst inProgress = tasks.filter(t => t.status === 'in_progress');\nconst pending = tasks.filter(t => t.status === 'pending');\nconst blocked = tasks.filter(t => t.status === 'blocked');\n\n// Identify at-risk turnovers (arrivals before 3pm without clean room)\nconst atRisk = tasks.filter(t => {\n  if (t.taskType === 'turnover' && t.status !== 'completed') {\n    const checkinTime = new Date(`${now.toISOString().split('T')[0]}T${t.checkinTime || '15:00'}:00`);\n    const hoursUntilCheckin = (checkinTime - now) / (1000 * 60 * 60);\n    return hoursUntilCheckin < 2;\n  }\n  return false;\n});\n\n// VIP rooms not yet ready\nconst vipNotReady = tasks.filter(t => t.vipStatus && t.status !== 'completed');\n\nconst progress = {\n  total: tasks.length,\n  completed: completed.length,\n  inProgress: inProgress.length,\n  pending: pending.length,\n  blocked: blocked.length,\n  completionRate: tasks.length > 0 ? Math.round((completed.length / tasks.length) * 100) : 0,\n  atRiskRooms: atRisk,\n  vipNotReady,\n  estimatedCompletionTime: null\n};\n\n// Estimate completion\nconst remainingMinutes = [...inProgress, ...pending].reduce((sum, t) => sum + (t.estimatedMinutes || 30), 0);\nconst avgRoomsPerHour = completed.length > 0 ? completed.length / ((now.getHours() - 6) || 1) : 2;\nprogress.estimatedCompletionTime = new Date(now.getTime() + (remainingMinutes * 60000)).toISOString();\n\nreturn [{ json: progress }];"
        },
        "id": "analyze-progress",
        "name": "Analyze Progress",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          1100
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-at-risk",
                "leftValue": "={{ $json.atRiskRooms.length + $json.vipNotReady.length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-at-risk",
        "name": "At-Risk Rooms?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          1100
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.HOUSEKEEPING_SLACK_CHANNEL }}",
          "text": "=âš ï¸ *Housekeeping Progress Alert*\n\nðŸ“Š *Current Status (2 PM):*\nâ€¢ Completed: {{ $json.completed }}/{{ $json.total }} ({{ $json.completionRate }}%)\nâ€¢ In Progress: {{ $json.inProgress }}\nâ€¢ Pending: {{ $json.pending }}\nâ€¢ Blocked: {{ $json.blocked }}\n\nðŸš¨ *At-Risk Turnovers:* {{ $json.atRiskRooms.length }}\n{{ $json.atRiskRooms.map(r => `â€¢ Room ${r.roomNumber} - Checkin at ${r.checkinTime}`).join('\\n') || 'None' }}\n\nâ­ *VIP Rooms Not Ready:* {{ $json.vipNotReady.length }}\n{{ $json.vipNotReady.map(r => `â€¢ Room ${r.roomNumber} - ${r.guestName}`).join('\\n') || 'None' }}\n\n*Please prioritize these rooms immediately!*",
          "otherOptions": {}
        },
        "id": "alert-at-risk",
        "name": "Alert At-Risk Rooms",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1250,
          1050
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.HOUSEKEEPING_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Daily Log",
            "mode": "list",
            "cachedResultName": "Daily Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Date": "={{ $now.format('yyyy-MM-dd') }}",
              "Total Tasks": "={{ $json.total }}",
              "Completed": "={{ $json.completed }}",
              "Completion Rate": "={{ $json.completionRate }}%",
              "At Risk Rooms": "={{ $json.atRiskRooms.length }}",
              "VIP Not Ready": "={{ $json.vipNotReady.length }}",
              "Blocked": "={{ $json.blocked }}",
              "Check Time": "=2:00 PM"
            }
          },
          "options": {}
        },
        "id": "log-progress",
        "name": "Log Progress",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1250,
          1200
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Daily 6 AM": {
        "main": [
          [
            {
              "node": "Fetch Room Status",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Arrivals & Departures",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Available Staff",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Room Status": {
        "main": [
          [
            {
              "node": "Generate Task List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Arrivals & Departures": {
        "main": [
          [
            {
              "node": "Generate Task List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Available Staff": {
        "main": [
          [
            {
              "node": "Generate Task List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Task List": {
        "main": [
          [
            {
              "node": "Create Tasks in PMS",
              "type": "main",
              "index": 0
            },
            {
              "node": "Post Daily Schedule",
              "type": "main",
              "index": 0
            },
            {
              "node": "Prepare Staff Notifications",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Staff Notifications": {
        "main": [
          [
            {
              "node": "Send to Staff App",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Status Update Webhook": {
        "main": [
          [
            {
              "node": "Process Status Update",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Status Update": {
        "main": [
          [
            {
              "node": "Update Task in PMS",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Task in PMS": {
        "main": [
          [
            {
              "node": "Task Completed?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Maintenance Needed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Task Completed?": {
        "main": [
          [
            {
              "node": "Update Room Status",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Maintenance Needed?": {
        "main": [
          [
            {
              "node": "Create Maintenance Ticket",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Create Maintenance Ticket": {
        "main": [
          [
            {
              "node": "Notify Maintenance Team",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily 2 PM Check": {
        "main": [
          [
            {
              "node": "Fetch Task Progress",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Task Progress": {
        "main": [
          [
            {
              "node": "Analyze Progress",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Progress": {
        "main": [
          [
            {
              "node": "At-Risk Rooms?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Progress",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "At-Risk Rooms?": {
        "main": [
          [
            {
              "node": "Alert At-Risk Rooms",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "hospitality",
        "name": "hospitality"
      },
      {
        "id": "housekeeping",
        "name": "housekeeping"
      },
      {
        "id": "operations",
        "name": "operations"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 3,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Influencer Marketing Hub v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1"
              }
            ]
          }
        },
        "id": "weekly-discovery",
        "name": "Weekly Discovery",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "influencer-campaign",
          "options": {}
        },
        "id": "campaign-webhook",
        "name": "Campaign Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          500
        ],
        "webhookId": "influencer-campaign"
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.modash.io/v1/instagram/search",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "niches",
                "value": "={{ $vars.TARGET_NICHES }}"
              },
              {
                "name": "followers_min",
                "value": "10000"
              },
              {
                "name": "followers_max",
                "value": "500000"
              },
              {
                "name": "engagement_rate_min",
                "value": "3"
              },
              {
                "name": "location",
                "value": "={{ $vars.TARGET_LOCATIONS }}"
              },
              {
                "name": "limit",
                "value": "50"
              }
            ]
          },
          "options": {}
        },
        "id": "discover-instagram",
        "name": "Discover Instagram",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          200
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "modash-api",
            "name": "Modash API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.modash.io/v1/tiktok/search",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "niches",
                "value": "={{ $vars.TARGET_NICHES }}"
              },
              {
                "name": "followers_min",
                "value": "10000"
              },
              {
                "name": "followers_max",
                "value": "1000000"
              },
              {
                "name": "engagement_rate_min",
                "value": "5"
              },
              {
                "name": "location",
                "value": "={{ $vars.TARGET_LOCATIONS }}"
              },
              {
                "name": "limit",
                "value": "50"
              }
            ]
          },
          "options": {}
        },
        "id": "discover-tiktok",
        "name": "Discover TikTok",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "modash-api",
            "name": "Modash API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.modash.io/v1/youtube/search",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "niches",
                "value": "={{ $vars.TARGET_NICHES }}"
              },
              {
                "name": "subscribers_min",
                "value": "5000"
              },
              {
                "name": "subscribers_max",
                "value": "500000"
              },
              {
                "name": "avg_views_min",
                "value": "1000"
              },
              {
                "name": "location",
                "value": "={{ $vars.TARGET_LOCATIONS }}"
              },
              {
                "name": "limit",
                "value": "30"
              }
            ]
          },
          "options": {}
        },
        "id": "discover-youtube",
        "name": "Discover YouTube",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "modash-api",
            "name": "Modash API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Aggregate and score influencers from all platforms\nconst instagram = $('Discover Instagram').first().json.influencers || [];\nconst tiktok = $('Discover TikTok').first().json.influencers || [];\nconst youtube = $('Discover YouTube').first().json.influencers || [];\n\nconst allInfluencers = [];\n\n// Process Instagram\ninstagram.forEach(inf => {\n  const score = calculateScore(inf, 'instagram');\n  allInfluencers.push({\n    platform: 'instagram',\n    id: inf.id,\n    username: inf.username,\n    displayName: inf.full_name,\n    followers: inf.followers,\n    engagementRate: inf.engagement_rate,\n    avgLikes: inf.avg_likes,\n    avgComments: inf.avg_comments,\n    bio: inf.bio,\n    email: inf.email,\n    location: inf.location,\n    niche: inf.niche,\n    audienceDemo: inf.audience_demographics,\n    score,\n    tier: getTier(inf.followers),\n    estimatedCPM: getEstimatedCPM(inf.followers, inf.engagement_rate, 'instagram')\n  });\n});\n\n// Process TikTok\ntiktok.forEach(inf => {\n  const score = calculateScore(inf, 'tiktok');\n  allInfluencers.push({\n    platform: 'tiktok',\n    id: inf.id,\n    username: inf.username,\n    displayName: inf.nickname,\n    followers: inf.followers,\n    engagementRate: inf.engagement_rate,\n    avgViews: inf.avg_views,\n    avgLikes: inf.avg_likes,\n    bio: inf.bio,\n    email: inf.email,\n    location: inf.location,\n    niche: inf.niche,\n    score,\n    tier: getTier(inf.followers),\n    estimatedCPM: getEstimatedCPM(inf.followers, inf.engagement_rate, 'tiktok')\n  });\n});\n\n// Process YouTube\nyoutube.forEach(inf => {\n  const score = calculateScore(inf, 'youtube');\n  allInfluencers.push({\n    platform: 'youtube',\n    id: inf.id,\n    username: inf.channel_name,\n    displayName: inf.channel_name,\n    followers: inf.subscribers,\n    avgViews: inf.avg_views,\n    engagementRate: inf.engagement_rate,\n    bio: inf.description,\n    email: inf.email,\n    location: inf.location,\n    niche: inf.niche,\n    score,\n    tier: getTier(inf.subscribers),\n    estimatedCPM: getEstimatedCPM(inf.subscribers, inf.engagement_rate, 'youtube')\n  });\n});\n\nfunction calculateScore(inf, platform) {\n  let score = 0;\n  \n  // Engagement rate scoring (max 40 points)\n  const er = inf.engagement_rate || 0;\n  if (platform === 'tiktok') {\n    score += Math.min(er * 4, 40);\n  } else {\n    score += Math.min(er * 10, 40);\n  }\n  \n  // Follower count scoring (max 20 points)\n  const followers = inf.followers || inf.subscribers || 0;\n  if (followers >= 100000) score += 20;\n  else if (followers >= 50000) score += 15;\n  else if (followers >= 25000) score += 10;\n  else score += 5;\n  \n  // Authenticity indicators (max 20 points)\n  if (inf.is_verified) score += 5;\n  if (inf.has_email) score += 5;\n  if (inf.fake_followers_percent < 10) score += 10;\n  else if (inf.fake_followers_percent < 20) score += 5;\n  \n  // Content quality (max 20 points)\n  if (inf.post_frequency && inf.post_frequency >= 3) score += 10;\n  if (inf.brand_mentions < 30) score += 10; // Not over-sponsored\n  \n  return Math.round(score);\n}\n\nfunction getTier(followers) {\n  if (followers >= 1000000) return 'mega';\n  if (followers >= 100000) return 'macro';\n  if (followers >= 10000) return 'micro';\n  return 'nano';\n}\n\nfunction getEstimatedCPM(followers, er, platform) {\n  let baseCPM = 0;\n  if (platform === 'instagram') baseCPM = 10;\n  else if (platform === 'tiktok') baseCPM = 8;\n  else if (platform === 'youtube') baseCPM = 15;\n  \n  // Adjust for engagement\n  const erMultiplier = 1 + (er / 10);\n  \n  return Math.round(baseCPM * erMultiplier);\n}\n\n// Sort by score\nallInfluencers.sort((a, b) => b.score - a.score);\n\nreturn [{\n  json: {\n    influencers: allInfluencers,\n    summary: {\n      total: allInfluencers.length,\n      byPlatform: {\n        instagram: instagram.length,\n        tiktok: tiktok.length,\n        youtube: youtube.length\n      },\n      byTier: {\n        nano: allInfluencers.filter(i => i.tier === 'nano').length,\n        micro: allInfluencers.filter(i => i.tier === 'micro').length,\n        macro: allInfluencers.filter(i => i.tier === 'macro').length,\n        mega: allInfluencers.filter(i => i.tier === 'mega').length\n      },\n      avgScore: Math.round(allInfluencers.reduce((a, b) => a + b.score, 0) / allInfluencers.length)\n    },\n    discoveryDate: new Date().toISOString()\n  }\n}];"
        },
        "id": "aggregate-influencers",
        "name": "Aggregate & Score",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          800,
          400
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are an Influencer Marketing Analyst AI. Analyze the discovered influencers and provide strategic recommendations.\n\nYour analysis should include:\n1. Top recommended influencers with justification\n2. Campaign strategy suggestions based on influencer mix\n3. Budget allocation recommendations by platform\n4. Content collaboration ideas\n5. Risk assessment (fake followers, brand safety)\n6. Estimated ROI projections\n\nProvide actionable insights for the marketing team.",
                "role": "system"
              },
              {
                "content": "=Analyze these discovered influencers:\n\n**Summary:**\n{{ JSON.stringify($json.summary, null, 2) }}\n\n**Top 20 Influencers by Score:**\n{{ JSON.stringify($json.influencers.slice(0, 20), null, 2) }}\n\nProvide strategic recommendations for influencer campaign planning.",
                "role": "user"
              }
            ]
          },
          "options": {
            "temperature": 0.5,
            "maxTokens": 2500
          }
        },
        "id": "ai-analysis",
        "name": "AI Strategic Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1050,
          300
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CRM_API_URL }}/influencers/bulk",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ influencers: $('Aggregate & Score').first().json.influencers }) }}",
          "options": {}
        },
        "id": "save-to-crm",
        "name": "Save to CRM",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1050,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "crm-api-key",
            "name": "CRM API Key"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.MARKETING_SLACK_CHANNEL }}",
          "text": "=ðŸ“Š *Weekly Influencer Discovery Report*\n\n*{{ $('Aggregate & Score').first().json.summary.total }} influencers discovered*\n\nðŸ“± *By Platform:*\nâ€¢ Instagram: {{ $('Aggregate & Score').first().json.summary.byPlatform.instagram }}\nâ€¢ TikTok: {{ $('Aggregate & Score').first().json.summary.byPlatform.tiktok }}\nâ€¢ YouTube: {{ $('Aggregate & Score').first().json.summary.byPlatform.youtube }}\n\nðŸŽ¯ *By Tier:*\nâ€¢ Nano (1-10K): {{ $('Aggregate & Score').first().json.summary.byTier.nano }}\nâ€¢ Micro (10-100K): {{ $('Aggregate & Score').first().json.summary.byTier.micro }}\nâ€¢ Macro (100K-1M): {{ $('Aggregate & Score').first().json.summary.byTier.macro }}\nâ€¢ Mega (1M+): {{ $('Aggregate & Score').first().json.summary.byTier.mega }}\n\nâ­ *Average Score:* {{ $('Aggregate & Score').first().json.summary.avgScore }}/100\n\nðŸ¤– *AI Analysis:*\n{{ $json.message?.content || $json.choices?.[0]?.message?.content || 'See detailed report' }}\n\n_Full list saved to CRM_",
          "otherOptions": {}
        },
        "id": "notify-discovery",
        "name": "Notify Discovery",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1300,
          300
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Process campaign request\nconst campaign = $input.first().json.body;\n\nconst campaignData = {\n  campaignId: `CAMP-${Date.now().toString(36).toUpperCase()}`,\n  name: campaign.name,\n  brand: campaign.brand,\n  objective: campaign.objective, // awareness, engagement, conversions\n  budget: campaign.budget,\n  platforms: campaign.platforms || ['instagram', 'tiktok'],\n  targetAudience: campaign.targetAudience,\n  startDate: campaign.startDate,\n  endDate: campaign.endDate,\n  contentRequirements: campaign.contentRequirements,\n  hashtags: campaign.hashtags || [],\n  selectedInfluencers: campaign.influencerIds || [],\n  status: 'planning',\n  createdAt: new Date().toISOString()\n};\n\nreturn [{ json: campaignData }];"
        },
        "id": "parse-campaign",
        "name": "Parse Campaign Request",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          800
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CRM_API_URL }}/influencers",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "ids",
                "value": "={{ $json.selectedInfluencers.join(',') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-selected-influencers",
        "name": "Fetch Selected Influencers",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "crm-api-key",
            "name": "CRM API Key"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are an Influencer Outreach Specialist AI. Generate personalized outreach messages for influencer collaborations.\n\nYour messages should:\n1. Be personalized based on the influencer's content and style\n2. Clearly explain the brand and campaign\n3. Highlight mutual benefits\n4. Include specific collaboration details\n5. Have a clear call-to-action\n6. Be professional yet friendly\n\nGenerate outreach templates that can be personalized further.",
                "role": "system"
              },
              {
                "content": "=Generate outreach messages for this campaign:\n\n**Campaign:**\n{{ JSON.stringify($('Parse Campaign Request').first().json, null, 2) }}\n\n**Selected Influencers:**\n{{ JSON.stringify($json.influencers?.slice(0, 10), null, 2) }}\n\nGenerate personalized outreach messages for each influencer.",
                "role": "user"
              }
            ]
          },
          "options": {
            "temperature": 0.7,
            "maxTokens": 3000
          }
        },
        "id": "generate-outreach",
        "name": "Generate Outreach Messages",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1000,
          800
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CRM_API_URL }}/campaigns",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"campaign\": {{ JSON.stringify($('Parse Campaign Request').first().json) }},\n  \"influencers\": {{ JSON.stringify($('Fetch Selected Influencers').first().json.influencers) }},\n  \"outreachMessages\": {{ JSON.stringify($json) }}\n}",
          "options": {}
        },
        "id": "create-campaign",
        "name": "Create Campaign",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "crm-api-key",
            "name": "CRM API Key"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.MARKETING_SLACK_CHANNEL }}",
          "text": "=ðŸš€ *New Influencer Campaign Created*\n\n*Campaign:* {{ $('Parse Campaign Request').first().json.name }}\n*ID:* {{ $('Parse Campaign Request').first().json.campaignId }}\n*Budget:* ${{ $('Parse Campaign Request').first().json.budget.toLocaleString() }}\n*Platforms:* {{ $('Parse Campaign Request').first().json.platforms.join(', ') }}\n*Duration:* {{ $('Parse Campaign Request').first().json.startDate }} - {{ $('Parse Campaign Request').first().json.endDate }}\n\nðŸ‘¥ *Selected Influencers:* {{ $('Parse Campaign Request').first().json.selectedInfluencers.length }}\n\nðŸ“ *Outreach messages generated and ready for review*\n\n_Campaign saved to CRM_",
          "otherOptions": {}
        },
        "id": "notify-campaign-created",
        "name": "Notify Campaign Created",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1500,
          800
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.INFLUENCER_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Discovery Log",
            "mode": "list",
            "cachedResultName": "Discovery Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Date": "={{ $now.format('yyyy-MM-dd') }}",
              "Total Discovered": "={{ $('Aggregate & Score').first().json.summary.total }}",
              "Instagram": "={{ $('Aggregate & Score').first().json.summary.byPlatform.instagram }}",
              "TikTok": "={{ $('Aggregate & Score').first().json.summary.byPlatform.tiktok }}",
              "YouTube": "={{ $('Aggregate & Score').first().json.summary.byPlatform.youtube }}",
              "Avg Score": "={{ $('Aggregate & Score').first().json.summary.avgScore }}"
            }
          },
          "options": {}
        },
        "id": "log-discovery",
        "name": "Log Discovery",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1300,
          500
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Weekly Discovery": {
        "main": [
          [
            {
              "node": "Discover Instagram",
              "type": "main",
              "index": 0
            },
            {
              "node": "Discover TikTok",
              "type": "main",
              "index": 0
            },
            {
              "node": "Discover YouTube",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Discover Instagram": {
        "main": [
          [
            {
              "node": "Aggregate & Score",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Discover TikTok": {
        "main": [
          [
            {
              "node": "Aggregate & Score",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Discover YouTube": {
        "main": [
          [
            {
              "node": "Aggregate & Score",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate & Score": {
        "main": [
          [
            {
              "node": "AI Strategic Analysis",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to CRM",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Strategic Analysis": {
        "main": [
          [
            {
              "node": "Notify Discovery",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Discovery",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Campaign Webhook": {
        "main": [
          [
            {
              "node": "Parse Campaign Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Campaign Request": {
        "main": [
          [
            {
              "node": "Fetch Selected Influencers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Selected Influencers": {
        "main": [
          [
            {
              "node": "Generate Outreach Messages",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Outreach Messages": {
        "main": [
          [
            {
              "node": "Create Campaign",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Campaign": {
        "main": [
          [
            {
              "node": "Notify Campaign Created",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "marketing",
        "name": "marketing"
      },
      {
        "id": "influencer",
        "name": "influencer"
      },
      {
        "id": "social-media",
        "name": "social-media"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Intelligent CDP v1",
    "nodes": [
      {
        "parameters": {},
        "id": "webhook-data-ingestion",
        "name": "Data Ingestion Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          300
        ],
        "webhookId": "cdp-data-ingestion"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 */2 * * *"
              }
            ]
          }
        },
        "id": "scheduled-sync",
        "name": "Scheduled Data Sync",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          500
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.segment.io/v1/users",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpBasicAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "page_size",
                "value": "100"
              }
            ]
          },
          "options": {}
        },
        "id": "segment-fetch",
        "name": "Fetch Segment Profiles",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.hubspot.com/crm/v3/objects/contacts",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "hubSpotApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "limit",
                "value": "100"
              },
              {
                "name": "properties",
                "value": "email,firstname,lastname,company,phone,lifecyclestage,hs_lead_status,hubspot_owner_id,createdate,lastmodifieddate"
              }
            ]
          },
          "options": {}
        },
        "id": "hubspot-fetch",
        "name": "Fetch HubSpot Contacts",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.intercom.io/contacts",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "intercomApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "per_page",
                "value": "100"
              }
            ]
          },
          "options": {}
        },
        "id": "intercom-fetch",
        "name": "Fetch Intercom Users",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          700
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.mixpanel.com/engage",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpBasicAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "{\n  \"$token\": \"{{ $env.MIXPANEL_TOKEN }}\",\n  \"$distinct_id\": \"\"\n}",
          "options": {}
        },
        "id": "mixpanel-fetch",
        "name": "Fetch Mixpanel Profiles",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          900
        ]
      },
      {
        "parameters": {
          "jsCode": "// Identity Resolution Engine\n// Merges profiles from multiple sources into unified customer profiles\n\nconst segmentData = $('Fetch Segment Profiles').all();\nconst hubspotData = $('Fetch HubSpot Contacts').all();\nconst intercomData = $('Fetch Intercom Users').all();\nconst mixpanelData = $('Fetch Mixpanel Profiles').all();\n\n// Identity graph for resolution\nconst identityGraph = new Map();\n\n// Identity matching function\nfunction getIdentityKey(profile) {\n  // Primary: email\n  if (profile.email) return `email:${profile.email.toLowerCase()}`;\n  // Secondary: phone\n  if (profile.phone) return `phone:${profile.phone.replace(/\\D/g, '')}`;\n  // Tertiary: external_id\n  if (profile.external_id) return `ext:${profile.external_id}`;\n  // Fallback: anonymous_id\n  if (profile.anonymous_id) return `anon:${profile.anonymous_id}`;\n  return null;\n}\n\n// Merge profiles with conflict resolution\nfunction mergeProfiles(existing, newProfile, source) {\n  const merged = { ...existing };\n  \n  // Source priority for conflict resolution\n  const sourcePriority = {\n    'hubspot': 4,\n    'salesforce': 4,\n    'segment': 3,\n    'intercom': 2,\n    'mixpanel': 1\n  };\n  \n  const newPriority = sourcePriority[source] || 0;\n  const existingPriority = sourcePriority[merged._primarySource] || 0;\n  \n  // Merge fields with priority\n  for (const [key, value] of Object.entries(newProfile)) {\n    if (value !== null && value !== undefined && value !== '') {\n      if (!merged[key] || newPriority > existingPriority) {\n        merged[key] = value;\n      }\n    }\n  }\n  \n  // Track all sources\n  if (!merged._sources) merged._sources = [];\n  if (!merged._sources.includes(source)) merged._sources.push(source);\n  \n  // Update primary source if higher priority\n  if (newPriority > existingPriority) {\n    merged._primarySource = source;\n  }\n  \n  return merged;\n}\n\n// Process Segment profiles\nsegmentData.forEach(item => {\n  const users = item.json.users || [item.json];\n  users.forEach(profile => {\n    const key = getIdentityKey(profile);\n    if (key) {\n      const normalized = {\n        email: profile.email,\n        firstName: profile.traits?.first_name || profile.firstName,\n        lastName: profile.traits?.last_name || profile.lastName,\n        phone: profile.traits?.phone || profile.phone,\n        company: profile.traits?.company?.name || profile.company,\n        createdAt: profile.created_at,\n        lastSeen: profile.last_seen_at,\n        anonymous_id: profile.anonymous_id,\n        external_id: profile.user_id\n      };\n      \n      const existing = identityGraph.get(key) || {};\n      identityGraph.set(key, mergeProfiles(existing, normalized, 'segment'));\n    }\n  });\n});\n\n// Process HubSpot contacts\nhubspotData.forEach(item => {\n  const contacts = item.json.results || [item.json];\n  contacts.forEach(contact => {\n    const key = getIdentityKey({ email: contact.properties?.email });\n    if (key) {\n      const normalized = {\n        email: contact.properties?.email,\n        firstName: contact.properties?.firstname,\n        lastName: contact.properties?.lastname,\n        phone: contact.properties?.phone,\n        company: contact.properties?.company,\n        lifecycleStage: contact.properties?.lifecyclestage,\n        leadStatus: contact.properties?.hs_lead_status,\n        ownerId: contact.properties?.hubspot_owner_id,\n        createdAt: contact.properties?.createdate,\n        lastModified: contact.properties?.lastmodifieddate,\n        hubspotId: contact.id\n      };\n      \n      const existing = identityGraph.get(key) || {};\n      identityGraph.set(key, mergeProfiles(existing, normalized, 'hubspot'));\n    }\n  });\n});\n\n// Process Intercom users\nintercomData.forEach(item => {\n  const users = item.json.data || [item.json];\n  users.forEach(user => {\n    const key = getIdentityKey({ email: user.email });\n    if (key) {\n      const normalized = {\n        email: user.email,\n        firstName: user.name?.split(' ')[0],\n        lastName: user.name?.split(' ').slice(1).join(' '),\n        phone: user.phone,\n        company: user.companies?.data?.[0]?.name,\n        lastSeen: user.last_seen_at,\n        sessionCount: user.session_count,\n        unsubscribed: user.unsubscribed_from_emails,\n        intercomId: user.id\n      };\n      \n      const existing = identityGraph.get(key) || {};\n      identityGraph.set(key, mergeProfiles(existing, normalized, 'intercom'));\n    }\n  });\n});\n\n// Process Mixpanel profiles\nmixpanelData.forEach(item => {\n  const profiles = item.json.results || [item.json];\n  profiles.forEach(profile => {\n    const key = getIdentityKey({ email: profile.$properties?.$email });\n    if (key) {\n      const normalized = {\n        email: profile.$properties?.$email,\n        firstName: profile.$properties?.$first_name,\n        lastName: profile.$properties?.$last_name,\n        city: profile.$properties?.$city,\n        country: profile.$properties?.$country,\n        lastSeen: profile.$properties?.$last_seen,\n        mixpanelId: profile.$distinct_id\n      };\n      \n      const existing = identityGraph.get(key) || {};\n      identityGraph.set(key, mergeProfiles(existing, normalized, 'mixpanel'));\n    }\n  });\n});\n\n// Convert to array and add unified profile ID\nconst unifiedProfiles = Array.from(identityGraph.entries()).map(([key, profile], index) => {\n  return {\n    ...profile,\n    unifiedProfileId: `UP-${Date.now()}-${index}`,\n    identityKey: key,\n    resolvedAt: new Date().toISOString(),\n    sourceCount: profile._sources?.length || 1\n  };\n});\n\nreturn [{\n  json: {\n    totalProfiles: unifiedProfiles.length,\n    profiles: unifiedProfiles,\n    summary: {\n      bySource: {\n        segment: unifiedProfiles.filter(p => p._sources?.includes('segment')).length,\n        hubspot: unifiedProfiles.filter(p => p._sources?.includes('hubspot')).length,\n        intercom: unifiedProfiles.filter(p => p._sources?.includes('intercom')).length,\n        mixpanel: unifiedProfiles.filter(p => p._sources?.includes('mixpanel')).length\n      },\n      multiSourceProfiles: unifiedProfiles.filter(p => (p._sources?.length || 0) > 1).length\n    },\n    processedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "identity-resolution",
        "name": "Identity Resolution Engine",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "// Real-time Behavioral Analysis\n// Analyzes user behavior patterns and generates insights\n\nconst profiles = $input.first().json.profiles;\n\nconst analyzedProfiles = profiles.map(profile => {\n  // Calculate engagement score\n  let engagementScore = 0;\n  \n  // Session activity\n  if (profile.sessionCount > 10) engagementScore += 25;\n  else if (profile.sessionCount > 5) engagementScore += 15;\n  else if (profile.sessionCount > 0) engagementScore += 5;\n  \n  // Recency\n  const lastSeen = new Date(profile.lastSeen || profile.lastModified);\n  const daysSinceActive = (Date.now() - lastSeen.getTime()) / (1000 * 60 * 60 * 24);\n  if (daysSinceActive < 1) engagementScore += 30;\n  else if (daysSinceActive < 7) engagementScore += 20;\n  else if (daysSinceActive < 30) engagementScore += 10;\n  \n  // Profile completeness\n  const requiredFields = ['email', 'firstName', 'lastName', 'company', 'phone'];\n  const completedFields = requiredFields.filter(f => profile[f]);\n  engagementScore += (completedFields.length / requiredFields.length) * 20;\n  \n  // Multi-source data\n  if (profile.sourceCount > 2) engagementScore += 15;\n  else if (profile.sourceCount > 1) engagementScore += 10;\n  \n  // Determine lifecycle stage\n  let predictedStage = 'unknown';\n  if (profile.lifecycleStage) {\n    predictedStage = profile.lifecycleStage;\n  } else if (engagementScore >= 70) {\n    predictedStage = 'opportunity';\n  } else if (engagementScore >= 50) {\n    predictedStage = 'marketing_qualified_lead';\n  } else if (engagementScore >= 30) {\n    predictedStage = 'lead';\n  } else {\n    predictedStage = 'subscriber';\n  }\n  \n  // Churn risk assessment\n  let churnRisk = 'low';\n  if (daysSinceActive > 60 && engagementScore < 30) {\n    churnRisk = 'high';\n  } else if (daysSinceActive > 30 && engagementScore < 50) {\n    churnRisk = 'medium';\n  }\n  \n  return {\n    ...profile,\n    analysis: {\n      engagementScore: Math.min(100, Math.round(engagementScore)),\n      predictedStage,\n      churnRisk,\n      daysSinceActive: Math.round(daysSinceActive),\n      profileCompleteness: Math.round((completedFields.length / requiredFields.length) * 100),\n      recommendedActions: getRecommendedActions(engagementScore, churnRisk, predictedStage)\n    }\n  };\n});\n\nfunction getRecommendedActions(score, churnRisk, stage) {\n  const actions = [];\n  \n  if (churnRisk === 'high') {\n    actions.push('urgent_reengagement_campaign');\n    actions.push('personal_outreach');\n  } else if (churnRisk === 'medium') {\n    actions.push('nurture_sequence');\n  }\n  \n  if (score >= 70 && stage !== 'customer') {\n    actions.push('sales_handoff');\n    actions.push('demo_invitation');\n  } else if (score >= 50) {\n    actions.push('case_study_share');\n    actions.push('feature_highlight');\n  }\n  \n  return actions;\n}\n\n// Segment profiles for activation\nconst segments = {\n  highValue: analyzedProfiles.filter(p => p.analysis.engagementScore >= 70),\n  atRisk: analyzedProfiles.filter(p => p.analysis.churnRisk !== 'low'),\n  needsNurturing: analyzedProfiles.filter(p => \n    p.analysis.engagementScore >= 30 && \n    p.analysis.engagementScore < 70 &&\n    p.analysis.churnRisk === 'low'\n  ),\n  cold: analyzedProfiles.filter(p => p.analysis.engagementScore < 30)\n};\n\nreturn [{\n  json: {\n    profiles: analyzedProfiles,\n    segments: {\n      highValue: segments.highValue.length,\n      atRisk: segments.atRisk.length,\n      needsNurturing: segments.needsNurturing.length,\n      cold: segments.cold.length\n    },\n    segmentedProfiles: segments,\n    processedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "behavioral-analysis",
        "name": "Behavioral Analysis",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Customer Data Platform AI that generates real-time insights and predictions from unified customer profiles.\n\nAnalyze the customer segments and provide:\n1. Key trends and patterns\n2. Actionable recommendations for each segment\n3. Predicted outcomes for different intervention strategies\n4. Priority accounts that need immediate attention\n\nReturn JSON:\n{\n  \"insights\": [\"insight1\", \"insight2\"],\n  \"segmentRecommendations\": {\n    \"highValue\": {\"strategy\": \"\", \"expectedOutcome\": \"\"},\n    \"atRisk\": {\"strategy\": \"\", \"expectedOutcome\": \"\"},\n    \"needsNurturing\": {\"strategy\": \"\", \"expectedOutcome\": \"\"},\n    \"cold\": {\"strategy\": \"\", \"expectedOutcome\": \"\"}\n  },\n  \"priorityAccounts\": [{\"email\": \"\", \"reason\": \"\", \"action\": \"\"}],\n  \"predictedMRRImpact\": \"$amount\",\n  \"churnRiskReduction\": \"percentage\"\n}"
              },
              {
                "role": "user",
                "content": "=Analyze these customer segments:\n\nTotal Profiles: {{ $json.profiles.length }}\n\nSegment Distribution:\n- High Value: {{ $json.segments.highValue }}\n- At Risk: {{ $json.segments.atRisk }}\n- Needs Nurturing: {{ $json.segments.needsNurturing }}\n- Cold: {{ $json.segments.cold }}\n\nHigh Value Profiles:\n{{ JSON.stringify($json.segmentedProfiles.highValue.slice(0, 10), null, 2) }}\n\nAt Risk Profiles:\n{{ JSON.stringify($json.segmentedProfiles.atRisk.slice(0, 10), null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.3
          }
        },
        "id": "ai-insights",
        "name": "AI-Powered Insights",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "// Audience Activation - Prepare audiences for downstream systems\n\nconst profileData = $('Behavioral Analysis').first().json;\nconst aiInsights = $('AI-Powered Insights').first().json;\n\nconst activations = [];\n\n// High-value segment â†’ Sales handoff\nprofileData.segmentedProfiles.highValue.forEach(profile => {\n  activations.push({\n    destination: 'salesforce',\n    action: 'upsert_lead',\n    profile: {\n      email: profile.email,\n      firstName: profile.firstName,\n      lastName: profile.lastName,\n      company: profile.company,\n      leadScore: profile.analysis.engagementScore,\n      stage: 'Qualified',\n      source: 'CDP High-Value Segment'\n    }\n  });\n});\n\n// At-risk segment â†’ Retention campaign\nprofileData.segmentedProfiles.atRisk.forEach(profile => {\n  activations.push({\n    destination: 'customer_io',\n    action: 'trigger_campaign',\n    campaign: 'retention_win_back',\n    profile: {\n      email: profile.email,\n      firstName: profile.firstName,\n      churnRisk: profile.analysis.churnRisk,\n      daysSinceActive: profile.analysis.daysSinceActive\n    }\n  });\n});\n\n// Needs nurturing â†’ Marketing automation\nprofileData.segmentedProfiles.needsNurturing.forEach(profile => {\n  activations.push({\n    destination: 'hubspot',\n    action: 'add_to_workflow',\n    workflow: 'nurture_sequence_v2',\n    profile: {\n      email: profile.email,\n      firstName: profile.firstName,\n      lifecycleStage: profile.analysis.predictedStage,\n      engagementScore: profile.analysis.engagementScore\n    }\n  });\n});\n\n// Priority accounts â†’ Slack notification\nconst priorityNotifications = aiInsights.priorityAccounts?.map(account => ({\n  destination: 'slack',\n  action: 'send_message',\n  channel: '#priority-accounts',\n  message: `ðŸŽ¯ Priority Account Alert\\n*${account.email}*\\nReason: ${account.reason}\\nRecommended Action: ${account.action}`\n})) || [];\n\nreturn [{\n  json: {\n    totalActivations: activations.length,\n    activations,\n    priorityNotifications,\n    insights: aiInsights,\n    activatedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "audience-activation",
        "name": "Audience Activation",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1250,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://track.customer.io/api/v1/customers/{{ $json.profile.email }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpBasicAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"email\": \"{{ $json.profile.email }}\",\n  \"first_name\": \"{{ $json.profile.firstName }}\",\n  \"churn_risk\": \"{{ $json.profile.churnRisk }}\",\n  \"days_since_active\": {{ $json.profile.daysSinceActive }},\n  \"segment\": \"at_risk\"\n}",
          "options": {}
        },
        "id": "sync-to-customerio",
        "name": "Sync to Customer.io",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.hubspot.com/crm/v3/objects/contacts",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "hubSpotApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"properties\": {\n    \"email\": \"{{ $json.profile.email }}\",\n    \"firstname\": \"{{ $json.profile.firstName }}\",\n    \"lifecyclestage\": \"{{ $json.profile.lifecycleStage }}\",\n    \"hs_lead_status\": \"OPEN\",\n    \"cdp_engagement_score\": \"{{ $json.profile.engagementScore }}\"\n  }\n}",
          "options": {}
        },
        "id": "sync-to-hubspot",
        "name": "Sync to HubSpot",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.segment.io/v1/identify",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpBasicAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"userId\": \"{{ $json.profile.email }}\",\n  \"traits\": {\n    \"email\": \"{{ $json.profile.email }}\",\n    \"first_name\": \"{{ $json.profile.firstName }}\",\n    \"last_name\": \"{{ $json.profile.lastName }}\",\n    \"company\": \"{{ $json.profile.company }}\",\n    \"engagement_score\": {{ $json.engagementScore || 0 }},\n    \"predicted_stage\": \"{{ $json.predictedStage }}\",\n    \"churn_risk\": \"{{ $json.churnRisk }}\",\n    \"cdp_unified_profile_id\": \"{{ $json.unifiedProfileId }}\"\n  }\n}",
          "options": {}
        },
        "id": "sync-to-segment",
        "name": "Sync to Segment",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#customer-data",
          "text": "=ðŸ“Š *CDP Sync Report*\n\n*Profiles Processed:* {{ $('Behavioral Analysis').first().json.profiles.length }}\n\n*Segment Distribution:*\nâ€¢ High Value: {{ $('Behavioral Analysis').first().json.segments.highValue }}\nâ€¢ At Risk: {{ $('Behavioral Analysis').first().json.segments.atRisk }}\nâ€¢ Needs Nurturing: {{ $('Behavioral Analysis').first().json.segments.needsNurturing }}\nâ€¢ Cold: {{ $('Behavioral Analysis').first().json.segments.cold }}\n\n*AI Insights:*\n{{ $('AI-Powered Insights').first().json.insights?.slice(0, 3).map((i, idx) => (idx + 1) + '. ' + i).join('\\n') }}\n\n*Predicted MRR Impact:* {{ $('AI-Powered Insights').first().json.predictedMRRImpact }}\n*Churn Risk Reduction:* {{ $('AI-Powered Insights').first().json.churnRiskReduction }}\n\n*Activations:* {{ $json.totalActivations }} profiles synced to downstream systems",
          "otherOptions": {}
        },
        "id": "slack-cdp-report",
        "name": "Slack CDP Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1750,
          500
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.CDP_ANALYTICS_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Profile History",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ new Date().toISOString() }}",
              "total_profiles": "={{ $('Behavioral Analysis').first().json.profiles.length }}",
              "high_value": "={{ $('Behavioral Analysis').first().json.segments.highValue }}",
              "at_risk": "={{ $('Behavioral Analysis').first().json.segments.atRisk }}",
              "needs_nurturing": "={{ $('Behavioral Analysis').first().json.segments.needsNurturing }}",
              "cold": "={{ $('Behavioral Analysis').first().json.segments.cold }}",
              "activations": "={{ $json.totalActivations }}"
            }
          }
        },
        "id": "log-to-sheets",
        "name": "Log CDP Analytics",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1750,
          700
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"status\": \"success\",\n  \"profilesProcessed\": {{ $('Behavioral Analysis').first().json.profiles.length }},\n  \"segments\": {{ JSON.stringify($('Behavioral Analysis').first().json.segments) }},\n  \"activations\": {{ $json.totalActivations }},\n  \"insights\": {{ JSON.stringify($('AI-Powered Insights').first().json.insights) }},\n  \"timestamp\": \"{{ new Date().toISOString() }}\"\n}"
        },
        "id": "webhook-response",
        "name": "Webhook Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1750,
          300
        ]
      }
    ],
    "connections": {
      "Data Ingestion Webhook": {
        "main": [
          [
            {
              "node": "Fetch Segment Profiles",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch HubSpot Contacts",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Intercom Users",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Mixpanel Profiles",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Scheduled Data Sync": {
        "main": [
          [
            {
              "node": "Fetch Segment Profiles",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch HubSpot Contacts",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Intercom Users",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Mixpanel Profiles",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Segment Profiles": {
        "main": [
          [
            {
              "node": "Identity Resolution Engine",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch HubSpot Contacts": {
        "main": [
          [
            {
              "node": "Identity Resolution Engine",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Intercom Users": {
        "main": [
          [
            {
              "node": "Identity Resolution Engine",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Mixpanel Profiles": {
        "main": [
          [
            {
              "node": "Identity Resolution Engine",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Identity Resolution Engine": {
        "main": [
          [
            {
              "node": "Behavioral Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Behavioral Analysis": {
        "main": [
          [
            {
              "node": "AI-Powered Insights",
              "type": "main",
              "index": 0
            },
            {
              "node": "Audience Activation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI-Powered Insights": {
        "main": [
          [
            {
              "node": "Audience Activation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Audience Activation": {
        "main": [
          [
            {
              "node": "Sync to Customer.io",
              "type": "main",
              "index": 0
            },
            {
              "node": "Sync to HubSpot",
              "type": "main",
              "index": 0
            },
            {
              "node": "Sync to Segment",
              "type": "main",
              "index": 0
            },
            {
              "node": "Slack CDP Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log CDP Analytics",
              "type": "main",
              "index": 0
            },
            {
              "node": "Webhook Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-saas-cdp"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 2,
    "tags": [
      {
        "name": "CDP",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Customer Data",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Identity Resolution",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "AI",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain Invoice & Billing Automation v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 1 * *"
              }
            ]
          }
        },
        "id": "monthly-invoice-trigger",
        "name": "Monthly Invoice Generation",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          300
        ]
      },
      {
        "parameters": {},
        "id": "webhook-milestone",
        "name": "Milestone Completed Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          500
        ],
        "webhookId": "milestone-invoice-trigger"
      },
      {
        "parameters": {
          "events": [
            "invoice.payment_succeeded",
            "invoice.payment_failed",
            "customer.subscription.updated",
            "customer.subscription.deleted"
          ]
        },
        "id": "stripe-webhook",
        "name": "Stripe Webhook Events",
        "type": "n8n-nodes-base.stripeTrigger",
        "typeVersion": 1,
        "position": [
          200,
          700
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.CLIENT_DATABASE_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Billing",
            "mode": "list"
          },
          "options": {
            "filterByFormula": "AND({billing_type} = 'recurring', {status} = 'active')"
          }
        },
        "id": "get-recurring-clients",
        "name": "Get Recurring Clients",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "// Invoice Generator\n// Creates invoice data structure for different billing types\n\nconst client = $input.first().json;\nconst billingDate = new Date();\n\nconst invoice = {\n  invoiceNumber: `INV-${billingDate.getFullYear()}${String(billingDate.getMonth() + 1).padStart(2, '0')}-${client.client_id}-${Date.now().toString().slice(-4)}`,\n  \n  // Client details\n  client: {\n    id: client.client_id,\n    name: client.client_name,\n    email: client.billing_email || client.email,\n    address: client.billing_address,\n    taxId: client.tax_id,\n    stripeCustomerId: client.stripe_customer_id\n  },\n  \n  // Invoice details\n  issueDate: billingDate.toISOString().split('T')[0],\n  dueDate: new Date(billingDate.getTime() + 30*24*60*60*1000).toISOString().split('T')[0],\n  currency: client.currency || 'USD',\n  \n  // Line items\n  lineItems: [],\n  \n  // Billing type specific\n  billingType: client.billing_type, // recurring, milestone, hourly, one-time\n  billingPeriod: {\n    start: new Date(billingDate.getFullYear(), billingDate.getMonth() - 1, 1).toISOString().split('T')[0],\n    end: new Date(billingDate.getFullYear(), billingDate.getMonth(), 0).toISOString().split('T')[0]\n  },\n  \n  // Totals (calculated after line items)\n  subtotal: 0,\n  taxRate: parseFloat(client.tax_rate) || 0,\n  taxAmount: 0,\n  discount: parseFloat(client.discount) || 0,\n  total: 0,\n  \n  // Payment\n  paymentMethod: client.payment_method || 'stripe',\n  status: 'draft',\n  \n  // Notes\n  notes: client.invoice_notes || '',\n  terms: client.payment_terms || 'Net 30'\n};\n\n// Add line items based on billing type\nswitch (client.billing_type) {\n  case 'recurring':\n    // Retainer or subscription\n    invoice.lineItems.push({\n      description: client.service_description || 'Monthly Retainer Services',\n      quantity: 1,\n      unitPrice: parseFloat(client.monthly_rate) || 0,\n      amount: parseFloat(client.monthly_rate) || 0\n    });\n    \n    // Add any overage charges\n    if (client.overage_hours > 0) {\n      invoice.lineItems.push({\n        description: `Additional Hours (${client.overage_hours} hrs @ $${client.hourly_rate}/hr)`,\n        quantity: parseFloat(client.overage_hours),\n        unitPrice: parseFloat(client.hourly_rate),\n        amount: parseFloat(client.overage_hours) * parseFloat(client.hourly_rate)\n      });\n    }\n    break;\n    \n  case 'milestone':\n    // Project milestone\n    invoice.lineItems.push({\n      description: `${client.project_name}: ${client.milestone_name}`,\n      quantity: 1,\n      unitPrice: parseFloat(client.milestone_amount) || 0,\n      amount: parseFloat(client.milestone_amount) || 0\n    });\n    break;\n    \n  case 'hourly':\n    // Time-based billing\n    const hours = parseFloat(client.hours_worked) || 0;\n    const rate = parseFloat(client.hourly_rate) || 0;\n    invoice.lineItems.push({\n      description: `Professional Services - ${hours} hours`,\n      quantity: hours,\n      unitPrice: rate,\n      amount: hours * rate\n    });\n    break;\n}\n\n// Add any recurring add-ons\nif (client.addons) {\n  const addons = typeof client.addons === 'string' ? JSON.parse(client.addons) : client.addons;\n  addons.forEach(addon => {\n    invoice.lineItems.push({\n      description: addon.name,\n      quantity: addon.quantity || 1,\n      unitPrice: addon.price,\n      amount: (addon.quantity || 1) * addon.price\n    });\n  });\n}\n\n// Calculate totals\ninvoice.subtotal = invoice.lineItems.reduce((sum, item) => sum + item.amount, 0);\ninvoice.taxAmount = invoice.subtotal * (invoice.taxRate / 100);\ninvoice.total = invoice.subtotal + invoice.taxAmount - invoice.discount;\n\nreturn [{ json: invoice }];"
        },
        "id": "generate-invoice",
        "name": "Generate Invoice",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          700,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.stripe.com/v1/invoices",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "stripeApi",
          "sendBody": true,
          "contentType": "form-urlencoded",
          "bodyParameters": {
            "parameters": [
              {
                "name": "customer",
                "value": "={{ $json.client.stripeCustomerId }}"
              },
              {
                "name": "collection_method",
                "value": "send_invoice"
              },
              {
                "name": "days_until_due",
                "value": "30"
              },
              {
                "name": "auto_advance",
                "value": "true"
              },
              {
                "name": "metadata[invoice_number]",
                "value": "={{ $json.invoiceNumber }}"
              },
              {
                "name": "metadata[client_id]",
                "value": "={{ $json.client.id }}"
              }
            ]
          },
          "options": {}
        },
        "id": "create-stripe-invoice",
        "name": "Create Stripe Invoice",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          950,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.stripe.com/v1/invoiceitems",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "stripeApi",
          "sendBody": true,
          "contentType": "form-urlencoded",
          "bodyParameters": {
            "parameters": [
              {
                "name": "customer",
                "value": "={{ $json.client.stripeCustomerId }}"
              },
              {
                "name": "invoice",
                "value": "={{ $('Create Stripe Invoice').first().json.id }}"
              },
              {
                "name": "amount",
                "value": "={{ Math.round($json.total * 100) }}"
              },
              {
                "name": "currency",
                "value": "={{ $json.currency.toLowerCase() }}"
              },
              {
                "name": "description",
                "value": "={{ $json.lineItems.map(i => i.description).join(', ') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "add-stripe-line-items",
        "name": "Add Stripe Line Items",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          950,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.stripe.com/v1/invoices/{{ $('Create Stripe Invoice').first().json.id }}/finalize",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "stripeApi",
          "options": {}
        },
        "id": "finalize-stripe-invoice",
        "name": "Finalize & Send Invoice",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1200,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "// Process Stripe Payment Events\n\nconst event = $input.first().json;\nconst eventType = event.type;\nconst invoiceData = event.data?.object || {};\n\nconst paymentEvent = {\n  eventType,\n  eventId: event.id,\n  invoiceId: invoiceData.id,\n  invoiceNumber: invoiceData.metadata?.invoice_number || invoiceData.number,\n  customerId: invoiceData.customer,\n  amount: (invoiceData.amount_paid || invoiceData.amount_due || 0) / 100,\n  currency: invoiceData.currency?.toUpperCase(),\n  status: invoiceData.status,\n  paidAt: invoiceData.status_transitions?.paid_at \n    ? new Date(invoiceData.status_transitions.paid_at * 1000).toISOString() \n    : null,\n  hostedInvoiceUrl: invoiceData.hosted_invoice_url,\n  pdfUrl: invoiceData.invoice_pdf,\n  processedAt: new Date().toISOString()\n};\n\n// Determine notification type\nswitch (eventType) {\n  case 'invoice.payment_succeeded':\n    paymentEvent.notificationType = 'payment_success';\n    paymentEvent.message = `Payment of $${paymentEvent.amount} received for invoice ${paymentEvent.invoiceNumber}`;\n    break;\n  case 'invoice.payment_failed':\n    paymentEvent.notificationType = 'payment_failed';\n    paymentEvent.message = `Payment failed for invoice ${paymentEvent.invoiceNumber}. Amount: $${paymentEvent.amount}`;\n    paymentEvent.failureReason = invoiceData.last_finalization_error?.message || 'Unknown error';\n    break;\n  case 'customer.subscription.updated':\n    paymentEvent.notificationType = 'subscription_updated';\n    paymentEvent.message = `Subscription updated for customer ${paymentEvent.customerId}`;\n    break;\n  case 'customer.subscription.deleted':\n    paymentEvent.notificationType = 'subscription_cancelled';\n    paymentEvent.message = `Subscription cancelled for customer ${paymentEvent.customerId}`;\n    break;\n}\n\nreturn [{ json: paymentEvent }];"
        },
        "id": "process-payment-event",
        "name": "Process Payment Event",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          700
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "payment-failed",
                "leftValue": "={{ $json.notificationType }}",
                "rightValue": "payment_failed",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ]
          }
        },
        "id": "check-payment-status",
        "name": "Payment Failed?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          700,
          700
        ]
      },
      {
        "parameters": {
          "to": "={{ $json.customerEmail }}",
          "subject": "Action Required: Payment Failed for Invoice {{ $json.invoiceNumber }}",
          "emailType": "html",
          "html": "=<div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n  <h2 style=\"color: #e74c3c;\">Payment Failed</h2>\n  <p>We were unable to process your payment for invoice <strong>{{ $json.invoiceNumber }}</strong>.</p>\n  \n  <div style=\"background: #fef2f2; padding: 15px; border-radius: 8px; margin: 20px 0;\">\n    <p><strong>Amount Due:</strong> ${{ $json.amount }}</p>\n    <p><strong>Reason:</strong> {{ $json.failureReason }}</p>\n  </div>\n  \n  <p>Please update your payment method or try again:</p>\n  \n  <div style=\"text-align: center; margin: 30px 0;\">\n    <a href=\"{{ $json.hostedInvoiceUrl }}\" style=\"background: #3498db; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px;\">Pay Invoice Now</a>\n  </div>\n  \n  <p>If you have questions, please contact us.</p>\n</div>",
          "options": {}
        },
        "id": "send-payment-failed-email",
        "name": "Send Payment Failed Email",
        "type": "n8n-nodes-base.sendEmail",
        "typeVersion": 2.1,
        "position": [
          950,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#billing-alerts",
          "text": "=ðŸš¨ *Payment Failed Alert*\n\n*Invoice:* {{ $json.invoiceNumber }}\n*Customer:* {{ $json.customerId }}\n*Amount:* ${{ $json.amount }} {{ $json.currency }}\n*Reason:* {{ $json.failureReason }}\n\n_Action Required: Follow up with customer_",
          "otherOptions": {}
        },
        "id": "slack-payment-failed",
        "name": "Slack Payment Failed Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          950,
          800
        ]
      },
      {
        "parameters": {
          "to": "={{ $json.customerEmail }}",
          "subject": "Thank you! Payment received for Invoice {{ $json.invoiceNumber }}",
          "emailType": "html",
          "html": "=<div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n  <h2 style=\"color: #27ae60;\">âœ“ Payment Received</h2>\n  <p>Thank you! We've received your payment.</p>\n  \n  <div style=\"background: #f0fdf4; padding: 15px; border-radius: 8px; margin: 20px 0;\">\n    <p><strong>Invoice Number:</strong> {{ $json.invoiceNumber }}</p>\n    <p><strong>Amount Paid:</strong> ${{ $json.amount }} {{ $json.currency }}</p>\n    <p><strong>Date:</strong> {{ new Date($json.paidAt).toLocaleDateString() }}</p>\n  </div>\n  \n  <p><a href=\"{{ $json.pdfUrl }}\">Download PDF Receipt</a></p>\n  \n  <p>Thank you for your business!</p>\n</div>",
          "options": {}
        },
        "id": "send-payment-success-email",
        "name": "Send Payment Success Email",
        "type": "n8n-nodes-base.sendEmail",
        "typeVersion": 2.1,
        "position": [
          950,
          950
        ]
      },
      {
        "parameters": {
          "channel": "#billing",
          "text": "=âœ… *Payment Received*\n\n*Invoice:* {{ $json.invoiceNumber }}\n*Amount:* ${{ $json.amount }} {{ $json.currency }}\n*Customer:* {{ $json.customerId }}",
          "otherOptions": {}
        },
        "id": "slack-payment-success",
        "name": "Slack Payment Success",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1200,
          950
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 * * *"
              }
            ]
          }
        },
        "id": "daily-overdue-check",
        "name": "Daily Overdue Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          1100
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.stripe.com/v1/invoices",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "stripeApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "status",
                "value": "open"
              },
              {
                "name": "due_date[lt]",
                "value": "={{ Math.floor(Date.now() / 1000) }}"
              }
            ]
          },
          "options": {}
        },
        "id": "get-overdue-invoices",
        "name": "Get Overdue Invoices",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          1100
        ]
      },
      {
        "parameters": {
          "jsCode": "// Process overdue invoices for reminders\n\nconst overdueInvoices = $input.first().json.data || [];\n\nreturn overdueInvoices.map(invoice => {\n  const daysOverdue = Math.floor((Date.now() / 1000 - invoice.due_date) / (24 * 60 * 60));\n  \n  return {\n    json: {\n      invoiceId: invoice.id,\n      invoiceNumber: invoice.number,\n      customerId: invoice.customer,\n      customerEmail: invoice.customer_email,\n      amount: invoice.amount_due / 100,\n      currency: invoice.currency.toUpperCase(),\n      dueDate: new Date(invoice.due_date * 1000).toISOString().split('T')[0],\n      daysOverdue,\n      hostedInvoiceUrl: invoice.hosted_invoice_url,\n      reminderLevel: daysOverdue <= 7 ? 'gentle' : daysOverdue <= 14 ? 'firm' : 'urgent'\n    }\n  };\n});"
        },
        "id": "process-overdue",
        "name": "Process Overdue Invoices",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          700,
          1100
        ]
      },
      {
        "parameters": {
          "to": "={{ $json.customerEmail }}",
          "subject": "={{ $json.reminderLevel === 'urgent' ? 'âš ï¸ URGENT: ' : '' }}Payment Reminder - Invoice {{ $json.invoiceNumber }}",
          "emailType": "html",
          "html": "=<div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n  <h2>Payment Reminder</h2>\n  <p>This is a {{ $json.reminderLevel }} reminder that invoice <strong>{{ $json.invoiceNumber }}</strong> is now {{ $json.daysOverdue }} days overdue.</p>\n  \n  <div style=\"background: {{ $json.reminderLevel === 'urgent' ? '#fef2f2' : '#fffbeb' }}; padding: 15px; border-radius: 8px; margin: 20px 0;\">\n    <p><strong>Amount Due:</strong> ${{ $json.amount }} {{ $json.currency }}</p>\n    <p><strong>Due Date:</strong> {{ $json.dueDate }}</p>\n    <p><strong>Days Overdue:</strong> {{ $json.daysOverdue }}</p>\n  </div>\n  \n  <div style=\"text-align: center; margin: 30px 0;\">\n    <a href=\"{{ $json.hostedInvoiceUrl }}\" style=\"background: {{ $json.reminderLevel === 'urgent' ? '#e74c3c' : '#3498db' }}; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px;\">Pay Now</a>\n  </div>\n  \n  {{ $json.reminderLevel === 'urgent' ? '<p style=\"color: #e74c3c;\"><strong>Please note:</strong> To avoid service interruption, please make payment immediately.</p>' : '' }}\n</div>",
          "options": {}
        },
        "id": "send-overdue-reminder",
        "name": "Send Overdue Reminder",
        "type": "n8n-nodes-base.sendEmail",
        "typeVersion": 2.1,
        "position": [
          950,
          1100
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.BILLING_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Invoice Log",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ new Date().toISOString() }}",
              "invoice_number": "={{ $json.invoiceNumber }}",
              "client_id": "={{ $json.client?.id }}",
              "client_name": "={{ $json.client?.name }}",
              "amount": "={{ $json.total }}",
              "status": "={{ $json.status }}",
              "stripe_invoice_id": "={{ $('Create Stripe Invoice').first()?.json?.id || '' }}",
              "billing_type": "={{ $json.billingType }}"
            }
          }
        },
        "id": "log-invoice",
        "name": "Log Invoice",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1450,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#billing",
          "text": "=ðŸ“„ *Invoice Generated*\n\n*Invoice #:* {{ $json.invoiceNumber }}\n*Client:* {{ $json.client.name }}\n*Amount:* ${{ $json.total.toFixed(2) }} {{ $json.currency }}\n*Due Date:* {{ $json.dueDate }}\n*Type:* {{ $json.billingType }}\n\n<{{ $('Finalize & Send Invoice').first()?.json?.hosted_invoice_url || '#' }}|View Invoice>",
          "otherOptions": {}
        },
        "id": "slack-invoice-created",
        "name": "Slack Invoice Created",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1450,
          600
        ]
      }
    ],
    "connections": {
      "Monthly Invoice Generation": {
        "main": [
          [
            {
              "node": "Get Recurring Clients",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Milestone Completed Webhook": {
        "main": [
          [
            {
              "node": "Generate Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Stripe Webhook Events": {
        "main": [
          [
            {
              "node": "Process Payment Event",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Recurring Clients": {
        "main": [
          [
            {
              "node": "Generate Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Invoice": {
        "main": [
          [
            {
              "node": "Create Stripe Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Stripe Invoice": {
        "main": [
          [
            {
              "node": "Add Stripe Line Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Stripe Line Items": {
        "main": [
          [
            {
              "node": "Finalize & Send Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Finalize & Send Invoice": {
        "main": [
          [
            {
              "node": "Log Invoice",
              "type": "main",
              "index": 0
            },
            {
              "node": "Slack Invoice Created",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Payment Event": {
        "main": [
          [
            {
              "node": "Payment Failed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Payment Failed?": {
        "main": [
          [
            {
              "node": "Send Payment Failed Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Slack Payment Failed Alert",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Payment Success Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Slack Payment Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Overdue Check": {
        "main": [
          [
            {
              "node": "Get Overdue Invoices",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Overdue Invoices": {
        "main": [
          [
            {
              "node": "Process Overdue Invoices",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Overdue Invoices": {
        "main": [
          [
            {
              "node": "Send Overdue Reminder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-invoice-billing-automation"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 4,
    "tags": [
      {
        "name": "Billing",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Invoice",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Stripe",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Automation",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain Keyword Research Pipeline v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "keyword-research",
          "options": {}
        },
        "id": "research-webhook",
        "name": "Research Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "keyword-research"
      },
      {
        "parameters": {
          "jsCode": "// Initialize keyword research\nconst request = $input.first().json.body;\n\nconst researchConfig = {\n  researchId: `KW-${Date.now().toString(36).toUpperCase()}`,\n  seedKeywords: request.seedKeywords || [],\n  domain: request.domain,\n  competitors: request.competitors || [],\n  country: request.country || 'US',\n  language: request.language || 'en',\n  intent: request.intent || 'all', // all, informational, transactional, navigational, commercial\n  difficulty: request.maxDifficulty || 100,\n  minVolume: request.minVolume || 10,\n  maxVolume: request.maxVolume || null,\n  includeQuestions: request.includeQuestions !== false,\n  includeRelated: request.includeRelated !== false,\n  includeLongTail: request.includeLongTail !== false,\n  limit: request.limit || 500,\n  startedAt: new Date().toISOString()\n};\n\nreturn [{ json: researchConfig }];"
        },
        "id": "init-research",
        "name": "Initialize Research",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.KEYWORD_API_URL }}/research",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"keywords\": {{ JSON.stringify($json.seedKeywords) }},\n  \"country\": \"{{ $json.country }}\",\n  \"language\": \"{{ $json.language }}\",\n  \"includeMetrics\": true,\n  \"limit\": {{ $json.limit }}\n}",
          "options": {
            "timeout": 60000
          }
        },
        "id": "fetch-seed-metrics",
        "name": "Fetch Seed Metrics",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "keyword-api-key",
            "name": "Keyword API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.KEYWORD_API_URL }}/related",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"keywords\": {{ JSON.stringify($json.seedKeywords) }},\n  \"country\": \"{{ $json.country }}\",\n  \"language\": \"{{ $json.language }}\",\n  \"depth\": 2,\n  \"limit\": {{ Math.floor($json.limit / 2) }}\n}",
          "options": {
            "timeout": 60000
          }
        },
        "id": "fetch-related",
        "name": "Fetch Related Keywords",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "keyword-api-key",
            "name": "Keyword API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.KEYWORD_API_URL }}/questions",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"keywords\": {{ JSON.stringify($json.seedKeywords) }},\n  \"country\": \"{{ $json.country }}\",\n  \"language\": \"{{ $json.language }}\",\n  \"questionTypes\": [\"what\", \"how\", \"why\", \"when\", \"where\", \"which\", \"who\", \"can\", \"does\", \"is\"],\n  \"limit\": 100\n}",
          "options": {}
        },
        "id": "fetch-questions",
        "name": "Fetch Question Keywords",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          700
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "keyword-api-key",
            "name": "Keyword API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.KEYWORD_API_URL }}/competitors/keywords",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "domains",
                "value": "={{ $json.competitors.join(',') }}"
              },
              {
                "name": "country",
                "value": "={{ $json.country }}"
              },
              {
                "name": "limit",
                "value": "={{ Math.floor($json.limit / 3) }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-competitor-keywords",
        "name": "Competitor Keywords",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          900
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "keyword-api-key",
            "name": "Keyword API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Merge and deduplicate all keywords\nconst config = $('Initialize Research').first().json;\nconst seedData = $('Fetch Seed Metrics').first().json;\nconst relatedData = $('Fetch Related Keywords').first().json;\nconst questionData = $('Fetch Question Keywords').first().json;\nconst competitorData = $('Competitor Keywords').first().json;\n\n// Collect all keywords\nconst allKeywords = new Map();\n\n// Process seed keywords\n(seedData.keywords || []).forEach(kw => {\n  allKeywords.set(kw.keyword.toLowerCase(), {\n    ...kw,\n    source: 'seed',\n    keyword: kw.keyword.toLowerCase()\n  });\n});\n\n// Process related keywords\n(relatedData.keywords || []).forEach(kw => {\n  const key = kw.keyword.toLowerCase();\n  if (!allKeywords.has(key)) {\n    allKeywords.set(key, {\n      ...kw,\n      source: 'related',\n      keyword: key\n    });\n  }\n});\n\n// Process question keywords\n(questionData.keywords || []).forEach(kw => {\n  const key = kw.keyword.toLowerCase();\n  if (!allKeywords.has(key)) {\n    allKeywords.set(key, {\n      ...kw,\n      source: 'question',\n      keyword: key,\n      isQuestion: true\n    });\n  } else {\n    allKeywords.get(key).isQuestion = true;\n  }\n});\n\n// Process competitor keywords\n(competitorData.keywords || []).forEach(kw => {\n  const key = kw.keyword.toLowerCase();\n  if (!allKeywords.has(key)) {\n    allKeywords.set(key, {\n      ...kw,\n      source: 'competitor',\n      keyword: key\n    });\n  } else {\n    allKeywords.get(key).competitorRanking = kw.position;\n  }\n});\n\n// Convert to array and filter\nlet keywords = Array.from(allKeywords.values())\n  .filter(kw => {\n    if (kw.volume < config.minVolume) return false;\n    if (config.maxVolume && kw.volume > config.maxVolume) return false;\n    if (kw.difficulty > config.difficulty) return false;\n    if (config.intent !== 'all' && kw.intent !== config.intent) return false;\n    return true;\n  });\n\n// Classify intent if not present\nkeywords = keywords.map(kw => {\n  if (!kw.intent) {\n    const keyword = kw.keyword;\n    if (/buy|price|cheap|discount|deal|order|shop/.test(keyword)) {\n      kw.intent = 'transactional';\n    } else if (/best|top|review|vs|compare|alternative/.test(keyword)) {\n      kw.intent = 'commercial';\n    } else if (/how|what|why|when|where|guide|tutorial|learn/.test(keyword)) {\n      kw.intent = 'informational';\n    } else {\n      kw.intent = 'navigational';\n    }\n  }\n  \n  // Calculate opportunity score\n  kw.opportunityScore = Math.round(\n    (kw.volume / 1000) * (100 - kw.difficulty) / 10\n  );\n  \n  // Classify as long-tail\n  kw.isLongTail = kw.keyword.split(' ').length >= 4;\n  \n  return kw;\n});\n\n// Sort by opportunity score\nkeywords.sort((a, b) => b.opportunityScore - a.opportunityScore);\n\nreturn [{ json: {\n  config,\n  keywords: keywords.slice(0, config.limit),\n  totalFound: keywords.length\n}}];"
        },
        "id": "merge-keywords",
        "name": "Merge & Deduplicate",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          600
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are an SEO Keyword Strategist. Analyze the keyword data and create strategic clusters for content planning.\n\nFor each cluster, provide:\n1. Cluster name and theme\n2. Primary keyword (highest opportunity)\n3. Supporting keywords (semantically related)\n4. Content type recommendation (blog, landing page, product page, FAQ)\n5. Estimated traffic potential\n6. Priority score (1-10)",
                "role": "system"
              },
              {
                "content": "=Analyze these keywords for {{ $json.config.domain }}:\n\n**Seed Keywords:** {{ $json.config.seedKeywords.join(', ') }}\n**Total Keywords Found:** {{ $json.totalFound }}\n\n**Top 50 Keywords by Opportunity:**\n{{ $json.keywords.slice(0, 50).map(k => \n  `- ${k.keyword} (Vol: ${k.volume}, KD: ${k.difficulty}, Intent: ${k.intent}, Score: ${k.opportunityScore})`\n).join('\\n') }}\n\n**Question Keywords:**\n{{ $json.keywords.filter(k => k.isQuestion).slice(0, 20).map(k => `- ${k.keyword}`).join('\\n') }}\n\nCreate strategic keyword clusters for content planning.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.5,
            "maxTokens": 3000
          }
        },
        "id": "ai-clustering",
        "name": "AI Keyword Clustering",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1250,
          500
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are an SEO Content Strategist. Based on keyword data, identify content gaps and opportunities.\n\nAnalyze:\n1. Keywords competitors rank for that we don't\n2. Question keywords that need FAQ/guide content\n3. Long-tail opportunities for quick wins\n4. High-volume keywords worth targeting\n5. Seasonal/trending keywords to plan for",
                "role": "system"
              },
              {
                "content": "=Identify content gaps for {{ $json.config.domain }}:\n\n**Competitor Keywords (we don't rank):**\n{{ $json.keywords.filter(k => k.source === 'competitor').slice(0, 30).map(k => \n  `- ${k.keyword} (Vol: ${k.volume}, Competitor Rank: ${k.competitorRanking || 'Top 10'})`\n).join('\\n') }}\n\n**Long-tail Opportunities:**\n{{ $json.keywords.filter(k => k.isLongTail && k.difficulty < 30).slice(0, 20).map(k => \n  `- ${k.keyword} (Vol: ${k.volume}, KD: ${k.difficulty})`\n).join('\\n') }}\n\n**High-Volume Keywords (KD < 50):**\n{{ $json.keywords.filter(k => k.volume > 1000 && k.difficulty < 50).slice(0, 15).map(k => \n  `- ${k.keyword} (Vol: ${k.volume}, KD: ${k.difficulty})`\n).join('\\n') }}\n\nIdentify the best content opportunities.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.4,
            "maxTokens": 2000
          }
        },
        "id": "ai-gap-analysis",
        "name": "AI Gap Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1250,
          700
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Compile final research report\nconst mergedData = $('Merge & Deduplicate').first().json;\nconst clusters = $('AI Keyword Clustering').first().json;\nconst gapAnalysis = $('AI Gap Analysis').first().json;\nconst config = mergedData.config;\n\n// Calculate summary stats\nconst keywords = mergedData.keywords;\nconst avgVolume = Math.round(keywords.reduce((a, b) => a + b.volume, 0) / keywords.length);\nconst avgDifficulty = Math.round(keywords.reduce((a, b) => a + b.difficulty, 0) / keywords.length);\n\nconst intentDistribution = {\n  informational: keywords.filter(k => k.intent === 'informational').length,\n  transactional: keywords.filter(k => k.intent === 'transactional').length,\n  commercial: keywords.filter(k => k.intent === 'commercial').length,\n  navigational: keywords.filter(k => k.intent === 'navigational').length\n};\n\nconst report = {\n  researchId: config.researchId,\n  domain: config.domain,\n  seedKeywords: config.seedKeywords,\n  completedAt: new Date().toISOString(),\n  summary: {\n    totalKeywords: keywords.length,\n    avgVolume,\n    avgDifficulty,\n    totalSearchVolume: keywords.reduce((a, b) => a + b.volume, 0),\n    questionKeywords: keywords.filter(k => k.isQuestion).length,\n    longTailKeywords: keywords.filter(k => k.isLongTail).length,\n    lowCompetition: keywords.filter(k => k.difficulty < 30).length,\n    intentDistribution\n  },\n  topOpportunities: keywords.slice(0, 20).map(k => ({\n    keyword: k.keyword,\n    volume: k.volume,\n    difficulty: k.difficulty,\n    intent: k.intent,\n    opportunityScore: k.opportunityScore\n  })),\n  quickWins: keywords.filter(k => k.difficulty < 30 && k.volume > 100).slice(0, 10),\n  clusters: clusters.clusters || clusters,\n  gapAnalysis,\n  allKeywords: keywords,\n  exportUrls: {\n    csv: `{{ $vars.EXPORT_BASE_URL }}/keywords/${config.researchId}/csv`,\n    xlsx: `{{ $vars.EXPORT_BASE_URL }}/keywords/${config.researchId}/xlsx`\n  }\n};\n\nreturn [{ json: report }];"
        },
        "id": "compile-report",
        "name": "Compile Report",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1500,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.KEYWORD_DB_URL }}/research",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-research",
        "name": "Save to Database",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1750,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "keyword-db-api",
            "name": "Keyword DB API"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.SEO_SLACK_CHANNEL }}",
          "text": "=ðŸ”‘ *Keyword Research Complete*\n\n*Domain:* {{ $json.domain }}\n*Seeds:* {{ $json.seedKeywords.join(', ') }}\n\nðŸ“Š *Summary:*\nâ€¢ Total Keywords: {{ $json.summary.totalKeywords }}\nâ€¢ Avg Volume: {{ $json.summary.avgVolume }}\nâ€¢ Avg Difficulty: {{ $json.summary.avgDifficulty }}\nâ€¢ Total Search Volume: {{ $json.summary.totalSearchVolume.toLocaleString() }}\n\nðŸŽ¯ *Quick Wins (Low KD, Good Volume):*\n{{ $json.quickWins.slice(0, 5).map(k => `â€¢ ${k.keyword} - Vol: ${k.volume}, KD: ${k.difficulty}`).join('\\n') }}\n\nðŸ† *Top Opportunities:*\n{{ $json.topOpportunities.slice(0, 5).map(k => `â€¢ ${k.keyword} (Score: ${k.opportunityScore})`).join('\\n') }}\n\nðŸ“¥ <{{ $json.exportUrls.csv }}|Download CSV> | <{{ $json.exportUrls.xlsx }}|Download Excel>",
          "otherOptions": {}
        },
        "id": "notify-slack",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1750,
          700
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "respond-webhook",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1750,
          900
        ]
      }
    ],
    "connections": {
      "Research Request": {
        "main": [
          [
            {
              "node": "Initialize Research",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Initialize Research": {
        "main": [
          [
            {
              "node": "Fetch Seed Metrics",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Related Keywords",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Question Keywords",
              "type": "main",
              "index": 0
            },
            {
              "node": "Competitor Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Seed Metrics": {
        "main": [
          [
            {
              "node": "Merge & Deduplicate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Related Keywords": {
        "main": [
          [
            {
              "node": "Merge & Deduplicate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Question Keywords": {
        "main": [
          [
            {
              "node": "Merge & Deduplicate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Competitor Keywords": {
        "main": [
          [
            {
              "node": "Merge & Deduplicate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge & Deduplicate": {
        "main": [
          [
            {
              "node": "AI Keyword Clustering",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Gap Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Keyword Clustering": {
        "main": [
          [
            {
              "node": "Compile Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Gap Analysis": {
        "main": [
          [
            {
              "node": "Compile Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compile Report": {
        "main": [
          [
            {
              "node": "Save to Database",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "seo",
        "name": "seo"
      },
      {
        "id": "keywords",
        "name": "keywords"
      },
      {
        "id": "research",
        "name": "research"
      },
      {
        "id": "ai",
        "name": "ai"
      }
    ],
    "triggerCount": 1,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Landing Page CRO Hub v1",
    "nodes": [
      {
        "parameters": {},
        "id": "webhook-page-request",
        "name": "Page Builder Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          300
        ],
        "webhookId": "landing-page-builder"
      },
      {
        "parameters": {},
        "id": "webhook-form-submit",
        "name": "Form Submission Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          500
        ],
        "webhookId": "form-submission"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * *"
              }
            ]
          }
        },
        "id": "daily-analytics",
        "name": "Daily Analytics Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          700
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an expert Landing Page Designer and Conversion Rate Optimization specialist. Generate high-converting landing page content and structure based on the requirements.\n\nCreate pages that follow CRO best practices:\n- Clear value proposition above the fold\n- Compelling headlines that address pain points\n- Social proof and trust signals\n- Single, focused CTA\n- Minimal distractions\n- Mobile-optimized layout\n\nReturn JSON:\n{\n  \"pageStructure\": {\n    \"hero\": {\n      \"headline\": \"\",\n      \"subheadline\": \"\",\n      \"cta\": {\"text\": \"\", \"color\": \"\"},\n      \"heroImage\": \"description for AI image generation\",\n      \"trustBadges\": []\n    },\n    \"problemSection\": {\n      \"title\": \"\",\n      \"painPoints\": []\n    },\n    \"solutionSection\": {\n      \"title\": \"\",\n      \"features\": [{\"icon\": \"\", \"title\": \"\", \"description\": \"\"}]\n    },\n    \"socialProof\": {\n      \"testimonials\": [{\"quote\": \"\", \"author\": \"\", \"role\": \"\", \"company\": \"\"}],\n      \"logos\": [],\n      \"stats\": [{\"number\": \"\", \"label\": \"\"}]\n    },\n    \"pricing\": {\n      \"showPricing\": true,\n      \"plans\": []\n    },\n    \"faq\": [{\"question\": \"\", \"answer\": \"\"}],\n    \"finalCta\": {\n      \"headline\": \"\",\n      \"subheadline\": \"\",\n      \"buttonText\": \"\"\n    }\n  },\n  \"seoMeta\": {\n    \"title\": \"\",\n    \"description\": \"\",\n    \"keywords\": []\n  },\n  \"conversionGoals\": [],\n  \"abTestSuggestions\": []\n}"
              },
              {
                "role": "user",
                "content": "=Create a landing page for:\n\nProduct/Service: {{ $json.product || 'SaaS Product' }}\nTarget Audience: {{ $json.audience || 'Small business owners' }}\nMain Goal: {{ $json.goal || 'Lead generation' }}\nValue Proposition: {{ $json.valueProp || 'Save time and increase productivity' }}\nTone: {{ $json.tone || 'Professional yet friendly' }}\n\nAdditional Context:\n{{ $json.context || 'None provided' }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-page-generator",
        "name": "AI Page Generator",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Form Optimization Expert. Design high-converting forms with optimal field structure, conditional logic, and progressive profiling.\n\nBest practices:\n- Minimize required fields (each field reduces conversion by ~7%)\n- Use smart defaults and auto-fill\n- Group related fields\n- Show progress for multi-step forms\n- Include microcopy to reduce friction\n\nReturn JSON:\n{\n  \"formStructure\": {\n    \"type\": \"single|multi-step\",\n    \"steps\": [\n      {\n        \"stepName\": \"\",\n        \"fields\": [\n          {\n            \"name\": \"\",\n            \"type\": \"text|email|phone|select|radio|checkbox|textarea\",\n            \"label\": \"\",\n            \"placeholder\": \"\",\n            \"required\": true,\n            \"validation\": \"\",\n            \"helpText\": \"\",\n            \"conditionalLogic\": null\n          }\n        ]\n      }\n    ],\n    \"submitButton\": {\n      \"text\": \"\",\n      \"loadingText\": \"\"\n    }\n  },\n  \"progressiveFields\": [],\n  \"exitIntentPopup\": {\n    \"enabled\": true,\n    \"headline\": \"\",\n    \"offer\": \"\",\n    \"formFields\": []\n  },\n  \"thankYouPage\": {\n    \"headline\": \"\",\n    \"message\": \"\",\n    \"nextSteps\": []\n  }\n}"
              },
              {
                "role": "user",
                "content": "=Design a form for:\n\nPurpose: {{ $json.formPurpose || 'Lead capture' }}\nAudience: {{ $json.audience || 'B2B professionals' }}\nRequired Data: {{ $json.requiredData || 'Name, email, company' }}\nConversion Goal: {{ $json.goal || 'Newsletter signup' }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.5
          }
        },
        "id": "ai-form-builder",
        "name": "AI Form Builder",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "// Form Submission Processor\n// Validates, enriches, and routes form submissions\n\nconst submission = $input.first().json;\n\n// Validate submission\nconst errors = [];\nif (!submission.email || !submission.email.includes('@')) {\n  errors.push('Invalid email address');\n}\n\nif (errors.length > 0) {\n  return [{\n    json: {\n      success: false,\n      errors,\n      submission\n    }\n  }];\n}\n\n// Process submission\nconst processedSubmission = {\n  id: `sub-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n  timestamp: new Date().toISOString(),\n  \n  // Form data\n  data: {\n    email: submission.email?.toLowerCase(),\n    firstName: submission.firstName || submission.first_name || '',\n    lastName: submission.lastName || submission.last_name || '',\n    company: submission.company || '',\n    phone: submission.phone || '',\n    ...submission\n  },\n  \n  // Source tracking\n  source: {\n    page: submission._page || submission.page,\n    utm_source: submission.utm_source || '',\n    utm_medium: submission.utm_medium || '',\n    utm_campaign: submission.utm_campaign || '',\n    referrer: submission._referrer || '',\n    landingPage: submission._landingPage || ''\n  },\n  \n  // Device info\n  device: {\n    userAgent: submission._userAgent || '',\n    screenSize: submission._screenSize || '',\n    isMobile: submission._isMobile || false\n  },\n  \n  // Scoring\n  leadScore: calculateLeadScore(submission),\n  \n  // Routing\n  assignedTo: null,\n  workflow: determineWorkflow(submission)\n};\n\nfunction calculateLeadScore(data) {\n  let score = 0;\n  \n  // Company provided\n  if (data.company) score += 20;\n  \n  // Phone provided\n  if (data.phone) score += 15;\n  \n  // Business email (not gmail, yahoo, etc)\n  const personalDomains = ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com'];\n  const emailDomain = data.email?.split('@')[1]?.toLowerCase();\n  if (emailDomain && !personalDomains.includes(emailDomain)) score += 25;\n  \n  // UTM campaign present (targeted traffic)\n  if (data.utm_campaign) score += 10;\n  \n  // Time spent (if tracked)\n  if (data._timeOnPage > 60) score += 10;\n  if (data._timeOnPage > 180) score += 10;\n  \n  return Math.min(100, score);\n}\n\nfunction determineWorkflow(data) {\n  // High-intent indicators\n  if (data.demo_request || data.pricing_interest) {\n    return 'sales_qualified';\n  }\n  \n  // Lead score based routing\n  const score = calculateLeadScore(data);\n  if (score >= 60) return 'marketing_qualified';\n  if (score >= 30) return 'nurture_sequence';\n  return 'general_newsletter';\n}\n\nreturn [{ json: processedSubmission }];"
        },
        "id": "form-processor",
        "name": "Form Submission Processor",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.clearbit.com/v2/people/find",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "email",
                "value": "={{ $json.data.email }}"
              }
            ]
          },
          "options": {}
        },
        "id": "clearbit-enrich",
        "name": "Clearbit Enrichment",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          700,
          450
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.hubspot.com/crm/v3/objects/contacts",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "hubSpotApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"properties\": {\n    \"email\": \"{{ $json.data.email }}\",\n    \"firstname\": \"{{ $json.data.firstName }}\",\n    \"lastname\": \"{{ $json.data.lastName }}\",\n    \"company\": \"{{ $json.data.company }}\",\n    \"phone\": \"{{ $json.data.phone }}\",\n    \"hs_lead_status\": \"NEW\",\n    \"lead_source\": \"{{ $json.source.page }}\",\n    \"lead_score\": \"{{ $json.leadScore }}\",\n    \"utm_source\": \"{{ $json.source.utm_source }}\",\n    \"utm_campaign\": \"{{ $json.source.utm_campaign }}\"\n  }\n}",
          "options": {}
        },
        "id": "hubspot-create-contact",
        "name": "Create HubSpot Contact",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          700,
          600
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "high-intent",
                "leftValue": "={{ $json.workflow }}",
                "rightValue": "sales_qualified",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ]
          }
        },
        "id": "route-by-intent",
        "name": "Route by Intent",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          950,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#sales-leads",
          "text": "=ðŸ”¥ *High-Intent Lead!*\n\n*Name:* {{ $json.data.firstName }} {{ $json.data.lastName }}\n*Email:* {{ $json.data.email }}\n*Company:* {{ $json.data.company || 'Not provided' }}\n*Phone:* {{ $json.data.phone || 'Not provided' }}\n\n*Lead Score:* {{ $json.leadScore }}/100\n*Source:* {{ $json.source.page }}\n*Campaign:* {{ $json.source.utm_campaign || 'Direct' }}\n\n_Submitted at {{ $json.timestamp }}_\n\n<{{ $env.CRM_LINK }}/contact/{{ $json.id }}|View in CRM>",
          "otherOptions": {}
        },
        "id": "slack-sales-alert",
        "name": "Slack Sales Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1200,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.resend.com/emails",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.RESEND_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"from\": \"Your Company <hello@yourdomain.com>\",\n  \"to\": [\"{{ $json.data.email }}\"],\n  \"subject\": \"Thanks for reaching out, {{ $json.data.firstName }}!\",\n  \"html\": \"<h2>Hi {{ $json.data.firstName }},</h2><p>Thanks for your interest! Our team will be in touch within 24 hours.</p><p>In the meantime, check out our <a href='https://yourdomain.com/resources'>resources page</a>.</p><p>Best,<br>The Team</p>\"\n}",
          "options": {}
        },
        "id": "send-confirmation-email",
        "name": "Send Confirmation Email",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1200,
          600
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.posthog.com/api/projects/{{ $env.POSTHOG_PROJECT_ID }}/insights",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "insight",
                "value": "FUNNELS"
              },
              {
                "name": "date_from",
                "value": "-7d"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-analytics",
        "name": "Fetch PostHog Analytics",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          700
        ]
      },
      {
        "parameters": {
          "jsCode": "// CRO Analytics Processor\n// Analyzes landing page performance and identifies optimization opportunities\n\nconst analyticsData = $input.first().json;\n\n// Process funnel data\nconst funnelAnalysis = {\n  steps: [],\n  dropoffs: [],\n  overallConversion: 0\n};\n\nif (analyticsData.results) {\n  const steps = analyticsData.results[0]?.result || [];\n  let previousCount = null;\n  \n  steps.forEach((step, index) => {\n    const count = step.count || 0;\n    const dropoff = previousCount ? ((previousCount - count) / previousCount * 100) : 0;\n    \n    funnelAnalysis.steps.push({\n      name: step.name || `Step ${index + 1}`,\n      count,\n      conversionRate: previousCount ? ((count / previousCount) * 100).toFixed(2) : 100,\n      dropoff: dropoff.toFixed(2)\n    });\n    \n    if (dropoff > 20) {\n      funnelAnalysis.dropoffs.push({\n        step: step.name || `Step ${index + 1}`,\n        dropoffRate: dropoff.toFixed(2),\n        severity: dropoff > 50 ? 'critical' : dropoff > 35 ? 'high' : 'medium'\n      });\n    }\n    \n    previousCount = count;\n  });\n  \n  // Overall conversion\n  if (steps.length > 0) {\n    const first = steps[0]?.count || 0;\n    const last = steps[steps.length - 1]?.count || 0;\n    funnelAnalysis.overallConversion = first > 0 ? ((last / first) * 100).toFixed(2) : 0;\n  }\n}\n\n// Generate recommendations\nconst recommendations = [];\n\nfunnelAnalysis.dropoffs.forEach(dropoff => {\n  if (dropoff.severity === 'critical') {\n    recommendations.push({\n      priority: 'high',\n      step: dropoff.step,\n      issue: `Critical dropoff of ${dropoff.dropoffRate}%`,\n      suggestions: [\n        'Simplify this step',\n        'Add progress indicator',\n        'Reduce form fields',\n        'Add trust signals'\n      ]\n    });\n  }\n});\n\nreturn [{\n  json: {\n    funnelAnalysis,\n    recommendations,\n    period: '7 days',\n    analyzedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "cro-analyzer",
        "name": "CRO Analyzer",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          700,
          700
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a CRO Expert AI. Analyze landing page performance data and provide actionable optimization recommendations.\n\nFocus on:\n1. Identifying conversion bottlenecks\n2. Prioritizing high-impact changes\n3. Suggesting specific copy/design improvements\n4. Recommending A/B tests\n\nReturn JSON:\n{\n  \"performanceSummary\": \"\",\n  \"criticalIssues\": [],\n  \"optimizationPlan\": [\n    {\n      \"priority\": \"high|medium|low\",\n      \"area\": \"hero|form|cta|social-proof|etc\",\n      \"issue\": \"\",\n      \"recommendation\": \"\",\n      \"expectedImpact\": \"\",\n      \"effort\": \"low|medium|high\"\n    }\n  ],\n  \"abTestIdeas\": [\n    {\n      \"hypothesis\": \"\",\n      \"control\": \"\",\n      \"variant\": \"\",\n      \"expectedLift\": \"\"\n    }\n  ],\n  \"quickWins\": [],\n  \"overallScore\": 0\n}"
              },
              {
                "role": "user",
                "content": "=Analyze this landing page performance data:\n\n{{ JSON.stringify($json, null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.3
          }
        },
        "id": "ai-cro-recommendations",
        "name": "AI CRO Recommendations",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          950,
          700
        ]
      },
      {
        "parameters": {
          "channel": "#marketing",
          "text": "=ðŸ“Š *Daily Landing Page CRO Report*\n\n*Funnel Performance (Last 7 Days):*\n{{ $('CRO Analyzer').first().json.funnelAnalysis.steps.map((s, i) => `${i+1}. ${s.name}: ${s.count} (${s.conversionRate}%)`).join('\\n') }}\n\n*Overall Conversion:* {{ $('CRO Analyzer').first().json.funnelAnalysis.overallConversion }}%\n\n*Critical Issues:*\n{{ $json.criticalIssues?.map(i => 'ðŸš¨ ' + i).join('\\n') || 'None identified' }}\n\n*Quick Wins:*\n{{ $json.quickWins?.slice(0, 3).map((w, i) => `${i+1}. ${w}`).join('\\n') || 'None identified' }}\n\n*Performance Score:* {{ $json.overallScore }}/100\n\n*Top A/B Test Suggestion:*\n{{ $json.abTestIdeas?.[0]?.hypothesis || 'No suggestions' }}",
          "otherOptions": {}
        },
        "id": "slack-cro-report",
        "name": "Slack CRO Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1200,
          700
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.LANDING_PAGE_ANALYTICS_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Submissions",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ $json.timestamp }}",
              "email": "={{ $json.data.email }}",
              "name": "={{ $json.data.firstName }} {{ $json.data.lastName }}",
              "company": "={{ $json.data.company }}",
              "lead_score": "={{ $json.leadScore }}",
              "source": "={{ $json.source.page }}",
              "campaign": "={{ $json.source.utm_campaign }}",
              "workflow": "={{ $json.workflow }}"
            }
          }
        },
        "id": "log-submission",
        "name": "Log Submission",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          950,
          400
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"success\": true,\n  \"pageContent\": {{ JSON.stringify($('AI Page Generator').first().json) }},\n  \"formStructure\": {{ JSON.stringify($('AI Form Builder').first().json) }},\n  \"generatedAt\": \"{{ new Date().toISOString() }}\"\n}"
        },
        "id": "webhook-response-builder",
        "name": "Page Builder Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          950,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"success\": true,\n  \"submissionId\": \"{{ $json.id }}\",\n  \"leadScore\": {{ $json.leadScore }},\n  \"message\": \"Thank you for your submission!\"\n}"
        },
        "id": "webhook-response-form",
        "name": "Form Submission Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1450,
          500
        ]
      }
    ],
    "connections": {
      "Page Builder Request": {
        "main": [
          [
            {
              "node": "AI Page Generator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Form Submission Webhook": {
        "main": [
          [
            {
              "node": "Form Submission Processor",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Analytics Check": {
        "main": [
          [
            {
              "node": "Fetch PostHog Analytics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Page Generator": {
        "main": [
          [
            {
              "node": "AI Form Builder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Form Builder": {
        "main": [
          [
            {
              "node": "Page Builder Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Form Submission Processor": {
        "main": [
          [
            {
              "node": "Clearbit Enrichment",
              "type": "main",
              "index": 0
            },
            {
              "node": "Create HubSpot Contact",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Submission",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Clearbit Enrichment": {
        "main": [
          [
            {
              "node": "Route by Intent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create HubSpot Contact": {
        "main": [
          [
            {
              "node": "Route by Intent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Intent": {
        "main": [
          [
            {
              "node": "Slack Sales Alert",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send Confirmation Email",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Confirmation Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Confirmation Email": {
        "main": [
          [
            {
              "node": "Form Submission Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch PostHog Analytics": {
        "main": [
          [
            {
              "node": "CRO Analyzer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "CRO Analyzer": {
        "main": [
          [
            {
              "node": "AI CRO Recommendations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI CRO Recommendations": {
        "main": [
          [
            {
              "node": "Slack CRO Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-saas-landing-page-cro"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 3,
    "tags": [
      {
        "name": "Landing Page",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "CRO",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Conversion",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "AI",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain Lead Conversion Funnel v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 6
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Every 6 Hours",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          300
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Leads_Raw"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-raw-leads",
        "name": "Get Raw Leads",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "not-processed",
                "leftValue": "={{ $json.status }}",
                "rightValue": "new",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-new-leads",
        "name": "Filter New Leads",
        "type": "n8n-nodes-base.filter",
        "position": [
          650,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "// Deduplicate leads by email\nconst leads = $input.all();\nconst seen = new Set();\nconst unique = [];\n\nfor (const lead of leads) {\n  const email = lead.json.email?.toLowerCase().trim();\n  if (email && !seen.has(email)) {\n    seen.add(email);\n    unique.push(lead);\n  }\n}\n\nreturn unique;"
        },
        "id": "deduplicate",
        "name": "Deduplicate by Email",
        "type": "n8n-nodes-base.code",
        "position": [
          850,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://emailverifier.reoon.com/api/v1/verify",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "email",
                "value": "={{ $json.email }}"
              },
              {
                "name": "key",
                "value": "={{ $env.REOON_API_KEY }}"
              },
              {
                "name": "mode",
                "value": "quick"
              }
            ]
          },
          "options": {}
        },
        "id": "verify-email",
        "name": "Verify Email",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1050,
          300
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "valid-email",
                "leftValue": "={{ $json.status }}",
                "rightValue": "valid",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-valid-emails",
        "name": "Filter Valid Emails",
        "type": "n8n-nodes-base.if",
        "position": [
          1250,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir B2B lead skorlama uzmansin. Verilen lead bilgilerine gore 1-100 arasi bir skor ver ve kategori belirle.\n\nSKORLAMA KRITERLERI:\n- Sirket buyuklugu (calisana sayisi)\n- Pozisyon (C-level, Director, Manager, vs)\n- Sektor uyumu\n- Lokasyon\n- Web sitesi kalitesi\n\nKATEGORILER:\n- HOT (80-100): Hemen iletisime gec\n- WARM (50-79): Nurturing kampanyasina ekle\n- COLD (20-49): Uzun vadeli takip\n- DISQUALIFIED (0-19): Liste disi\n\nJSON formatinda dondur:\n{\n  \"score\": 85,\n  \"category\": \"HOT\",\n  \"reasoning\": \"C-level pozisyon, buyuk sirket, hedef sektorde\",\n  \"recommended_approach\": \"Direkt telefon + kisisel email\",\n  \"personalization_hooks\": [\"son blog yazisi\", \"sirket haberleri\"]\n}"
              },
              {
                "role": "user",
                "content": "Lead Bilgileri:\nIsim: {{ $json.first_name }} {{ $json.last_name }}\nEmail: {{ $json.email }}\nSirket: {{ $json.company }}\nPozisyon: {{ $json.title }}\nSektor: {{ $json.industry }}\nCalisana Sayisi: {{ $json.employee_count }}\nLokasyon: {{ $json.location }}\nLinkedIn: {{ $json.linkedin_url }}\nWebsite: {{ $json.website }}"
              }
            ]
          },
          "options": {
            "temperature": 0.3
          }
        },
        "id": "ai-lead-scoring",
        "name": "AI Lead Scoring",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1450,
          200
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse AI scoring response\nconst aiResponse = $input.item.json.message?.content || $input.item.json.content;\nlet scoring;\n\ntry {\n  scoring = JSON.parse(aiResponse);\n} catch (e) {\n  scoring = {\n    score: 50,\n    category: 'WARM',\n    reasoning: 'Default scoring - AI parse failed',\n    recommended_approach: 'Standard email sequence',\n    personalization_hooks: []\n  };\n}\n\nreturn {\n  json: {\n    ...$input.item.json,\n    lead_score: scoring.score,\n    lead_category: scoring.category,\n    scoring_reasoning: scoring.reasoning,\n    recommended_approach: scoring.recommended_approach,\n    personalization_hooks: scoring.personalization_hooks?.join(', ') || ''\n  }\n};"
        },
        "id": "parse-scoring",
        "name": "Parse Lead Score",
        "type": "n8n-nodes-base.code",
        "position": [
          1650,
          200
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "rules": {
            "rules": [
              {
                "outputKey": "HOT",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.lead_category }}",
                      "rightValue": "HOT",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "WARM",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.lead_category }}",
                      "rightValue": "WARM",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "COLD",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.lead_category }}",
                      "rightValue": "COLD",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "options": {}
        },
        "id": "route-by-score",
        "name": "Route by Score",
        "type": "n8n-nodes-base.switch",
        "position": [
          1850,
          200
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir B2B cold email uzmanisin. Cok kisisel ve dikkat cekici bir email yaz.\n\nKURALLAR:\n- Max 150 kelime\n- Direkt konuya gir, uzun giris yapma\n- Kisi adini ve sirketini kullan\n- Spesifik bir deger onerisi sun\n- Tek bir net CTA (call-to-action)\n- Samimi ama profesyonel ton\n- SPAM kelimelerinden kacin (free, guarantee, limited time)\n\nJSON formatinda dondur:\n{\n  \"subject\": \"Dikkat cekici konu satiri (max 50 karakter)\",\n  \"body\": \"Email icerik\",\n  \"cta_type\": \"meeting\" | \"reply\" | \"resource\"\n}"
              },
              {
                "role": "user",
                "content": "Lead: {{ $json.first_name }} {{ $json.last_name }}\nSirket: {{ $json.company }}\nPozisyon: {{ $json.title }}\nSektor: {{ $json.industry }}\n\nKisiselestirme notlari: {{ $json.personalization_hooks }}\n\nBizim hizmet: Dijital pazarlama otomasyonu ve sosyal medya yonetimi"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "generate-hot-email",
        "name": "Generate HOT Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2050,
          100
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir B2B nurturing email uzmanisin. Deger saglayan, egitici bir email yaz.\n\nKURALLAR:\n- Max 200 kelime\n- Deger odakli - bir sey ogren\n- Soft CTA - kaynak veya blog oneris\n- Uzun vadeli iliski kurma odakli\n\nJSON formatinda dondur:\n{\n  \"subject\": \"Deger odakli konu satiri\",\n  \"body\": \"Email icerik\",\n  \"resource_link\": \"onerilecek kaynak URL (opsiyonel)\"\n}"
              },
              {
                "role": "user",
                "content": "Lead: {{ $json.first_name }} {{ $json.last_name }}\nSirket: {{ $json.company }}\nSektor: {{ $json.industry }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "generate-warm-email",
        "name": "Generate WARM Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2050,
          300
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Uzun vadeli nurturing icin kisa, bilgilendirici bir email yaz. Satis yapma, sadece radar'da kal.\n\nJSON formatinda dondur:\n{\n  \"subject\": \"Konu\",\n  \"body\": \"Kisa email (max 100 kelime)\"\n}"
              },
              {
                "role": "user",
                "content": "Lead: {{ $json.first_name }}\nSektor: {{ $json.industry }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "generate-cold-email",
        "name": "Generate COLD Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2050,
          500
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse email content and merge with lead data\nconst aiResponse = $input.item.json.message?.content || $input.item.json.content;\nlet email;\n\ntry {\n  email = JSON.parse(aiResponse);\n} catch (e) {\n  email = {\n    subject: 'Sizinle tanismak isterim',\n    body: 'Merhaba, sizinle iletisime gecmek istedim.',\n    cta_type: 'reply'\n  };\n}\n\nreturn {\n  json: {\n    ...$input.item.json,\n    email_subject: email.subject,\n    email_body: email.body,\n    email_cta_type: email.cta_type || 'reply',\n    email_resource_link: email.resource_link || ''\n  }\n};"
        },
        "id": "parse-email-content",
        "name": "Parse Email Content",
        "type": "n8n-nodes-base.code",
        "position": [
          2250,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "={{ $json.email_subject }}",
          "emailType": "text",
          "message": "={{ $json.email_body }}",
          "options": {
            "appendAttribution": false
          }
        },
        "id": "send-email",
        "name": "Send Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          2450,
          300
        ],
        "typeVersion": 2.1,
        "credentials": {
          "gmailOAuth2": {
            "id": "",
            "name": "Gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Email_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "lead_email": "={{ $json.email }}",
              "lead_name": "={{ $json.first_name }} {{ $json.last_name }}",
              "company": "={{ $json.company }}",
              "lead_score": "={{ $json.lead_score }}",
              "lead_category": "={{ $json.lead_category }}",
              "email_subject": "={{ $json.email_subject }}",
              "sent_at": "={{ $now.format('YYYY-MM-DD HH:mm:ss') }}",
              "sequence_step": "1",
              "status": "sent"
            }
          }
        },
        "id": "log-email",
        "name": "Log Email Sent",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2650,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Leads_Raw"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "status": "contacted",
              "lead_score": "={{ $json.lead_score }}",
              "lead_category": "={{ $json.lead_category }}",
              "first_contact_date": "={{ $now.format('YYYY-MM-DD') }}",
              "last_email_sent": "={{ $now.format('YYYY-MM-DD HH:mm:ss') }}"
            }
          },
          "options": {}
        },
        "id": "update-lead-status",
        "name": "Update Lead Status",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2850,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "channel": "#leads",
          "text": "=*Yeni Lead Islendi*\n\n*Isim:* {{ $json.first_name }} {{ $json.last_name }}\n*Sirket:* {{ $json.company }}\n*Skor:* {{ $json.lead_score }}/100 ({{ $json.lead_category }})\n*Email:* {{ $json.email }}\n\n*Gonderilen Email Konusu:* {{ $json.email_subject }}\n\n*AI Analizi:* {{ $json.scoring_reasoning }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Slack",
        "type": "n8n-nodes-base.slack",
        "position": [
          3050,
          300
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "days",
                "daysInterval": 3
              }
            ]
          }
        },
        "id": "followup-trigger",
        "name": "Follow-up Check (3 Days)",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          600
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Email_Log"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-email-log",
        "name": "Get Email Log",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          600
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Find leads needing follow-up (sent 3+ days ago, no response, sequence_step < 3)\nconst logs = $input.all();\nconst now = new Date();\nconst threeDaysAgo = new Date(now - 3 * 24 * 60 * 60 * 1000);\n\nconst needsFollowup = logs.filter(log => {\n  const sentDate = new Date(log.json.sent_at);\n  const step = parseInt(log.json.sequence_step) || 1;\n  const status = log.json.status;\n  \n  return sentDate <= threeDaysAgo && \n         step < 3 && \n         status !== 'replied' && \n         status !== 'unsubscribed';\n});\n\nreturn needsFollowup;"
        },
        "id": "filter-followup-needed",
        "name": "Filter Needs Follow-up",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Onceki emaile cevap gelmedi. Nazik bir follow-up emaili yaz.\n\nKURALLAR:\n- Onceki emaile referans ver\n- Yeni bir deger onerisi ekle\n- Kisa tut (max 100 kelime)\n- Ispam gibi olmasin\n\nJSON formatinda dondur:\n{\n  \"subject\": \"Re: [onceki konu] - Takip\",\n  \"body\": \"Follow-up email\"\n}"
              },
              {
                "role": "user",
                "content": "Lead: {{ $json.lead_name }}\nSirket: {{ $json.company }}\nOnceki email konusu: {{ $json.email_subject }}\nSequence step: {{ $json.sequence_step }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "generate-followup",
        "name": "Generate Follow-up",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          850,
          600
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      }
    ],
    "connections": {
      "Every 6 Hours": {
        "main": [
          [
            {
              "node": "Get Raw Leads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Raw Leads": {
        "main": [
          [
            {
              "node": "Filter New Leads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter New Leads": {
        "main": [
          [
            {
              "node": "Deduplicate by Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Deduplicate by Email": {
        "main": [
          [
            {
              "node": "Verify Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Verify Email": {
        "main": [
          [
            {
              "node": "Filter Valid Emails",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Valid Emails": {
        "main": [
          [
            {
              "node": "AI Lead Scoring",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "AI Lead Scoring": {
        "main": [
          [
            {
              "node": "Parse Lead Score",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Lead Score": {
        "main": [
          [
            {
              "node": "Route by Score",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Score": {
        "main": [
          [
            {
              "node": "Generate HOT Email",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Generate WARM Email",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Generate COLD Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate HOT Email": {
        "main": [
          [
            {
              "node": "Parse Email Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate WARM Email": {
        "main": [
          [
            {
              "node": "Parse Email Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate COLD Email": {
        "main": [
          [
            {
              "node": "Parse Email Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Email Content": {
        "main": [
          [
            {
              "node": "Send Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Email": {
        "main": [
          [
            {
              "node": "Log Email Sent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Email Sent": {
        "main": [
          [
            {
              "node": "Update Lead Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Lead Status": {
        "main": [
          [
            {
              "node": "Notify Slack",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Follow-up Check (3 Days)": {
        "main": [
          [
            {
              "node": "Get Email Log",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Email Log": {
        "main": [
          [
            {
              "node": "Filter Needs Follow-up",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Needs Follow-up": {
        "main": [
          [
            {
              "node": "Generate Follow-up",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "grain-automation"
      },
      {
        "name": "lead-funnel"
      },
      {
        "name": "sales"
      }
    ],
    "meta": {
      "templateId": "grain-lcf-v1",
      "version": "1.0.0",
      "description": "End-to-end lead conversion funnel: Lead validation, AI scoring, personalized emails, follow-up sequences",
      "requiredCredentials": [
        "Google Sheets OAuth2",
        "OpenAI API",
        "Gmail OAuth2",
        "Reoon API",
        "Slack"
      ],
      "requiredEnvVars": [
        "REOON_API_KEY"
      ]
    }
  },
  {
    "name": "Grain Local Citation Builder v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "citation-build",
          "options": {}
        },
        "id": "build-webhook",
        "name": "Citation Build Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "citation-build"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 6 * * 1"
              }
            ]
          }
        },
        "id": "weekly-audit",
        "name": "Weekly Citation Audit",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "// Initialize citation build request\nconst request = $input.first().json.body || $input.first().json;\n\nconst buildRequest = {\n  buildId: `CIT-${Date.now().toString(36).toUpperCase()}`,\n  business: {\n    name: request.businessName,\n    address: request.address,\n    city: request.city,\n    state: request.state,\n    zip: request.zip,\n    country: request.country || 'US',\n    phone: request.phone,\n    website: request.website,\n    email: request.email,\n    categories: request.categories || [],\n    description: request.description,\n    hours: request.hours || {},\n    images: request.images || [],\n    socialProfiles: request.socialProfiles || {}\n  },\n  targetDirectories: request.directories || 'all',\n  priority: request.priority || 'standard',\n  startedAt: new Date().toISOString()\n};\n\n// Normalize NAP\nbuildRequest.nap = {\n  name: buildRequest.business.name.trim(),\n  address: `${buildRequest.business.address}, ${buildRequest.business.city}, ${buildRequest.business.state} ${buildRequest.business.zip}`.trim(),\n  phone: buildRequest.business.phone.replace(/\\D/g, '').replace(/^1/, '')\n};\n\nreturn [{ json: buildRequest }];"
        },
        "id": "init-build",
        "name": "Initialize Build",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CITATION_DB_URL }}/businesses/active",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-businesses",
        "name": "Fetch Businesses",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "citation-db-api",
            "name": "Citation DB API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CITATION_API_URL }}/directories",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "country",
                "value": "={{ $json.business.country }}"
              },
              {
                "name": "categories",
                "value": "={{ $json.business.categories.join(',') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-directories",
        "name": "Fetch Target Directories",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "citation-api-key",
            "name": "Citation API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CITATION_API_URL }}/scan",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"businessName\": \"{{ $json.business.name }}\",\n  \"phone\": \"{{ $json.business.phone }}\",\n  \"address\": \"{{ $json.business.address }}\",\n  \"city\": \"{{ $json.business.city }}\",\n  \"state\": \"{{ $json.business.state }}\"\n}",
          "options": {
            "timeout": 120000
          }
        },
        "id": "scan-existing",
        "name": "Scan Existing Citations",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "citation-api-key",
            "name": "Citation API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Analyze existing citations and find gaps\nconst buildRequest = $('Initialize Build').first().json;\nconst directories = $('Fetch Target Directories').first().json;\nconst existingCitations = $('Scan Existing Citations').first().json;\n\nconst allDirectories = directories.directories || [];\nconst existing = existingCitations.citations || [];\n\n// Create directory map\nconst existingMap = new Map();\nexisting.forEach(citation => {\n  existingMap.set(citation.directory.toLowerCase(), citation);\n});\n\n// Analyze each directory\nconst analysis = {\n  buildId: buildRequest.buildId,\n  business: buildRequest.business,\n  nap: buildRequest.nap,\n  directories: [],\n  summary: {\n    total: allDirectories.length,\n    existing: 0,\n    missing: 0,\n    inconsistent: 0,\n    correct: 0\n  }\n};\n\nallDirectories.forEach(dir => {\n  const dirName = dir.name.toLowerCase();\n  const existingCitation = existingMap.get(dirName);\n  \n  let status = 'missing';\n  let issues = [];\n  \n  if (existingCitation) {\n    analysis.summary.existing++;\n    \n    // Check NAP consistency\n    const nameMatch = existingCitation.name?.toLowerCase() === buildRequest.nap.name.toLowerCase();\n    const addressMatch = existingCitation.address?.toLowerCase().includes(buildRequest.business.address.toLowerCase());\n    const phoneMatch = existingCitation.phone?.replace(/\\D/g, '') === buildRequest.nap.phone;\n    \n    if (nameMatch && addressMatch && phoneMatch) {\n      status = 'correct';\n      analysis.summary.correct++;\n    } else {\n      status = 'inconsistent';\n      analysis.summary.inconsistent++;\n      \n      if (!nameMatch) issues.push({ field: 'name', expected: buildRequest.nap.name, found: existingCitation.name });\n      if (!addressMatch) issues.push({ field: 'address', expected: buildRequest.business.address, found: existingCitation.address });\n      if (!phoneMatch) issues.push({ field: 'phone', expected: buildRequest.business.phone, found: existingCitation.phone });\n    }\n  } else {\n    analysis.summary.missing++;\n  }\n  \n  analysis.directories.push({\n    name: dir.name,\n    url: dir.url,\n    category: dir.category,\n    domainAuthority: dir.domainAuthority || dir.da,\n    priority: dir.priority || 'standard',\n    status,\n    existingListing: existingCitation || null,\n    issues,\n    submissionUrl: dir.submissionUrl,\n    requiresManual: dir.requiresManual || false\n  });\n});\n\n// Sort by priority and DA\nanalysis.directories.sort((a, b) => {\n  if (a.status === 'missing' && b.status !== 'missing') return -1;\n  if (a.status !== 'missing' && b.status === 'missing') return 1;\n  if (a.status === 'inconsistent' && b.status === 'correct') return -1;\n  return (b.domainAuthority || 0) - (a.domainAuthority || 0);\n});\n\n// Calculate NAP score\nanalysis.napScore = analysis.summary.total > 0 \n  ? Math.round(analysis.summary.correct / analysis.summary.total * 100)\n  : 0;\n\nreturn [{ json: analysis }];"
        },
        "id": "analyze-citations",
        "name": "Analyze Citations",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "// Generate submission tasks for missing/inconsistent citations\nconst analysis = $input.first().json;\n\nconst tasks = [];\n\n// Add tasks for missing citations\nanalysis.directories\n  .filter(d => d.status === 'missing')\n  .slice(0, 50) // Limit batch size\n  .forEach(dir => {\n    tasks.push({\n      taskId: `TASK-${Date.now().toString(36)}-${Math.random().toString(36).substr(2, 4)}`,\n      type: 'new_submission',\n      directory: dir.name,\n      url: dir.submissionUrl || dir.url,\n      domainAuthority: dir.domainAuthority,\n      priority: dir.domainAuthority >= 70 ? 'high' : dir.domainAuthority >= 40 ? 'medium' : 'low',\n      status: 'pending',\n      requiresManual: dir.requiresManual,\n      data: {\n        name: analysis.business.name,\n        address: analysis.business.address,\n        city: analysis.business.city,\n        state: analysis.business.state,\n        zip: analysis.business.zip,\n        phone: analysis.business.phone,\n        website: analysis.business.website,\n        email: analysis.business.email,\n        categories: analysis.business.categories,\n        description: analysis.business.description,\n        hours: analysis.business.hours\n      }\n    });\n  });\n\n// Add tasks for inconsistent citations\nanalysis.directories\n  .filter(d => d.status === 'inconsistent')\n  .forEach(dir => {\n    tasks.push({\n      taskId: `TASK-${Date.now().toString(36)}-${Math.random().toString(36).substr(2, 4)}`,\n      type: 'update_listing',\n      directory: dir.name,\n      url: dir.existingListing?.listingUrl || dir.url,\n      domainAuthority: dir.domainAuthority,\n      priority: 'high', // Inconsistencies are high priority\n      status: 'pending',\n      requiresManual: true, // Updates usually require manual\n      issues: dir.issues,\n      existingData: dir.existingListing,\n      correctData: {\n        name: analysis.business.name,\n        address: analysis.business.address,\n        city: analysis.business.city,\n        state: analysis.business.state,\n        zip: analysis.business.zip,\n        phone: analysis.business.phone\n      }\n    });\n  });\n\n// Sort by priority\nconst priorityOrder = { high: 0, medium: 1, low: 2 };\ntasks.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);\n\nreturn [{ json: {\n  buildId: analysis.buildId,\n  business: analysis.business,\n  napScore: analysis.napScore,\n  summary: analysis.summary,\n  tasks,\n  directories: analysis.directories\n}}];"
        },
        "id": "generate-tasks",
        "name": "Generate Submission Tasks",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "// Process automated submissions for supported directories\nconst data = $input.first().json;\nconst automatedTasks = data.tasks.filter(t => !t.requiresManual && t.type === 'new_submission');\n\n// Return tasks that can be automated\nreturn automatedTasks.map(task => ({ json: task }));"
        },
        "id": "filter-automated",
        "name": "Filter Automated Tasks",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CITATION_API_URL }}/submit",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"directory\": \"{{ $json.directory }}\",\n  \"businessData\": {{ JSON.stringify($json.data) }}\n}",
          "options": {
            "timeout": 60000
          }
        },
        "id": "submit-citation",
        "name": "Submit to Directory",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1750,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "citation-api-key",
            "name": "Citation API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CITATION_DB_URL }}/tasks",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-tasks",
        "name": "Save Tasks",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "citation-db-api",
            "name": "Citation DB API"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.SEO_SLACK_CHANNEL }}",
          "text": "=ðŸ“ *Citation Build Report - {{ $json.business.name }}*\n\nðŸ“Š *NAP Consistency Score:* {{ $json.napScore }}%\n\n*Citation Summary:*\nâ€¢ Total Directories: {{ $json.summary.total }}\nâ€¢ âœ… Correct: {{ $json.summary.correct }}\nâ€¢ âš ï¸ Inconsistent: {{ $json.summary.inconsistent }}\nâ€¢ âŒ Missing: {{ $json.summary.missing }}\n\nðŸ“‹ *Tasks Generated:* {{ $json.tasks.length }}\nâ€¢ High Priority: {{ $json.tasks.filter(t => t.priority === 'high').length }}\nâ€¢ Medium Priority: {{ $json.tasks.filter(t => t.priority === 'medium').length }}\nâ€¢ Manual Required: {{ $json.tasks.filter(t => t.requiresManual).length }}\n\n*Top Missing (High DA):*\n{{ $json.directories.filter(d => d.status === 'missing').slice(0, 5).map(d => `â€¢ ${d.name} (DA: ${d.domainAuthority})`).join('\\n') }}\n\n<{{ $vars.CITATION_DASHBOARD_URL }}|View Full Report>",
          "otherOptions": {}
        },
        "id": "notify-slack",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1750,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.CITATION_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Citation Report",
            "mode": "list",
            "cachedResultName": "Citation Report"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Date": "={{ new Date().toISOString().split('T')[0] }}",
              "Business": "={{ $json.business.name }}",
              "NAP Score": "={{ $json.napScore }}",
              "Total Directories": "={{ $json.summary.total }}",
              "Correct": "={{ $json.summary.correct }}",
              "Inconsistent": "={{ $json.summary.inconsistent }}",
              "Missing": "={{ $json.summary.missing }}",
              "Tasks Created": "={{ $json.tasks.length }}"
            }
          },
          "options": {}
        },
        "id": "log-sheets",
        "name": "Log to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1750,
          700
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"success\": true,\n  \"buildId\": \"{{ $json.buildId }}\",\n  \"napScore\": {{ $json.napScore }},\n  \"summary\": {{ JSON.stringify($json.summary) }},\n  \"tasksCreated\": {{ $json.tasks.length }}\n}",
          "options": {}
        },
        "id": "respond-webhook",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          2000,
          400
        ]
      }
    ],
    "connections": {
      "Citation Build Request": {
        "main": [
          [
            {
              "node": "Initialize Build",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Weekly Citation Audit": {
        "main": [
          [
            {
              "node": "Fetch Businesses",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Initialize Build": {
        "main": [
          [
            {
              "node": "Fetch Target Directories",
              "type": "main",
              "index": 0
            },
            {
              "node": "Scan Existing Citations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Target Directories": {
        "main": [
          [
            {
              "node": "Analyze Citations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Scan Existing Citations": {
        "main": [
          [
            {
              "node": "Analyze Citations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Citations": {
        "main": [
          [
            {
              "node": "Generate Submission Tasks",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Submission Tasks": {
        "main": [
          [
            {
              "node": "Filter Automated Tasks",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Tasks",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Automated Tasks": {
        "main": [
          [
            {
              "node": "Submit to Directory",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "local-seo",
        "name": "local-seo"
      },
      {
        "id": "citations",
        "name": "citations"
      },
      {
        "id": "nap",
        "name": "nap"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Local SEO Automation Hub v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 7 * * *"
              }
            ]
          }
        },
        "id": "daily-trigger",
        "name": "Daily 7 AM",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://mybusinessbusinessinformation.googleapis.com/v1/accounts/{{ $vars.GOOGLE_ACCOUNT_ID }}/locations",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleApi",
          "options": {}
        },
        "id": "fetch-gbp-locations",
        "name": "Fetch GBP Locations",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          200
        ],
        "credentials": {
          "googleApi": {
            "id": "google-business-credential",
            "name": "Google Business Profile OAuth2"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://mybusinessperformance.googleapis.com/v1/locations/{{ $json.name }}/searchkeywords/impressions/monthly",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "monthlyRange.startMonth.year",
                "value": "={{ $now.minus({ months: 3 }).year }}"
              },
              {
                "name": "monthlyRange.startMonth.month",
                "value": "={{ $now.minus({ months: 3 }).month }}"
              },
              {
                "name": "monthlyRange.endMonth.year",
                "value": "={{ $now.year }}"
              },
              {
                "name": "monthlyRange.endMonth.month",
                "value": "={{ $now.month }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-gbp-insights",
        "name": "Fetch GBP Insights",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ],
        "credentials": {
          "googleApi": {
            "id": "google-business-credential",
            "name": "Google Business Profile OAuth2"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://mybusinessreviews.googleapis.com/v1/accounts/{{ $vars.GOOGLE_ACCOUNT_ID }}/locations/{{ $json.locationId }}/reviews",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "pageSize",
                "value": "50"
              },
              {
                "name": "orderBy",
                "value": "updateTime desc"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-google-reviews",
        "name": "Fetch Google Reviews",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ],
        "credentials": {
          "googleApi": {
            "id": "google-business-credential",
            "name": "Google Business Profile OAuth2"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.yelp.com/v3/businesses/{{ $vars.YELP_BUSINESS_ID }}/reviews",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-yelp-reviews",
        "name": "Fetch Yelp Reviews",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "yelp-api",
            "name": "Yelp API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.tripadvisor.com/api/partner/2.0/location/{{ $vars.TRIPADVISOR_ID }}/reviews",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-tripadvisor-reviews",
        "name": "Fetch TripAdvisor Reviews",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          1000
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "tripadvisor-api",
            "name": "TripAdvisor API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Aggregate reviews from all platforms\nconst googleReviews = $('Fetch Google Reviews').first().json.reviews || [];\nconst yelpReviews = $('Fetch Yelp Reviews').first().json.reviews || [];\nconst tripadvisorReviews = $('Fetch TripAdvisor Reviews').first().json.data || [];\n\nconst allReviews = [];\n\n// Process Google Reviews\ngoogleReviews.forEach(review => {\n  allReviews.push({\n    id: review.reviewId,\n    platform: 'google',\n    rating: review.starRating === 'FIVE' ? 5 : \n            review.starRating === 'FOUR' ? 4 : \n            review.starRating === 'THREE' ? 3 : \n            review.starRating === 'TWO' ? 2 : 1,\n    text: review.comment,\n    authorName: review.reviewer?.displayName,\n    createdAt: review.createTime,\n    replied: !!review.reviewReply,\n    replyText: review.reviewReply?.comment,\n    needsResponse: !review.reviewReply && review.comment\n  });\n});\n\n// Process Yelp Reviews\nyelpReviews.forEach(review => {\n  allReviews.push({\n    id: review.id,\n    platform: 'yelp',\n    rating: review.rating,\n    text: review.text,\n    authorName: review.user?.name,\n    createdAt: review.time_created,\n    replied: false, // Yelp doesn't support replies via API\n    needsResponse: review.rating <= 3\n  });\n});\n\n// Process TripAdvisor Reviews\ntripadvisorReviews.forEach(review => {\n  allReviews.push({\n    id: review.id,\n    platform: 'tripadvisor',\n    rating: review.rating,\n    text: review.text,\n    authorName: review.user?.username,\n    createdAt: review.published_date,\n    replied: !!review.owner_response,\n    needsResponse: !review.owner_response && review.text\n  });\n});\n\n// Calculate metrics\nconst metrics = {\n  totalReviews: allReviews.length,\n  avgRating: allReviews.length > 0 ? \n    (allReviews.reduce((a, b) => a + b.rating, 0) / allReviews.length).toFixed(2) : 0,\n  byPlatform: {\n    google: {\n      count: googleReviews.length,\n      avgRating: googleReviews.length > 0 ? \n        (googleReviews.reduce((a, b) => a + (b.starRating === 'FIVE' ? 5 : b.starRating === 'FOUR' ? 4 : b.starRating === 'THREE' ? 3 : b.starRating === 'TWO' ? 2 : 1), 0) / googleReviews.length).toFixed(2) : 0\n    },\n    yelp: {\n      count: yelpReviews.length,\n      avgRating: yelpReviews.length > 0 ? \n        (yelpReviews.reduce((a, b) => a + b.rating, 0) / yelpReviews.length).toFixed(2) : 0\n    },\n    tripadvisor: {\n      count: tripadvisorReviews.length,\n      avgRating: tripadvisorReviews.length > 0 ? \n        (tripadvisorReviews.reduce((a, b) => a + b.rating, 0) / tripadvisorReviews.length).toFixed(2) : 0\n    }\n  },\n  needingResponse: allReviews.filter(r => r.needsResponse).length,\n  negativeReviews: allReviews.filter(r => r.rating <= 2).length\n};\n\n// Sort by date (newest first)\nallReviews.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));\n\nreturn [{ json: { reviews: allReviews, metrics, analyzedAt: new Date().toISOString() } }];"
        },
        "id": "aggregate-reviews",
        "name": "Aggregate All Reviews",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          800,
          700
        ]
      },
      {
        "parameters": {
          "jsCode": "// Filter reviews needing AI response\nconst data = $input.first().json;\nconst reviewsNeedingResponse = data.reviews.filter(r => r.needsResponse && r.platform === 'google');\n\nreturn reviewsNeedingResponse.map(r => ({ json: r }));"
        },
        "id": "filter-needs-response",
        "name": "Filter Needs Response",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1050,
          600
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a professional review response specialist for a local business. Generate thoughtful, personalized responses to customer reviews.\n\nGuidelines:\n1. Thank the customer by name\n2. Address specific points they mentioned\n3. For positive reviews: Express genuine gratitude, mention specific praise\n4. For negative reviews: Apologize sincerely, explain steps to improve, offer to make it right\n5. Include a call to visit again\n6. Keep responses under 150 words\n7. Match the tone to the review sentiment\n8. Never be defensive or argumentative",
                "role": "system"
              },
              {
                "content": "=Generate a response for this {{ $json.rating }}-star review:\n\n**Platform:** {{ $json.platform }}\n**Author:** {{ $json.authorName }}\n**Rating:** {{ $json.rating }}/5 stars\n**Review:** {{ $json.text }}\n\nGenerate a professional, personalized response.",
                "role": "user"
              }
            ]
          },
          "options": {
            "temperature": 0.6,
            "maxTokens": 300
          }
        },
        "id": "generate-response",
        "name": "Generate AI Response",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1300,
          600
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "negative-review",
                "leftValue": "={{ $json.rating }}",
                "rightValue": 3,
                "operator": {
                  "type": "number",
                  "operation": "lte"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-negative",
        "name": "Negative Review?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1550,
          600
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.REVIEWS_SLACK_CHANNEL }}",
          "text": "=âš ï¸ *Negative Review Alert*\n\n*Platform:* {{ $('Filter Needs Response').item.json.platform }}\n*Rating:* {{ $('Filter Needs Response').item.json.rating }}/5 â­\n*Author:* {{ $('Filter Needs Response').item.json.authorName }}\n\n*Review:*\n> {{ $('Filter Needs Response').item.json.text }}\n\nðŸ’¡ *Suggested Response:*\n{{ $json.message?.content || $json.choices?.[0]?.message?.content }}\n\n_Please review and approve before posting_",
          "otherOptions": {}
        },
        "id": "alert-negative",
        "name": "Alert Negative Review",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1800,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "method": "PUT",
          "url": "https://mybusinessreviews.googleapis.com/v1/{{ $json.reviewId }}/reply",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"comment\": \"{{ $('Generate AI Response').item.json.message?.content || $('Generate AI Response').item.json.choices?.[0]?.message?.content }}\"\n}",
          "options": {}
        },
        "id": "auto-reply-positive",
        "name": "Auto-Reply Positive",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1800,
          700
        ],
        "credentials": {
          "googleApi": {
            "id": "google-business-credential",
            "name": "Google Business Profile OAuth2"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.brightlocal.com/v4/citations/search",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "business_name",
                "value": "={{ $vars.BUSINESS_NAME }}"
              },
              {
                "name": "country",
                "value": "={{ $vars.COUNTRY_CODE }}"
              }
            ]
          },
          "options": {}
        },
        "id": "check-citations",
        "name": "Check Citations",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          800,
          200
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "brightlocal-api",
            "name": "BrightLocal API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Analyze citation consistency (NAP - Name, Address, Phone)\nconst citations = $input.first().json.citations || [];\nconst correctNAP = {\n  name: $vars.BUSINESS_NAME,\n  address: $vars.BUSINESS_ADDRESS,\n  phone: $vars.BUSINESS_PHONE\n};\n\nconst analysis = {\n  total: citations.length,\n  consistent: 0,\n  inconsistent: [],\n  missing: [],\n  directories: []\n};\n\ncitations.forEach(citation => {\n  const isConsistent = \n    citation.business_name === correctNAP.name &&\n    citation.address === correctNAP.address &&\n    citation.phone === correctNAP.phone;\n  \n  if (isConsistent) {\n    analysis.consistent++;\n  } else {\n    analysis.inconsistent.push({\n      directory: citation.directory_name,\n      url: citation.url,\n      issues: {\n        name: citation.business_name !== correctNAP.name,\n        address: citation.address !== correctNAP.address,\n        phone: citation.phone !== correctNAP.phone\n      },\n      found: {\n        name: citation.business_name,\n        address: citation.address,\n        phone: citation.phone\n      }\n    });\n  }\n  \n  analysis.directories.push(citation.directory_name);\n});\n\n// Check for missing important directories\nconst importantDirectories = [\n  'Google Business Profile', 'Yelp', 'Facebook', 'Apple Maps',\n  'Bing Places', 'Yellow Pages', 'BBB', 'Foursquare'\n];\n\nimportantDirectories.forEach(dir => {\n  if (!analysis.directories.includes(dir)) {\n    analysis.missing.push(dir);\n  }\n});\n\nanalysis.consistencyScore = analysis.total > 0 ? \n  Math.round((analysis.consistent / analysis.total) * 100) : 0;\n\nreturn [{ json: analysis }];"
        },
        "id": "analyze-citations",
        "name": "Analyze Citation Consistency",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1050,
          200
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Local SEO Content Specialist. Create engaging Google Business Profile posts that drive local engagement.\n\nPost types to create:\n1. Offer/Promotion posts\n2. What's New updates\n3. Event announcements\n4. Product/Service highlights\n\nGuidelines:\n- Include a clear CTA\n- Use local keywords naturally\n- Keep posts 150-300 words\n- Make them timely and relevant\n- Include emoji for visual appeal",
                "role": "system"
              },
              {
                "content": "=Create 3 Google Business Profile posts for a {{ $vars.BUSINESS_TYPE }} business named \"{{ $vars.BUSINESS_NAME }}\" located in {{ $vars.BUSINESS_CITY }}.\n\nFocus on:\n1. A seasonal promotion\n2. A what's new update\n3. A product/service highlight\n\nReturn as JSON array with: type, title, content, cta_text, cta_url",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.7,
            "maxTokens": 1500
          }
        },
        "id": "generate-gbp-posts",
        "name": "Generate GBP Posts",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          800,
          400
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://mybusiness.googleapis.com/v4/accounts/{{ $vars.GOOGLE_ACCOUNT_ID }}/locations/{{ $vars.GBP_LOCATION_ID }}/localPosts",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"languageCode\": \"en-US\",\n  \"summary\": \"{{ $json.posts?.[0]?.content || $json[0]?.content }}\",\n  \"callToAction\": {\n    \"actionType\": \"LEARN_MORE\",\n    \"url\": \"{{ $vars.WEBSITE_URL }}\"\n  },\n  \"topicType\": \"STANDARD\"\n}",
          "options": {}
        },
        "id": "publish-gbp-post",
        "name": "Publish GBP Post",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1050,
          400
        ],
        "credentials": {
          "googleApi": {
            "id": "google-business-credential",
            "name": "Google Business Profile OAuth2"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.LOCAL_SEO_SLACK_CHANNEL }}",
          "text": "=ðŸ“Š *Daily Local SEO Report - {{ $now.format('MMMM d, yyyy') }}*\n\nâ­ *Review Summary:*\nâ€¢ Total Reviews: {{ $('Aggregate All Reviews').first().json.metrics.totalReviews }}\nâ€¢ Average Rating: {{ $('Aggregate All Reviews').first().json.metrics.avgRating }}/5\nâ€¢ Needing Response: {{ $('Aggregate All Reviews').first().json.metrics.needingResponse }}\nâ€¢ Negative Reviews: {{ $('Aggregate All Reviews').first().json.metrics.negativeReviews }}\n\nðŸ“ *By Platform:*\nâ€¢ Google: {{ $('Aggregate All Reviews').first().json.metrics.byPlatform.google.count }} ({{ $('Aggregate All Reviews').first().json.metrics.byPlatform.google.avgRating }}â­)\nâ€¢ Yelp: {{ $('Aggregate All Reviews').first().json.metrics.byPlatform.yelp.count }} ({{ $('Aggregate All Reviews').first().json.metrics.byPlatform.yelp.avgRating }}â­)\nâ€¢ TripAdvisor: {{ $('Aggregate All Reviews').first().json.metrics.byPlatform.tripadvisor.count }} ({{ $('Aggregate All Reviews').first().json.metrics.byPlatform.tripadvisor.avgRating }}â­)\n\nðŸ¢ *Citation Health:*\nâ€¢ Consistency Score: {{ $('Analyze Citation Consistency').first().json.consistencyScore }}%\nâ€¢ Inconsistent: {{ $('Analyze Citation Consistency').first().json.inconsistent.length }}\nâ€¢ Missing Directories: {{ $('Analyze Citation Consistency').first().json.missing.join(', ') || 'None' }}\n\nâœ… *GBP Post Published*",
          "otherOptions": {}
        },
        "id": "daily-report",
        "name": "Daily Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1300,
          300
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.LOCAL_SEO_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Daily Metrics",
            "mode": "list",
            "cachedResultName": "Daily Metrics"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Date": "={{ $now.format('yyyy-MM-dd') }}",
              "Total Reviews": "={{ $('Aggregate All Reviews').first().json.metrics.totalReviews }}",
              "Avg Rating": "={{ $('Aggregate All Reviews').first().json.metrics.avgRating }}",
              "Google Rating": "={{ $('Aggregate All Reviews').first().json.metrics.byPlatform.google.avgRating }}",
              "Yelp Rating": "={{ $('Aggregate All Reviews').first().json.metrics.byPlatform.yelp.avgRating }}",
              "Citation Score": "={{ $('Analyze Citation Consistency').first().json.consistencyScore }}",
              "Responses Needed": "={{ $('Aggregate All Reviews').first().json.metrics.needingResponse }}"
            }
          },
          "options": {}
        },
        "id": "log-metrics",
        "name": "Log Daily Metrics",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1550,
          300
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Daily 7 AM": {
        "main": [
          [
            {
              "node": "Fetch GBP Locations",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch GBP Insights",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Google Reviews",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Yelp Reviews",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch TripAdvisor Reviews",
              "type": "main",
              "index": 0
            },
            {
              "node": "Check Citations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Google Reviews": {
        "main": [
          [
            {
              "node": "Aggregate All Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Yelp Reviews": {
        "main": [
          [
            {
              "node": "Aggregate All Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch TripAdvisor Reviews": {
        "main": [
          [
            {
              "node": "Aggregate All Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate All Reviews": {
        "main": [
          [
            {
              "node": "Filter Needs Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Needs Response": {
        "main": [
          [
            {
              "node": "Generate AI Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate AI Response": {
        "main": [
          [
            {
              "node": "Negative Review?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Negative Review?": {
        "main": [
          [
            {
              "node": "Alert Negative Review",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Auto-Reply Positive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Citations": {
        "main": [
          [
            {
              "node": "Analyze Citation Consistency",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch GBP Insights": {
        "main": [
          [
            {
              "node": "Generate GBP Posts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate GBP Posts": {
        "main": [
          [
            {
              "node": "Publish GBP Post",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Publish GBP Post": {
        "main": [
          [
            {
              "node": "Daily Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Report": {
        "main": [
          [
            {
              "node": "Log Daily Metrics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "local-seo",
        "name": "local-seo"
      },
      {
        "id": "reviews",
        "name": "reviews"
      },
      {
        "id": "gbp",
        "name": "gbp"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 1,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Multi-Agent AI Content System v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "content-request",
          "options": {}
        },
        "id": "content-request-webhook",
        "name": "Content Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "multi-agent-content"
      },
      {
        "parameters": {
          "jsCode": "// Parse content request and determine agent workflow\nconst request = $input.first().json.body;\n\nconst contentBrief = {\n  requestId: `REQ-${Date.now().toString(36).toUpperCase()}`,\n  type: request.contentType || 'blog_post',\n  topic: request.topic,\n  keywords: request.keywords || [],\n  targetAudience: request.targetAudience || 'general',\n  tone: request.tone || 'professional',\n  length: request.length || 'medium',\n  platform: request.platform || 'website',\n  brand: request.brand || {},\n  additionalContext: request.context || '',\n  dueDate: request.dueDate || null,\n  priority: request.priority || 'normal',\n  requester: request.requester || 'system',\n  createdAt: new Date().toISOString()\n};\n\n// Determine required agents based on content type\nconst requiredAgents = ['researcher', 'writer'];\n\nif (['blog_post', 'article', 'whitepaper'].includes(contentBrief.type)) {\n  requiredAgents.push('seo_optimizer');\n}\n\nif (['social_media', 'ad_copy', 'email'].includes(contentBrief.type)) {\n  requiredAgents.push('copywriter');\n}\n\nif (['video_script', 'podcast_script'].includes(contentBrief.type)) {\n  requiredAgents.push('scriptwriter');\n}\n\nrequiredAgents.push('editor', 'quality_checker');\n\nreturn [{ json: { brief: contentBrief, requiredAgents, totalAgents: requiredAgents.length } }];"
        },
        "id": "parse-request",
        "name": "Parse Content Request",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Research Agent specializing in comprehensive topic research. Your role is to:\n\n1. Analyze the content brief thoroughly\n2. Research key facts, statistics, and trends related to the topic\n3. Identify authoritative sources and references\n4. Gather relevant data points that will strengthen the content\n5. Find competitor content gaps and opportunities\n6. Compile a comprehensive research brief for the writing team\n\nProvide structured research output in JSON format with:\n- key_findings: Array of main research points\n- statistics: Relevant numbers and data\n- sources: List of authoritative sources\n- competitor_analysis: What competitors are covering\n- unique_angles: Unexplored angles for differentiation\n- recommended_structure: Suggested content outline",
                "role": "system"
              },
              {
                "content": "=Research this content request:\n\n**Topic:** {{ $json.brief.topic }}\n**Content Type:** {{ $json.brief.type }}\n**Target Audience:** {{ $json.brief.targetAudience }}\n**Keywords:** {{ $json.brief.keywords.join(', ') }}\n**Additional Context:** {{ $json.brief.additionalContext }}\n\nProvide comprehensive research to inform the content creation.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.5,
            "maxTokens": 3000
          }
        },
        "id": "research-agent",
        "name": "Research Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          750,
          300
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are an SEO Optimization Agent. Your role is to:\n\n1. Analyze keywords for search intent and volume potential\n2. Suggest optimal keyword placement strategy\n3. Recommend internal and external linking opportunities\n4. Create meta title and description suggestions\n5. Identify semantic keywords and LSI terms\n6. Structure content for featured snippet opportunities\n\nProvide SEO recommendations in JSON format with:\n- primary_keyword: Main target keyword\n- secondary_keywords: Supporting keywords\n- lsi_keywords: Latent semantic indexing terms\n- meta_title: Optimized title (50-60 chars)\n- meta_description: Optimized description (150-160 chars)\n- heading_structure: Recommended H1, H2, H3 structure\n- featured_snippet_opportunity: Type and content suggestion\n- internal_links: Suggested internal link anchors\n- content_length_recommendation: Ideal word count",
                "role": "system"
              },
              {
                "content": "=Optimize for SEO:\n\n**Topic:** {{ $('Parse Content Request').first().json.brief.topic }}\n**Target Keywords:** {{ $('Parse Content Request').first().json.brief.keywords.join(', ') }}\n**Content Type:** {{ $('Parse Content Request').first().json.brief.type }}\n\n**Research Findings:**\n{{ JSON.stringify($('Research Agent').first().json, null, 2) }}\n\nProvide comprehensive SEO optimization recommendations.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.3,
            "maxTokens": 2000
          }
        },
        "id": "seo-agent",
        "name": "SEO Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1000,
          200
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "=You are a Professional Content Writer Agent. Your role is to create high-quality, engaging content.\n\nBrand Voice Guidelines:\n- Tone: {{ $('Parse Content Request').first().json.brief.tone }}\n- Target Audience: {{ $('Parse Content Request').first().json.brief.targetAudience }}\n- Platform: {{ $('Parse Content Request').first().json.brief.platform }}\n\nWriting Guidelines:\n1. Follow the recommended structure from research\n2. Incorporate key findings naturally\n3. Use statistics and data to support points\n4. Maintain consistent brand voice\n5. Include compelling introduction and conclusion\n6. Use active voice and clear language\n7. Add relevant examples and analogies\n\nOutput Format:\n- title: Compelling headline\n- introduction: Hook and thesis (150-200 words)\n- body: Main content sections with headers\n- conclusion: Summary and call-to-action\n- word_count: Total words",
                "role": "system"
              },
              {
                "content": "=Write the content based on this brief:\n\n**Topic:** {{ $('Parse Content Request').first().json.brief.topic }}\n**Content Type:** {{ $('Parse Content Request').first().json.brief.type }}\n**Target Length:** {{ $('Parse Content Request').first().json.brief.length }}\n\n**Research:**\n{{ JSON.stringify($('Research Agent').first().json, null, 2) }}\n\n**SEO Guidance:**\n{{ JSON.stringify($('SEO Agent').first().json, null, 2) }}\n\nCreate engaging, well-structured content that incorporates the research findings and SEO recommendations.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.7,
            "maxTokens": 4000
          }
        },
        "id": "writer-agent",
        "name": "Writer Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1250,
          300
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Professional Editor Agent. Your role is to:\n\n1. Review content for grammar, spelling, and punctuation\n2. Improve clarity and readability\n3. Ensure consistent tone and voice\n4. Verify logical flow and structure\n5. Tighten prose and remove redundancy\n6. Check for factual consistency\n7. Enhance engagement and impact\n\nProvide edited content with:\n- edited_content: The improved version\n- changes_made: List of significant edits\n- readability_score: Estimated Flesch-Kincaid score\n- suggestions: Additional improvement recommendations",
                "role": "system"
              },
              {
                "content": "=Edit and improve this content:\n\n**Original Brief:**\n- Tone: {{ $('Parse Content Request').first().json.brief.tone }}\n- Audience: {{ $('Parse Content Request').first().json.brief.targetAudience }}\n\n**Draft Content:**\n{{ JSON.stringify($('Writer Agent').first().json, null, 2) }}\n\nEdit for quality, clarity, and brand voice consistency.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.3,
            "maxTokens": 4000
          }
        },
        "id": "editor-agent",
        "name": "Editor Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1500,
          300
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Quality Assurance Agent. Your role is to:\n\n1. Verify content meets the original brief requirements\n2. Check SEO elements are properly implemented\n3. Ensure brand guidelines are followed\n4. Verify all facts and statistics are accurately cited\n5. Check for plagiarism indicators\n6. Assess overall content quality\n7. Provide final approval or rejection with reasons\n\nProvide QA assessment with:\n- approved: boolean\n- overall_score: 1-100\n- brief_compliance: Score for meeting original requirements\n- seo_compliance: Score for SEO implementation\n- quality_score: Score for writing quality\n- brand_compliance: Score for brand voice\n- issues: Array of any problems found\n- final_recommendations: Last improvements before publishing",
                "role": "system"
              },
              {
                "content": "=Perform quality check:\n\n**Original Brief:**\n{{ JSON.stringify($('Parse Content Request').first().json.brief, null, 2) }}\n\n**SEO Requirements:**\n{{ JSON.stringify($('SEO Agent').first().json, null, 2) }}\n\n**Final Content:**\n{{ JSON.stringify($('Editor Agent').first().json, null, 2) }}\n\nProvide comprehensive quality assessment.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.2,
            "maxTokens": 2000
          }
        },
        "id": "qa-agent",
        "name": "QA Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1750,
          300
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "qa-approved",
                "leftValue": "={{ $json.approved }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                }
              },
              {
                "id": "quality-threshold",
                "leftValue": "={{ $json.overall_score }}",
                "rightValue": 70,
                "operator": {
                  "type": "number",
                  "operation": "gte"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-qa-pass",
        "name": "QA Passed?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          2000,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "// Compile final content package\nconst brief = $('Parse Content Request').first().json.brief;\nconst research = $('Research Agent').first().json;\nconst seo = $('SEO Agent').first().json;\nconst editedContent = $('Editor Agent').first().json;\nconst qa = $('QA Agent').first().json;\n\nconst finalPackage = {\n  requestId: brief.requestId,\n  status: 'approved',\n  content: {\n    title: editedContent.edited_content?.title || editedContent.title,\n    metaTitle: seo.meta_title,\n    metaDescription: seo.meta_description,\n    body: editedContent.edited_content?.body || editedContent.body,\n    introduction: editedContent.edited_content?.introduction || editedContent.introduction,\n    conclusion: editedContent.edited_content?.conclusion || editedContent.conclusion,\n    wordCount: editedContent.word_count\n  },\n  seo: {\n    primaryKeyword: seo.primary_keyword,\n    secondaryKeywords: seo.secondary_keywords,\n    headingStructure: seo.heading_structure,\n    internalLinks: seo.internal_links\n  },\n  quality: {\n    overallScore: qa.overall_score,\n    briefCompliance: qa.brief_compliance,\n    seoCompliance: qa.seo_compliance,\n    qualityScore: qa.quality_score,\n    readabilityScore: editedContent.readability_score\n  },\n  metadata: {\n    contentType: brief.type,\n    topic: brief.topic,\n    targetAudience: brief.targetAudience,\n    platform: brief.platform,\n    createdAt: brief.createdAt,\n    completedAt: new Date().toISOString(),\n    agentsUsed: ['researcher', 'seo_optimizer', 'writer', 'editor', 'qa']\n  }\n};\n\nreturn [{ json: finalPackage }];"
        },
        "id": "compile-final",
        "name": "Compile Final Package",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2250,
          200
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CMS_API_URL }}/content/drafts",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-to-cms",
        "name": "Save to CMS",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2500,
          200
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "cms-api-key",
            "name": "CMS API Key"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.CONTENT_SLACK_CHANNEL }}",
          "text": "=âœ… *Content Created Successfully!*\n\n*Request ID:* {{ $json.requestId }}\n*Topic:* {{ $json.metadata.topic }}\n*Type:* {{ $json.metadata.contentType }}\n\nðŸ“Š *Quality Scores:*\nâ€¢ Overall: {{ $json.quality.overallScore }}/100\nâ€¢ SEO: {{ $json.quality.seoCompliance }}/100\nâ€¢ Quality: {{ $json.quality.qualityScore }}/100\nâ€¢ Readability: {{ $json.quality.readabilityScore }}\n\nðŸ“ *Content Preview:*\n*{{ $json.content.title }}*\n\n_{{ $json.content.introduction?.substring(0, 200) }}..._\n\nðŸ”— Word Count: {{ $json.content.wordCount }}\nðŸ·ï¸ Primary Keyword: {{ $json.seo.primaryKeyword }}\n\n_Content saved to CMS as draft. Ready for review._",
          "otherOptions": {}
        },
        "id": "notify-success",
        "name": "Notify Success",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          2500,
          400
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Handle QA failure - prepare for revision\nconst brief = $('Parse Content Request').first().json.brief;\nconst qa = $('QA Agent').first().json;\n\nreturn [{\n  json: {\n    requestId: brief.requestId,\n    status: 'revision_needed',\n    overallScore: qa.overall_score,\n    issues: qa.issues,\n    recommendations: qa.final_recommendations,\n    failedChecks: {\n      briefCompliance: qa.brief_compliance < 70,\n      seoCompliance: qa.seo_compliance < 70,\n      qualityScore: qa.quality_score < 70\n    }\n  }\n}];"
        },
        "id": "handle-revision",
        "name": "Handle Revision Needed",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.CONTENT_SLACK_CHANNEL }}",
          "text": "=âš ï¸ *Content Needs Revision*\n\n*Request ID:* {{ $json.requestId }}\n*Overall Score:* {{ $json.overallScore }}/100\n\nâŒ *Issues Found:*\n{{ $json.issues?.map(i => `â€¢ ${i}`).join('\\n') || 'See recommendations' }}\n\nðŸ’¡ *Recommendations:*\n{{ $json.recommendations?.map ? $json.recommendations.map(r => `â€¢ ${r}`).join('\\n') : $json.recommendations || 'Review content manually' }}\n\n_Content requires manual review and revision_",
          "otherOptions": {}
        },
        "id": "notify-revision",
        "name": "Notify Revision Needed",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          2500,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.CONTENT_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Content Production",
            "mode": "list",
            "cachedResultName": "Content Production"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Request ID": "={{ $('Parse Content Request').first().json.brief.requestId }}",
              "Topic": "={{ $('Parse Content Request').first().json.brief.topic }}",
              "Type": "={{ $('Parse Content Request').first().json.brief.type }}",
              "Status": "={{ $json.status }}",
              "Overall Score": "={{ $('QA Agent').first().json.overall_score }}",
              "Agents Used": "=5",
              "Created At": "={{ $('Parse Content Request').first().json.brief.createdAt }}",
              "Completed At": "={{ $now.toISO() }}"
            }
          },
          "options": {}
        },
        "id": "log-production",
        "name": "Log Production",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          2750,
          300
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Content Request": {
        "main": [
          [
            {
              "node": "Parse Content Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Content Request": {
        "main": [
          [
            {
              "node": "Research Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Research Agent": {
        "main": [
          [
            {
              "node": "SEO Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SEO Agent": {
        "main": [
          [
            {
              "node": "Writer Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Writer Agent": {
        "main": [
          [
            {
              "node": "Editor Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Editor Agent": {
        "main": [
          [
            {
              "node": "QA Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "QA Agent": {
        "main": [
          [
            {
              "node": "QA Passed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "QA Passed?": {
        "main": [
          [
            {
              "node": "Compile Final Package",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Handle Revision Needed",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compile Final Package": {
        "main": [
          [
            {
              "node": "Save to CMS",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Success",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Production",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Handle Revision Needed": {
        "main": [
          [
            {
              "node": "Notify Revision Needed",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Production",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "content",
        "name": "content"
      },
      {
        "id": "ai-agents",
        "name": "ai-agents"
      },
      {
        "id": "multi-agent",
        "name": "multi-agent"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 1,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Multi-Platform Publisher v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 30
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Every 30 Minutes",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          300
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Content_Calendar"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "google-sheets-read",
        "name": "Get Content Calendar",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "condition-status",
                "leftValue": "={{ $json.status }}",
                "rightValue": "approved",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "condition-published",
                "leftValue": "={{ $json.published }}",
                "rightValue": "FALSE",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-approved",
        "name": "Filter Approved & Unpublished",
        "type": "n8n-nodes-base.filter",
        "position": [
          650,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "// Check if scheduled time has passed\nconst now = new Date();\nconst scheduledTime = new Date($input.item.json.scheduled_datetime);\n\n// Return item if time has come\nif (scheduledTime <= now) {\n  return $input.item;\n}\n\n// Return empty if not ready\nreturn [];"
        },
        "id": "check-time",
        "name": "Check If Time Ready",
        "type": "n8n-nodes-base.code",
        "position": [
          850,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "batchSize": 1,
          "options": {}
        },
        "id": "loop-posts",
        "name": "Process Each Post",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          1050,
          300
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir sosyal medya uzmanisÄ±n. Tek bir icerik icin farkli platformlara ozel caption ureteceksin.\n\nKURALLAR:\n\nINSTAGRAM:\n- Max 2,200 karakter\n- Ilk 125 karakter cok onemli (preview)\n- Emoji kullan\n- 20-30 hashtag (sonda)\n- CTA ekle\n\nFACEBOOK:\n- Max 500 karakter\n- Samimi ton\n- 3-5 hashtag\n- Soru sor\n\nTWITTER:\n- MAX 280 karakter (KESIN!)\n- Punchy\n- 1-2 hashtag\n\nLINKEDIN:\n- Profesyonel ton\n- 1,000 karakter\n- Istatistik ekle\n- 3-5 hashtag\n\nTIKTOK:\n- Max 150 karakter\n- Gen-Z dili\n- Trending hashtag\n\nTurkce uret. JSON formatinda dondur:\n{\n  \"instagram\": \"caption + hashtags\",\n  \"facebook\": \"caption\",\n  \"twitter\": \"max 280 char\",\n  \"linkedin\": \"professional caption\",\n  \"tiktok\": \"short caption\"\n}"
              },
              {
                "role": "user",
                "content": "=Icerik: {{ $json.original_caption }}\nMarka: {{ $json.client_name }}\nSektor: {{ $json.industry }}\nIcerik turu: {{ $json.content_type }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "openai-captions",
        "name": "AI Generate Captions",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1250,
          300
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse AI response\nconst aiResponse = $input.item.json.message.content;\nlet captions;\n\ntry {\n  // Parse JSON\n  captions = JSON.parse(aiResponse);\n} catch (e) {\n  // Use original caption if parse fails\n  captions = {\n    instagram: $input.item.json.original_caption,\n    facebook: $input.item.json.original_caption,\n    twitter: $input.item.json.original_caption.substring(0, 280),\n    linkedin: $input.item.json.original_caption,\n    tiktok: $input.item.json.original_caption.substring(0, 150)\n  };\n}\n\n// Parse platform list\nconst platforms = $input.item.json.platforms.split(',').map(p => p.trim().toLowerCase());\n\nreturn {\n  json: {\n    ...$input.item.json,\n    captions: captions,\n    platform_list: platforms,\n    post_to_instagram: platforms.includes('instagram') || platforms.includes('ig'),\n    post_to_facebook: platforms.includes('facebook') || platforms.includes('fb'),\n    post_to_twitter: platforms.includes('twitter') || platforms.includes('tw'),\n    post_to_linkedin: platforms.includes('linkedin') || platforms.includes('li'),\n    post_to_tiktok: platforms.includes('tiktok') || platforms.includes('tt')\n  }\n};"
        },
        "id": "parse-captions",
        "name": "Parse AI Captions",
        "type": "n8n-nodes-base.code",
        "position": [
          1450,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "check-ig",
                "leftValue": "={{ $json.post_to_instagram }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-instagram",
        "name": "If Instagram",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          100
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v18.0/{{ $env.IG_BUSINESS_ID }}/media",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "image_url",
                "value": "={{ $json.media_url }}"
              },
              {
                "name": "caption",
                "value": "={{ $json.captions.instagram }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.META_ACCESS_TOKEN }}"
              }
            ]
          },
          "options": {}
        },
        "id": "instagram-create-media",
        "name": "Instagram Create Media",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          0
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v18.0/{{ $env.IG_BUSINESS_ID }}/media_publish",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "creation_id",
                "value": "={{ $json.id }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.META_ACCESS_TOKEN }}"
              }
            ]
          },
          "options": {}
        },
        "id": "instagram-publish",
        "name": "Instagram Publish",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2050,
          0
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "check-fb",
                "leftValue": "={{ $json.post_to_facebook }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-facebook",
        "name": "If Facebook",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v18.0/{{ $env.FB_PAGE_ID }}/photos",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "url",
                "value": "={{ $json.media_url }}"
              },
              {
                "name": "message",
                "value": "={{ $json.captions.facebook }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.META_ACCESS_TOKEN }}"
              }
            ]
          },
          "options": {}
        },
        "id": "facebook-post",
        "name": "Facebook Post",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          300
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "check-li",
                "leftValue": "={{ $json.post_to_linkedin }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-linkedin",
        "name": "If LinkedIn",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          500
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.linkedin.com/v2/ugcPosts",
          "authentication": "genericCredentialType",
          "genericAuthType": "oAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-Restli-Protocol-Version",
                "value": "2.0.0"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"author\": \"urn:li:organization:{{ $env.LINKEDIN_ORG_ID }}\",\n  \"lifecycleState\": \"PUBLISHED\",\n  \"specificContent\": {\n    \"com.linkedin.ugc.ShareContent\": {\n      \"shareCommentary\": {\n        \"text\": \"{{ $json.captions.linkedin }}\"\n      },\n      \"shareMediaCategory\": \"IMAGE\",\n      \"media\": [\n        {\n          \"status\": \"READY\",\n          \"originalUrl\": \"{{ $json.media_url }}\"\n        }\n      ]\n    }\n  },\n  \"visibility\": {\n    \"com.linkedin.ugc.MemberNetworkVisibility\": \"PUBLIC\"\n  }\n}",
          "options": {}
        },
        "id": "linkedin-post",
        "name": "LinkedIn Post",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          500
        ],
        "typeVersion": 4.2,
        "credentials": {
          "oAuth2Api": {
            "id": "",
            "name": "LinkedIn OAuth2"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "check-tw",
                "leftValue": "={{ $json.post_to_twitter }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-twitter",
        "name": "If Twitter",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          700
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "text": "={{ $json.captions.twitter }}",
          "additionalFields": {}
        },
        "id": "twitter-post",
        "name": "Twitter Post",
        "type": "n8n-nodes-base.twitter",
        "position": [
          1850,
          700
        ],
        "typeVersion": 2,
        "credentials": {
          "twitterOAuth2Api": {
            "id": "",
            "name": "Twitter OAuth2"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Merge all platform results\nconst results = {\n  post_id: $input.item.json.post_id,\n  client_name: $input.item.json.client_name,\n  row_number: $input.item.json.row_number,\n  published_platforms: [],\n  post_ids: {},\n  errors: []\n};\n\n// Check each platform result\nif ($input.item.json.instagram_result) {\n  results.published_platforms.push('instagram');\n  results.post_ids.instagram = $input.item.json.instagram_result.id;\n}\nif ($input.item.json.facebook_result) {\n  results.published_platforms.push('facebook');\n  results.post_ids.facebook = $input.item.json.facebook_result.id;\n}\nif ($input.item.json.linkedin_result) {\n  results.published_platforms.push('linkedin');\n  results.post_ids.linkedin = $input.item.json.linkedin_result.id;\n}\nif ($input.item.json.twitter_result) {\n  results.published_platforms.push('twitter');\n  results.post_ids.twitter = $input.item.json.twitter_result.data.id;\n}\n\nreturn {\n  json: results\n};"
        },
        "id": "merge-results",
        "name": "Merge Results",
        "type": "n8n-nodes-base.code",
        "position": [
          2250,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Content_Calendar"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "published": "TRUE",
              "published_at": "={{ $now.format('YYYY-MM-DD HH:mm:ss') }}",
              "instagram_post_id": "={{ $json.post_ids.instagram || '' }}",
              "facebook_post_id": "={{ $json.post_ids.facebook || '' }}",
              "linkedin_post_id": "={{ $json.post_ids.linkedin || '' }}",
              "twitter_post_id": "={{ $json.post_ids.twitter || '' }}",
              "published_platforms": "={{ $json.published_platforms.join(', ') }}"
            }
          },
          "options": {}
        },
        "id": "update-sheet",
        "name": "Update Sheet Status",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2450,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "channel": "#social-posts",
          "text": "=*Icerik Paylasildi*\n\n*Musteri:* {{ $json.client_name }}\n*Post ID:* {{ $json.post_id }}\n*Zaman:* {{ $now.format('DD.MM.YYYY HH:mm') }}\n\n*Paylasilan Platformlar:*\n{{ $json.published_platforms.map(p => '- ' + p).join('\\n') }}\n\n*Post IDler:*\n{{ Object.entries($json.post_ids).map(([k,v]) => k + ': ' + v).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Slack",
        "type": "n8n-nodes-base.slack",
        "position": [
          2650,
          300
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      }
    ],
    "connections": {
      "Every 30 Minutes": {
        "main": [
          [
            {
              "node": "Get Content Calendar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Content Calendar": {
        "main": [
          [
            {
              "node": "Filter Approved & Unpublished",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Approved & Unpublished": {
        "main": [
          [
            {
              "node": "Check If Time Ready",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check If Time Ready": {
        "main": [
          [
            {
              "node": "Process Each Post",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Each Post": {
        "main": [
          [
            {
              "node": "AI Generate Captions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Captions": {
        "main": [
          [
            {
              "node": "Parse AI Captions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse AI Captions": {
        "main": [
          [
            {
              "node": "If Instagram",
              "type": "main",
              "index": 0
            },
            {
              "node": "If Facebook",
              "type": "main",
              "index": 0
            },
            {
              "node": "If LinkedIn",
              "type": "main",
              "index": 0
            },
            {
              "node": "If Twitter",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Instagram": {
        "main": [
          [
            {
              "node": "Instagram Create Media",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Instagram Create Media": {
        "main": [
          [
            {
              "node": "Instagram Publish",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Instagram Publish": {
        "main": [
          [
            {
              "node": "Merge Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Facebook": {
        "main": [
          [
            {
              "node": "Facebook Post",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Facebook Post": {
        "main": [
          [
            {
              "node": "Merge Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If LinkedIn": {
        "main": [
          [
            {
              "node": "LinkedIn Post",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "LinkedIn Post": {
        "main": [
          [
            {
              "node": "Merge Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Twitter": {
        "main": [
          [
            {
              "node": "Twitter Post",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Twitter Post": {
        "main": [
          [
            {
              "node": "Merge Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Results": {
        "main": [
          [
            {
              "node": "Update Sheet Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Sheet Status": {
        "main": [
          [
            {
              "node": "Notify Slack",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "name": "grain-automation"
      },
      {
        "name": "social-media"
      },
      {
        "name": "multi-platform"
      }
    ],
    "meta": {
      "templateId": "grain-mpp-v1",
      "version": "1.0.0",
      "description": "Multi-platform content publisher for agencies. Reads from Google Sheets calendar, generates AI captions per platform, posts to Instagram, Facebook, LinkedIn, Twitter.",
      "author": "Grain Automation Suite",
      "requiredCredentials": [
        "Google Sheets OAuth2",
        "OpenAI API",
        "Meta Access Token (Instagram/Facebook)",
        "LinkedIn OAuth2",
        "Twitter OAuth2",
        "Slack (optional)"
      ],
      "requiredEnvVars": [
        "IG_BUSINESS_ID",
        "FB_PAGE_ID",
        "META_ACCESS_TOKEN",
        "LINKEDIN_ORG_ID"
      ]
    }
  },
  {
    "name": "Grain Multi-Platform Publisher v2",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 30
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Every 30 Minutes",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          300
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Content_Calendar"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "google-sheets-read",
        "name": "Get Content Calendar",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "condition-status",
                "leftValue": "={{ $json.status }}",
                "rightValue": "approved",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "condition-published",
                "leftValue": "={{ $json.published }}",
                "rightValue": "FALSE",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-approved",
        "name": "Filter Approved & Unpublished",
        "type": "n8n-nodes-base.filter",
        "position": [
          650,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "const now = new Date();\nconst scheduledTime = new Date($input.item.json.scheduled_datetime);\nif (scheduledTime <= now) { return $input.item; }\nreturn [];"
        },
        "id": "check-time",
        "name": "Check If Time Ready",
        "type": "n8n-nodes-base.code",
        "position": [
          850,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "batchSize": 1,
          "options": {}
        },
        "id": "loop-posts",
        "name": "Process Each Post",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          1050,
          300
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir sosyal medya uzmanisÄ±n. Tek bir icerik icin 9 FARKLI platforma ozel caption ureteceksin.\n\nPLATFORM KURALLARI:\n\nðŸ“¸ INSTAGRAM:\n- Max 2,200 karakter, ilk 125 kritik\n- Emoji kullan, 20-30 hashtag sonda\n- CTA ekle\n\nðŸ“˜ FACEBOOK:\n- Max 500 karakter, samimi ton\n- 3-5 hashtag, soru sor\n\nðŸ¦ TWITTER/X:\n- MAX 280 karakter (KESIN!)\n- Punchy, 1-2 hashtag\n\nðŸ’¼ LINKEDIN:\n- Profesyonel ton, 1,000 karakter\n- Istatistik ekle, 3-5 hashtag\n\nðŸŽµ TIKTOK:\n- Max 150 karakter, Gen-Z dili\n- Trending hashtag, hook baslangic\n\nðŸ§µ THREADS:\n- Max 500 karakter, konusmaci ton\n- Emoji az, 2-3 hashtag\n\nðŸ”´ REDDIT:\n- Baslik: Max 300 karakter, clickbait YASAK\n- Icerik: Detayli, degerli bilgi\n- Subreddit uyumlu ton\n- Self-promotion dikkatli\n\nâ“ QUORA:\n- Soru-cevap formati\n- Uzman tonu, kaynak goster\n- 500-1000 karakter ideal\n\nðŸ“Œ PINTEREST:\n- SEO odakli baslik (max 100)\n- Aciklama: 500 karakter, keyword zengin\n\nJSON formatinda dondur:\n{\n  \"instagram\": \"caption + hashtags\",\n  \"facebook\": \"caption\",\n  \"twitter\": \"max 280 char\",\n  \"linkedin\": \"professional caption\",\n  \"tiktok\": \"short hook + hashtags\",\n  \"threads\": \"conversational caption\",\n  \"reddit\": { \"title\": \"baslik\", \"body\": \"icerik\" },\n  \"quora\": { \"question\": \"soru\", \"answer\": \"cevap\" },\n  \"pinterest\": { \"title\": \"SEO title\", \"description\": \"keyword rich desc\" }\n}"
              },
              {
                "role": "user",
                "content": "=Icerik: {{ $json.original_caption }}\nMarka: {{ $json.client_name }}\nSektor: {{ $json.industry }}\nIcerik turu: {{ $json.content_type }}\nHedef kitle: {{ $json.target_audience || 'genel' }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "openai-captions",
        "name": "AI Generate Captions (9 Platform)",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1250,
          300
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiResponse = $input.item.json.message?.content || $input.item.json.content;\nlet captions;\n\ntry {\n  captions = JSON.parse(aiResponse);\n} catch (e) {\n  const orig = $input.item.json.original_caption || '';\n  captions = {\n    instagram: orig, facebook: orig, twitter: orig.substring(0, 280),\n    linkedin: orig, tiktok: orig.substring(0, 150), threads: orig,\n    reddit: { title: orig.substring(0, 100), body: orig },\n    quora: { question: 'Soru?', answer: orig },\n    pinterest: { title: orig.substring(0, 100), description: orig }\n  };\n}\n\nconst platforms = ($input.item.json.platforms || '').split(',').map(p => p.trim().toLowerCase());\n\nreturn {\n  json: {\n    ...$input.item.json,\n    captions: captions,\n    platform_list: platforms,\n    post_to_instagram: platforms.includes('instagram') || platforms.includes('ig'),\n    post_to_facebook: platforms.includes('facebook') || platforms.includes('fb'),\n    post_to_twitter: platforms.includes('twitter') || platforms.includes('tw') || platforms.includes('x'),\n    post_to_linkedin: platforms.includes('linkedin') || platforms.includes('li'),\n    post_to_tiktok: platforms.includes('tiktok') || platforms.includes('tt'),\n    post_to_threads: platforms.includes('threads') || platforms.includes('thr'),\n    post_to_reddit: platforms.includes('reddit') || platforms.includes('rd'),\n    post_to_quora: platforms.includes('quora') || platforms.includes('qa'),\n    post_to_pinterest: platforms.includes('pinterest') || platforms.includes('pin')\n  }\n};"
        },
        "id": "parse-captions",
        "name": "Parse AI Captions",
        "type": "n8n-nodes-base.code",
        "position": [
          1450,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-ig",
                "leftValue": "={{ $json.post_to_instagram }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-instagram",
        "name": "If Instagram",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          -100
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v18.0/{{ $env.IG_BUSINESS_ID }}/media",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "image_url",
                "value": "={{ $json.media_url }}"
              },
              {
                "name": "caption",
                "value": "={{ $json.captions.instagram }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.META_ACCESS_TOKEN }}"
              }
            ]
          },
          "options": {}
        },
        "id": "instagram-create-media",
        "name": "Instagram Create Media",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          -200
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v18.0/{{ $env.IG_BUSINESS_ID }}/media_publish",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "creation_id",
                "value": "={{ $json.id }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.META_ACCESS_TOKEN }}"
              }
            ]
          },
          "options": {}
        },
        "id": "instagram-publish",
        "name": "Instagram Publish",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2050,
          -200
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-fb",
                "leftValue": "={{ $json.post_to_facebook }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-facebook",
        "name": "If Facebook",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          100
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v18.0/{{ $env.FB_PAGE_ID }}/photos",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "url",
                "value": "={{ $json.media_url }}"
              },
              {
                "name": "message",
                "value": "={{ $json.captions.facebook }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.META_ACCESS_TOKEN }}"
              }
            ]
          },
          "options": {}
        },
        "id": "facebook-post",
        "name": "Facebook Post",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          100
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-li",
                "leftValue": "={{ $json.post_to_linkedin }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-linkedin",
        "name": "If LinkedIn",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.linkedin.com/v2/ugcPosts",
          "authentication": "genericCredentialType",
          "genericAuthType": "oAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-Restli-Protocol-Version",
                "value": "2.0.0"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"author\": \"urn:li:organization:{{ $env.LINKEDIN_ORG_ID }}\",\n  \"lifecycleState\": \"PUBLISHED\",\n  \"specificContent\": {\n    \"com.linkedin.ugc.ShareContent\": {\n      \"shareCommentary\": { \"text\": \"{{ $json.captions.linkedin }}\" },\n      \"shareMediaCategory\": \"IMAGE\",\n      \"media\": [{ \"status\": \"READY\", \"originalUrl\": \"{{ $json.media_url }}\" }]\n    }\n  },\n  \"visibility\": { \"com.linkedin.ugc.MemberNetworkVisibility\": \"PUBLIC\" }\n}",
          "options": {}
        },
        "id": "linkedin-post",
        "name": "LinkedIn Post",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "oAuth2Api": {
            "id": "",
            "name": "LinkedIn OAuth2"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-tw",
                "leftValue": "={{ $json.post_to_twitter }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-twitter",
        "name": "If Twitter/X",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          500
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "text": "={{ $json.captions.twitter }}",
          "additionalFields": {}
        },
        "id": "twitter-post",
        "name": "Twitter Post",
        "type": "n8n-nodes-base.twitter",
        "position": [
          1850,
          500
        ],
        "typeVersion": 2,
        "credentials": {
          "twitterOAuth2Api": {
            "id": "",
            "name": "Twitter OAuth2"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-tt",
                "leftValue": "={{ $json.post_to_tiktok }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-tiktok",
        "name": "If TikTok",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          700
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://open.tiktokapis.com/v2/post/publish/content/init/",
          "authentication": "genericCredentialType",
          "genericAuthType": "oAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"post_info\": {\n    \"title\": \"{{ $json.captions.tiktok }}\",\n    \"privacy_level\": \"PUBLIC_TO_EVERYONE\",\n    \"disable_duet\": false,\n    \"disable_comment\": false,\n    \"disable_stitch\": false\n  },\n  \"source_info\": {\n    \"source\": \"PULL_FROM_URL\",\n    \"video_url\": \"{{ $json.media_url }}\"\n  }\n}",
          "options": {}
        },
        "id": "tiktok-post",
        "name": "TikTok Post",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          700
        ],
        "typeVersion": 4.2,
        "credentials": {
          "oAuth2Api": {
            "id": "",
            "name": "TikTok OAuth2"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-thr",
                "leftValue": "={{ $json.post_to_threads }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-threads",
        "name": "If Threads",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          900
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.threads.net/v1.0/{{ $env.THREADS_USER_ID }}/threads",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "media_type",
                "value": "IMAGE"
              },
              {
                "name": "image_url",
                "value": "={{ $json.media_url }}"
              },
              {
                "name": "text",
                "value": "={{ $json.captions.threads }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.THREADS_ACCESS_TOKEN }}"
              }
            ]
          },
          "options": {}
        },
        "id": "threads-create",
        "name": "Threads Create",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          900
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.threads.net/v1.0/{{ $env.THREADS_USER_ID }}/threads_publish",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "creation_id",
                "value": "={{ $json.id }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.THREADS_ACCESS_TOKEN }}"
              }
            ]
          },
          "options": {}
        },
        "id": "threads-publish",
        "name": "Threads Publish",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2050,
          900
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-rd",
                "leftValue": "={{ $json.post_to_reddit }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-reddit",
        "name": "If Reddit",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          1100
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://oauth.reddit.com/api/submit",
          "authentication": "genericCredentialType",
          "genericAuthType": "oAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "User-Agent",
                "value": "GrainAutomation/1.0"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "sr",
                "value": "={{ $json.subreddit || $env.DEFAULT_SUBREDDIT }}"
              },
              {
                "name": "kind",
                "value": "link"
              },
              {
                "name": "title",
                "value": "={{ $json.captions.reddit.title }}"
              },
              {
                "name": "url",
                "value": "={{ $json.media_url }}"
              },
              {
                "name": "api_type",
                "value": "json"
              }
            ]
          },
          "options": {}
        },
        "id": "reddit-post",
        "name": "Reddit Post",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          1100
        ],
        "typeVersion": 4.2,
        "credentials": {
          "oAuth2Api": {
            "id": "",
            "name": "Reddit OAuth2"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-qa",
                "leftValue": "={{ $json.post_to_quora }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-quora",
        "name": "If Quora",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          1300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://www.quora.com/api/logged_in_user/answers",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Quora-Formkey",
                "value": "={{ $env.QUORA_FORMKEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"question_text\": \"{{ $json.captions.quora.question }}\",\n  \"answer_text\": \"{{ $json.captions.quora.answer }}\",\n  \"topics\": [\"{{ $json.industry }}\"]\n}",
          "options": {}
        },
        "id": "quora-post",
        "name": "Quora Answer",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          1300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "httpHeaderAuth": {
            "id": "",
            "name": "Quora Auth"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-pin",
                "leftValue": "={{ $json.post_to_pinterest }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-pinterest",
        "name": "If Pinterest",
        "type": "n8n-nodes-base.if",
        "position": [
          1650,
          1500
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.pinterest.com/v5/pins",
          "authentication": "genericCredentialType",
          "genericAuthType": "oAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"board_id\": \"{{ $env.PINTEREST_BOARD_ID }}\",\n  \"media_source\": {\n    \"source_type\": \"image_url\",\n    \"url\": \"{{ $json.media_url }}\"\n  },\n  \"title\": \"{{ $json.captions.pinterest.title }}\",\n  \"description\": \"{{ $json.captions.pinterest.description }}\",\n  \"link\": \"{{ $json.link_url || '' }}\"\n}",
          "options": {}
        },
        "id": "pinterest-post",
        "name": "Pinterest Pin",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1850,
          1500
        ],
        "typeVersion": 4.2,
        "credentials": {
          "oAuth2Api": {
            "id": "",
            "name": "Pinterest OAuth2"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Merge all platform results\nconst results = {\n  post_id: $input.item.json.post_id,\n  client_name: $input.item.json.client_name,\n  row_number: $input.item.json.row_number,\n  published_platforms: [],\n  post_ids: {},\n  errors: []\n};\n\n// Check each platform result\nconst platformChecks = [\n  { key: 'instagram', result: 'instagram_result' },\n  { key: 'facebook', result: 'facebook_result' },\n  { key: 'linkedin', result: 'linkedin_result' },\n  { key: 'twitter', result: 'twitter_result' },\n  { key: 'tiktok', result: 'tiktok_result' },\n  { key: 'threads', result: 'threads_result' },\n  { key: 'reddit', result: 'reddit_result' },\n  { key: 'quora', result: 'quora_result' },\n  { key: 'pinterest', result: 'pinterest_result' }\n];\n\nplatformChecks.forEach(({ key, result }) => {\n  if ($input.item.json[result]) {\n    results.published_platforms.push(key);\n    results.post_ids[key] = $input.item.json[result].id || $input.item.json[result].data?.id || 'posted';\n  }\n});\n\nreturn { json: results };"
        },
        "id": "merge-results",
        "name": "Merge All Results",
        "type": "n8n-nodes-base.code",
        "position": [
          2250,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Content_Calendar"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "published": "TRUE",
              "published_at": "={{ $now.format('YYYY-MM-DD HH:mm:ss') }}",
              "instagram_post_id": "={{ $json.post_ids.instagram || '' }}",
              "facebook_post_id": "={{ $json.post_ids.facebook || '' }}",
              "linkedin_post_id": "={{ $json.post_ids.linkedin || '' }}",
              "twitter_post_id": "={{ $json.post_ids.twitter || '' }}",
              "tiktok_post_id": "={{ $json.post_ids.tiktok || '' }}",
              "threads_post_id": "={{ $json.post_ids.threads || '' }}",
              "reddit_post_id": "={{ $json.post_ids.reddit || '' }}",
              "quora_post_id": "={{ $json.post_ids.quora || '' }}",
              "pinterest_post_id": "={{ $json.post_ids.pinterest || '' }}",
              "published_platforms": "={{ $json.published_platforms.join(', ') }}"
            }
          },
          "options": {}
        },
        "id": "update-sheet",
        "name": "Update Sheet Status",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2450,
          600
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "channel": "#social-posts",
          "text": "=*Icerik {{ $json.published_platforms.length }} Platforma Paylasildi*\n\n*Musteri:* {{ $json.client_name }}\n*Post ID:* {{ $json.post_id }}\n*Zaman:* {{ $now.format('DD.MM.YYYY HH:mm') }}\n\n*Paylasilan Platformlar:*\n{{ $json.published_platforms.map(p => 'âœ… ' + p).join('\\n') }}\n\n*Post IDler:*\n{{ Object.entries($json.post_ids).map(([k,v]) => 'â€¢ ' + k + ': ' + v).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Slack",
        "type": "n8n-nodes-base.slack",
        "position": [
          2650,
          600
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      }
    ],
    "connections": {
      "Every 30 Minutes": {
        "main": [
          [
            {
              "node": "Get Content Calendar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Content Calendar": {
        "main": [
          [
            {
              "node": "Filter Approved & Unpublished",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Approved & Unpublished": {
        "main": [
          [
            {
              "node": "Check If Time Ready",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check If Time Ready": {
        "main": [
          [
            {
              "node": "Process Each Post",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Each Post": {
        "main": [
          [
            {
              "node": "AI Generate Captions (9 Platform)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Captions (9 Platform)": {
        "main": [
          [
            {
              "node": "Parse AI Captions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse AI Captions": {
        "main": [
          [
            {
              "node": "If Instagram",
              "type": "main",
              "index": 0
            },
            {
              "node": "If Facebook",
              "type": "main",
              "index": 0
            },
            {
              "node": "If LinkedIn",
              "type": "main",
              "index": 0
            },
            {
              "node": "If Twitter/X",
              "type": "main",
              "index": 0
            },
            {
              "node": "If TikTok",
              "type": "main",
              "index": 0
            },
            {
              "node": "If Threads",
              "type": "main",
              "index": 0
            },
            {
              "node": "If Reddit",
              "type": "main",
              "index": 0
            },
            {
              "node": "If Quora",
              "type": "main",
              "index": 0
            },
            {
              "node": "If Pinterest",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Instagram": {
        "main": [
          [
            {
              "node": "Instagram Create Media",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Instagram Create Media": {
        "main": [
          [
            {
              "node": "Instagram Publish",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Instagram Publish": {
        "main": [
          [
            {
              "node": "Merge All Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Facebook": {
        "main": [
          [
            {
              "node": "Facebook Post",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Facebook Post": {
        "main": [
          [
            {
              "node": "Merge All Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If LinkedIn": {
        "main": [
          [
            {
              "node": "LinkedIn Post",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "LinkedIn Post": {
        "main": [
          [
            {
              "node": "Merge All Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Twitter/X": {
        "main": [
          [
            {
              "node": "Twitter Post",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Twitter Post": {
        "main": [
          [
            {
              "node": "Merge All Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If TikTok": {
        "main": [
          [
            {
              "node": "TikTok Post",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "TikTok Post": {
        "main": [
          [
            {
              "node": "Merge All Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Threads": {
        "main": [
          [
            {
              "node": "Threads Create",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Threads Create": {
        "main": [
          [
            {
              "node": "Threads Publish",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Threads Publish": {
        "main": [
          [
            {
              "node": "Merge All Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Reddit": {
        "main": [
          [
            {
              "node": "Reddit Post",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Reddit Post": {
        "main": [
          [
            {
              "node": "Merge All Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Quora": {
        "main": [
          [
            {
              "node": "Quora Answer",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Quora Answer": {
        "main": [
          [
            {
              "node": "Merge All Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Pinterest": {
        "main": [
          [
            {
              "node": "Pinterest Pin",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Pinterest Pin": {
        "main": [
          [
            {
              "node": "Merge All Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge All Results": {
        "main": [
          [
            {
              "node": "Update Sheet Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Sheet Status": {
        "main": [
          [
            {
              "node": "Notify Slack",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "grain-automation"
      },
      {
        "name": "social-media"
      },
      {
        "name": "multi-platform"
      }
    ],
    "meta": {
      "templateId": "grain-mpp-v2",
      "version": "2.0.0",
      "description": "9-platform content publisher: Instagram, Facebook, LinkedIn, Twitter/X, TikTok, Threads, Reddit, Quora, Pinterest. AI-generated platform-specific captions.",
      "requiredCredentials": [
        "Google Sheets OAuth2",
        "OpenAI API",
        "Meta Access Token",
        "LinkedIn OAuth2",
        "Twitter OAuth2",
        "TikTok OAuth2",
        "Reddit OAuth2",
        "Pinterest OAuth2",
        "Slack"
      ],
      "requiredEnvVars": [
        "IG_BUSINESS_ID",
        "FB_PAGE_ID",
        "META_ACCESS_TOKEN",
        "LINKEDIN_ORG_ID",
        "THREADS_USER_ID",
        "THREADS_ACCESS_TOKEN",
        "DEFAULT_SUBREDDIT",
        "QUORA_FORMKEY",
        "PINTEREST_BOARD_ID"
      ],
      "supportedPlatforms": [
        "instagram",
        "facebook",
        "linkedin",
        "twitter",
        "tiktok",
        "threads",
        "reddit",
        "quora",
        "pinterest"
      ]
    }
  },
  {
    "name": "Grain Omnichannel Marketing Hub v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "omnichannel-campaign",
          "options": {}
        },
        "id": "campaign-webhook",
        "name": "Campaign Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "omnichannel-campaign"
      },
      {
        "parameters": {
          "jsCode": "// Parse and orchestrate omnichannel campaign\nconst campaign = $input.first().json.body;\n\nconst campaignData = {\n  campaignId: `OMC-${Date.now().toString(36).toUpperCase()}`,\n  name: campaign.name,\n  objective: campaign.objective,\n  targetAudience: campaign.targetAudience,\n  channels: campaign.channels || ['email', 'sms', 'push', 'social'],\n  content: campaign.content,\n  schedule: campaign.schedule,\n  segmentation: campaign.segmentation,\n  budget: campaign.budget,\n  startDate: campaign.startDate,\n  endDate: campaign.endDate,\n  status: 'active',\n  createdAt: new Date().toISOString()\n};\n\n// Generate channel-specific content variants\nconst channelContent = {};\ncampaignData.channels.forEach(channel => {\n  channelContent[channel] = {\n    enabled: true,\n    status: 'pending',\n    content: campaign.content[channel] || campaign.content.default\n  };\n});\n\ncampaignData.channelContent = channelContent;\n\nreturn [{ json: campaignData }];"
        },
        "id": "parse-campaign",
        "name": "Parse Campaign",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CDP_API_URL }}/segments/{{ $json.segmentation.segmentId }}/users",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "limit",
                "value": "10000"
              },
              {
                "name": "include_preferences",
                "value": "true"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-audience",
        "name": "Fetch Target Audience",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "cdp-api-key",
            "name": "CDP API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Segment users by preferred channels\nconst campaign = $('Parse Campaign').first().json;\nconst users = $input.first().json.users || [];\n\nconst channelSegments = {\n  email: [],\n  sms: [],\n  push: [],\n  social: [],\n  whatsapp: []\n};\n\nusers.forEach(user => {\n  const preferences = user.communication_preferences || {};\n  const optedIn = user.opt_in_status || {};\n  \n  // Prioritize by engagement and preference\n  if (campaign.channels.includes('email') && optedIn.email && user.email) {\n    channelSegments.email.push({\n      userId: user.id,\n      email: user.email,\n      firstName: user.first_name,\n      lastName: user.last_name,\n      engagementScore: user.email_engagement_score || 50,\n      lastEmailOpen: user.last_email_open\n    });\n  }\n  \n  if (campaign.channels.includes('sms') && optedIn.sms && user.phone) {\n    channelSegments.sms.push({\n      userId: user.id,\n      phone: user.phone,\n      firstName: user.first_name,\n      carrier: user.phone_carrier\n    });\n  }\n  \n  if (campaign.channels.includes('push') && optedIn.push && user.push_token) {\n    channelSegments.push.push({\n      userId: user.id,\n      pushToken: user.push_token,\n      platform: user.device_platform,\n      firstName: user.first_name\n    });\n  }\n  \n  if (campaign.channels.includes('whatsapp') && optedIn.whatsapp && user.whatsapp_number) {\n    channelSegments.whatsapp.push({\n      userId: user.id,\n      phone: user.whatsapp_number,\n      firstName: user.first_name\n    });\n  }\n  \n  // Social retargeting audience\n  if (campaign.channels.includes('social')) {\n    channelSegments.social.push({\n      userId: user.id,\n      email: user.email,\n      externalIds: user.external_ids\n    });\n  }\n});\n\nreturn [{\n  json: {\n    campaign,\n    channelSegments,\n    summary: {\n      totalUsers: users.length,\n      email: channelSegments.email.length,\n      sms: channelSegments.sms.length,\n      push: channelSegments.push.length,\n      whatsapp: channelSegments.whatsapp.length,\n      social: channelSegments.social.length\n    }\n  }\n}];"
        },
        "id": "segment-by-channel",
        "name": "Segment by Channel",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-email",
                "leftValue": "={{ $json.summary.email }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-email",
        "name": "Has Email?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1250,
          200
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.EMAIL_API_URL }}/campaigns/send",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"campaign_id\": \"{{ $('Parse Campaign').first().json.campaignId }}\",\n  \"name\": \"{{ $('Parse Campaign').first().json.name }}\",\n  \"subject\": \"{{ $('Parse Campaign').first().json.content.email.subject }}\",\n  \"html_content\": {{ JSON.stringify($('Parse Campaign').first().json.content.email.body) }},\n  \"recipients\": {{ JSON.stringify($json.channelSegments.email) }},\n  \"send_at\": \"{{ $('Parse Campaign').first().json.schedule.email || 'now' }}\"\n}",
          "options": {}
        },
        "id": "send-email",
        "name": "Send Email Campaign",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          100
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "email-api-key",
            "name": "Email API Key"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-sms",
                "leftValue": "={{ $json.summary.sms }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-sms",
        "name": "Has SMS?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.twilio.com/2010-04-01/Accounts/{{ $vars.TWILIO_ACCOUNT_SID }}/Messages.json",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "twilioApi",
          "sendBody": true,
          "contentType": "form-urlencoded",
          "bodyParameters": {
            "parameters": [
              {
                "name": "MessagingServiceSid",
                "value": "={{ $vars.TWILIO_MESSAGING_SERVICE }}"
              },
              {
                "name": "Body",
                "value": "={{ $('Parse Campaign').first().json.content.sms.body }}"
              }
            ]
          },
          "options": {}
        },
        "id": "send-sms-batch",
        "name": "Send SMS Batch",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          300
        ],
        "credentials": {
          "twilioApi": {
            "id": "twilio-credential",
            "name": "Twilio API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-push",
                "leftValue": "={{ $json.summary.push }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-push",
        "name": "Has Push?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1250,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://onesignal.com/api/v1/notifications",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"app_id\": \"{{ $vars.ONESIGNAL_APP_ID }}\",\n  \"include_player_ids\": {{ JSON.stringify($json.channelSegments.push.map(u => u.pushToken)) }},\n  \"headings\": { \"en\": \"{{ $('Parse Campaign').first().json.content.push.title }}\" },\n  \"contents\": { \"en\": \"{{ $('Parse Campaign').first().json.content.push.body }}\" },\n  \"url\": \"{{ $('Parse Campaign').first().json.content.push.url }}\"\n}",
          "options": {}
        },
        "id": "send-push",
        "name": "Send Push Notifications",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "onesignal-api",
            "name": "OneSignal API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-social",
                "leftValue": "={{ $json.summary.social }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-social",
        "name": "Has Social?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1250,
          800
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://graph.facebook.com/v19.0/act_{{ $vars.META_AD_ACCOUNT_ID }}/customaudiences",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "facebookGraphApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"name\": \"{{ $('Parse Campaign').first().json.name }} - Retargeting\",\n  \"subtype\": \"CUSTOM\",\n  \"description\": \"Omnichannel campaign audience\",\n  \"customer_file_source\": \"USER_PROVIDED_ONLY\"\n}",
          "options": {}
        },
        "id": "create-custom-audience",
        "name": "Create Custom Audience",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          700
        ],
        "credentials": {
          "facebookGraphApi": {
            "id": "meta-ads-credential",
            "name": "Meta Ads API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Aggregate results from all channels\nconst campaign = $('Parse Campaign').first().json;\nconst segmentData = $('Segment by Channel').first().json;\n\nconst results = {\n  campaignId: campaign.campaignId,\n  campaignName: campaign.name,\n  status: 'sent',\n  channels: {},\n  summary: segmentData.summary,\n  completedAt: new Date().toISOString()\n};\n\n// Collect results from each channel\ntry {\n  const emailResult = $('Send Email Campaign').first()?.json;\n  if (emailResult) {\n    results.channels.email = {\n      status: 'sent',\n      recipients: segmentData.summary.email,\n      messageId: emailResult.id\n    };\n  }\n} catch (e) {}\n\ntry {\n  const smsResult = $('Send SMS Batch').first()?.json;\n  if (smsResult) {\n    results.channels.sms = {\n      status: 'sent',\n      recipients: segmentData.summary.sms\n    };\n  }\n} catch (e) {}\n\ntry {\n  const pushResult = $('Send Push Notifications').first()?.json;\n  if (pushResult) {\n    results.channels.push = {\n      status: 'sent',\n      recipients: pushResult.recipients || segmentData.summary.push,\n      notificationId: pushResult.id\n    };\n  }\n} catch (e) {}\n\ntry {\n  const socialResult = $('Create Custom Audience').first()?.json;\n  if (socialResult) {\n    results.channels.social = {\n      status: 'audience_created',\n      audienceId: socialResult.id,\n      audienceSize: segmentData.summary.social\n    };\n  }\n} catch (e) {}\n\nreturn [{ json: results }];"
        },
        "id": "aggregate-results",
        "name": "Aggregate Results",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1750,
          400
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.MARKETING_SLACK_CHANNEL }}",
          "text": "=ðŸ“£ *Omnichannel Campaign Launched!*\n\n*Campaign:* {{ $json.campaignName }}\n*ID:* {{ $json.campaignId }}\n\nðŸ“Š *Channel Summary:*\n{{ $json.summary.email > 0 ? `â€¢ ðŸ“§ Email: ${$json.summary.email} recipients` : '' }}\n{{ $json.summary.sms > 0 ? `â€¢ ðŸ“± SMS: ${$json.summary.sms} recipients` : '' }}\n{{ $json.summary.push > 0 ? `â€¢ ðŸ”” Push: ${$json.summary.push} recipients` : '' }}\n{{ $json.summary.social > 0 ? `â€¢ ðŸŒ Social: ${$json.summary.social} audience` : '' }}\n\n*Total Reach:* {{ $json.summary.totalUsers }} users\n\n_Campaign tracking enabled across all channels_",
          "otherOptions": {}
        },
        "id": "notify-launch",
        "name": "Notify Launch",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          2000,
          300
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.CAMPAIGN_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Omnichannel Campaigns",
            "mode": "list",
            "cachedResultName": "Omnichannel Campaigns"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Campaign ID": "={{ $json.campaignId }}",
              "Campaign Name": "={{ $json.campaignName }}",
              "Status": "={{ $json.status }}",
              "Total Reach": "={{ $json.summary.totalUsers }}",
              "Email": "={{ $json.summary.email }}",
              "SMS": "={{ $json.summary.sms }}",
              "Push": "={{ $json.summary.push }}",
              "Social": "={{ $json.summary.social }}",
              "Launched At": "={{ $json.completedAt }}"
            }
          },
          "options": {}
        },
        "id": "log-campaign",
        "name": "Log Campaign",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          2000,
          500
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 24
              }
            ]
          }
        },
        "id": "daily-report",
        "name": "Daily Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          700
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.ANALYTICS_API_URL }}/campaigns/performance",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "date_range",
                "value": "last_24h"
              },
              {
                "name": "group_by",
                "value": "channel,campaign_id"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-performance",
        "name": "Fetch Performance Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          700
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "analytics-api-key",
            "name": "Analytics API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Analyze cross-channel performance\nconst data = $input.first().json;\n\nconst channelMetrics = {\n  email: { sent: 0, delivered: 0, opens: 0, clicks: 0, conversions: 0, revenue: 0 },\n  sms: { sent: 0, delivered: 0, clicks: 0, conversions: 0, revenue: 0 },\n  push: { sent: 0, delivered: 0, clicks: 0, conversions: 0, revenue: 0 },\n  social: { impressions: 0, clicks: 0, conversions: 0, spend: 0, revenue: 0 }\n};\n\n// Aggregate metrics by channel\n(data.campaigns || []).forEach(campaign => {\n  const channel = campaign.channel;\n  if (channelMetrics[channel]) {\n    Object.keys(campaign.metrics).forEach(metric => {\n      if (channelMetrics[channel][metric] !== undefined) {\n        channelMetrics[channel][metric] += campaign.metrics[metric] || 0;\n      }\n    });\n  }\n});\n\n// Calculate derived metrics\nObject.keys(channelMetrics).forEach(channel => {\n  const m = channelMetrics[channel];\n  if (channel === 'email') {\n    m.openRate = m.delivered > 0 ? ((m.opens / m.delivered) * 100).toFixed(2) : 0;\n    m.clickRate = m.opens > 0 ? ((m.clicks / m.opens) * 100).toFixed(2) : 0;\n    m.conversionRate = m.clicks > 0 ? ((m.conversions / m.clicks) * 100).toFixed(2) : 0;\n  } else if (channel === 'sms' || channel === 'push') {\n    m.clickRate = m.delivered > 0 ? ((m.clicks / m.delivered) * 100).toFixed(2) : 0;\n    m.conversionRate = m.clicks > 0 ? ((m.conversions / m.clicks) * 100).toFixed(2) : 0;\n  } else if (channel === 'social') {\n    m.ctr = m.impressions > 0 ? ((m.clicks / m.impressions) * 100).toFixed(2) : 0;\n    m.roas = m.spend > 0 ? (m.revenue / m.spend).toFixed(2) : 0;\n    m.cpa = m.conversions > 0 ? (m.spend / m.conversions).toFixed(2) : 0;\n  }\n});\n\n// Overall totals\nconst totals = {\n  totalReach: channelMetrics.email.delivered + channelMetrics.sms.delivered + channelMetrics.push.delivered + channelMetrics.social.impressions,\n  totalClicks: Object.values(channelMetrics).reduce((sum, c) => sum + (c.clicks || 0), 0),\n  totalConversions: Object.values(channelMetrics).reduce((sum, c) => sum + (c.conversions || 0), 0),\n  totalRevenue: Object.values(channelMetrics).reduce((sum, c) => sum + (c.revenue || 0), 0)\n};\n\nreturn [{ json: { channelMetrics, totals, reportDate: new Date().toISOString() } }];"
        },
        "id": "analyze-performance",
        "name": "Analyze Performance",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          700
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.MARKETING_SLACK_CHANNEL }}",
          "text": "=ðŸ“Š *Daily Omnichannel Performance Report*\n\n*Overall Metrics:*\nâ€¢ Total Reach: {{ $json.totals.totalReach.toLocaleString() }}\nâ€¢ Total Clicks: {{ $json.totals.totalClicks.toLocaleString() }}\nâ€¢ Total Conversions: {{ $json.totals.totalConversions }}\nâ€¢ Total Revenue: ${{ $json.totals.totalRevenue.toLocaleString() }}\n\nðŸ“§ *Email:*\nâ€¢ Open Rate: {{ $json.channelMetrics.email.openRate }}%\nâ€¢ Click Rate: {{ $json.channelMetrics.email.clickRate }}%\nâ€¢ Conversions: {{ $json.channelMetrics.email.conversions }}\n\nðŸ“± *SMS:*\nâ€¢ Click Rate: {{ $json.channelMetrics.sms.clickRate }}%\nâ€¢ Conversions: {{ $json.channelMetrics.sms.conversions }}\n\nðŸ”” *Push:*\nâ€¢ Click Rate: {{ $json.channelMetrics.push.clickRate }}%\nâ€¢ Conversions: {{ $json.channelMetrics.push.conversions }}\n\nðŸŒ *Social:*\nâ€¢ CTR: {{ $json.channelMetrics.social.ctr }}%\nâ€¢ ROAS: {{ $json.channelMetrics.social.roas }}x\nâ€¢ CPA: ${{ $json.channelMetrics.social.cpa }}",
          "otherOptions": {}
        },
        "id": "notify-performance",
        "name": "Notify Performance",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1000,
          700
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      }
    ],
    "connections": {
      "Campaign Trigger": {
        "main": [
          [
            {
              "node": "Parse Campaign",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Campaign": {
        "main": [
          [
            {
              "node": "Fetch Target Audience",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Target Audience": {
        "main": [
          [
            {
              "node": "Segment by Channel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Segment by Channel": {
        "main": [
          [
            {
              "node": "Has Email?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has SMS?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has Push?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has Social?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Email?": {
        "main": [
          [
            {
              "node": "Send Email Campaign",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Has SMS?": {
        "main": [
          [
            {
              "node": "Send SMS Batch",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Has Push?": {
        "main": [
          [
            {
              "node": "Send Push Notifications",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Has Social?": {
        "main": [
          [
            {
              "node": "Create Custom Audience",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Send Email Campaign": {
        "main": [
          [
            {
              "node": "Aggregate Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send SMS Batch": {
        "main": [
          [
            {
              "node": "Aggregate Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Push Notifications": {
        "main": [
          [
            {
              "node": "Aggregate Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Custom Audience": {
        "main": [
          [
            {
              "node": "Aggregate Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Results": {
        "main": [
          [
            {
              "node": "Notify Launch",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Campaign",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Report": {
        "main": [
          [
            {
              "node": "Fetch Performance Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Performance Data": {
        "main": [
          [
            {
              "node": "Analyze Performance",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Performance": {
        "main": [
          [
            {
              "node": "Notify Performance",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "marketing",
        "name": "marketing"
      },
      {
        "id": "omnichannel",
        "name": "omnichannel"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Personalization Engine v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "personalize",
          "options": {}
        },
        "id": "personalization-webhook",
        "name": "Personalization Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "personalization-engine"
      },
      {
        "parameters": {
          "jsCode": "// Parse personalization request\nconst request = $input.first().json.body;\n\nconst context = {\n  requestId: `PERS-${Date.now().toString(36).toUpperCase()}`,\n  userId: request.userId || request.visitorId,\n  sessionId: request.sessionId,\n  context: request.context || 'website',\n  page: request.page || 'homepage',\n  touchpoint: request.touchpoint || 'web',\n  device: request.device || 'desktop',\n  location: request.location,\n  timestamp: new Date().toISOString()\n};\n\nreturn [{ json: context }];"
        },
        "id": "parse-context",
        "name": "Parse Context",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CDP_API_URL }}/profiles/{{ $json.userId }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "include",
                "value": "traits,segments,events,predictions"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-profile",
        "name": "Fetch User Profile",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "cdp-api-key",
            "name": "CDP API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CDP_API_URL }}/profiles/{{ $json.userId }}/history",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "types",
                "value": "page_view,product_view,purchase,search,email_click"
              },
              {
                "name": "limit",
                "value": "50"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-behavior",
        "name": "Fetch Behavior History",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "cdp-api-key",
            "name": "CDP API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Build comprehensive user context\nconst requestContext = $('Parse Context').first().json;\nconst profile = $('Fetch User Profile').first().json;\nconst behavior = $('Fetch Behavior History').first().json;\n\n// Extract key traits\nconst traits = profile.traits || {};\nconst segments = profile.segments || [];\nconst predictions = profile.predictions || {};\n\n// Analyze behavior patterns\nconst events = behavior.events || [];\nconst recentProducts = events\n  .filter(e => e.type === 'product_view')\n  .slice(0, 10)\n  .map(e => e.properties?.product);\n\nconst recentCategories = [...new Set(\n  recentProducts.map(p => p?.category).filter(Boolean)\n)];\n\nconst recentSearches = events\n  .filter(e => e.type === 'search')\n  .slice(0, 5)\n  .map(e => e.properties?.query);\n\nconst purchaseHistory = events\n  .filter(e => e.type === 'purchase')\n  .map(e => e.properties);\n\n// Calculate engagement score\nlet engagementScore = 0;\nif (events.length > 20) engagementScore += 30;\nelse if (events.length > 10) engagementScore += 20;\nelse if (events.length > 5) engagementScore += 10;\n\nif (purchaseHistory.length > 0) engagementScore += 30;\nif (traits.email_verified) engagementScore += 10;\nif (segments.includes('vip') || segments.includes('loyal')) engagementScore += 20;\n\n// Determine user stage\nlet userStage = 'awareness';\nif (purchaseHistory.length > 3) userStage = 'loyalty';\nelse if (purchaseHistory.length > 0) userStage = 'retention';\nelse if (events.some(e => e.type === 'cart_add')) userStage = 'decision';\nelse if (recentProducts.length > 3) userStage = 'consideration';\n\nconst userContext = {\n  ...requestContext,\n  profile: {\n    id: profile.id,\n    name: traits.first_name || 'Visitor',\n    email: traits.email,\n    lifetime_value: traits.ltv || 0,\n    total_orders: purchaseHistory.length,\n    avg_order_value: purchaseHistory.length > 0 \n      ? purchaseHistory.reduce((a, b) => a + (b.total || 0), 0) / purchaseHistory.length \n      : 0\n  },\n  segments,\n  predictions: {\n    purchase_likelihood: predictions.purchase_likelihood || 0.5,\n    churn_risk: predictions.churn_risk || 0.2,\n    predicted_ltv: predictions.ltv || 100\n  },\n  behavior: {\n    engagementScore,\n    userStage,\n    recentProducts,\n    recentCategories,\n    recentSearches,\n    lastPurchase: purchaseHistory[0] || null,\n    totalEvents: events.length\n  },\n  preferences: {\n    favoriteCategories: recentCategories.slice(0, 3),\n    priceRange: traits.preferred_price_range || 'mid',\n    communicationPreference: traits.communication_preference || 'email'\n  }\n};\n\nreturn [{ json: userContext }];"
        },
        "id": "build-context",
        "name": "Build User Context",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.RECOMMENDATION_API_URL }}/products",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "user_id",
                "value": "={{ $json.profile.id }}"
              },
              {
                "name": "categories",
                "value": "={{ $json.preferences.favoriteCategories.join(',') }}"
              },
              {
                "name": "exclude_purchased",
                "value": "true"
              },
              {
                "name": "limit",
                "value": "12"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-recommendations",
        "name": "Fetch Product Recommendations",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "recommendation-api",
            "name": "Recommendation API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CMS_API_URL }}/content/personalized",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "segments",
                "value": "={{ $json.segments.join(',') }}"
              },
              {
                "name": "stage",
                "value": "={{ $json.behavior.userStage }}"
              },
              {
                "name": "page",
                "value": "={{ $json.page }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-content",
        "name": "Fetch Personalized Content",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "cms-api-key",
            "name": "CMS API Key"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a Personalization AI. Generate personalized messaging based on user context.\n\nRules:\n1. Address user by name if known\n2. Reference relevant products/categories\n3. Match tone to user stage\n4. Create urgency for high-intent users\n5. Be helpful, not pushy",
                "role": "system"
              },
              {
                "content": "=Generate personalized messages for this user context:\n\n**User Stage:** {{ $json.behavior.userStage }}\n**Name:** {{ $json.profile.name }}\n**Recent Interests:** {{ $json.preferences.favoriteCategories.join(', ') }}\n**Engagement Score:** {{ $json.behavior.engagementScore }}/100\n**Purchase Likelihood:** {{ Math.round($json.predictions.purchase_likelihood * 100) }}%\n\nGenerate:\n1. Headline (personalized greeting)\n2. Subheadline (value proposition)\n3. CTA button text\n4. Banner message\n5. Exit intent popup message",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.6,
            "maxTokens": 1000
          }
        },
        "id": "ai-personalization",
        "name": "AI Personalization",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1250,
          700
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Compile personalization response\nconst userContext = $('Build User Context').first().json;\nconst recommendations = $('Fetch Product Recommendations').first().json;\nconst content = $('Fetch Personalized Content').first().json;\nconst aiMessages = $('AI Personalization').first().json;\n\n// Select offers based on user stage and predictions\nconst offers = [];\nif (userContext.predictions.purchase_likelihood > 0.7) {\n  offers.push({\n    type: 'discount',\n    code: 'WELCOME10',\n    value: '10%',\n    message: 'Complete your purchase with 10% off!'\n  });\n}\n\nif (userContext.behavior.userStage === 'consideration' && userContext.behavior.engagementScore > 50) {\n  offers.push({\n    type: 'free_shipping',\n    threshold: 50,\n    message: 'Free shipping on orders over $50'\n  });\n}\n\nif (userContext.predictions.churn_risk > 0.5) {\n  offers.push({\n    type: 'loyalty',\n    code: 'COMEBACK20',\n    value: '20%',\n    message: 'We miss you! Here\\'s 20% off your next order'\n  });\n}\n\nconst response = {\n  requestId: userContext.requestId,\n  userId: userContext.profile.id,\n  personalization: {\n    messages: aiMessages,\n    recommendations: recommendations.products?.slice(0, 8) || [],\n    content: content.blocks || [],\n    offers,\n    layout: {\n      heroVariant: userContext.segments.includes('vip') ? 'premium' : 'standard',\n      showRecentlyViewed: userContext.behavior.recentProducts.length > 0,\n      showRecommendations: true,\n      showSocialProof: userContext.behavior.userStage === 'decision'\n    }\n  },\n  context: {\n    userStage: userContext.behavior.userStage,\n    engagementScore: userContext.behavior.engagementScore,\n    segments: userContext.segments,\n    predictions: userContext.predictions\n  },\n  tracking: {\n    experimentId: 'pers-v1',\n    variant: 'personalized',\n    timestamp: new Date().toISOString()\n  }\n};\n\nreturn [{ json: response }];"
        },
        "id": "compile-response",
        "name": "Compile Response",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ JSON.stringify($json) }}",
          "options": {
            "responseHeaders": {
              "entries": [
                {
                  "name": "Cache-Control",
                  "value": "private, max-age=300"
                }
              ]
            }
          }
        },
        "id": "respond",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1750,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.ANALYTICS_API_URL }}/events",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"event\": \"personalization_served\",\n  \"user_id\": \"{{ $json.userId }}\",\n  \"request_id\": \"{{ $json.requestId }}\",\n  \"variant\": \"{{ $json.tracking.variant }}\",\n  \"user_stage\": \"{{ $json.context.userStage }}\",\n  \"recommendations_count\": {{ $json.personalization.recommendations.length }},\n  \"offers_count\": {{ $json.personalization.offers.length }},\n  \"timestamp\": \"{{ $json.tracking.timestamp }}\"\n}",
          "options": {}
        },
        "id": "track-event",
        "name": "Track Personalization",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1750,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "analytics-api-key",
            "name": "Analytics API Key"
          }
        }
      }
    ],
    "connections": {
      "Personalization Request": {
        "main": [
          [
            {
              "node": "Parse Context",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Context": {
        "main": [
          [
            {
              "node": "Fetch User Profile",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Behavior History",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch User Profile": {
        "main": [
          [
            {
              "node": "Build User Context",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Behavior History": {
        "main": [
          [
            {
              "node": "Build User Context",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Build User Context": {
        "main": [
          [
            {
              "node": "Fetch Product Recommendations",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Personalized Content",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Personalization",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Product Recommendations": {
        "main": [
          [
            {
              "node": "Compile Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Personalized Content": {
        "main": [
          [
            {
              "node": "Compile Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Personalization": {
        "main": [
          [
            {
              "node": "Compile Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compile Response": {
        "main": [
          [
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            },
            {
              "node": "Track Personalization",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "personalization",
        "name": "personalization"
      },
      {
        "id": "marketing",
        "name": "marketing"
      },
      {
        "id": "ai",
        "name": "ai"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 1,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Prompt Engineering Studio v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "prompt-studio",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Prompt Request",
        "type": "n8n-nodes-base.webhook",
        "position": [
          250,
          300
        ],
        "typeVersion": 2,
        "webhookId": "prompt-studio"
      },
      {
        "parameters": {
          "jsCode": "// Advanced Request Normalizer with Template Detection\nconst input = $input.item.json;\n\nconst request = {\n  request_id: input.request_id || `PRM-${Date.now()}`,\n  \n  // Core Input\n  raw_prompt: input.prompt || input.raw_prompt,\n  context: input.context || '',\n  \n  // Task Configuration\n  task_type: input.task_type || 'general', // general, email, caption, analysis, classification, creative, code\n  output_format: input.output_format || 'text', // text, json, markdown, html\n  \n  // Target Configuration\n  target_model: input.target_model || 'auto', // auto, gpt-4o, gpt-4o-mini, claude-opus, claude-sonnet\n  target_platform: input.target_platform || 'any', // instagram, linkedin, email, web, any\n  target_audience: input.target_audience || 'general',\n  target_language: input.target_language || 'tr', // tr, en, auto\n  \n  // Style & Tone\n  tone: input.tone || 'professional', // professional, casual, formal, friendly, urgent, empathetic\n  style: input.style || 'balanced', // concise, detailed, balanced, creative, technical\n  \n  // Advanced Options\n  use_chain_of_thought: input.use_chain_of_thought !== false,\n  use_few_shot: input.use_few_shot !== false,\n  generate_variants: input.generate_variants || 1, // 1-5 variants\n  include_negative_examples: input.include_negative_examples || false,\n  \n  // Constraints\n  max_tokens: input.max_tokens || null,\n  max_words: input.max_words || null,\n  max_characters: input.max_characters || null,\n  \n  // Quality Settings\n  quality_level: input.quality_level || 'high', // draft, standard, high, premium\n  temperature_override: input.temperature || null,\n  \n  // Metadata\n  client_name: input.client_name || 'Unknown',\n  project: input.project || 'General',\n  tags: input.tags || []\n};\n\nreturn { json: request };"
        },
        "id": "normalize-request",
        "name": "Normalize & Enrich Request",
        "type": "n8n-nodes-base.code",
        "position": [
          450,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen dunyanin en iyi prompt muhendisisin. Kullanicinin ham promptunu analiz et ve detayli bir analiz raporu olustur.\n\n## ANALIZ BOYUTLARI\n\n1. **INTENT DETECTION**: Kullanici ne yapmak istiyor?\n2. **CLARITY SCORE (1-10)**: Prompt ne kadar net?\n3. **COMPLETENESS SCORE (1-10)**: Eksik bilgi var mi?\n4. **AMBIGUITY DETECTION**: Belirsiz noktalar\n5. **IMPLICIT REQUIREMENTS**: Soylenmemis ama beklenen seyler\n6. **OPTIMAL MODEL**: En uygun AI model\n7. **OPTIMAL TEMPERATURE**: Onerilen sicaklik\n8. **RISK AREAS**: Halusinasyon, bias, hata riskleri\n\nJSON formatinda dondur:\n{\n  \"intent\": {\n    \"primary\": \"ana amac\",\n    \"secondary\": [\"yan amaclar\"],\n    \"task_category\": \"classification|generation|analysis|transformation|qa\"\n  },\n  \"quality_scores\": {\n    \"clarity\": 8,\n    \"completeness\": 6,\n    \"specificity\": 7,\n    \"actionability\": 9\n  },\n  \"missing_elements\": [\n    { \"element\": \"hedef kitle\", \"importance\": \"high\", \"suggestion\": \"Kimlere hitap edecek?\" }\n  ],\n  \"ambiguities\": [\n    { \"phrase\": \"iyi bir\", \"issue\": \"subjektif\", \"clarification_needed\": \"Hangi kriterlere gore iyi?\" }\n  ],\n  \"implicit_requirements\": [\n    \"Turkce olacak\",\n    \"Profesyonel ton bekleniyor\"\n  ],\n  \"optimal_settings\": {\n    \"model\": \"gpt-4o-mini\",\n    \"temperature\": 0.7,\n    \"reasoning\": \"Yaratici icerik, orta karmasiklik\"\n  },\n  \"risk_assessment\": {\n    \"hallucination_risk\": \"low|medium|high\",\n    \"bias_risk\": \"low|medium|high\",\n    \"factual_accuracy_concern\": true,\n    \"mitigation_suggestions\": [\"kaynak belirt\", \"dogrulama ekle\"]\n  },\n  \"enhancement_suggestions\": [\n    { \"type\": \"add_context\", \"suggestion\": \"Sektor bilgisi ekle\" },\n    { \"type\": \"add_constraint\", \"suggestion\": \"Karakter limiti belirt\" },\n    { \"type\": \"add_example\", \"suggestion\": \"Ornek cikti goster\" }\n  ]\n}"
              },
              {
                "role": "user",
                "content": "HAM PROMPT:\n{{ $json.raw_prompt }}\n\nEK CONTEXT:\n{{ $json.context }}\n\nGOREV TIPI: {{ $json.task_type }}\nHEDEF PLATFORM: {{ $json.target_platform }}\nHEDEF KITLE: {{ $json.target_audience }}\nTON: {{ $json.tone }}\nSTIL: {{ $json.style }}"
              }
            ]
          },
          "options": {
            "temperature": 0.3
          }
        },
        "id": "analyze-prompt",
        "name": "Deep Prompt Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          650,
          300
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse analysis and merge with request\nconst request = $input.item.json;\nconst aiResponse = $('Deep Prompt Analysis').item?.json?.message?.content;\n\nlet analysis;\ntry {\n  analysis = JSON.parse(aiResponse);\n} catch (e) {\n  analysis = {\n    intent: { primary: 'unknown', task_category: 'generation' },\n    quality_scores: { clarity: 5, completeness: 5, specificity: 5, actionability: 5 },\n    missing_elements: [],\n    ambiguities: [],\n    implicit_requirements: [],\n    optimal_settings: { model: 'gpt-4o-mini', temperature: 0.7 },\n    risk_assessment: { hallucination_risk: 'medium' },\n    enhancement_suggestions: []\n  };\n}\n\n// Calculate overall quality score\nconst scores = analysis.quality_scores;\nconst overallScore = (scores.clarity + scores.completeness + scores.specificity + scores.actionability) / 4;\n\nreturn {\n  json: {\n    ...request,\n    analysis: analysis,\n    overall_quality_score: overallScore.toFixed(1),\n    needs_enhancement: overallScore < 7,\n    auto_model: analysis.optimal_settings?.model || 'gpt-4o-mini',\n    auto_temperature: analysis.optimal_settings?.temperature || 0.7\n  }\n};"
        },
        "id": "parse-analysis",
        "name": "Parse Analysis Results",
        "type": "n8n-nodes-base.code",
        "position": [
          850,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir prompt engineering uzmanisÄ±n. Verilen analiz sonuclarina gore promptu optimize et ve gelistir.\n\n## OPTIMIZATION FRAMEWORK\n\n### 1. STRUCTURE OPTIMIZATION\n- Clear role definition\n- Explicit task description  \n- Output format specification\n- Constraints and boundaries\n- Examples (few-shot)\n\n### 2. CLARITY ENHANCEMENT\n- Remove ambiguity\n- Add specific metrics\n- Define success criteria\n- Include edge cases\n\n### 3. CHAIN-OF-THOUGHT INTEGRATION\nKarmasik gorevler icin:\n\"Adim adim dusun:\n1. Oncelikle [X] analiz et\n2. Sonra [Y] degerlendir\n3. Son olarak [Z] karar ver\"\n\n### 4. FEW-SHOT EXAMPLES\nOrnek format:\n\"ORNEK 1:\nInput: [ornek girdi]\nOutput: [beklenen cikti]\n\nORNEK 2:\nInput: [farkli senaryo]\nOutput: [beklenen cikti]\"\n\n### 5. NEGATIVE EXAMPLES (Opsiyonel)\n\"YAPMA:\n- [yanlis ornek 1]\n- [yanlis ornek 2]\"\n\n### 6. OUTPUT VALIDATION\n\"Ciktini kontrol et:\n- [kriter 1] saglanmali\n- [kriter 2] olmamali\n- [format] uyumlu olmali\"\n\nJSON formatinda dondur:\n{\n  \"optimized_system_prompt\": \"[tam sistem promptu]\",\n  \"optimized_user_prompt_template\": \"[kullanici promptu sablonu]\",\n  \"few_shot_examples\": [\n    { \"input\": \"...\", \"output\": \"...\" }\n  ],\n  \"negative_examples\": [\n    { \"bad_output\": \"...\", \"why_bad\": \"...\" }\n  ],\n  \"output_schema\": {\n    \"type\": \"json|text|markdown\",\n    \"fields\": [\"field1\", \"field2\"],\n    \"validation_rules\": [\"rule1\", \"rule2\"]\n  },\n  \"chain_of_thought_steps\": [\n    \"Step 1: ...\",\n    \"Step 2: ...\"\n  ],\n  \"recommended_temperature\": 0.7,\n  \"recommended_max_tokens\": 1000,\n  \"quality_improvements\": [\n    \"Eklenen: explicit output format\",\n    \"Duzeltilen: ambiguous language\"\n  ],\n  \"confidence_score\": 85\n}"
              },
              {
                "role": "user",
                "content": "HAM PROMPT: {{ $json.raw_prompt }}\n\nANALIZ SONUCLARI:\n- Intent: {{ $json.analysis.intent.primary }}\n- Task Category: {{ $json.analysis.intent.task_category }}\n- Quality Score: {{ $json.overall_quality_score }}/10\n- Missing Elements: {{ JSON.stringify($json.analysis.missing_elements) }}\n- Ambiguities: {{ JSON.stringify($json.analysis.ambiguities) }}\n- Enhancement Suggestions: {{ JSON.stringify($json.analysis.enhancement_suggestions) }}\n\nTARGET CONFIG:\n- Task Type: {{ $json.task_type }}\n- Output Format: {{ $json.output_format }}\n- Target Platform: {{ $json.target_platform }}\n- Target Audience: {{ $json.target_audience }}\n- Tone: {{ $json.tone }}\n- Style: {{ $json.style }}\n- Language: {{ $json.target_language }}\n\nADVANCED OPTIONS:\n- Chain of Thought: {{ $json.use_chain_of_thought }}\n- Few-Shot Examples: {{ $json.use_few_shot }}\n- Negative Examples: {{ $json.include_negative_examples }}\n\nCONSTRAINTS:\n- Max Words: {{ $json.max_words || 'unlimited' }}\n- Max Characters: {{ $json.max_characters || 'unlimited' }}"
              }
            ]
          },
          "options": {
            "temperature": 0.5
          }
        },
        "id": "optimize-prompt",
        "name": "Optimize & Enhance Prompt",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1050,
          300
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse optimized prompt\nconst request = $input.item.json;\nconst aiResponse = $('Optimize & Enhance Prompt').item?.json?.message?.content;\n\nlet optimized;\ntry {\n  optimized = JSON.parse(aiResponse);\n} catch (e) {\n  // Fallback: use raw prompt with basic structure\n  optimized = {\n    optimized_system_prompt: `Sen bir ${request.task_type} uzmanisin. ${request.raw_prompt}`,\n    optimized_user_prompt_template: request.raw_prompt,\n    few_shot_examples: [],\n    output_schema: { type: request.output_format },\n    recommended_temperature: request.auto_temperature,\n    confidence_score: 50\n  };\n}\n\nreturn {\n  json: {\n    ...request,\n    optimized: optimized,\n    final_system_prompt: optimized.optimized_system_prompt,\n    final_user_template: optimized.optimized_user_prompt_template,\n    final_temperature: request.temperature_override || optimized.recommended_temperature || 0.7,\n    final_model: request.target_model !== 'auto' ? request.target_model : request.auto_model\n  }\n};"
        },
        "id": "parse-optimization",
        "name": "Parse Optimized Prompt",
        "type": "n8n-nodes-base.code",
        "position": [
          1250,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "id": "check-variants",
                "leftValue": "={{ $json.generate_variants }}",
                "rightValue": "1",
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-generate-variants",
        "name": "If Multiple Variants",
        "type": "n8n-nodes-base.if",
        "position": [
          1450,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Ayni promptun {{ $json.generate_variants }} farkli varyasyonunu olustur. Her varyasyon:\n- Farkli bir yaklasim\n- Farkli ton/stil\n- Farkli vurgu\n\nJSON array dondur:\n[\n  {\n    \"variant_id\": 1,\n    \"variant_name\": \"Concise Version\",\n    \"system_prompt\": \"...\",\n    \"user_template\": \"...\",\n    \"temperature\": 0.7,\n    \"differentiator\": \"Kisa ve oz\"\n  },\n  ...\n]"
              },
              {
                "role": "user",
                "content": "BASE SYSTEM PROMPT:\n{{ $json.final_system_prompt }}\n\nBASE USER TEMPLATE:\n{{ $json.final_user_template }}\n\nVaryasyon sayisi: {{ $json.generate_variants }}"
              }
            ]
          },
          "options": {
            "temperature": 0.8
          }
        },
        "id": "generate-variants",
        "name": "Generate Prompt Variants",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1650,
          200
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "{{ $json.final_system_prompt }}"
              },
              {
                "role": "user",
                "content": "{{ $json.final_user_template }}"
              }
            ]
          },
          "options": {
            "temperature": "={{ $json.final_temperature }}"
          }
        },
        "id": "test-prompt",
        "name": "Test Optimized Prompt",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1650,
          400
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir AI output validator'sun. Verilen ciktiyi analiz et ve kalite degerlendirmesi yap.\n\n## VALIDATION CRITERIA\n\n1. **FORMAT COMPLIANCE**: Beklenen formata uygun mu?\n2. **COMPLETENESS**: Tum gerekli bilgiler var mi?\n3. **ACCURACY SIGNALS**: Halusinasyon belirtileri var mi?\n4. **TONE MATCH**: Istenen tona uygun mu?\n5. **CONSTRAINT ADHERENCE**: Kisitlamalara uyulmus mu?\n6. **ACTIONABILITY**: Kullanilabilir mi?\n\nJSON dondur:\n{\n  \"validation_passed\": true,\n  \"overall_score\": 85,\n  \"dimension_scores\": {\n    \"format_compliance\": 90,\n    \"completeness\": 80,\n    \"accuracy_confidence\": 75,\n    \"tone_match\": 85,\n    \"constraint_adherence\": 95,\n    \"actionability\": 80\n  },\n  \"issues_found\": [\n    { \"severity\": \"warning\", \"issue\": \"...\", \"location\": \"...\", \"suggestion\": \"...\" }\n  ],\n  \"strengths\": [\"...\"],\n  \"improvement_suggestions\": [\"...\"],\n  \"human_review_needed\": false,\n  \"confidence_in_assessment\": 90\n}"
              },
              {
                "role": "user",
                "content": "BEKLENEN FORMAT: {{ $json.output_format }}\nBEKLENEN TON: {{ $json.tone }}\nKISITLAMALAR: Max words={{ $json.max_words }}, Max chars={{ $json.max_characters }}\n\nTEST CIKTISI:\n{{ $('Test Optimized Prompt').item?.json?.message?.content || 'No output' }}"
              }
            ]
          },
          "options": {
            "temperature": 0.2
          }
        },
        "id": "validate-output",
        "name": "Validate Test Output",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1850,
          400
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Compile final prompt package\nconst request = $input.item.json;\nconst testOutput = $('Test Optimized Prompt').item?.json?.message?.content || '';\nconst validationRaw = $('Validate Test Output').item?.json?.message?.content || '{}';\nconst variantsRaw = $('Generate Prompt Variants').item?.json?.message?.content || '[]';\n\nlet validation, variants;\ntry { validation = JSON.parse(validationRaw); } catch { validation = { overall_score: 70, validation_passed: true }; }\ntry { variants = JSON.parse(variantsRaw); } catch { variants = []; }\n\nconst promptPackage = {\n  // Meta\n  request_id: request.request_id,\n  created_at: new Date().toISOString(),\n  client_name: request.client_name,\n  project: request.project,\n  \n  // Original Input\n  original_prompt: request.raw_prompt,\n  original_context: request.context,\n  \n  // Analysis Results\n  analysis: {\n    intent: request.analysis?.intent,\n    quality_scores: request.analysis?.quality_scores,\n    overall_score: request.overall_quality_score,\n    missing_elements: request.analysis?.missing_elements,\n    risk_assessment: request.analysis?.risk_assessment\n  },\n  \n  // Optimized Prompts\n  optimized: {\n    system_prompt: request.final_system_prompt,\n    user_template: request.final_user_template,\n    few_shot_examples: request.optimized?.few_shot_examples || [],\n    chain_of_thought: request.optimized?.chain_of_thought_steps || [],\n    output_schema: request.optimized?.output_schema,\n    quality_improvements: request.optimized?.quality_improvements || []\n  },\n  \n  // Variants (if generated)\n  variants: variants,\n  \n  // Recommended Settings\n  settings: {\n    model: request.final_model,\n    temperature: request.final_temperature,\n    max_tokens: request.optimized?.recommended_max_tokens,\n    output_format: request.output_format\n  },\n  \n  // Test Results\n  test: {\n    output_sample: testOutput.substring(0, 500),\n    validation: validation,\n    passed: validation.validation_passed,\n    score: validation.overall_score\n  },\n  \n  // Final Scores\n  scores: {\n    original_quality: parseFloat(request.overall_quality_score),\n    optimization_confidence: request.optimized?.confidence_score || 75,\n    test_validation_score: validation.overall_score || 70,\n    overall_confidence: Math.round(\n      (parseFloat(request.overall_quality_score) * 0.2) +\n      ((request.optimized?.confidence_score || 75) * 0.4) +\n      ((validation.overall_score || 70) * 0.4)\n    )\n  },\n  \n  // Usage Instructions\n  usage: {\n    copy_system_prompt: request.final_system_prompt,\n    copy_user_template: request.final_user_template,\n    suggested_variables: extractVariables(request.final_user_template)\n  }\n};\n\nfunction extractVariables(template) {\n  const matches = template.match(/\\{\\{[^}]+\\}\\}/g) || [];\n  return [...new Set(matches.map(m => m.replace(/[{}\\s]/g, '')))];\n}\n\nreturn { json: promptPackage };"
        },
        "id": "compile-package",
        "name": "Compile Prompt Package",
        "type": "n8n-nodes-base.code",
        "position": [
          2050,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Prompt_Library"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "request_id": "={{ $json.request_id }}",
              "client_name": "={{ $json.client_name }}",
              "project": "={{ $json.project }}",
              "original_prompt": "={{ $json.original_prompt }}",
              "optimized_system_prompt": "={{ $json.optimized.system_prompt }}",
              "optimized_user_template": "={{ $json.optimized.user_template }}",
              "model": "={{ $json.settings.model }}",
              "temperature": "={{ $json.settings.temperature }}",
              "original_score": "={{ $json.scores.original_quality }}",
              "final_score": "={{ $json.scores.overall_confidence }}",
              "test_passed": "={{ $json.test.passed }}",
              "created_at": "={{ $json.created_at }}"
            }
          }
        },
        "id": "save-to-library",
        "name": "Save to Prompt Library",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2250,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "respond-webhook",
        "name": "Return Prompt Package",
        "type": "n8n-nodes-base.respondToWebhook",
        "position": [
          2450,
          300
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "channel": "#prompt-engineering",
          "text": "=*Yeni Prompt Optimize Edildi*\n\n*Request ID:* {{ $json.request_id }}\n*Client:* {{ $json.client_name }}\n*Project:* {{ $json.project }}\n\n*Original Score:* {{ $json.scores.original_quality }}/10\n*Final Score:* {{ $json.scores.overall_confidence }}/100\n*Test Passed:* {{ $json.test.passed ? 'Yes' : 'No' }}\n\n*Model:* {{ $json.settings.model }}\n*Temperature:* {{ $json.settings.temperature }}\n\n*Improvements:*\n{{ ($json.optimized.quality_improvements || []).slice(0, 3).map(i => '- ' + i).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Slack",
        "type": "n8n-nodes-base.slack",
        "position": [
          2450,
          450
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "prompt-templates",
          "options": {}
        },
        "id": "templates-webhook",
        "name": "Get Templates",
        "type": "n8n-nodes-base.webhook",
        "position": [
          250,
          600
        ],
        "typeVersion": 2,
        "webhookId": "prompt-templates"
      },
      {
        "parameters": {
          "jsCode": "// Return pre-built prompt templates\nconst templates = {\n  email_cold_outreach: {\n    name: 'Cold Email Outreach',\n    system_prompt: `Sen bir B2B satis uzmanisin. Kisisel, dikkat cekici ve deger odakli cold email'ler yaziyorsun.\n\nKURALLAR:\n- Max 150 kelime\n- Direkt konuya gir\n- Spesifik deger onerisi sun\n- Tek net CTA\n- SPAM kelimelerinden kacin\n\nADIM ADIM:\n1. Hook ile basla (dikkat cekici ilk cumle)\n2. Deger onerisi (ne sunuyorsun)\n3. Sosyal kanit (kisa)\n4. CTA (tek ve net)`,\n    user_template: 'Lead: {{name}}\\nSirket: {{company}}\\nPozisyon: {{title}}\\nSektor: {{industry}}',\n    variables: ['name', 'company', 'title', 'industry'],\n    temperature: 0.7,\n    output_format: 'json',\n    expected_output: '{ \"subject\": \"...\", \"body\": \"...\", \"cta_type\": \"...\" }'\n  },\n  \n  social_media_caption: {\n    name: 'Social Media Caption',\n    system_prompt: `Sen bir sosyal medya uzmanisin. Platform-specific caption'lar yaziyorsun.\n\nPLATFORM KURALLARI:\n- Instagram: 2200 char, emoji, 20-30 hashtag\n- LinkedIn: Professional, 1000 char, 3-5 hashtag\n- Twitter: MAX 280 char, punchy, 1-2 hashtag\n- TikTok: 150 char, Gen-Z, trending hashtag`,\n    user_template: 'Icerik: {{content}}\\nMarka: {{brand}}\\nPlatform: {{platform}}',\n    variables: ['content', 'brand', 'platform'],\n    temperature: 0.8,\n    output_format: 'text'\n  },\n  \n  customer_response: {\n    name: 'Customer Support Response',\n    system_prompt: `Sen bir musteri destek temsilcisisin. Empati gosteren, cozum odakli yanitlar yaziyorsun.\n\nYAKLASIM:\n1. Empati goster\n2. Sorunu anla\n3. Cozum sun\n4. Sonraki adimlari belirt\n\nTON: Sicak ama profesyonel\nMAX: 200 kelime`,\n    user_template: 'Musteri: {{customer_name}}\\nSorun: {{issue}}\\nKategori: {{category}}',\n    variables: ['customer_name', 'issue', 'category'],\n    temperature: 0.6,\n    output_format: 'text'\n  },\n  \n  content_analysis: {\n    name: 'Content Analysis',\n    system_prompt: `Sen bir icerik analistisin. Verilen icerigi detayli analiz ediyorsun.\n\nANALIZ BOYUTLARI:\n1. Sentiment (positive/negative/neutral)\n2. Tone (formal/casual/urgent/etc)\n3. Key themes\n4. Target audience\n5. Call-to-actions\n6. SEO keywords\n7. Readability score`,\n    user_template: 'Icerik:\\n{{content}}',\n    variables: ['content'],\n    temperature: 0.3,\n    output_format: 'json',\n    expected_output: '{ \"sentiment\": \"...\", \"tone\": \"...\", \"themes\": [...], \"audience\": \"...\", \"ctas\": [...], \"keywords\": [...], \"readability\": 8 }'\n  },\n  \n  product_description: {\n    name: 'Product Description',\n    system_prompt: `Sen bir e-ticaret copywriter'isin. SatÄ±ÅŸ odaklÄ± Ã¼rÃ¼n aÃ§Ä±klamalarÄ± yazÄ±yorsun.\n\nFORMAT:\n1. Hook (dikkat Ã§ekici baÅŸlÄ±k)\n2. Problem (mÃ¼ÅŸteri aÄŸrÄ± noktasÄ±)\n3. Solution (Ã¼rÃ¼n nasÄ±l Ã§Ã¶zÃ¼yor)\n4. Features (Ã¶zellikler - bullet points)\n5. Benefits (faydalar)\n6. Social proof (varsa)\n7. CTA`,\n    user_template: 'Urun: {{product_name}}\\nKategori: {{category}}\\nOzellikler: {{features}}\\nFiyat: {{price}}',\n    variables: ['product_name', 'category', 'features', 'price'],\n    temperature: 0.7,\n    output_format: 'markdown'\n  },\n  \n  meeting_summary: {\n    name: 'Meeting Summary',\n    system_prompt: `Sen bir executive assistant'sin. Toplanti notlarindan ozet ve action items cikariyorsun.\n\nFORMAT:\n## Ozet\n[2-3 cumle toplanti ozeti]\n\n## Ana Kararlar\n- Karar 1\n- Karar 2\n\n## Action Items\n| Gorev | Sorumlu | Deadline |\n|-------|---------|----------|\n\n## Sonraki Adimlar\n- Adim 1\n- Adim 2`,\n    user_template: 'Toplanti Notlari:\\n{{notes}}\\nKatilimcilar: {{participants}}',\n    variables: ['notes', 'participants'],\n    temperature: 0.3,\n    output_format: 'markdown'\n  },\n  \n  competitor_analysis: {\n    name: 'Competitor Analysis',\n    system_prompt: `Sen bir strateji danismanisin. Rakip analizi yapiyorsun.\n\nANALIZ FRAMEWORK:\n1. Overview (kim, ne yapÄ±yor)\n2. Strengths (gÃ¼Ã§lÃ¼ yÃ¶nler)\n3. Weaknesses (zayÄ±f yÃ¶nler)\n4. Market Position (pazar konumu)\n5. Threat Level (tehdit seviyesi: LOW/MEDIUM/HIGH/CRITICAL)\n6. Opportunities (bizim iÃ§in fÄ±rsatlar)\n7. Recommended Actions (Ã¶nerilen aksiyonlar)`,\n    user_template: 'Rakip: {{competitor_name}}\\nSektor: {{industry}}\\nBilgiler:\\n{{intel}}',\n    variables: ['competitor_name', 'industry', 'intel'],\n    temperature: 0.4,\n    output_format: 'json'\n  },\n  \n  blog_outline: {\n    name: 'Blog Post Outline',\n    system_prompt: `Sen bir content strategist'sin. SEO-optimized blog outline'larÄ± oluÅŸturuyorsun.\n\nFORMAT:\n# [BaÅŸlÄ±k - H1]\n\n## GiriÅŸ\n[hook + thesis]\n\n## [H2 BÃ¶lÃ¼m 1]\n### [H3 Alt bÃ¶lÃ¼mler]\n- Key points\n\n## [H2 BÃ¶lÃ¼m 2-4]\n...\n\n## SonuÃ§\n[Ã–zet + CTA]\n\n## SEO Notes\n- Primary keyword:\n- Secondary keywords:\n- Meta description:`,\n    user_template: 'Konu: {{topic}}\\nHedef Kitle: {{audience}}\\nAnahtar Kelime: {{keyword}}\\nKelime Sayisi: {{word_count}}',\n    variables: ['topic', 'audience', 'keyword', 'word_count'],\n    temperature: 0.6,\n    output_format: 'markdown'\n  }\n};\n\nconst category = $input.item.json.category || 'all';\n\nif (category === 'all') {\n  return { json: { templates: templates, count: Object.keys(templates).length } };\n} else {\n  return { json: { template: templates[category] || null } };\n}"
        },
        "id": "return-templates",
        "name": "Return Prompt Templates",
        "type": "n8n-nodes-base.code",
        "position": [
          450,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "respond-templates",
        "name": "Return Templates Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "position": [
          650,
          600
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "prompt-ab-test",
          "options": {}
        },
        "id": "ab-test-webhook",
        "name": "A/B Test Request",
        "type": "n8n-nodes-base.webhook",
        "position": [
          250,
          800
        ],
        "typeVersion": 2,
        "webhookId": "prompt-ab-test"
      },
      {
        "parameters": {
          "jsCode": "// A/B Test two prompts\nconst input = $input.item.json;\n\nconst testConfig = {\n  test_id: `ABT-${Date.now()}`,\n  prompt_a: input.prompt_a,\n  prompt_b: input.prompt_b,\n  test_input: input.test_input,\n  evaluation_criteria: input.evaluation_criteria || ['clarity', 'relevance', 'actionability'],\n  model: input.model || 'gpt-4o-mini',\n  temperature: input.temperature || 0.7,\n  runs_per_variant: input.runs || 3\n};\n\nreturn { json: testConfig };"
        },
        "id": "setup-ab-test",
        "name": "Setup A/B Test",
        "type": "n8n-nodes-base.code",
        "position": [
          450,
          800
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "={{ $json.prompt_a }}"
              },
              {
                "role": "user",
                "content": "={{ $json.test_input }}"
              }
            ]
          },
          "options": {
            "temperature": "={{ $json.temperature }}"
          }
        },
        "id": "run-prompt-a",
        "name": "Run Prompt A",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          650,
          750
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "={{ $json.prompt_b }}"
              },
              {
                "role": "user",
                "content": "={{ $json.test_input }}"
              }
            ]
          },
          "options": {
            "temperature": "={{ $json.temperature }}"
          }
        },
        "id": "run-prompt-b",
        "name": "Run Prompt B",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          650,
          900
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir prompt kalite hakemisin. Iki farkli prompt ciktisini kiyasla ve kazanani belirle.\n\nDEGERLENDIRME KRITERLERI:\n{{ $json.evaluation_criteria.join(', ') }}\n\nOBJEKTIF OL. Sadece cikti kalitesine bak.\n\nJSON dondur:\n{\n  \"winner\": \"A\" | \"B\" | \"tie\",\n  \"scores\": {\n    \"A\": { \"overall\": 85, \"criteria_scores\": {...} },\n    \"B\": { \"overall\": 78, \"criteria_scores\": {...} }\n  },\n  \"reasoning\": \"Neden bu kazandi?\",\n  \"detailed_comparison\": {\n    \"A_strengths\": [...],\n    \"A_weaknesses\": [...],\n    \"B_strengths\": [...],\n    \"B_weaknesses\": [...]\n  },\n  \"recommendation\": \"Hangi prompt kullanilmali ve neden\"\n}"
              },
              {
                "role": "user",
                "content": "TEST INPUT:\n{{ $json.test_input }}\n\n--- OUTPUT A ---\n{{ $('Run Prompt A').item?.json?.message?.content || 'No output' }}\n\n--- OUTPUT B ---\n{{ $('Run Prompt B').item?.json?.message?.content || 'No output' }}"
              }
            ]
          },
          "options": {
            "temperature": 0.2
          }
        },
        "id": "compare-outputs",
        "name": "Compare A/B Outputs",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          850,
          800
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Compile A/B test results\nconst config = $input.item.json;\nconst outputA = $('Run Prompt A').item?.json?.message?.content || '';\nconst outputB = $('Run Prompt B').item?.json?.message?.content || '';\nconst comparisonRaw = $('Compare A/B Outputs').item?.json?.message?.content || '{}';\n\nlet comparison;\ntry { comparison = JSON.parse(comparisonRaw); } catch { comparison = { winner: 'tie', scores: {} }; }\n\nconst results = {\n  test_id: config.test_id,\n  test_input: config.test_input,\n  \n  prompt_a: {\n    prompt: config.prompt_a,\n    output: outputA,\n    score: comparison.scores?.A?.overall || 0\n  },\n  \n  prompt_b: {\n    prompt: config.prompt_b,\n    output: outputB,\n    score: comparison.scores?.B?.overall || 0\n  },\n  \n  winner: comparison.winner,\n  score_difference: Math.abs((comparison.scores?.A?.overall || 0) - (comparison.scores?.B?.overall || 0)),\n  reasoning: comparison.reasoning,\n  detailed_comparison: comparison.detailed_comparison,\n  recommendation: comparison.recommendation,\n  \n  tested_at: new Date().toISOString()\n};\n\nreturn { json: results };"
        },
        "id": "compile-ab-results",
        "name": "Compile A/B Results",
        "type": "n8n-nodes-base.code",
        "position": [
          1050,
          800
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "respond-ab-test",
        "name": "Return A/B Results",
        "type": "n8n-nodes-base.respondToWebhook",
        "position": [
          1250,
          800
        ],
        "typeVersion": 1.1
      }
    ],
    "connections": {
      "Prompt Request": {
        "main": [
          [
            {
              "node": "Normalize & Enrich Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize & Enrich Request": {
        "main": [
          [
            {
              "node": "Deep Prompt Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Deep Prompt Analysis": {
        "main": [
          [
            {
              "node": "Parse Analysis Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Analysis Results": {
        "main": [
          [
            {
              "node": "Optimize & Enhance Prompt",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Optimize & Enhance Prompt": {
        "main": [
          [
            {
              "node": "Parse Optimized Prompt",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Optimized Prompt": {
        "main": [
          [
            {
              "node": "If Multiple Variants",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Multiple Variants": {
        "main": [
          [
            {
              "node": "Generate Prompt Variants",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Test Optimized Prompt",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Prompt Variants": {
        "main": [
          [
            {
              "node": "Compile Prompt Package",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Test Optimized Prompt": {
        "main": [
          [
            {
              "node": "Validate Test Output",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Validate Test Output": {
        "main": [
          [
            {
              "node": "Compile Prompt Package",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compile Prompt Package": {
        "main": [
          [
            {
              "node": "Save to Prompt Library",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save to Prompt Library": {
        "main": [
          [
            {
              "node": "Return Prompt Package",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Slack",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Templates": {
        "main": [
          [
            {
              "node": "Return Prompt Templates",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Return Prompt Templates": {
        "main": [
          [
            {
              "node": "Return Templates Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "A/B Test Request": {
        "main": [
          [
            {
              "node": "Setup A/B Test",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Setup A/B Test": {
        "main": [
          [
            {
              "node": "Run Prompt A",
              "type": "main",
              "index": 0
            },
            {
              "node": "Run Prompt B",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Run Prompt A": {
        "main": [
          [
            {
              "node": "Compare A/B Outputs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Run Prompt B": {
        "main": [
          [
            {
              "node": "Compare A/B Outputs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compare A/B Outputs": {
        "main": [
          [
            {
              "node": "Compile A/B Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compile A/B Results": {
        "main": [
          [
            {
              "node": "Return A/B Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "grain-automation"
      },
      {
        "name": "prompt-engineering"
      },
      {
        "name": "ai-tools"
      }
    ],
    "meta": {
      "templateId": "grain-pes-v1",
      "version": "1.0.0",
      "description": "Advanced Prompt Engineering Studio: Analyze, optimize, test, and version prompts. Includes few-shot generation, chain-of-thought, A/B testing, and prompt library.",
      "requiredCredentials": [
        "Google Sheets OAuth2",
        "OpenAI API",
        "Slack"
      ],
      "endpoints": {
        "optimize": "/webhook/prompt-studio",
        "templates": "/webhook/prompt-templates",
        "ab_test": "/webhook/prompt-ab-test"
      },
      "features": [
        "Deep prompt analysis",
        "Auto-optimization with CoT",
        "Few-shot example generation",
        "Multi-variant generation",
        "Output validation",
        "A/B testing framework",
        "Pre-built template library",
        "Prompt versioning"
      ]
    }
  },
  {
    "name": "Grain Rank Tracking v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 6 * * *"
              }
            ]
          }
        },
        "id": "daily-tracking",
        "name": "Daily Rank Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "rank-check",
          "options": {}
        },
        "id": "manual-check",
        "name": "Manual Check Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          600
        ],
        "webhookId": "rank-check-trigger"
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.TRACKING_DB_URL }}/campaigns/active",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-campaigns",
        "name": "Fetch Active Campaigns",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "tracking-db-api",
            "name": "Tracking DB API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Prepare tracking jobs for all campaigns\nconst campaigns = $input.first().json.campaigns || [];\n\nconst trackingJobs = campaigns.map(campaign => ({\n  trackingId: `TRK-${Date.now().toString(36).toUpperCase()}-${campaign.id}`,\n  campaignId: campaign.id,\n  domain: campaign.domain,\n  keywords: campaign.keywords || [],\n  locations: campaign.locations || [{ country: 'US', device: 'desktop' }],\n  competitors: campaign.competitors || [],\n  searchEngine: campaign.searchEngine || 'google',\n  checkDate: new Date().toISOString().split('T')[0],\n  timestamp: new Date().toISOString()\n}));\n\nreturn trackingJobs.map(job => ({ json: job }));"
        },
        "id": "prepare-jobs",
        "name": "Prepare Tracking Jobs",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "batchSize": 10,
          "options": {}
        },
        "id": "batch-keywords",
        "name": "Batch Keywords",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.SERP_API_URL }}/check",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"domain\": \"{{ $json.domain }}\",\n  \"keywords\": {{ JSON.stringify($json.keywords) }},\n  \"locations\": {{ JSON.stringify($json.locations) }},\n  \"searchEngine\": \"{{ $json.searchEngine }}\",\n  \"checkCompetitors\": {{ $json.competitors.length > 0 }},\n  \"competitors\": {{ JSON.stringify($json.competitors) }}\n}",
          "options": {
            "timeout": 120000
          }
        },
        "id": "check-rankings",
        "name": "Check SERP Rankings",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "serp-api-key",
            "name": "SERP API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Process ranking results and compare with previous\nconst currentJob = $('Batch Keywords').first().json;\nconst serpResults = $input.first().json;\n\n// Process each keyword result\nconst processedResults = (serpResults.results || []).map(result => {\n  const previousPosition = result.previousPosition || null;\n  const currentPosition = result.position || null;\n  \n  let change = 0;\n  let changeType = 'stable';\n  \n  if (previousPosition && currentPosition) {\n    change = previousPosition - currentPosition;\n    if (change > 0) changeType = 'improved';\n    else if (change < 0) changeType = 'declined';\n  } else if (!previousPosition && currentPosition) {\n    changeType = 'new_ranking';\n  } else if (previousPosition && !currentPosition) {\n    changeType = 'lost_ranking';\n  }\n  \n  // Determine ranking tier\n  let tier = 'not_ranked';\n  if (currentPosition) {\n    if (currentPosition <= 3) tier = 'top3';\n    else if (currentPosition <= 10) tier = 'top10';\n    else if (currentPosition <= 20) tier = 'top20';\n    else if (currentPosition <= 50) tier = 'top50';\n    else tier = 'below50';\n  }\n  \n  return {\n    keyword: result.keyword,\n    position: currentPosition,\n    previousPosition,\n    change,\n    changeType,\n    tier,\n    url: result.url,\n    title: result.title,\n    snippet: result.snippet,\n    features: result.serp_features || [],\n    localPack: result.local_pack || false,\n    featuredSnippet: result.featured_snippet || false,\n    volume: result.volume,\n    difficulty: result.difficulty,\n    location: result.location,\n    device: result.device,\n    competitors: result.competitors || []\n  };\n});\n\n// Calculate summary stats\nconst ranked = processedResults.filter(r => r.position);\nconst improved = processedResults.filter(r => r.changeType === 'improved');\nconst declined = processedResults.filter(r => r.changeType === 'declined');\nconst lost = processedResults.filter(r => r.changeType === 'lost_ranking');\nconst newRankings = processedResults.filter(r => r.changeType === 'new_ranking');\n\nconst summary = {\n  totalKeywords: processedResults.length,\n  ranked: ranked.length,\n  notRanked: processedResults.length - ranked.length,\n  avgPosition: ranked.length > 0 \n    ? Math.round(ranked.reduce((a, b) => a + b.position, 0) / ranked.length * 10) / 10\n    : null,\n  top3: processedResults.filter(r => r.tier === 'top3').length,\n  top10: processedResults.filter(r => r.tier === 'top10' || r.tier === 'top3').length,\n  top20: processedResults.filter(r => ['top3', 'top10', 'top20'].includes(r.tier)).length,\n  improved: improved.length,\n  declined: declined.length,\n  stable: processedResults.filter(r => r.changeType === 'stable').length,\n  newRankings: newRankings.length,\n  lostRankings: lost.length,\n  totalImprovement: improved.reduce((a, b) => a + b.change, 0),\n  totalDecline: Math.abs(declined.reduce((a, b) => a + b.change, 0)),\n  featuredSnippets: processedResults.filter(r => r.featuredSnippet).length,\n  localPack: processedResults.filter(r => r.localPack).length\n};\n\n// Identify significant changes (alerts)\nconst alerts = [\n  ...improved.filter(r => r.change >= 10).map(r => ({\n    type: 'big_improvement',\n    severity: 'positive',\n    keyword: r.keyword,\n    message: `Jumped ${r.change} positions to #${r.position}`\n  })),\n  ...declined.filter(r => Math.abs(r.change) >= 10).map(r => ({\n    type: 'big_decline',\n    severity: 'negative',\n    keyword: r.keyword,\n    message: `Dropped ${Math.abs(r.change)} positions to #${r.position}`\n  })),\n  ...lost.map(r => ({\n    type: 'lost_ranking',\n    severity: 'critical',\n    keyword: r.keyword,\n    message: `Lost ranking (was #${r.previousPosition})`\n  })),\n  ...newRankings.map(r => ({\n    type: 'new_ranking',\n    severity: 'positive',\n    keyword: r.keyword,\n    message: `New ranking at #${r.position}`\n  }))\n];\n\nreturn [{ json: {\n  trackingId: currentJob.trackingId,\n  campaignId: currentJob.campaignId,\n  domain: currentJob.domain,\n  checkDate: currentJob.checkDate,\n  timestamp: currentJob.timestamp,\n  summary,\n  alerts,\n  results: processedResults\n}}];"
        },
        "id": "process-results",
        "name": "Process Results",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.TRACKING_DB_URL }}/results",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-results",
        "name": "Save Results",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1750,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "tracking-db-api",
            "name": "Tracking DB API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-critical-alerts",
                "leftValue": "={{ $json.alerts.filter(a => a.severity === 'critical' || a.severity === 'negative').length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-alerts",
        "name": "Has Critical Alerts?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1750,
          600
        ]
      },
      {
        "parameters": {
          "channel": "={{ $vars.SEO_SLACK_CHANNEL }}",
          "text": "=âš ï¸ *Rank Tracking Alert - {{ $json.domain }}*\n\n{{ $json.alerts.filter(a => a.severity === 'critical' || a.severity === 'negative').map(a => \n  `${a.severity === 'critical' ? 'ðŸ”´' : 'ðŸŸ¡'} *${a.keyword}*: ${a.message}`\n).join('\\n') }}\n\nðŸ“Š *Daily Summary:*\nâ€¢ Average Position: {{ $json.summary.avgPosition || 'N/A' }}\nâ€¢ Top 10 Rankings: {{ $json.summary.top10 }}\nâ€¢ Improved: {{ $json.summary.improved }} (+{{ $json.summary.totalImprovement }} positions)\nâ€¢ Declined: {{ $json.summary.declined }} (-{{ $json.summary.totalDecline }} positions)\n\n_Check dashboard for full details_",
          "otherOptions": {}
        },
        "id": "alert-slack",
        "name": "Send Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          2000,
          550
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "summary-email",
                "name": "emailRequired",
                "value": "={{ $json.summary.improved > 5 || $json.summary.declined > 5 }}",
                "type": "boolean"
              }
            ]
          },
          "options": {}
        },
        "id": "check-email",
        "name": "Check Email Needed",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2000,
          750
        ]
      },
      {
        "parameters": {
          "operation": "generateChart",
          "chartConfig": "={\n  \"type\": \"line\",\n  \"data\": {\n    \"labels\": [\"7d ago\", \"6d ago\", \"5d ago\", \"4d ago\", \"3d ago\", \"2d ago\", \"Yesterday\", \"Today\"],\n    \"datasets\": [{\n      \"label\": \"Avg Position\",\n      \"data\": {{ JSON.stringify($json.historicalPositions || [0,0,0,0,0,0,0,$json.summary.avgPosition]) }},\n      \"borderColor\": \"#4285F4\",\n      \"fill\": false\n    }]\n  },\n  \"options\": {\n    \"scales\": {\n      \"y\": {\n        \"reverse\": true,\n        \"min\": 1\n      }\n    }\n  }\n}"
        },
        "id": "generate-chart",
        "name": "Generate Chart",
        "type": "n8n-nodes-base.quickChart",
        "typeVersion": 1,
        "position": [
          2250,
          500
        ]
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.RANK_TRACKING_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Daily Rankings",
            "mode": "list",
            "cachedResultName": "Daily Rankings"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Date": "={{ $json.checkDate }}",
              "Domain": "={{ $json.domain }}",
              "Keywords Tracked": "={{ $json.summary.totalKeywords }}",
              "Avg Position": "={{ $json.summary.avgPosition }}",
              "Top 3": "={{ $json.summary.top3 }}",
              "Top 10": "={{ $json.summary.top10 }}",
              "Top 20": "={{ $json.summary.top20 }}",
              "Improved": "={{ $json.summary.improved }}",
              "Declined": "={{ $json.summary.declined }}",
              "Featured Snippets": "={{ $json.summary.featuredSnippets }}"
            }
          },
          "options": {}
        },
        "id": "log-sheets",
        "name": "Log to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          2250,
          700
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Daily Rank Check": {
        "main": [
          [
            {
              "node": "Fetch Active Campaigns",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Check Trigger": {
        "main": [
          [
            {
              "node": "Fetch Active Campaigns",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Active Campaigns": {
        "main": [
          [
            {
              "node": "Prepare Tracking Jobs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Tracking Jobs": {
        "main": [
          [
            {
              "node": "Batch Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Batch Keywords": {
        "main": [
          [
            {
              "node": "Check SERP Rankings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check SERP Rankings": {
        "main": [
          [
            {
              "node": "Process Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Results": {
        "main": [
          [
            {
              "node": "Save Results",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has Critical Alerts?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Generate Chart",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Critical Alerts?": {
        "main": [
          [
            {
              "node": "Send Alert",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Check Email Needed",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "seo",
        "name": "seo"
      },
      {
        "id": "ranking",
        "name": "ranking"
      },
      {
        "id": "tracking",
        "name": "tracking"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Referral Program Automation v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "referral-signup",
          "options": {}
        },
        "id": "referral-signup",
        "name": "Referral Signup",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "referral-signup"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "referral-conversion",
          "options": {}
        },
        "id": "referral-conversion",
        "name": "Referral Conversion",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          600
        ],
        "webhookId": "referral-conversion"
      },
      {
        "parameters": {
          "jsCode": "// Process new referral signup (someone joined via referral link)\nconst data = $input.first().json.body;\n\nconst referral = {\n  referralId: `REF-${Date.now().toString(36).toUpperCase()}`,\n  referrerId: data.referrerId || data.referrer_code,\n  referredId: data.userId,\n  referredEmail: data.email,\n  referredName: data.name,\n  source: data.source || 'referral_link',\n  campaignId: data.campaignId,\n  status: 'pending',\n  signupDate: new Date().toISOString(),\n  conversionDate: null,\n  rewards: {\n    referrer: null,\n    referred: null\n  },\n  metadata: data.metadata || {}\n};\n\nreturn [{ json: referral }];"
        },
        "id": "parse-signup",
        "name": "Parse Signup",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CRM_API_URL }}/users/{{ $json.referrerId }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-referrer",
        "name": "Fetch Referrer",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          200
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "crm-api-key",
            "name": "CRM API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.REFERRAL_API_URL }}/referrals",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($('Parse Signup').first().json) }}",
          "options": {}
        },
        "id": "create-referral",
        "name": "Create Referral Record",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "referral-api-key",
            "name": "Referral API Key"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "=You were referred by {{ $json.name }}!",
          "message": "=Welcome to {{ $vars.COMPANY_NAME }}!\n\n{{ $('Fetch Referrer').first().json.name }} thought you'd love our product, and we're excited to have you!\n\nðŸŽ **Your Welcome Bonus:**\nAs a referred friend, you get:\n- 20% off your first purchase\n- Extended 30-day trial\n- Priority onboarding support\n\n**Use code:** FRIEND20 at checkout\n\nStart exploring now and see why {{ $('Fetch Referrer').first().json.name }} recommends us!\n\nBest,\nThe {{ $vars.COMPANY_NAME }} Team",
          "options": {}
        },
        "id": "welcome-referred",
        "name": "Welcome Referred User",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1000,
          300
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $('Fetch Referrer').first().json.email }}",
          "subject": "=Great news! {{ $json.name }} just signed up",
          "message": "=Hi {{ $('Fetch Referrer').first().json.name }},\n\nAwesome news! Your friend {{ $('Parse Signup').first().json.referredName }} just signed up using your referral link!\n\nðŸŽ¯ **What's next:**\nOnce they make their first purchase, you'll both receive your rewards:\n- You: ${{ $vars.REFERRER_REWARD }} credit\n- Them: 20% off first purchase\n\nðŸ“Š **Your Referral Stats:**\n- Total Referrals: {{ $('Fetch Referrer').first().json.referral_count || 1 }}\n- Successful Conversions: {{ $('Fetch Referrer').first().json.conversion_count || 0 }}\n- Total Earned: ${{ $('Fetch Referrer').first().json.total_rewards || 0 }}\n\nKeep sharing your link to earn more rewards!\nYour unique link: {{ $vars.REFERRAL_BASE_URL }}/{{ $('Fetch Referrer').first().json.referral_code }}\n\nThanks for spreading the word!\n\nThe {{ $vars.COMPANY_NAME }} Team",
          "options": {}
        },
        "id": "notify-referrer-signup",
        "name": "Notify Referrer",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1000,
          500
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Process referral conversion (referred user made purchase)\nconst data = $input.first().json.body;\n\nconst conversion = {\n  referralId: data.referralId,\n  referrerId: data.referrerId,\n  referredId: data.referredId,\n  conversionType: data.conversionType || 'purchase',\n  orderValue: data.orderValue || 0,\n  orderId: data.orderId,\n  conversionDate: new Date().toISOString(),\n  status: 'converted'\n};\n\nreturn [{ json: conversion }];"
        },
        "id": "parse-conversion",
        "name": "Parse Conversion",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          600
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.REFERRAL_API_URL }}/referrals/{{ $json.referralId }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-referral",
        "name": "Fetch Referral Details",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "referral-api-key",
            "name": "Referral API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Calculate and process rewards\nconst conversion = $('Parse Conversion').first().json;\nconst referral = $input.first().json;\n\n// Reward tiers based on referral count\nconst referrerTiers = {\n  1: 25,   // First referral: $25\n  5: 30,   // 5+ referrals: $30 each\n  10: 40,  // 10+ referrals: $40 each\n  25: 50   // 25+ referrals: $50 each\n};\n\n// Get referrer's total successful referrals\nconst totalReferrals = referral.referrer?.successful_referrals || 0;\n\n// Determine reward amount\nlet referrerReward = 25; // Default\nfor (const [threshold, amount] of Object.entries(referrerTiers)) {\n  if (totalReferrals >= parseInt(threshold)) {\n    referrerReward = amount;\n  }\n}\n\n// Calculate commission if applicable (for high-value referrers)\nlet commission = 0;\nif (totalReferrals >= 10 && conversion.orderValue > 0) {\n  commission = Math.round(conversion.orderValue * 0.1); // 10% commission\n}\n\nconst rewards = {\n  referralId: conversion.referralId,\n  referrerId: conversion.referrerId,\n  referredId: conversion.referredId,\n  referrer: {\n    userId: conversion.referrerId,\n    email: referral.referrer?.email,\n    name: referral.referrer?.name,\n    rewardType: 'credit',\n    amount: referrerReward + commission,\n    breakdown: {\n      baseReward: referrerReward,\n      commission\n    }\n  },\n  referred: {\n    userId: conversion.referredId,\n    email: referral.referred?.email,\n    name: referral.referred?.name,\n    rewardType: 'discount',\n    amount: 20, // 20% off\n    applied: true // Already applied at checkout\n  },\n  orderValue: conversion.orderValue,\n  processedAt: new Date().toISOString()\n};\n\nreturn [{ json: rewards }];"
        },
        "id": "calculate-rewards",
        "name": "Calculate Rewards",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.BILLING_API_URL }}/credits",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"user_id\": \"{{ $json.referrer.userId }}\",\n  \"amount\": {{ $json.referrer.amount }},\n  \"type\": \"referral_reward\",\n  \"description\": \"Referral reward for {{ $json.referred.name }}\",\n  \"referral_id\": \"{{ $json.referralId }}\"\n}",
          "options": {}
        },
        "id": "issue-credit",
        "name": "Issue Referrer Credit",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "billing-api-key",
            "name": "Billing API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "={{ $vars.REFERRAL_API_URL }}/referrals/{{ $json.referralId }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"status\": \"converted\",\n  \"conversion_date\": \"{{ $json.processedAt }}\",\n  \"rewards_issued\": true,\n  \"referrer_reward\": {{ $json.referrer.amount }},\n  \"order_value\": {{ $json.orderValue }}\n}",
          "options": {}
        },
        "id": "update-referral",
        "name": "Update Referral Status",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          700
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "referral-api-key",
            "name": "Referral API Key"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $json.referrer.email }}",
          "subject": "=ðŸŽ‰ You earned ${{ $json.referrer.amount }} from your referral!",
          "message": "=Hi {{ $json.referrer.name }},\n\nGreat news! {{ $json.referred.name }} just made their first purchase, and you've earned your reward!\n\nðŸ’° **Your Reward:**\n${{ $json.referrer.amount }} credit added to your account\n{{ $json.referrer.breakdown.commission > 0 ? `\\n(Includes $${$json.referrer.breakdown.commission} bonus commission!)` : '' }}\n\nðŸ“Š **Your Referral Dashboard:**\nVisit {{ $vars.REFERRAL_DASHBOARD_URL }} to:\n- See your total earnings\n- Track pending referrals\n- Get your shareable link\n- Access marketing materials\n\nðŸš€ **Keep the momentum going!**\nShare your unique link and earn ${{ $json.referrer.breakdown.baseReward }}+ for every successful referral.\n\nThank you for being an amazing advocate!\n\nThe {{ $vars.COMPANY_NAME }} Team",
          "options": {}
        },
        "id": "notify-reward",
        "name": "Notify Referrer Reward",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1500,
          600
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.GROWTH_SLACK_CHANNEL }}",
          "text": "=ðŸŽ¯ *Referral Conversion!*\n\n*Referrer:* {{ $json.referrer.name }}\n*Referred:* {{ $json.referred.name }}\n*Order Value:* ${{ $json.orderValue }}\n*Reward Issued:* ${{ $json.referrer.amount }}\n\n_{{ $json.referrer.breakdown.commission > 0 ? 'Includes commission bonus!' : '' }}_",
          "otherOptions": {}
        },
        "id": "notify-conversion",
        "name": "Notify Conversion",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1500,
          800
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 * * 1"
              }
            ]
          }
        },
        "id": "weekly-report",
        "name": "Weekly Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          900
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.REFERRAL_API_URL }}/stats",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "period",
                "value": "last_7_days"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-stats",
        "name": "Fetch Weekly Stats",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          900
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "referral-api-key",
            "name": "Referral API Key"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.GROWTH_SLACK_CHANNEL }}",
          "text": "=ðŸ“Š *Weekly Referral Program Report*\n\n*Last 7 Days:*\nâ€¢ New Referrals: {{ $json.new_referrals || 0 }}\nâ€¢ Conversions: {{ $json.conversions || 0 }}\nâ€¢ Conversion Rate: {{ $json.conversion_rate || 0 }}%\nâ€¢ Total Revenue: ${{ $json.referral_revenue?.toLocaleString() || 0 }}\nâ€¢ Rewards Issued: ${{ $json.rewards_issued?.toLocaleString() || 0 }}\n\n*Top Referrers:*\n{{ $json.top_referrers?.slice(0, 5).map((r, i) => `${i + 1}. ${r.name}: ${r.conversions} conversions`).join('\\n') || 'No data' }}\n\n*Program Health:*\nâ€¢ Active Referrers: {{ $json.active_referrers || 0 }}\nâ€¢ Avg Reward: ${{ $json.avg_reward || 0 }}\nâ€¢ CAC via Referral: ${{ $json.referral_cac || 0 }}",
          "otherOptions": {}
        },
        "id": "post-weekly-report",
        "name": "Post Weekly Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          750,
          900
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.REFERRAL_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Referrals",
            "mode": "list",
            "cachedResultName": "Referrals"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Referral ID": "={{ $('Parse Signup').first().json.referralId }}",
              "Referrer ID": "={{ $('Parse Signup').first().json.referrerId }}",
              "Referred Email": "={{ $('Parse Signup').first().json.referredEmail }}",
              "Referred Name": "={{ $('Parse Signup').first().json.referredName }}",
              "Source": "={{ $('Parse Signup').first().json.source }}",
              "Status": "=pending",
              "Signup Date": "={{ $('Parse Signup').first().json.signupDate }}"
            }
          },
          "options": {}
        },
        "id": "log-referral",
        "name": "Log Referral",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1250,
          300
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Referral Signup": {
        "main": [
          [
            {
              "node": "Parse Signup",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Signup": {
        "main": [
          [
            {
              "node": "Fetch Referrer",
              "type": "main",
              "index": 0
            },
            {
              "node": "Create Referral Record",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Referrer": {
        "main": [
          [
            {
              "node": "Welcome Referred User",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Referrer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Referral Record": {
        "main": [
          [
            {
              "node": "Log Referral",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Referral Conversion": {
        "main": [
          [
            {
              "node": "Parse Conversion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Conversion": {
        "main": [
          [
            {
              "node": "Fetch Referral Details",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Referral Details": {
        "main": [
          [
            {
              "node": "Calculate Rewards",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Rewards": {
        "main": [
          [
            {
              "node": "Issue Referrer Credit",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Referral Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Issue Referrer Credit": {
        "main": [
          [
            {
              "node": "Notify Referrer Reward",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Referral Status": {
        "main": [
          [
            {
              "node": "Notify Conversion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Weekly Report": {
        "main": [
          [
            {
              "node": "Fetch Weekly Stats",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Weekly Stats": {
        "main": [
          [
            {
              "node": "Post Weekly Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "referral",
        "name": "referral"
      },
      {
        "id": "growth",
        "name": "growth"
      },
      {
        "id": "marketing",
        "name": "marketing"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 3,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Restaurant Loyalty Program v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "loyalty/transaction",
          "options": {}
        },
        "id": "transaction-webhook",
        "name": "Transaction Received",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "loyalty-transaction"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "loyalty/enroll",
          "options": {}
        },
        "id": "enroll-webhook",
        "name": "New Enrollment",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          600
        ],
        "webhookId": "loyalty-enroll"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "loyalty/redeem",
          "options": {}
        },
        "id": "redeem-webhook",
        "name": "Reward Redemption",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          800
        ],
        "webhookId": "loyalty-redeem"
      },
      {
        "parameters": {
          "jsCode": "// Process transaction and calculate points\nconst transaction = $input.first().json.body;\n\nconst txData = {\n  transactionId: `TXN-${Date.now().toString(36).toUpperCase()}`,\n  type: 'purchase',\n  memberId: transaction.memberId || transaction.customerId,\n  restaurantId: transaction.restaurantId || transaction.locationId,\n  orderId: transaction.orderId,\n  subtotal: transaction.subtotal || 0,\n  tax: transaction.tax || 0,\n  total: transaction.total || transaction.subtotal || 0,\n  items: transaction.items || [],\n  paymentMethod: transaction.paymentMethod,\n  timestamp: new Date().toISOString(),\n  source: transaction.source || 'pos'\n};\n\n// Calculate base points (1 point per dollar)\nlet basePoints = Math.floor(txData.subtotal);\n\n// Bonus multipliers\nlet multiplier = 1;\nconst bonuses = [];\n\n// Double points on specific days\nconst dayOfWeek = new Date().getDay();\nif (dayOfWeek === 2) { // Tuesday\n  multiplier *= 2;\n  bonuses.push({ type: 'double_tuesday', multiplier: 2 });\n}\n\n// Birthday bonus (checked later with member data)\ntxData.checkBirthday = true;\n\n// Happy hour bonus (3-6pm)\nconst hour = new Date().getHours();\nif (hour >= 15 && hour < 18) {\n  multiplier *= 1.5;\n  bonuses.push({ type: 'happy_hour', multiplier: 1.5 });\n}\n\n// Category bonuses\nconst premiumItems = txData.items.filter(i => \n  i.category === 'premium' || i.category === 'signature'\n);\nif (premiumItems.length > 0) {\n  const premiumBonus = premiumItems.reduce((a, b) => a + (b.price || 0), 0) * 0.5;\n  basePoints += Math.floor(premiumBonus);\n  bonuses.push({ type: 'premium_items', extra: Math.floor(premiumBonus) });\n}\n\ntxData.pointsCalculation = {\n  basePoints,\n  multiplier,\n  bonuses,\n  earnedPoints: Math.floor(basePoints * multiplier)\n};\n\nreturn [{ json: txData }];"
        },
        "id": "process-transaction",
        "name": "Process Transaction",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "// Process new member enrollment\nconst enrollment = $input.first().json.body;\n\nconst memberData = {\n  enrollmentId: `ENR-${Date.now().toString(36).toUpperCase()}`,\n  type: 'enrollment',\n  member: {\n    id: `MEM-${Date.now().toString(36).toUpperCase()}`,\n    firstName: enrollment.firstName,\n    lastName: enrollment.lastName,\n    email: enrollment.email,\n    phone: enrollment.phone,\n    birthday: enrollment.birthday,\n    preferences: enrollment.preferences || {},\n    marketingConsent: enrollment.marketingConsent || false,\n    smsConsent: enrollment.smsConsent || false\n  },\n  restaurantId: enrollment.restaurantId,\n  enrollmentSource: enrollment.source || 'website',\n  welcomeBonus: 100, // Welcome bonus points\n  tier: 'bronze',\n  timestamp: new Date().toISOString()\n};\n\nreturn [{ json: memberData }];"
        },
        "id": "process-enrollment",
        "name": "Process Enrollment",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "// Process reward redemption\nconst redemption = $input.first().json.body;\n\nconst redeemData = {\n  redemptionId: `RDM-${Date.now().toString(36).toUpperCase()}`,\n  type: 'redemption',\n  memberId: redemption.memberId,\n  rewardId: redemption.rewardId,\n  rewardType: redemption.rewardType,\n  pointsCost: redemption.pointsCost || 0,\n  restaurantId: redemption.restaurantId,\n  timestamp: new Date().toISOString()\n};\n\nreturn [{ json: redeemData }];"
        },
        "id": "process-redemption",
        "name": "Process Redemption",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          800
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.LOYALTY_DB_URL }}/members/{{ $json.memberId }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-member",
        "name": "Fetch Member",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "loyalty-db-api",
            "name": "Loyalty DB API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Calculate tier and update points\nconst transaction = $('Process Transaction').first().json;\nconst member = $input.first().json;\n\n// Add earned points to balance\nconst newBalance = (member.pointsBalance || 0) + transaction.pointsCalculation.earnedPoints;\nconst lifetimePoints = (member.lifetimePoints || 0) + transaction.pointsCalculation.earnedPoints;\nconst visitCount = (member.visitCount || 0) + 1;\n\n// Check birthday bonus\nlet birthdayBonus = 0;\nif (transaction.checkBirthday && member.birthday) {\n  const today = new Date();\n  const birthday = new Date(member.birthday);\n  if (today.getMonth() === birthday.getMonth() && today.getDate() === birthday.getDate()) {\n    birthdayBonus = 50;\n    transaction.pointsCalculation.bonuses.push({ type: 'birthday', extra: 50 });\n  }\n}\n\n// Calculate tier based on lifetime points\nlet newTier = 'bronze';\nlet tierBenefits = [];\n\nif (lifetimePoints >= 5000) {\n  newTier = 'platinum';\n  tierBenefits = [\n    '3x points on all purchases',\n    'Free appetizer monthly',\n    'Priority reservations',\n    'Exclusive events access',\n    'Birthday dinner complimentary'\n  ];\n} else if (lifetimePoints >= 2000) {\n  newTier = 'gold';\n  tierBenefits = [\n    '2x points on all purchases',\n    'Free dessert monthly',\n    'Early access to specials',\n    'Birthday 500 bonus points'\n  ];\n} else if (lifetimePoints >= 500) {\n  newTier = 'silver';\n  tierBenefits = [\n    '1.5x points on all purchases',\n    '10% off on Wednesdays',\n    'Birthday 250 bonus points'\n  ];\n} else {\n  tierBenefits = [\n    '1x points on all purchases',\n    'Birthday 100 bonus points'\n  ];\n}\n\nconst tierUpgrade = newTier !== member.tier && \n  ['silver', 'gold', 'platinum'].indexOf(newTier) > ['bronze', 'silver', 'gold', 'platinum'].indexOf(member.tier);\n\nconst memberUpdate = {\n  memberId: transaction.memberId,\n  previousBalance: member.pointsBalance || 0,\n  earnedPoints: transaction.pointsCalculation.earnedPoints + birthdayBonus,\n  newBalance: newBalance + birthdayBonus,\n  lifetimePoints,\n  visitCount,\n  previousTier: member.tier,\n  newTier,\n  tierUpgrade,\n  tierBenefits,\n  transaction: {\n    id: transaction.transactionId,\n    total: transaction.total,\n    bonuses: transaction.pointsCalculation.bonuses\n  },\n  timestamp: transaction.timestamp\n};\n\n// Calculate progress to next tier\nconst tierThresholds = { bronze: 500, silver: 2000, gold: 5000, platinum: Infinity };\nconst nextTierThreshold = tierThresholds[newTier];\nif (nextTierThreshold !== Infinity) {\n  memberUpdate.nextTierProgress = {\n    current: lifetimePoints,\n    needed: nextTierThreshold,\n    remaining: nextTierThreshold - lifetimePoints,\n    percentage: Math.round(lifetimePoints / nextTierThreshold * 100)\n  };\n}\n\n// Available rewards check\nconst rewards = [\n  { id: 'free_drink', name: 'Free Drink', points: 100, tier: 'bronze' },\n  { id: 'free_appetizer', name: 'Free Appetizer', points: 250, tier: 'bronze' },\n  { id: 'free_dessert', name: 'Free Dessert', points: 300, tier: 'bronze' },\n  { id: '10_off', name: '$10 Off', points: 500, tier: 'silver' },\n  { id: 'free_entree', name: 'Free EntrÃ©e', points: 1000, tier: 'silver' },\n  { id: '25_off', name: '$25 Off', points: 1200, tier: 'gold' },\n  { id: 'vip_dinner', name: 'VIP Dinner for Two', points: 2500, tier: 'platinum' }\n];\n\nmemberUpdate.availableRewards = rewards.filter(r => \n  newBalance >= r.points && \n  ['bronze', 'silver', 'gold', 'platinum'].indexOf(newTier) >= \n  ['bronze', 'silver', 'gold', 'platinum'].indexOf(r.tier)\n);\n\nreturn [{ json: memberUpdate }];"
        },
        "id": "calculate-update",
        "name": "Calculate Points & Tier",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "method": "PUT",
          "url": "={{ $vars.LOYALTY_DB_URL }}/members/{{ $json.memberId }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"pointsBalance\": {{ $json.newBalance }},\n  \"lifetimePoints\": {{ $json.lifetimePoints }},\n  \"visitCount\": {{ $json.visitCount }},\n  \"tier\": \"{{ $json.newTier }}\",\n  \"lastVisit\": \"{{ $json.timestamp }}\"\n}",
          "options": {}
        },
        "id": "update-member",
        "name": "Update Member",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "loyalty-db-api",
            "name": "Loyalty DB API"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.LOYALTY_DB_URL }}/members",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.member) }}",
          "options": {}
        },
        "id": "create-member",
        "name": "Create Member",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "loyalty-db-api",
            "name": "Loyalty DB API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "tier-upgrade",
                "leftValue": "={{ $json.tierUpgrade }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-upgrade",
        "name": "Tier Upgraded?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1500,
          400
        ]
      },
      {
        "parameters": {
          "fromEmail": "={{ $vars.RESTAURANT_EMAIL }}",
          "toEmail": "={{ $('Fetch Member').first().json.email }}",
          "subject": "=ðŸŽ‰ Congratulations! You've reached {{ $json.newTier.charAt(0).toUpperCase() + $json.newTier.slice(1) }} status!",
          "emailType": "html",
          "html": "=<h2>Welcome to {{ $json.newTier.charAt(0).toUpperCase() + $json.newTier.slice(1) }} Tier!</h2>\n<p>Dear {{ $('Fetch Member').first().json.firstName }},</p>\n<p>Congratulations! Your loyalty has paid off - you've been upgraded to <strong>{{ $json.newTier.toUpperCase() }}</strong> member status!</p>\n<h3>Your New Benefits:</h3>\n<ul>\n{{ $json.tierBenefits.map(b => `<li>${b}</li>`).join('') }}\n</ul>\n<p><strong>Current Points Balance:</strong> {{ $json.newBalance.toLocaleString() }} points</p>\n<p>Thank you for being a valued member of our family!</p>",
          "options": {}
        },
        "id": "send-upgrade-email",
        "name": "Send Upgrade Email",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1750,
          350
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "from": "={{ $vars.TWILIO_PHONE }}",
          "to": "={{ $('Fetch Member').first().json.phone }}",
          "message": "=ðŸŽ‰ {{ $('Fetch Member').first().json.firstName }}, you earned {{ $json.earnedPoints }} points today! Balance: {{ $json.newBalance }} pts. {{ $json.availableRewards.length > 0 ? 'You have rewards available!' : '' }}"
        },
        "id": "send-sms",
        "name": "Send Points SMS",
        "type": "n8n-nodes-base.twilio",
        "typeVersion": 1,
        "position": [
          1750,
          550
        ],
        "credentials": {
          "twilioApi": {
            "id": "twilio-credential",
            "name": "Twilio API"
          }
        }
      },
      {
        "parameters": {
          "fromEmail": "={{ $vars.RESTAURANT_EMAIL }}",
          "toEmail": "={{ $json.member.email }}",
          "subject": "=ðŸ½ï¸ Welcome to our Loyalty Program! Here's {{ $json.welcomeBonus }} bonus points",
          "emailType": "html",
          "html": "=<h2>Welcome to the Family, {{ $json.member.firstName }}!</h2>\n<p>Thank you for joining our loyalty program!</p>\n<h3>Your Welcome Gift:</h3>\n<p style=\"font-size: 24px; color: #e74c3c;\"><strong>{{ $json.welcomeBonus }} Bonus Points</strong></p>\n<h3>How It Works:</h3>\n<ul>\n<li>Earn 1 point for every $1 spent</li>\n<li>Double points on Tuesdays</li>\n<li>1.5x points during happy hour (3-6pm)</li>\n<li>Special birthday rewards</li>\n</ul>\n<h3>Rewards You Can Earn:</h3>\n<ul>\n<li>100 pts - Free Drink</li>\n<li>250 pts - Free Appetizer</li>\n<li>500 pts - $10 Off</li>\n<li>1000 pts - Free EntrÃ©e</li>\n</ul>\n<p>We can't wait to see you soon!</p>",
          "options": {}
        },
        "id": "send-welcome-email",
        "name": "Send Welcome Email",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1000,
          600
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"success\": true,\n  \"memberId\": \"{{ $json.memberId }}\",\n  \"earnedPoints\": {{ $json.earnedPoints }},\n  \"newBalance\": {{ $json.newBalance }},\n  \"tier\": \"{{ $json.newTier }}\",\n  \"tierUpgrade\": {{ $json.tierUpgrade }},\n  \"availableRewards\": {{ $json.availableRewards.length }}\n}",
          "options": {}
        },
        "id": "respond-transaction",
        "name": "Respond Transaction",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          2000,
          450
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"success\": true,\n  \"memberId\": \"{{ $json.member.id }}\",\n  \"welcomeBonus\": {{ $json.welcomeBonus }},\n  \"tier\": \"{{ $json.tier }}\"\n}",
          "options": {}
        },
        "id": "respond-enrollment",
        "name": "Respond Enrollment",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1250,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.LOYALTY_DB_URL }}/redemptions",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "record-redemption",
        "name": "Record Redemption",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "loyalty-db-api",
            "name": "Loyalty DB API"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"success\": true,\n  \"redemptionId\": \"{{ $json.redemptionId }}\",\n  \"pointsDeducted\": {{ $json.pointsCost }}\n}",
          "options": {}
        },
        "id": "respond-redemption",
        "name": "Respond Redemption",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1000,
          800
        ]
      }
    ],
    "connections": {
      "Transaction Received": {
        "main": [
          [
            {
              "node": "Process Transaction",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "New Enrollment": {
        "main": [
          [
            {
              "node": "Process Enrollment",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Reward Redemption": {
        "main": [
          [
            {
              "node": "Process Redemption",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Transaction": {
        "main": [
          [
            {
              "node": "Fetch Member",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Enrollment": {
        "main": [
          [
            {
              "node": "Create Member",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Redemption": {
        "main": [
          [
            {
              "node": "Record Redemption",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Member": {
        "main": [
          [
            {
              "node": "Calculate Points & Tier",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Points & Tier": {
        "main": [
          [
            {
              "node": "Update Member",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Member": {
        "main": [
          [
            {
              "node": "Tier Upgraded?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send Points SMS",
              "type": "main",
              "index": 0
            },
            {
              "node": "Respond Transaction",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Member": {
        "main": [
          [
            {
              "node": "Send Welcome Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Respond Enrollment",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tier Upgraded?": {
        "main": [
          [
            {
              "node": "Send Upgrade Email",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Record Redemption": {
        "main": [
          [
            {
              "node": "Respond Redemption",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "restaurant",
        "name": "restaurant"
      },
      {
        "id": "loyalty",
        "name": "loyalty"
      },
      {
        "id": "rewards",
        "name": "rewards"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 3,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Restaurant Marketing Hub v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "restaurant-guest",
          "options": {}
        },
        "id": "guest-webhook",
        "name": "New Guest Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "restaurant-guest"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 10 * * *"
              }
            ]
          }
        },
        "id": "daily-trigger",
        "name": "Daily 10 AM",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "// Parse new guest data from POS or reservation system\nconst data = $input.first().json.body;\n\nconst guest = {\n  guestId: data.guestId || `GUEST-${Date.now().toString(36).toUpperCase()}`,\n  firstName: data.firstName,\n  lastName: data.lastName,\n  email: data.email,\n  phone: data.phone,\n  source: data.source || 'walk-in', // reservation, walk-in, online-order\n  visitType: data.visitType || 'first_visit',\n  visitDate: data.visitDate || new Date().toISOString(),\n  partySize: data.partySize || 1,\n  orderTotal: data.orderTotal || 0,\n  items: data.items || [],\n  preferences: data.preferences || {},\n  tags: data.tags || [],\n  marketingConsent: data.marketingConsent !== false,\n  birthday: data.birthday || null,\n  anniversary: data.anniversary || null\n};\n\n// Determine guest segment\nlet segment = 'new';\nif (data.visitCount > 10) segment = 'vip';\nelse if (data.visitCount > 5) segment = 'regular';\nelse if (data.visitCount > 1) segment = 'returning';\n\nguest.segment = segment;\nguest.visitCount = data.visitCount || 1;\n\nreturn [{ json: guest }];"
        },
        "id": "parse-guest",
        "name": "Parse Guest Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CDP_API_URL }}/guests/upsert",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-to-cdp",
        "name": "Save to Guest CDP",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          200
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "cdp-api-key",
            "name": "CDP API Key"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "first-visit",
                "leftValue": "={{ $json.visitType }}",
                "rightValue": "first_visit",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "has-email",
                "leftValue": "={{ $json.email }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-first-visit",
        "name": "First Visit?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "=Welcome to {{ $vars.RESTAURANT_NAME }}! ðŸŽ‰",
          "message": "=Hi {{ $json.firstName }},\n\nThank you for dining with us at {{ $vars.RESTAURANT_NAME }}! We hope you had a wonderful experience.\n\nðŸŽ **Welcome Gift:**\nAs a thank you for visiting, here's a special offer:\n\n**15% OFF** your next visit!\nUse code: **WELCOME15**\n\nðŸ“± **Join Our Loyalty Program:**\nEarn points on every visit and unlock exclusive rewards!\n\n[Join Now]({{ $vars.LOYALTY_SIGNUP_URL }})\n\nWe can't wait to see you again!\n\nBest,\nThe {{ $vars.RESTAURANT_NAME }} Team\n\n---\nðŸ“ {{ $vars.RESTAURANT_ADDRESS }}\nðŸ“ž {{ $vars.RESTAURANT_PHONE }}\nðŸŒ {{ $vars.RESTAURANT_WEBSITE }}",
          "options": {}
        },
        "id": "send-welcome-email",
        "name": "Send Welcome Email",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1000,
          300
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.twilio.com/2010-04-01/Accounts/{{ $vars.TWILIO_ACCOUNT_SID }}/Messages.json",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "twilioApi",
          "sendBody": true,
          "contentType": "form-urlencoded",
          "bodyParameters": {
            "parameters": [
              {
                "name": "To",
                "value": "={{ $json.phone }}"
              },
              {
                "name": "From",
                "value": "={{ $vars.TWILIO_PHONE_NUMBER }}"
              },
              {
                "name": "Body",
                "value": "=Thanks for visiting {{ $vars.RESTAURANT_NAME }}! ðŸ½ï¸ Here's 15% off your next visit: WELCOME15. See you soon!"
              }
            ]
          },
          "options": {}
        },
        "id": "send-welcome-sms",
        "name": "Send Welcome SMS",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          500
        ],
        "credentials": {
          "twilioApi": {
            "id": "twilio-credential",
            "name": "Twilio API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CDP_API_URL }}/guests/segments/at-risk",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "days_since_visit",
                "value": "30"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-at-risk",
        "name": "Fetch At-Risk Guests",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "cdp-api-key",
            "name": "CDP API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CDP_API_URL }}/guests/segments/birthdays",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "days_ahead",
                "value": "7"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-birthdays",
        "name": "Fetch Upcoming Birthdays",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "cdp-api-key",
            "name": "CDP API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CDP_API_URL }}/guests/segments/vip",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-vips",
        "name": "Fetch VIP Guests",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          1000
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "cdp-api-key",
            "name": "CDP API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Process at-risk guests for win-back campaign\nconst guests = $input.first().json.guests || [];\n\nconst winBackCampaign = guests.map(guest => {\n  const daysSinceVisit = Math.floor(\n    (new Date() - new Date(guest.last_visit)) / (1000 * 60 * 60 * 24)\n  );\n  \n  // Determine offer based on guest value\n  let offer = '10% off';\n  let offerCode = 'COMEBACK10';\n  if (guest.lifetime_value > 500) {\n    offer = '25% off';\n    offerCode = 'VIP25';\n  } else if (guest.lifetime_value > 200) {\n    offer = '20% off';\n    offerCode = 'MISSYOU20';\n  } else if (guest.lifetime_value > 100) {\n    offer = '15% off';\n    offerCode = 'RETURN15';\n  }\n  \n  return {\n    guestId: guest.id,\n    firstName: guest.first_name,\n    email: guest.email,\n    phone: guest.phone,\n    daysSinceVisit,\n    lifetimeValue: guest.lifetime_value,\n    visitCount: guest.visit_count,\n    offer,\n    offerCode,\n    favoriteItems: guest.favorite_items || []\n  };\n});\n\nreturn winBackCampaign.map(g => ({ json: g }));"
        },
        "id": "prepare-winback",
        "name": "Prepare Win-Back Campaign",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          600
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are a restaurant marketing copywriter. Create personalized win-back messages for guests who haven't visited recently.\n\nGuidelines:\n1. Address guest by first name\n2. Reference their favorite items if known\n3. Create urgency without being pushy\n4. Highlight the special offer\n5. Keep it warm and inviting\n6. Include a clear CTA",
                "role": "system"
              },
              {
                "content": "=Create a personalized win-back email for:\n\n**Guest:** {{ $json.firstName }}\n**Days Since Visit:** {{ $json.daysSinceVisit }}\n**Visit Count:** {{ $json.visitCount }}\n**Favorite Items:** {{ $json.favoriteItems.join(', ') || 'Not tracked' }}\n**Offer:** {{ $json.offer }} with code {{ $json.offerCode }}\n**Restaurant:** {{ $vars.RESTAURANT_NAME }}\n\nGenerate subject line and email body.",
                "role": "user"
              }
            ]
          },
          "options": {
            "temperature": 0.7,
            "maxTokens": 500
          }
        },
        "id": "generate-winback-email",
        "name": "Generate Win-Back Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1000,
          600
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $('Prepare Win-Back Campaign').item.json.email }}",
          "subject": "=We miss you, {{ $('Prepare Win-Back Campaign').item.json.firstName }}! ðŸ’",
          "message": "={{ $json.message?.content || $json.choices?.[0]?.message?.content }}",
          "options": {}
        },
        "id": "send-winback-email",
        "name": "Send Win-Back Email",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1250,
          600
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Process birthday guests\nconst guests = $input.first().json.guests || [];\n\nreturn guests.map(guest => ({\n  json: {\n    guestId: guest.id,\n    firstName: guest.first_name,\n    email: guest.email,\n    phone: guest.phone,\n    birthday: guest.birthday,\n    daysUntilBirthday: Math.ceil(\n      (new Date(guest.birthday_this_year) - new Date()) / (1000 * 60 * 60 * 24)\n    ),\n    segment: guest.segment,\n    offer: guest.segment === 'vip' ? 'Complimentary dessert + 20% off' : 'Complimentary dessert',\n    offerCode: 'BIRTHDAY' + new Date().getFullYear()\n  }\n}));"
        },
        "id": "prepare-birthday",
        "name": "Prepare Birthday Campaign",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          800
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "=ðŸŽ‚ Happy Birthday, {{ $json.firstName }}! A gift awaits you",
          "message": "=Happy Birthday, {{ $json.firstName }}! ðŸŽ‰\n\nEveryone at {{ $vars.RESTAURANT_NAME }} wishes you a fantastic birthday!\n\nðŸŽ **Your Birthday Gift:**\n{{ $json.offer }}!\n\nUse code: **{{ $json.offerCode }}**\n\nValid for 2 weeks around your birthday. Bring your friends and family to celebrate with us!\n\nðŸ“… Book your table: {{ $vars.RESERVATION_URL }}\n\nLooking forward to celebrating with you!\n\nâ¤ï¸ The {{ $vars.RESTAURANT_NAME }} Team",
          "options": {}
        },
        "id": "send-birthday-email",
        "name": "Send Birthday Email",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1000,
          800
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Generate VIP exclusive offer\nconst vipGuests = $input.first().json.guests || [];\n\nconst campaign = {\n  type: 'vip_exclusive',\n  name: 'VIP Early Access',\n  guests: vipGuests.map(g => ({\n    guestId: g.id,\n    firstName: g.first_name,\n    email: g.email,\n    phone: g.phone,\n    lifetimeValue: g.lifetime_value,\n    visitCount: g.visit_count\n  })),\n  offer: {\n    title: 'VIP Exclusive: New Menu Preview',\n    description: 'Be the first to try our new seasonal menu',\n    discount: '30%',\n    code: 'VIPFIRST',\n    validDays: 7\n  },\n  createdAt: new Date().toISOString()\n};\n\nreturn [{ json: campaign }];"
        },
        "id": "prepare-vip-campaign",
        "name": "Prepare VIP Campaign",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          1000
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.EMAIL_API_URL }}/campaigns/send",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"template_id\": \"{{ $vars.VIP_EMAIL_TEMPLATE }}\",\n  \"recipients\": {{ JSON.stringify($json.guests.map(g => ({ email: g.email, name: g.firstName }))) }},\n  \"variables\": {\n    \"offer_title\": \"{{ $json.offer.title }}\",\n    \"offer_description\": \"{{ $json.offer.description }}\",\n    \"discount\": \"{{ $json.offer.discount }}\",\n    \"code\": \"{{ $json.offer.code }}\",\n    \"restaurant_name\": \"{{ $vars.RESTAURANT_NAME }}\"\n  }\n}",
          "options": {}
        },
        "id": "send-vip-campaign",
        "name": "Send VIP Campaign",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          1000
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "email-api-key",
            "name": "Email API Key"
          }
        }
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "feedback-submit",
          "options": {}
        },
        "id": "feedback-webhook",
        "name": "Feedback Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          1200
        ],
        "webhookId": "restaurant-feedback"
      },
      {
        "parameters": {
          "jsCode": "// Process guest feedback\nconst feedback = $input.first().json.body;\n\nconst processedFeedback = {\n  feedbackId: `FB-${Date.now().toString(36).toUpperCase()}`,\n  guestId: feedback.guestId,\n  guestName: feedback.guestName,\n  email: feedback.email,\n  visitDate: feedback.visitDate,\n  ratings: {\n    food: feedback.foodRating || 0,\n    service: feedback.serviceRating || 0,\n    ambiance: feedback.ambianceRating || 0,\n    value: feedback.valueRating || 0,\n    overall: feedback.overallRating || 0\n  },\n  comments: feedback.comments,\n  wouldRecommend: feedback.wouldRecommend,\n  submittedAt: new Date().toISOString()\n};\n\n// Calculate NPS category\nif (feedback.npsScore >= 9) {\n  processedFeedback.npsCategory = 'promoter';\n} else if (feedback.npsScore >= 7) {\n  processedFeedback.npsCategory = 'passive';\n} else {\n  processedFeedback.npsCategory = 'detractor';\n}\nprocessedFeedback.npsScore = feedback.npsScore;\n\n// Determine sentiment\nconst avgRating = (processedFeedback.ratings.food + processedFeedback.ratings.service + \n  processedFeedback.ratings.ambiance + processedFeedback.ratings.value) / 4;\nprocessedFeedback.sentiment = avgRating >= 4 ? 'positive' : avgRating >= 3 ? 'neutral' : 'negative';\n\nreturn [{ json: processedFeedback }];"
        },
        "id": "process-feedback",
        "name": "Process Feedback",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          1200
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "is-promoter",
                "leftValue": "={{ $json.npsCategory }}",
                "rightValue": "promoter",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "check-promoter",
        "name": "Is Promoter?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          750,
          1200
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "=Thank you for the amazing feedback! â­",
          "message": "=Hi {{ $json.guestName }},\n\nWow! Thank you so much for your wonderful feedback! It means the world to us. ðŸ™\n\nWe noticed you had a great experience, and we'd love to ask a small favor:\n\nâ­ **Would you mind sharing your experience on Google?**\n[Leave a Review]({{ $vars.GOOGLE_REVIEW_URL }})\n\nYour review helps other food lovers discover us and means so much to our team!\n\nðŸŽ **As a thank you:** Here's 10% off your next visit\nCode: **THANKS10**\n\nSee you soon!\n\nâ¤ï¸ {{ $vars.RESTAURANT_NAME }}",
          "options": {}
        },
        "id": "request-review",
        "name": "Request Google Review",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1000,
          1100
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.RESTAURANT_SLACK_CHANNEL }}",
          "text": "=âš ï¸ *Negative Feedback Alert*\n\n*Guest:* {{ $json.guestName }}\n*NPS Score:* {{ $json.npsScore }}/10 ({{ $json.npsCategory }})\n*Visit Date:* {{ $json.visitDate }}\n\n*Ratings:*\nðŸ½ï¸ Food: {{ $json.ratings.food }}/5\nðŸ‘¨â€ðŸ³ Service: {{ $json.ratings.service }}/5\nðŸ  Ambiance: {{ $json.ratings.ambiance }}/5\nðŸ’° Value: {{ $json.ratings.value }}/5\n\n*Comments:*\n> {{ $json.comments || 'No comments provided' }}\n\n_Please follow up with this guest within 24 hours_",
          "otherOptions": {}
        },
        "id": "alert-negative-feedback",
        "name": "Alert Negative Feedback",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1000,
          1300
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.RESTAURANT_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Guest Feedback",
            "mode": "list",
            "cachedResultName": "Guest Feedback"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Feedback ID": "={{ $json.feedbackId }}",
              "Guest Name": "={{ $json.guestName }}",
              "Visit Date": "={{ $json.visitDate }}",
              "NPS Score": "={{ $json.npsScore }}",
              "NPS Category": "={{ $json.npsCategory }}",
              "Food Rating": "={{ $json.ratings.food }}",
              "Service Rating": "={{ $json.ratings.service }}",
              "Ambiance Rating": "={{ $json.ratings.ambiance }}",
              "Value Rating": "={{ $json.ratings.value }}",
              "Overall Rating": "={{ $json.ratings.overall }}",
              "Comments": "={{ $json.comments }}",
              "Submitted At": "={{ $json.submittedAt }}"
            }
          },
          "options": {}
        },
        "id": "log-feedback",
        "name": "Log Feedback",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1250,
          1200
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "New Guest Webhook": {
        "main": [
          [
            {
              "node": "Parse Guest Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Guest Data": {
        "main": [
          [
            {
              "node": "Save to Guest CDP",
              "type": "main",
              "index": 0
            },
            {
              "node": "First Visit?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "First Visit?": {
        "main": [
          [
            {
              "node": "Send Welcome Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send Welcome SMS",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Daily 10 AM": {
        "main": [
          [
            {
              "node": "Fetch At-Risk Guests",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Upcoming Birthdays",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch VIP Guests",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch At-Risk Guests": {
        "main": [
          [
            {
              "node": "Prepare Win-Back Campaign",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Win-Back Campaign": {
        "main": [
          [
            {
              "node": "Generate Win-Back Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Win-Back Email": {
        "main": [
          [
            {
              "node": "Send Win-Back Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Upcoming Birthdays": {
        "main": [
          [
            {
              "node": "Prepare Birthday Campaign",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Birthday Campaign": {
        "main": [
          [
            {
              "node": "Send Birthday Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch VIP Guests": {
        "main": [
          [
            {
              "node": "Prepare VIP Campaign",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare VIP Campaign": {
        "main": [
          [
            {
              "node": "Send VIP Campaign",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Feedback Webhook": {
        "main": [
          [
            {
              "node": "Process Feedback",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Feedback": {
        "main": [
          [
            {
              "node": "Is Promoter?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Feedback",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Promoter?": {
        "main": [
          [
            {
              "node": "Request Google Review",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Alert Negative Feedback",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "restaurant",
        "name": "restaurant"
      },
      {
        "id": "marketing",
        "name": "marketing"
      },
      {
        "id": "loyalty",
        "name": "loyalty"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 3,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Review Management AI v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 */4 * * *"
              }
            ]
          }
        },
        "id": "scheduled-review-fetch",
        "name": "Fetch Reviews Every 4 Hours",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          400
        ]
      },
      {
        "parameters": {},
        "id": "webhook-new-review",
        "name": "New Review Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          600
        ],
        "webhookId": "review-notification"
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://mybusiness.googleapis.com/v4/accounts/{{ $env.GOOGLE_ACCOUNT_ID }}/locations/{{ $env.GOOGLE_LOCATION_ID }}/reviews",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleBusinessProfileOAuth2Api",
          "options": {}
        },
        "id": "fetch-google-reviews",
        "name": "Fetch Google Reviews",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.tripadvisor.com/api/partner/2.0/location/{{ $env.TRIPADVISOR_LOCATION_ID }}/reviews",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "key",
                "value": "={{ $env.TRIPADVISOR_API_KEY }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-tripadvisor-reviews",
        "name": "Fetch TripAdvisor Reviews",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.yelp.com/v3/businesses/{{ $env.YELP_BUSINESS_ID }}/reviews",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-yelp-reviews",
        "name": "Fetch Yelp Reviews",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          700
        ]
      },
      {
        "parameters": {
          "jsCode": "// Review Aggregator & Normalizer\n// Combines reviews from all sources into unified format\n\nconst googleReviews = $('Fetch Google Reviews').first()?.json?.reviews || [];\nconst tripadvisorReviews = $('Fetch TripAdvisor Reviews').first()?.json?.data || [];\nconst yelpReviews = $('Fetch Yelp Reviews').first()?.json?.reviews || [];\n\nconst normalizedReviews = [];\n\n// Process Google Reviews\ngoogleReviews.forEach(review => {\n  normalizedReviews.push({\n    id: review.reviewId,\n    source: 'google',\n    rating: parseInt(review.starRating?.replace('_', '')) || convertStarRating(review.starRating),\n    author: review.reviewer?.displayName || 'Anonymous',\n    text: review.comment || '',\n    date: review.createTime,\n    replied: !!review.reviewReply,\n    replyText: review.reviewReply?.comment || null,\n    profileUrl: review.reviewer?.profilePhotoUrl,\n    language: detectLanguage(review.comment)\n  });\n});\n\n// Process TripAdvisor Reviews\ntripadvisorReviews.forEach(review => {\n  normalizedReviews.push({\n    id: review.id,\n    source: 'tripadvisor',\n    rating: review.rating,\n    author: review.user?.username || 'Traveler',\n    text: review.text || '',\n    title: review.title || '',\n    date: review.published_date,\n    replied: !!review.owner_response,\n    replyText: review.owner_response?.text || null,\n    travelType: review.trip_type,\n    language: review.lang\n  });\n});\n\n// Process Yelp Reviews\nyelpReviews.forEach(review => {\n  normalizedReviews.push({\n    id: review.id,\n    source: 'yelp',\n    rating: review.rating,\n    author: review.user?.name || 'User',\n    text: review.text || '',\n    date: review.time_created,\n    replied: false, // Yelp doesn't expose reply status in API\n    profileUrl: review.user?.image_url,\n    language: detectLanguage(review.text)\n  });\n});\n\nfunction convertStarRating(starRating) {\n  const map = { 'ONE': 1, 'TWO': 2, 'THREE': 3, 'FOUR': 4, 'FIVE': 5 };\n  return map[starRating] || 3;\n}\n\nfunction detectLanguage(text) {\n  if (!text) return 'en';\n  // Simple detection - would use proper API in production\n  const turkishChars = /[ÄŸÃ¼ÅŸÄ±Ã¶Ã§ÄžÃœÅžÄ°Ã–Ã‡]/;\n  if (turkishChars.test(text)) return 'tr';\n  return 'en';\n}\n\n// Filter unreplied reviews and sort by urgency\nconst unrepliedReviews = normalizedReviews\n  .filter(r => !r.replied)\n  .sort((a, b) => {\n    // Prioritize: negative reviews first, then by date\n    if (a.rating <= 2 && b.rating > 2) return -1;\n    if (b.rating <= 2 && a.rating > 2) return 1;\n    return new Date(b.date) - new Date(a.date);\n  });\n\n// Calculate aggregate metrics\nconst metrics = {\n  totalReviews: normalizedReviews.length,\n  unrepliedCount: unrepliedReviews.length,\n  averageRating: (normalizedReviews.reduce((sum, r) => sum + r.rating, 0) / normalizedReviews.length || 0).toFixed(2),\n  bySource: {\n    google: normalizedReviews.filter(r => r.source === 'google').length,\n    tripadvisor: normalizedReviews.filter(r => r.source === 'tripadvisor').length,\n    yelp: normalizedReviews.filter(r => r.source === 'yelp').length\n  },\n  ratingDistribution: {\n    5: normalizedReviews.filter(r => r.rating === 5).length,\n    4: normalizedReviews.filter(r => r.rating === 4).length,\n    3: normalizedReviews.filter(r => r.rating === 3).length,\n    2: normalizedReviews.filter(r => r.rating === 2).length,\n    1: normalizedReviews.filter(r => r.rating === 1).length\n  },\n  negativeReviewsUnreplied: unrepliedReviews.filter(r => r.rating <= 2).length\n};\n\nreturn [{\n  json: {\n    reviews: unrepliedReviews,\n    metrics,\n    fetchedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "aggregate-reviews",
        "name": "Aggregate & Normalize Reviews",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a hospitality reputation management AI. Analyze reviews and perform sentiment analysis.\n\nFor each review, determine:\n1. Overall sentiment (positive/neutral/negative)\n2. Key topics mentioned (cleanliness, service, location, value, amenities, food)\n3. Specific praise or complaints\n4. Urgency level for response\n5. Emotional tone of the reviewer\n\nReturn JSON:\n{\n  \"sentiment\": \"positive|neutral|negative\",\n  \"sentimentScore\": -1 to 1,\n  \"topics\": [\"topic1\", \"topic2\"],\n  \"keyPraise\": [\"praise point\"],\n  \"keyComplaints\": [\"complaint point\"],\n  \"urgency\": \"immediate|high|normal|low\",\n  \"emotionalTone\": \"angry|frustrated|disappointed|neutral|pleased|delighted\",\n  \"suggestedResponseTone\": \"apologetic|empathetic|grateful|professional\",\n  \"recoveryOpportunity\": true/false,\n  \"responseDeadlineHours\": 24\n}"
              },
              {
                "role": "user",
                "content": "=Analyze this review:\n\nSource: {{ $json.source }}\nRating: {{ $json.rating }}/5\nAuthor: {{ $json.author }}\nTitle: {{ $json.title || 'N/A' }}\nText: {{ $json.text }}\nDate: {{ $json.date }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.2
          }
        },
        "id": "ai-sentiment-analysis",
        "name": "AI Sentiment Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a luxury hotel's guest relations manager. Write personalized, authentic responses to guest reviews.\n\nGuidelines:\n- Address the guest by name\n- For positive reviews: Express genuine gratitude, highlight specific things they mentioned, invite them back\n- For negative reviews: Apologize sincerely, acknowledge specific issues, explain corrective actions, offer to make it right offline\n- Never be defensive or make excuses\n- Keep responses under 150 words\n- Match the language of the original review\n- Include a personal sign-off with your role\n\nBrand voice: Warm, professional, solution-oriented, genuinely caring\n\nReturn JSON:\n{\n  \"response\": \"the complete response text\",\n  \"responseLanguage\": \"en|tr|de|fr|etc\",\n  \"followUpRequired\": true/false,\n  \"followUpAction\": \"action if needed\",\n  \"compensationSuggested\": \"none|discount|free_night|amenity_credit|etc\",\n  \"escalateToManager\": true/false\n}"
              },
              {
                "role": "user",
                "content": "=Write a response to this review:\n\nGuest: {{ $json.author }}\nSource: {{ $json.source }}\nRating: {{ $json.rating }}/5\nReview: {{ $json.text }}\n\nSentiment Analysis:\n- Sentiment: {{ $('AI Sentiment Analysis').first().json.sentiment }}\n- Key Complaints: {{ JSON.stringify($('AI Sentiment Analysis').first().json.keyComplaints) }}\n- Key Praise: {{ JSON.stringify($('AI Sentiment Analysis').first().json.keyPraise) }}\n- Suggested Tone: {{ $('AI Sentiment Analysis').first().json.suggestedResponseTone }}\n- Recovery Opportunity: {{ $('AI Sentiment Analysis').first().json.recoveryOpportunity }}\n\nHotel Name: {{ $env.HOTEL_NAME || 'Grand Hotel' }}\nResponder Name: {{ $env.GM_NAME || 'Michael' }}\nResponder Role: {{ $env.GM_ROLE || 'General Manager' }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-response-generator",
        "name": "AI Response Generator",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          1000,
          600
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "needs-approval",
                "leftValue": "={{ $('AI Sentiment Analysis').first().json.sentiment }}",
                "rightValue": "negative",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "escalate",
                "leftValue": "={{ $json.escalateToManager }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "or"
          }
        },
        "id": "approval-check",
        "name": "Needs Manager Approval?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          1250,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#review-responses",
          "text": "=ðŸ“ *Review Response Approval Required*\n\n*Platform:* {{ $json.source }}\n*Rating:* {{ 'â­'.repeat($json.rating) }} ({{ $json.rating }}/5)\n*Guest:* {{ $json.author }}\n\n*Review:*\n{{ $json.text.substring(0, 300) }}{{ $json.text.length > 300 ? '...' : '' }}\n\n*AI Sentiment:* {{ $('AI Sentiment Analysis').first().json.sentiment }} ({{ $('AI Sentiment Analysis').first().json.emotionalTone }})\n*Urgency:* {{ $('AI Sentiment Analysis').first().json.urgency }}\n\n*Proposed Response:*\n```\n{{ $('AI Response Generator').first().json.response }}\n```\n\n{{ $('AI Response Generator').first().json.compensationSuggested !== 'none' ? 'ðŸ’° *Compensation Suggested:* ' + $('AI Response Generator').first().json.compensationSuggested : '' }}\n\n*Actions:*\nâœ… React to approve and post\nâœï¸ React to edit\nâŒ React to reject",
          "otherOptions": {}
        },
        "id": "slack-approval-request",
        "name": "Slack Approval Request",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://mybusiness.googleapis.com/v4/accounts/{{ $env.GOOGLE_ACCOUNT_ID }}/locations/{{ $env.GOOGLE_LOCATION_ID }}/reviews/{{ $json.id }}/reply",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleBusinessProfileOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"comment\": \"{{ $('AI Response Generator').first().json.response }}\"\n}",
          "options": {}
        },
        "id": "post-google-reply",
        "name": "Post Google Reply",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          600
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.REVIEW_TRACKING_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Review Log",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "timestamp": "={{ new Date().toISOString() }}",
              "source": "={{ $json.source }}",
              "rating": "={{ $json.rating }}",
              "author": "={{ $json.author }}",
              "review_text": "={{ $json.text.substring(0, 500) }}",
              "sentiment": "={{ $('AI Sentiment Analysis').first().json.sentiment }}",
              "sentiment_score": "={{ $('AI Sentiment Analysis').first().json.sentimentScore }}",
              "topics": "={{ $('AI Sentiment Analysis').first().json.topics.join(', ') }}",
              "response_text": "={{ $('AI Response Generator').first().json.response.substring(0, 500) }}",
              "response_status": "={{ $json.responseStatus || 'pending' }}",
              "compensation": "={{ $('AI Response Generator').first().json.compensationSuggested }}"
            }
          }
        },
        "id": "log-review",
        "name": "Log Review & Response",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1750,
          500
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-negative",
                "leftValue": "={{ $json.metrics.negativeReviewsUnreplied }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ]
          }
        },
        "id": "check-negative-alert",
        "name": "Has Negative Reviews?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          750,
          700
        ]
      },
      {
        "parameters": {
          "channel": "#guest-alerts",
          "text": "=ðŸš¨ *Negative Review Alert*\n\n*{{ $json.metrics.negativeReviewsUnreplied }} negative review(s) need immediate attention!*\n\n*Overall Metrics:*\nâ€¢ Average Rating: {{ $json.metrics.averageRating }}/5\nâ€¢ Total Reviews: {{ $json.metrics.totalReviews }}\nâ€¢ Unreplied: {{ $json.metrics.unrepliedCount }}\n\n*Rating Distribution:*\nâ­â­â­â­â­ {{ $json.metrics.ratingDistribution[5] }}\nâ­â­â­â­ {{ $json.metrics.ratingDistribution[4] }}\nâ­â­â­ {{ $json.metrics.ratingDistribution[3] }}\nâ­â­ {{ $json.metrics.ratingDistribution[2] }}\nâ­ {{ $json.metrics.ratingDistribution[1] }}\n\n_Respond to negative reviews within 24 hours to maximize recovery opportunity._",
          "otherOptions": {}
        },
        "id": "slack-negative-alert",
        "name": "Slack Negative Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1000,
          800
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 * * 1"
              }
            ]
          }
        },
        "id": "weekly-report-trigger",
        "name": "Weekly Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          900
        ]
      },
      {
        "parameters": {
          "jsCode": "// Weekly Review Performance Report\n// Aggregates weekly metrics and trends\n\nconst allReviews = $('Aggregate & Normalize Reviews').first()?.json || { reviews: [], metrics: {} };\n\n// Calculate weekly trends (would use historical data in production)\nconst weeklyReport = {\n  period: {\n    start: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n    end: new Date().toISOString().split('T')[0]\n  },\n  metrics: allReviews.metrics,\n  trends: {\n    ratingChange: '+0.2', // Would calculate from historical\n    reviewVolumeChange: '+15%',\n    responseRateChange: '+5%'\n  },\n  topPraises: [],\n  topComplaints: [],\n  responseRate: allReviews.metrics.totalReviews > 0 \n    ? ((allReviews.metrics.totalReviews - allReviews.metrics.unrepliedCount) / allReviews.metrics.totalReviews * 100).toFixed(1)\n    : 100,\n  revenueImpact: {\n    estimatedFromRating: `${(parseFloat(allReviews.metrics.averageRating) * 2 - 1).toFixed(1)}%`,\n    note: '1-star improvement = 5-9% revenue increase'\n  },\n  generatedAt: new Date().toISOString()\n};\n\nreturn [{ json: weeklyReport }];"
        },
        "id": "generate-weekly-report",
        "name": "Generate Weekly Report",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          900
        ]
      },
      {
        "parameters": {
          "channel": "#reviews-weekly",
          "text": "=ðŸ“Š *Weekly Review Performance Report*\n_{{ $json.period.start }} to {{ $json.period.end }}_\n\n*Key Metrics:*\nâ€¢ Average Rating: {{ $json.metrics.averageRating }}/5 ({{ $json.trends.ratingChange }})\nâ€¢ Total Reviews: {{ $json.metrics.totalReviews }} ({{ $json.trends.reviewVolumeChange }})\nâ€¢ Response Rate: {{ $json.responseRate }}% ({{ $json.trends.responseRateChange }})\n\n*By Platform:*\nâ€¢ Google: {{ $json.metrics.bySource.google }} reviews\nâ€¢ TripAdvisor: {{ $json.metrics.bySource.tripadvisor }} reviews\nâ€¢ Yelp: {{ $json.metrics.bySource.yelp }} reviews\n\n*Rating Distribution:*\nâ­â­â­â­â­ {{ $json.metrics.ratingDistribution[5] }} ({{ ($json.metrics.ratingDistribution[5] / $json.metrics.totalReviews * 100).toFixed(0) }}%)\nâ­â­â­â­ {{ $json.metrics.ratingDistribution[4] }}\nâ­â­â­ {{ $json.metrics.ratingDistribution[3] }}\nâ­â­ {{ $json.metrics.ratingDistribution[2] }}\nâ­ {{ $json.metrics.ratingDistribution[1] }}\n\n*Estimated Revenue Impact:*\n{{ $json.revenueImpact.note }}\nCurrent rating impact: ~{{ $json.revenueImpact.estimatedFromRating }} revenue correlation",
          "otherOptions": {}
        },
        "id": "slack-weekly-report",
        "name": "Slack Weekly Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          700,
          900
        ]
      }
    ],
    "connections": {
      "Fetch Reviews Every 4 Hours": {
        "main": [
          [
            {
              "node": "Fetch Google Reviews",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch TripAdvisor Reviews",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Yelp Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "New Review Webhook": {
        "main": [
          [
            {
              "node": "Aggregate & Normalize Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Google Reviews": {
        "main": [
          [
            {
              "node": "Aggregate & Normalize Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch TripAdvisor Reviews": {
        "main": [
          [
            {
              "node": "Aggregate & Normalize Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Yelp Reviews": {
        "main": [
          [
            {
              "node": "Aggregate & Normalize Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate & Normalize Reviews": {
        "main": [
          [
            {
              "node": "AI Sentiment Analysis",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has Negative Reviews?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Sentiment Analysis": {
        "main": [
          [
            {
              "node": "AI Response Generator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Response Generator": {
        "main": [
          [
            {
              "node": "Needs Manager Approval?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Needs Manager Approval?": {
        "main": [
          [
            {
              "node": "Slack Approval Request",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Post Google Reply",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Post Google Reply": {
        "main": [
          [
            {
              "node": "Log Review & Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Slack Approval Request": {
        "main": [
          [
            {
              "node": "Log Review & Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Negative Reviews?": {
        "main": [
          [
            {
              "node": "Slack Negative Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Weekly Report": {
        "main": [
          [
            {
              "node": "Generate Weekly Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Weekly Report": {
        "main": [
          [
            {
              "node": "Slack Weekly Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-hospitality-review-management"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 3,
    "tags": [
      {
        "name": "Hospitality",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Reviews",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Reputation",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "AI",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain RevOps Hub v1",
    "nodes": [
      {
        "parameters": {},
        "id": "trigger-webhook",
        "name": "RevOps Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          300
        ],
        "webhookId": "revops-trigger"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 * * 1-5"
              }
            ]
          }
        },
        "id": "schedule-daily",
        "name": "Daily Pipeline Sync",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          500
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.apollo.io/v1/opportunities",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "apolloApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "stage",
                "value": "={{ $json.stage || 'all' }}"
              },
              {
                "name": "per_page",
                "value": "100"
              }
            ]
          },
          "options": {}
        },
        "id": "apollo-pipeline",
        "name": "Apollo Pipeline Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.hubspot.com/crm/v3/objects/deals",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "hubSpotApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "limit",
                "value": "100"
              },
              {
                "name": "properties",
                "value": "dealname,amount,dealstage,closedate,pipeline,hubspot_owner_id"
              }
            ]
          },
          "options": {}
        },
        "id": "hubspot-deals",
        "name": "HubSpot Deals",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.salesforce.com/services/data/v58.0/query",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "salesforceOAuth2Api",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "q",
                "value": "SELECT Id, Name, Amount, StageName, CloseDate, Probability, OwnerId FROM Opportunity WHERE IsClosed = false"
              }
            ]
          },
          "options": {}
        },
        "id": "salesforce-opps",
        "name": "Salesforce Opportunities",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          700
        ]
      },
      {
        "parameters": {
          "jsCode": "// Revenue Operations Data Aggregator\n// Combines data from Apollo, HubSpot, and Salesforce\n\nconst apolloData = $('Apollo Pipeline Data').all();\nconst hubspotData = $('HubSpot Deals').all();\nconst salesforceData = $('Salesforce Opportunities').all();\n\n// Normalize and merge pipeline data\nconst unifiedPipeline = [];\n\n// Process Apollo opportunities\napolloData.forEach(item => {\n  if (item.json.opportunities) {\n    item.json.opportunities.forEach(opp => {\n      unifiedPipeline.push({\n        source: 'apollo',\n        id: opp.id,\n        name: opp.name || opp.organization_name,\n        amount: parseFloat(opp.value) || 0,\n        stage: opp.stage_name || 'Unknown',\n        probability: opp.probability || 50,\n        closeDate: opp.expected_close_date,\n        owner: opp.owner_id,\n        createdAt: opp.created_at,\n        lastActivity: opp.last_activity_at\n      });\n    });\n  }\n});\n\n// Process HubSpot deals\nhubspotData.forEach(item => {\n  if (item.json.results) {\n    item.json.results.forEach(deal => {\n      unifiedPipeline.push({\n        source: 'hubspot',\n        id: deal.id,\n        name: deal.properties.dealname,\n        amount: parseFloat(deal.properties.amount) || 0,\n        stage: deal.properties.dealstage,\n        probability: getStageProbability(deal.properties.dealstage),\n        closeDate: deal.properties.closedate,\n        owner: deal.properties.hubspot_owner_id,\n        createdAt: deal.createdAt,\n        lastActivity: deal.updatedAt\n      });\n    });\n  }\n});\n\n// Process Salesforce opportunities\nsalesforceData.forEach(item => {\n  if (item.json.records) {\n    item.json.records.forEach(opp => {\n      unifiedPipeline.push({\n        source: 'salesforce',\n        id: opp.Id,\n        name: opp.Name,\n        amount: parseFloat(opp.Amount) || 0,\n        stage: opp.StageName,\n        probability: opp.Probability || 50,\n        closeDate: opp.CloseDate,\n        owner: opp.OwnerId,\n        createdAt: opp.CreatedDate,\n        lastActivity: opp.LastModifiedDate\n      });\n    });\n  }\n});\n\nfunction getStageProbability(stage) {\n  const probabilities = {\n    'appointmentscheduled': 20,\n    'qualifiedtobuy': 40,\n    'presentationscheduled': 60,\n    'decisionmakerboughtin': 80,\n    'contractsent': 90,\n    'closedwon': 100,\n    'closedlost': 0\n  };\n  return probabilities[stage?.toLowerCase()] || 50;\n}\n\n// Calculate pipeline metrics\nconst totalPipeline = unifiedPipeline.reduce((sum, opp) => sum + opp.amount, 0);\nconst weightedPipeline = unifiedPipeline.reduce((sum, opp) => sum + (opp.amount * opp.probability / 100), 0);\nconst avgDealSize = unifiedPipeline.length > 0 ? totalPipeline / unifiedPipeline.length : 0;\n\n// Stage distribution\nconst stageDistribution = {};\nunifiedPipeline.forEach(opp => {\n  if (!stageDistribution[opp.stage]) {\n    stageDistribution[opp.stage] = { count: 0, value: 0 };\n  }\n  stageDistribution[opp.stage].count++;\n  stageDistribution[opp.stage].value += opp.amount;\n});\n\nreturn [{\n  json: {\n    summary: {\n      totalOpportunities: unifiedPipeline.length,\n      totalPipelineValue: totalPipeline,\n      weightedPipelineValue: weightedPipeline,\n      averageDealSize: avgDealSize,\n      forecastAccuracy: (weightedPipeline / totalPipeline * 100).toFixed(2) + '%'\n    },\n    stageDistribution,\n    opportunities: unifiedPipeline,\n    timestamp: new Date().toISOString()\n  }\n}];"
        },
        "id": "aggregate-pipeline",
        "name": "Aggregate Pipeline Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          700,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Revenue Operations AI analyst. Analyze pipeline data and provide actionable insights for improving win rates, identifying at-risk deals, and optimizing the sales process.\n\nProvide your analysis in this JSON format:\n{\n  \"pipelineHealth\": \"healthy|warning|critical\",\n  \"keyInsights\": [\"insight1\", \"insight2\", \"insight3\"],\n  \"atRiskDeals\": [{\"name\": \"deal\", \"reason\": \"why at risk\", \"recommendation\": \"action\"}],\n  \"winRatePrediction\": \"percentage\",\n  \"recommendedActions\": [\"action1\", \"action2\"],\n  \"forecastAdjustment\": \"percentage adjustment needed\"\n}"
              },
              {
                "role": "user",
                "content": "=Analyze this pipeline data and provide strategic insights:\n\nTotal Pipeline: ${{ $json.summary.totalPipelineValue.toLocaleString() }}\nWeighted Pipeline: ${{ $json.summary.weightedPipelineValue.toLocaleString() }}\nTotal Opportunities: {{ $json.summary.totalOpportunities }}\nAverage Deal Size: ${{ $json.summary.averageDealSize.toLocaleString() }}\n\nStage Distribution:\n{{ JSON.stringify($json.stageDistribution, null, 2) }}\n\nRecent Opportunities:\n{{ JSON.stringify($json.opportunities.slice(0, 20), null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.3
          }
        },
        "id": "ai-pipeline-analysis",
        "name": "AI Pipeline Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          950,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an AI Lead Scoring & Routing specialist. Based on lead data, assign a score (0-100) and determine the optimal sales rep/team for routing.\n\nConsider factors:\n- Company size and revenue potential\n- Engagement level (website visits, email opens, content downloads)\n- Industry fit with ICP (Ideal Customer Profile)\n- Budget indicators\n- Decision timeline\n- Previous interactions\n\nReturn JSON:\n{\n  \"leadScore\": 0-100,\n  \"scoreBreakdown\": {\"firmographic\": 25, \"behavioral\": 25, \"engagement\": 25, \"intent\": 25},\n  \"priority\": \"hot|warm|cold\",\n  \"recommendedOwner\": \"rep name or team\",\n  \"routingReason\": \"explanation\",\n  \"nextBestAction\": \"recommended action\",\n  \"estimatedDealSize\": \"$amount\",\n  \"conversionProbability\": \"percentage\"\n}"
              },
              {
                "role": "user",
                "content": "=Score and route this lead:\n\n{{ JSON.stringify($json, null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.2
          }
        },
        "id": "ai-lead-scoring",
        "name": "AI Lead Scoring",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          950,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "// Revenue Forecasting Engine\n// Uses historical data and AI insights to generate forecasts\n\nconst pipelineData = $('Aggregate Pipeline Data').first().json;\nconst aiAnalysis = $('AI Pipeline Analysis').first().json;\n\n// Historical conversion rates (would come from actual historical data)\nconst historicalRates = {\n  'Prospecting': 0.15,\n  'Qualification': 0.25,\n  'Proposal': 0.45,\n  'Negotiation': 0.70,\n  'Closed Won': 1.0\n};\n\n// Calculate monthly forecast\nconst opportunities = pipelineData.opportunities || [];\nconst monthlyForecast = {};\n\nopportunities.forEach(opp => {\n  if (opp.closeDate) {\n    const month = opp.closeDate.substring(0, 7); // YYYY-MM\n    if (!monthlyForecast[month]) {\n      monthlyForecast[month] = {\n        committed: 0,\n        bestCase: 0,\n        pipeline: 0,\n        count: 0\n      };\n    }\n    \n    const prob = opp.probability / 100;\n    monthlyForecast[month].pipeline += opp.amount;\n    monthlyForecast[month].count++;\n    \n    if (prob >= 0.9) {\n      monthlyForecast[month].committed += opp.amount;\n    } else if (prob >= 0.5) {\n      monthlyForecast[month].bestCase += opp.amount * prob;\n    }\n  }\n});\n\n// Calculate velocity metrics\nconst avgCycleLength = 45; // days - would be calculated from historical\nconst currentVelocity = pipelineData.summary.totalPipelineValue / avgCycleLength;\nconst requiredVelocity = 1000000 / 30; // $1M/month target\n\nreturn [{\n  json: {\n    forecast: {\n      monthly: monthlyForecast,\n      quarterly: {\n        committed: Object.values(monthlyForecast).reduce((sum, m) => sum + m.committed, 0),\n        bestCase: Object.values(monthlyForecast).reduce((sum, m) => sum + m.bestCase, 0),\n        pipeline: Object.values(monthlyForecast).reduce((sum, m) => sum + m.pipeline, 0)\n      }\n    },\n    velocity: {\n      current: currentVelocity,\n      required: requiredVelocity,\n      gap: requiredVelocity - currentVelocity,\n      status: currentVelocity >= requiredVelocity ? 'on-track' : 'behind'\n    },\n    aiInsights: aiAnalysis,\n    pipelineSummary: pipelineData.summary,\n    generatedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "forecast-engine",
        "name": "Revenue Forecast Engine",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1200,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.hubspot.com/crm/v3/objects/deals/{{ $json.dealId }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "hubSpotApi",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"properties\": {\n    \"lead_score\": \"{{ $('AI Lead Scoring').first().json.leadScore }}\",\n    \"lead_priority\": \"{{ $('AI Lead Scoring').first().json.priority }}\",\n    \"ai_next_action\": \"{{ $('AI Lead Scoring').first().json.nextBestAction }}\",\n    \"hubspot_owner_id\": \"{{ $('AI Lead Scoring').first().json.recommendedOwner }}\"\n  }\n}",
          "options": {}
        },
        "id": "update-crm-scores",
        "name": "Update CRM with Scores",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1200,
          700
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "at-risk-check",
                "leftValue": "={{ $json.aiInsights.pipelineHealth }}",
                "rightValue": "critical",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "id": "check-at-risk",
        "name": "At-Risk Check",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          1450,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#revenue-ops-alerts",
          "text": "=ðŸš¨ *CRITICAL: Pipeline Health Alert*\n\n*Pipeline Status:* {{ $json.aiInsights.pipelineHealth }}\n*Win Rate Prediction:* {{ $json.aiInsights.winRatePrediction }}\n\n*Key Issues:*\n{{ $json.aiInsights.keyInsights.map(i => 'â€¢ ' + i).join('\\n') }}\n\n*At-Risk Deals:*\n{{ $json.aiInsights.atRiskDeals.map(d => 'â€¢ ' + d.name + ': ' + d.reason).join('\\n') }}\n\n*Recommended Actions:*\n{{ $json.aiInsights.recommendedActions.map((a, i) => (i+1) + '. ' + a).join('\\n') }}\n\n*Velocity Status:* {{ $json.velocity.status }}\n*Current Velocity:* ${{ Math.round($json.velocity.current).toLocaleString() }}/day\n*Required:* ${{ Math.round($json.velocity.required).toLocaleString() }}/day",
          "otherOptions": {}
        },
        "id": "slack-critical-alert",
        "name": "Slack Critical Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1700,
          300
        ]
      },
      {
        "parameters": {
          "channel": "#revenue-ops",
          "text": "=ðŸ“Š *Daily RevOps Pipeline Summary*\n\n*Total Pipeline:* ${{ $json.pipelineSummary.totalPipelineValue.toLocaleString() }}\n*Weighted Pipeline:* ${{ $json.pipelineSummary.weightedPipelineValue.toLocaleString() }}\n*Opportunities:* {{ $json.pipelineSummary.totalOpportunities }}\n*Avg Deal Size:* ${{ Math.round($json.pipelineSummary.averageDealSize).toLocaleString() }}\n\n*Pipeline Health:* {{ $json.aiInsights.pipelineHealth }}\n*Win Rate Prediction:* {{ $json.aiInsights.winRatePrediction }}\n\n*Quarterly Forecast:*\nâ€¢ Committed: ${{ $json.forecast.quarterly.committed.toLocaleString() }}\nâ€¢ Best Case: ${{ $json.forecast.quarterly.bestCase.toLocaleString() }}\nâ€¢ Pipeline: ${{ $json.forecast.quarterly.pipeline.toLocaleString() }}\n\n*Today's Focus:*\n{{ $json.aiInsights.recommendedActions.slice(0, 3).map((a, i) => (i+1) + '. ' + a).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "slack-daily-summary",
        "name": "Slack Daily Summary",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1700,
          500
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.REVOPS_SPREADSHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Pipeline History",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {
              "date": "={{ $json.generatedAt }}",
              "totalPipeline": "={{ $json.pipelineSummary.totalPipelineValue }}",
              "weightedPipeline": "={{ $json.pipelineSummary.weightedPipelineValue }}",
              "opportunities": "={{ $json.pipelineSummary.totalOpportunities }}",
              "avgDealSize": "={{ $json.pipelineSummary.averageDealSize }}",
              "pipelineHealth": "={{ $json.aiInsights.pipelineHealth }}",
              "winRatePrediction": "={{ $json.aiInsights.winRatePrediction }}",
              "committed": "={{ $json.forecast.quarterly.committed }}",
              "bestCase": "={{ $json.forecast.quarterly.bestCase }}"
            }
          },
          "options": {}
        },
        "id": "log-to-sheets",
        "name": "Log to Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1700,
          700
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.clari.com/v4/forecast/submit",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"forecast_period\": \"{{ new Date().toISOString().substring(0, 7) }}\",\n  \"forecast_data\": {\n    \"committed\": {{ $json.forecast.quarterly.committed }},\n    \"best_case\": {{ $json.forecast.quarterly.bestCase }},\n    \"pipeline\": {{ $json.forecast.quarterly.pipeline }},\n    \"ai_predicted_close\": {{ $json.pipelineSummary.weightedPipelineValue }}\n  },\n  \"confidence_score\": {{ parseFloat($json.aiInsights.winRatePrediction) || 75 }},\n  \"metadata\": {\n    \"source\": \"n8n_revops_hub\",\n    \"pipeline_health\": \"{{ $json.aiInsights.pipelineHealth }}\",\n    \"generated_at\": \"{{ $json.generatedAt }}\"\n  }\n}",
          "options": {}
        },
        "id": "sync-to-clari",
        "name": "Sync to Clari",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1950,
          500
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"status\": \"success\",\n  \"pipeline\": {\n    \"total\": {{ $json.pipelineSummary.totalPipelineValue }},\n    \"weighted\": {{ $json.pipelineSummary.weightedPipelineValue }},\n    \"opportunities\": {{ $json.pipelineSummary.totalOpportunities }}\n  },\n  \"forecast\": {{ JSON.stringify($json.forecast) }},\n  \"health\": \"{{ $json.aiInsights.pipelineHealth }}\",\n  \"insights\": {{ JSON.stringify($json.aiInsights.keyInsights) }},\n  \"timestamp\": \"{{ $json.generatedAt }}\"\n}"
        },
        "id": "webhook-response",
        "name": "Webhook Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1950,
          300
        ]
      }
    ],
    "connections": {
      "RevOps Trigger": {
        "main": [
          [
            {
              "node": "Apollo Pipeline Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "HubSpot Deals",
              "type": "main",
              "index": 0
            },
            {
              "node": "Salesforce Opportunities",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Pipeline Sync": {
        "main": [
          [
            {
              "node": "Apollo Pipeline Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "HubSpot Deals",
              "type": "main",
              "index": 0
            },
            {
              "node": "Salesforce Opportunities",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Apollo Pipeline Data": {
        "main": [
          [
            {
              "node": "Aggregate Pipeline Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HubSpot Deals": {
        "main": [
          [
            {
              "node": "Aggregate Pipeline Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Salesforce Opportunities": {
        "main": [
          [
            {
              "node": "Aggregate Pipeline Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Pipeline Data": {
        "main": [
          [
            {
              "node": "AI Pipeline Analysis",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Lead Scoring",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Pipeline Analysis": {
        "main": [
          [
            {
              "node": "Revenue Forecast Engine",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Lead Scoring": {
        "main": [
          [
            {
              "node": "Update CRM with Scores",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Revenue Forecast Engine": {
        "main": [
          [
            {
              "node": "Check-At-Risk",
              "type": "main",
              "index": 0
            },
            {
              "node": "Slack Daily Summary",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log to Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "At-Risk Check": {
        "main": [
          [
            {
              "node": "Slack Critical Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Slack Daily Summary": {
        "main": [
          [
            {
              "node": "Sync to Clari",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-saas-revops"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 2,
    "tags": [
      {
        "name": "RevOps",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Revenue",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "AI",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Pipeline",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain SEO Content Pipeline v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 7 * * 1"
              }
            ]
          }
        },
        "id": "weekly-trigger",
        "name": "Weekly Monday",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "seo-content-request",
          "options": {}
        },
        "id": "content-webhook",
        "name": "Content Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          500
        ],
        "webhookId": "seo-content-request"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.semrush.com/analytics/v1/",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpQueryAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "type",
                "value": "phrase_questions"
              },
              {
                "name": "phrase",
                "value": "={{ $vars.TARGET_KEYWORDS }}"
              },
              {
                "name": "database",
                "value": "us"
              },
              {
                "name": "export_columns",
                "value": "Ph,Nq,Cp,Co,Nr"
              },
              {
                "name": "display_limit",
                "value": "50"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-keyword-questions",
        "name": "Fetch Keyword Questions",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          200
        ],
        "credentials": {
          "httpQueryAuth": {
            "id": "semrush-api",
            "name": "SEMrush API"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.semrush.com/analytics/v1/",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpQueryAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "type",
                "value": "phrase_related"
              },
              {
                "name": "phrase",
                "value": "={{ $vars.TARGET_KEYWORDS }}"
              },
              {
                "name": "database",
                "value": "us"
              },
              {
                "name": "export_columns",
                "value": "Ph,Nq,Cp,Co,Nr,Kd"
              },
              {
                "name": "display_limit",
                "value": "100"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-related-keywords",
        "name": "Fetch Related Keywords",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ],
        "credentials": {
          "httpQueryAuth": {
            "id": "semrush-api",
            "name": "SEMrush API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.ahrefs.com/v3/keywords-explorer/keywords",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "target",
                "value": "={{ $vars.TARGET_KEYWORDS }}"
              },
              {
                "name": "country",
                "value": "us"
              },
              {
                "name": "select",
                "value": "keyword,volume,keyword_difficulty,cpc,parent_keyword"
              },
              {
                "name": "limit",
                "value": "100"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-ahrefs-data",
        "name": "Fetch Ahrefs Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "ahrefs-api",
            "name": "Ahrefs API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Aggregate and analyze keyword data\nconst questions = $('Fetch Keyword Questions').first().json;\nconst related = $('Fetch Related Keywords').first().json;\nconst ahrefs = $('Fetch Ahrefs Data').first().json;\n\n// Parse SEMrush data (CSV format)\nfunction parseSEMrushCSV(data) {\n  if (!data || typeof data !== 'string') return [];\n  const lines = data.split('\\n');\n  const headers = lines[0]?.split(';') || [];\n  return lines.slice(1).filter(l => l.trim()).map(line => {\n    const values = line.split(';');\n    const obj = {};\n    headers.forEach((h, i) => obj[h] = values[i]);\n    return obj;\n  });\n}\n\nconst questionKeywords = parseSEMrushCSV(questions);\nconst relatedKeywords = parseSEMrushCSV(related);\nconst ahrefsKeywords = ahrefs.keywords || [];\n\n// Combine and deduplicate keywords\nconst keywordMap = new Map();\n\nrelatedKeywords.forEach(kw => {\n  const keyword = kw.Ph?.toLowerCase();\n  if (keyword) {\n    keywordMap.set(keyword, {\n      keyword,\n      volume: parseInt(kw.Nq) || 0,\n      difficulty: parseInt(kw.Kd) || 0,\n      cpc: parseFloat(kw.Cp) || 0,\n      competition: parseFloat(kw.Co) || 0,\n      results: parseInt(kw.Nr) || 0,\n      type: 'related',\n      source: 'semrush'\n    });\n  }\n});\n\nquestionKeywords.forEach(kw => {\n  const keyword = kw.Ph?.toLowerCase();\n  if (keyword && !keywordMap.has(keyword)) {\n    keywordMap.set(keyword, {\n      keyword,\n      volume: parseInt(kw.Nq) || 0,\n      difficulty: 0,\n      cpc: parseFloat(kw.Cp) || 0,\n      competition: parseFloat(kw.Co) || 0,\n      results: parseInt(kw.Nr) || 0,\n      type: 'question',\n      source: 'semrush'\n    });\n  }\n});\n\nahrefsKeywords.forEach(kw => {\n  const keyword = kw.keyword?.toLowerCase();\n  if (keyword) {\n    const existing = keywordMap.get(keyword);\n    if (existing) {\n      // Merge data\n      existing.ahrefsVolume = kw.volume;\n      existing.ahrefsDifficulty = kw.keyword_difficulty;\n    } else {\n      keywordMap.set(keyword, {\n        keyword,\n        volume: kw.volume || 0,\n        difficulty: kw.keyword_difficulty || 0,\n        cpc: kw.cpc || 0,\n        type: 'related',\n        source: 'ahrefs'\n      });\n    }\n  }\n});\n\n// Score and rank keywords\nconst keywords = Array.from(keywordMap.values()).map(kw => {\n  // Calculate opportunity score\n  let score = 0;\n  \n  // Volume scoring (max 30)\n  if (kw.volume > 10000) score += 30;\n  else if (kw.volume > 5000) score += 25;\n  else if (kw.volume > 1000) score += 20;\n  else if (kw.volume > 500) score += 15;\n  else if (kw.volume > 100) score += 10;\n  else score += 5;\n  \n  // Difficulty scoring (max 30, lower is better)\n  if (kw.difficulty < 20) score += 30;\n  else if (kw.difficulty < 40) score += 25;\n  else if (kw.difficulty < 60) score += 15;\n  else if (kw.difficulty < 80) score += 5;\n  \n  // CPC scoring (indicates commercial intent, max 20)\n  if (kw.cpc > 10) score += 20;\n  else if (kw.cpc > 5) score += 15;\n  else if (kw.cpc > 2) score += 10;\n  else if (kw.cpc > 0.5) score += 5;\n  \n  // Question bonus (max 20)\n  if (kw.type === 'question') score += 20;\n  \n  kw.opportunityScore = score;\n  kw.priority = score > 70 ? 'high' : score > 50 ? 'medium' : 'low';\n  \n  return kw;\n});\n\n// Sort by opportunity score\nkeywords.sort((a, b) => b.opportunityScore - a.opportunityScore);\n\n// Group into content clusters\nconst clusters = [];\nconst usedKeywords = new Set();\n\nkeywords.slice(0, 50).forEach(kw => {\n  if (usedKeywords.has(kw.keyword)) return;\n  \n  // Find related keywords for this cluster\n  const clusterKeywords = keywords.filter(k => \n    !usedKeywords.has(k.keyword) &&\n    (k.keyword.includes(kw.keyword) || kw.keyword.includes(k.keyword) ||\n     k.keyword.split(' ').some(word => kw.keyword.includes(word)))\n  ).slice(0, 10);\n  \n  if (clusterKeywords.length >= 3) {\n    clusterKeywords.forEach(k => usedKeywords.add(k.keyword));\n    clusters.push({\n      primaryKeyword: kw.keyword,\n      volume: kw.volume,\n      difficulty: kw.difficulty,\n      opportunityScore: kw.opportunityScore,\n      supportingKeywords: clusterKeywords.filter(k => k.keyword !== kw.keyword),\n      contentSuggestion: kw.type === 'question' ? 'FAQ/How-to' : 'Pillar Content'\n    });\n  }\n});\n\nreturn [{\n  json: {\n    keywords: keywords.slice(0, 100),\n    clusters: clusters.slice(0, 10),\n    summary: {\n      totalKeywords: keywords.length,\n      highPriority: keywords.filter(k => k.priority === 'high').length,\n      mediumPriority: keywords.filter(k => k.priority === 'medium').length,\n      questionKeywords: keywords.filter(k => k.type === 'question').length,\n      clustersIdentified: clusters.length,\n      avgVolume: Math.round(keywords.reduce((a, b) => a + b.volume, 0) / keywords.length),\n      avgDifficulty: Math.round(keywords.reduce((a, b) => a + b.difficulty, 0) / keywords.length)\n    },\n    analyzedAt: new Date().toISOString()\n  }\n}];"
        },
        "id": "analyze-keywords",
        "name": "Analyze Keywords",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          800,
          400
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are an SEO Content Strategist AI. Analyze keyword clusters and generate comprehensive content briefs.\n\nFor each content cluster, create:\n1. Content title suggestions (3 options)\n2. Target word count\n3. Content type recommendation (blog post, guide, landing page, etc.)\n4. Primary heading structure (H1, H2, H3)\n5. Key sections to include\n6. Internal linking opportunities\n7. Featured snippet optimization (if applicable)\n8. Meta description suggestion\n\nConsider search intent, competitor content gaps, and user needs.",
                "role": "system"
              },
              {
                "content": "=Create content briefs for these keyword clusters:\n\n**Top Clusters:**\n{{ JSON.stringify($json.clusters.slice(0, 5), null, 2) }}\n\n**Keyword Summary:**\n{{ JSON.stringify($json.summary, null, 2) }}\n\nGenerate detailed, actionable content briefs for each cluster.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.5,
            "maxTokens": 4000
          }
        },
        "id": "generate-briefs",
        "name": "Generate Content Briefs",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1050,
          300
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.CMS_API_URL }}/posts",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "status",
                "value": "published"
              },
              {
                "name": "fields",
                "value": "id,title,slug,primary_keyword,meta_description,word_count"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-existing-content",
        "name": "Fetch Existing Content",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1050,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "cms-api-key",
            "name": "CMS API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Identify content gaps and optimization opportunities\nconst keywords = $('Analyze Keywords').first().json.keywords;\nconst existingContent = $input.first().json.posts || [];\n\n// Create map of existing content by keyword\nconst existingKeywords = new Set(\n  existingContent.map(c => c.primary_keyword?.toLowerCase()).filter(Boolean)\n);\n\nconst contentGaps = [];\nconst optimizationOpportunities = [];\n\nkeywords.forEach(kw => {\n  if (!existingKeywords.has(kw.keyword)) {\n    if (kw.opportunityScore >= 50) {\n      contentGaps.push({\n        keyword: kw.keyword,\n        volume: kw.volume,\n        difficulty: kw.difficulty,\n        opportunityScore: kw.opportunityScore,\n        priority: kw.priority,\n        type: 'new_content'\n      });\n    }\n  } else {\n    // Find the existing content\n    const existing = existingContent.find(\n      c => c.primary_keyword?.toLowerCase() === kw.keyword\n    );\n    if (existing) {\n      // Check if optimization is needed\n      const needsUpdate = (\n        existing.word_count < 1500 ||\n        !existing.meta_description\n      );\n      if (needsUpdate && kw.opportunityScore >= 40) {\n        optimizationOpportunities.push({\n          keyword: kw.keyword,\n          existingContent: existing,\n          volume: kw.volume,\n          recommendations: [\n            existing.word_count < 1500 ? 'Expand content length' : null,\n            !existing.meta_description ? 'Add meta description' : null\n          ].filter(Boolean),\n          type: 'optimization'\n        });\n      }\n    }\n  }\n});\n\nreturn [{\n  json: {\n    contentGaps: contentGaps.slice(0, 20),\n    optimizationOpportunities: optimizationOpportunities.slice(0, 10),\n    summary: {\n      newContentNeeded: contentGaps.length,\n      optimizationsNeeded: optimizationOpportunities.length,\n      existingContentCount: existingContent.length\n    }\n  }\n}];"
        },
        "id": "identify-gaps",
        "name": "Identify Content Gaps",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1300,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "// Create content calendar from briefs\nconst briefs = $('Generate Content Briefs').first().json;\nconst gaps = $('Identify Content Gaps').first().json;\n\nconst calendarItems = [];\nconst today = new Date();\n\n// Add high-priority gaps to calendar\nconst priorityBriefs = briefs.briefs || briefs;\n\n(Array.isArray(priorityBriefs) ? priorityBriefs : []).forEach((brief, index) => {\n  const publishDate = new Date(today);\n  publishDate.setDate(today.getDate() + (index * 7) + 7);\n  \n  calendarItems.push({\n    id: `CAL-${Date.now().toString(36)}-${index}`,\n    title: Array.isArray(brief.titleSuggestions) ? brief.titleSuggestions[0] : brief.title || brief.primaryKeyword,\n    primaryKeyword: brief.primaryKeyword,\n    type: brief.contentType || 'blog_post',\n    wordCount: brief.targetWordCount || brief.wordCount || 1500,\n    scheduledDate: publishDate.toISOString().split('T')[0],\n    status: 'planned',\n    priority: index < 3 ? 'high' : 'medium',\n    brief: brief\n  });\n});\n\nreturn [{ json: { calendar: calendarItems, totalItems: calendarItems.length } }];"
        },
        "id": "create-calendar",
        "name": "Create Content Calendar",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1300,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.PROJECT_MGMT_URL }}/content-calendar",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-calendar",
        "name": "Save Calendar",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1550,
          300
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "project-mgmt-api",
            "name": "Project Management API"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.CONTENT_SLACK_CHANNEL }}",
          "text": "=ðŸ“Š *Weekly SEO Content Pipeline Report*\n\nðŸ” *Keyword Analysis:*\nâ€¢ Total Keywords Analyzed: {{ $('Analyze Keywords').first().json.summary.totalKeywords }}\nâ€¢ High Priority: {{ $('Analyze Keywords').first().json.summary.highPriority }}\nâ€¢ Question Keywords: {{ $('Analyze Keywords').first().json.summary.questionKeywords }}\nâ€¢ Content Clusters: {{ $('Analyze Keywords').first().json.summary.clustersIdentified }}\n\nðŸ“ *Content Opportunities:*\nâ€¢ New Content Needed: {{ $('Identify Content Gaps').first().json.summary.newContentNeeded }}\nâ€¢ Optimizations Needed: {{ $('Identify Content Gaps').first().json.summary.optimizationsNeeded }}\n\nðŸ“… *Calendar Updated:*\nâ€¢ Items Added: {{ $json.totalItems }}\n\n*Top Keywords to Target:*\n{{ $('Analyze Keywords').first().json.keywords.slice(0, 5).map(k => `â€¢ ${k.keyword} (Vol: ${k.volume}, KD: ${k.difficulty})`).join('\\n') }}\n\n_Full report saved to project management_",
          "otherOptions": {}
        },
        "id": "notify-report",
        "name": "Notify Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1550,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.SEO_CONTENT_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Keyword Analysis",
            "mode": "list",
            "cachedResultName": "Keyword Analysis"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Date": "={{ $now.format('yyyy-MM-dd') }}",
              "Total Keywords": "={{ $('Analyze Keywords').first().json.summary.totalKeywords }}",
              "High Priority": "={{ $('Analyze Keywords').first().json.summary.highPriority }}",
              "Clusters": "={{ $('Analyze Keywords').first().json.summary.clustersIdentified }}",
              "Avg Volume": "={{ $('Analyze Keywords').first().json.summary.avgVolume }}",
              "Avg Difficulty": "={{ $('Analyze Keywords').first().json.summary.avgDifficulty }}",
              "Content Gaps": "={{ $('Identify Content Gaps').first().json.summary.newContentNeeded }}",
              "Optimizations": "={{ $('Identify Content Gaps').first().json.summary.optimizationsNeeded }}"
            }
          },
          "options": {}
        },
        "id": "log-analysis",
        "name": "Log Analysis",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1800,
          400
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Weekly Monday": {
        "main": [
          [
            {
              "node": "Fetch Keyword Questions",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Related Keywords",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Ahrefs Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Content Request": {
        "main": [
          [
            {
              "node": "Analyze Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Keyword Questions": {
        "main": [
          [
            {
              "node": "Analyze Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Related Keywords": {
        "main": [
          [
            {
              "node": "Analyze Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Ahrefs Data": {
        "main": [
          [
            {
              "node": "Analyze Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Keywords": {
        "main": [
          [
            {
              "node": "Generate Content Briefs",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Existing Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Content Briefs": {
        "main": [
          [
            {
              "node": "Create Content Calendar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Existing Content": {
        "main": [
          [
            {
              "node": "Identify Content Gaps",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Content Calendar": {
        "main": [
          [
            {
              "node": "Save Calendar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Identify Content Gaps": {
        "main": [
          [
            {
              "node": "Notify Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Calendar": {
        "main": [
          [
            {
              "node": "Notify Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Notify Report": {
        "main": [
          [
            {
              "node": "Log Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "seo",
        "name": "seo"
      },
      {
        "id": "content",
        "name": "content"
      },
      {
        "id": "marketing",
        "name": "marketing"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain SEO Site Audit v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 3 * * 0"
              }
            ]
          }
        },
        "id": "weekly-audit",
        "name": "Weekly Audit Schedule",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "site-audit",
          "options": {}
        },
        "id": "manual-audit",
        "name": "Manual Audit Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          600
        ],
        "webhookId": "site-audit-trigger"
      },
      {
        "parameters": {
          "jsCode": "// Initialize audit configuration\nconst input = $input.first().json;\n\nconst auditConfig = {\n  auditId: `AUDIT-${Date.now().toString(36).toUpperCase()}`,\n  domain: input.domain || input.body?.domain || $vars.DEFAULT_AUDIT_DOMAIN,\n  depth: input.depth || input.body?.depth || 'full',\n  maxPages: input.maxPages || input.body?.maxPages || 500,\n  categories: input.categories || input.body?.categories || [\n    'technical',\n    'content',\n    'performance',\n    'mobile',\n    'security',\n    'indexability'\n  ],\n  startedAt: new Date().toISOString(),\n  previousAuditId: input.previousAuditId || null\n};\n\n// Issue severity weights\nauditConfig.severityWeights = {\n  critical: 10,\n  high: 5,\n  medium: 3,\n  low: 1,\n  info: 0\n};\n\nreturn [{ json: auditConfig }];"
        },
        "id": "init-audit",
        "name": "Initialize Audit",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CRAWLER_API_URL }}/crawl",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"domain\": \"{{ $json.domain }}\",\n  \"maxPages\": {{ $json.maxPages }},\n  \"depth\": \"{{ $json.depth }}\",\n  \"includeResources\": true,\n  \"followRedirects\": true,\n  \"respectRobots\": true,\n  \"userAgent\": \"GrainBot/1.0\",\n  \"extractMetadata\": true,\n  \"checkLinks\": true\n}",
          "options": {
            "timeout": 300000
          }
        },
        "id": "crawl-site",
        "name": "Crawl Website",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "crawler-api-key",
            "name": "Crawler API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.PAGESPEED_API_URL }}/analyze",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "url",
                "value": "=https://{{ $('Initialize Audit').first().json.domain }}"
              },
              {
                "name": "strategy",
                "value": "mobile"
              },
              {
                "name": "category",
                "value": "performance,accessibility,best-practices,seo"
              }
            ]
          },
          "options": {}
        },
        "id": "pagespeed-mobile",
        "name": "PageSpeed Mobile",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pagespeed-api-key",
            "name": "PageSpeed API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.PAGESPEED_API_URL }}/analyze",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "url",
                "value": "=https://{{ $('Initialize Audit').first().json.domain }}"
              },
              {
                "name": "strategy",
                "value": "desktop"
              },
              {
                "name": "category",
                "value": "performance,accessibility,best-practices,seo"
              }
            ]
          },
          "options": {}
        },
        "id": "pagespeed-desktop",
        "name": "PageSpeed Desktop",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "pagespeed-api-key",
            "name": "PageSpeed API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Analyze technical SEO issues\nconst config = $('Initialize Audit').first().json;\nconst crawlData = $('Crawl Website').first().json;\n\nconst pages = crawlData.pages || [];\nconst issues = [];\n\n// Check each page for technical issues\npages.forEach(page => {\n  // Title tag issues\n  if (!page.title) {\n    issues.push({\n      type: 'missing_title',\n      severity: 'critical',\n      category: 'content',\n      url: page.url,\n      message: 'Page is missing a title tag',\n      recommendation: 'Add a unique, descriptive title tag (50-60 characters)'\n    });\n  } else if (page.title.length < 30) {\n    issues.push({\n      type: 'short_title',\n      severity: 'medium',\n      category: 'content',\n      url: page.url,\n      message: `Title tag is too short (${page.title.length} chars)`,\n      recommendation: 'Expand title to 50-60 characters for better SEO'\n    });\n  } else if (page.title.length > 60) {\n    issues.push({\n      type: 'long_title',\n      severity: 'low',\n      category: 'content',\n      url: page.url,\n      message: `Title tag is too long (${page.title.length} chars)`,\n      recommendation: 'Shorten title to under 60 characters to avoid truncation'\n    });\n  }\n\n  // Meta description issues\n  if (!page.metaDescription) {\n    issues.push({\n      type: 'missing_meta_description',\n      severity: 'high',\n      category: 'content',\n      url: page.url,\n      message: 'Page is missing a meta description',\n      recommendation: 'Add a compelling meta description (150-160 characters)'\n    });\n  } else if (page.metaDescription.length < 70) {\n    issues.push({\n      type: 'short_meta_description',\n      severity: 'medium',\n      category: 'content',\n      url: page.url,\n      message: `Meta description is too short (${page.metaDescription.length} chars)`,\n      recommendation: 'Expand meta description to 150-160 characters'\n    });\n  }\n\n  // H1 tag issues\n  if (!page.h1 || page.h1.length === 0) {\n    issues.push({\n      type: 'missing_h1',\n      severity: 'high',\n      category: 'content',\n      url: page.url,\n      message: 'Page is missing an H1 tag',\n      recommendation: 'Add a single, descriptive H1 tag'\n    });\n  } else if (page.h1.length > 1) {\n    issues.push({\n      type: 'multiple_h1',\n      severity: 'medium',\n      category: 'content',\n      url: page.url,\n      message: `Page has ${page.h1.length} H1 tags`,\n      recommendation: 'Use only one H1 tag per page'\n    });\n  }\n\n  // Canonical issues\n  if (!page.canonical) {\n    issues.push({\n      type: 'missing_canonical',\n      severity: 'medium',\n      category: 'indexability',\n      url: page.url,\n      message: 'Page is missing a canonical tag',\n      recommendation: 'Add a self-referencing canonical tag'\n    });\n  }\n\n  // Broken links\n  if (page.brokenLinks && page.brokenLinks.length > 0) {\n    page.brokenLinks.forEach(link => {\n      issues.push({\n        type: 'broken_link',\n        severity: 'high',\n        category: 'technical',\n        url: page.url,\n        message: `Broken link found: ${link.href} (${link.statusCode})`,\n        recommendation: 'Fix or remove the broken link'\n      });\n    });\n  }\n\n  // Image alt text\n  if (page.images) {\n    page.images.filter(img => !img.alt).forEach(img => {\n      issues.push({\n        type: 'missing_alt_text',\n        severity: 'medium',\n        category: 'content',\n        url: page.url,\n        message: `Image missing alt text: ${img.src}`,\n        recommendation: 'Add descriptive alt text to all images'\n      });\n    });\n  }\n\n  // HTTPS issues\n  if (page.url.startsWith('http://')) {\n    issues.push({\n      type: 'not_https',\n      severity: 'critical',\n      category: 'security',\n      url: page.url,\n      message: 'Page is not served over HTTPS',\n      recommendation: 'Migrate to HTTPS for security and SEO benefits'\n    });\n  }\n\n  // Response time issues\n  if (page.responseTime > 3000) {\n    issues.push({\n      type: 'slow_response',\n      severity: 'high',\n      category: 'performance',\n      url: page.url,\n      message: `Slow server response (${page.responseTime}ms)`,\n      recommendation: 'Optimize server response time to under 200ms'\n    });\n  }\n\n  // Word count issues\n  if (page.wordCount && page.wordCount < 300) {\n    issues.push({\n      type: 'thin_content',\n      severity: 'medium',\n      category: 'content',\n      url: page.url,\n      message: `Thin content (${page.wordCount} words)`,\n      recommendation: 'Expand content to at least 300 words for better rankings'\n    });\n  }\n\n  // Redirect chain issues\n  if (page.redirectChain && page.redirectChain.length > 1) {\n    issues.push({\n      type: 'redirect_chain',\n      severity: 'medium',\n      category: 'technical',\n      url: page.url,\n      message: `Redirect chain detected (${page.redirectChain.length} hops)`,\n      recommendation: 'Update links to point directly to final URL'\n    });\n  }\n});\n\n// Check for duplicate content\nconst titleCounts = {};\nconst descriptionCounts = {};\n\npages.forEach(page => {\n  if (page.title) {\n    titleCounts[page.title] = (titleCounts[page.title] || []);\n    titleCounts[page.title].push(page.url);\n  }\n  if (page.metaDescription) {\n    descriptionCounts[page.metaDescription] = (descriptionCounts[page.metaDescription] || []);\n    descriptionCounts[page.metaDescription].push(page.url);\n  }\n});\n\nObject.entries(titleCounts).filter(([_, urls]) => urls.length > 1).forEach(([title, urls]) => {\n  issues.push({\n    type: 'duplicate_title',\n    severity: 'high',\n    category: 'content',\n    urls,\n    message: `Duplicate title found on ${urls.length} pages: \"${title.substring(0, 50)}...\"`,\n    recommendation: 'Create unique titles for each page'\n  });\n});\n\nObject.entries(descriptionCounts).filter(([_, urls]) => urls.length > 1).forEach(([desc, urls]) => {\n  issues.push({\n    type: 'duplicate_description',\n    severity: 'medium',\n    category: 'content',\n    urls,\n    message: `Duplicate meta description found on ${urls.length} pages`,\n    recommendation: 'Create unique descriptions for each page'\n  });\n});\n\nreturn [{ json: {\n  config,\n  crawlSummary: {\n    totalPages: pages.length,\n    avgResponseTime: pages.reduce((a, b) => a + (b.responseTime || 0), 0) / pages.length,\n    totalLinks: pages.reduce((a, b) => a + (b.links?.length || 0), 0)\n  },\n  issues\n}}];"
        },
        "id": "technical-analysis",
        "name": "Technical SEO Analysis",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "// Analyze PageSpeed results\nconst mobileResults = $('PageSpeed Mobile').first().json;\nconst desktopResults = $('PageSpeed Desktop').first().json;\nconst config = $('Initialize Audit').first().json;\n\nconst issues = [];\n\n// Process mobile performance\nconst mobilePerf = mobileResults.lighthouseResult?.categories?.performance?.score * 100 || 0;\nconst desktopPerf = desktopResults.lighthouseResult?.categories?.performance?.score * 100 || 0;\n\nif (mobilePerf < 50) {\n  issues.push({\n    type: 'poor_mobile_performance',\n    severity: 'critical',\n    category: 'performance',\n    url: `https://${config.domain}`,\n    message: `Poor mobile performance score: ${mobilePerf}/100`,\n    recommendation: 'Optimize images, reduce JavaScript, and improve Core Web Vitals'\n  });\n} else if (mobilePerf < 90) {\n  issues.push({\n    type: 'moderate_mobile_performance',\n    severity: 'medium',\n    category: 'performance',\n    url: `https://${config.domain}`,\n    message: `Mobile performance needs improvement: ${mobilePerf}/100`,\n    recommendation: 'Review Core Web Vitals and optimize critical rendering path'\n  });\n}\n\n// Core Web Vitals\nconst cwv = mobileResults.lighthouseResult?.audits;\nif (cwv) {\n  // LCP (Largest Contentful Paint)\n  const lcp = cwv['largest-contentful-paint']?.numericValue;\n  if (lcp > 4000) {\n    issues.push({\n      type: 'poor_lcp',\n      severity: 'critical',\n      category: 'performance',\n      url: `https://${config.domain}`,\n      message: `Poor LCP: ${(lcp/1000).toFixed(1)}s (should be under 2.5s)`,\n      recommendation: 'Optimize largest contentful paint element, consider lazy loading'\n    });\n  } else if (lcp > 2500) {\n    issues.push({\n      type: 'needs_improvement_lcp',\n      severity: 'high',\n      category: 'performance',\n      url: `https://${config.domain}`,\n      message: `LCP needs improvement: ${(lcp/1000).toFixed(1)}s`,\n      recommendation: 'Improve server response time and optimize resource loading'\n    });\n  }\n\n  // FID / TBT (Total Blocking Time as proxy)\n  const tbt = cwv['total-blocking-time']?.numericValue;\n  if (tbt > 600) {\n    issues.push({\n      type: 'poor_tbt',\n      severity: 'critical',\n      category: 'performance',\n      url: `https://${config.domain}`,\n      message: `High Total Blocking Time: ${tbt}ms (should be under 200ms)`,\n      recommendation: 'Reduce JavaScript execution time, split long tasks'\n    });\n  }\n\n  // CLS (Cumulative Layout Shift)\n  const cls = cwv['cumulative-layout-shift']?.numericValue;\n  if (cls > 0.25) {\n    issues.push({\n      type: 'poor_cls',\n      severity: 'high',\n      category: 'performance',\n      url: `https://${config.domain}`,\n      message: `High layout shift: ${cls.toFixed(3)} (should be under 0.1)`,\n      recommendation: 'Set dimensions for images and embeds, avoid inserting content above existing content'\n    });\n  }\n}\n\n// Accessibility issues\nconst accessibilityScore = mobileResults.lighthouseResult?.categories?.accessibility?.score * 100 || 0;\nif (accessibilityScore < 90) {\n  issues.push({\n    type: 'accessibility_issues',\n    severity: accessibilityScore < 50 ? 'critical' : 'high',\n    category: 'accessibility',\n    url: `https://${config.domain}`,\n    message: `Accessibility score: ${accessibilityScore}/100`,\n    recommendation: 'Review and fix accessibility issues for better usability'\n  });\n}\n\n// SEO score from PageSpeed\nconst seoScore = mobileResults.lighthouseResult?.categories?.seo?.score * 100 || 0;\nif (seoScore < 90) {\n  issues.push({\n    type: 'pagespeed_seo_issues',\n    severity: 'high',\n    category: 'technical',\n    url: `https://${config.domain}`,\n    message: `PageSpeed SEO score: ${seoScore}/100`,\n    recommendation: 'Review Lighthouse SEO audit for specific improvements'\n  });\n}\n\nconst performanceData = {\n  mobile: {\n    performance: mobilePerf,\n    accessibility: accessibilityScore,\n    bestPractices: mobileResults.lighthouseResult?.categories?.['best-practices']?.score * 100 || 0,\n    seo: seoScore,\n    lcp: cwv?.['largest-contentful-paint']?.numericValue,\n    tbt: cwv?.['total-blocking-time']?.numericValue,\n    cls: cwv?.['cumulative-layout-shift']?.numericValue\n  },\n  desktop: {\n    performance: desktopPerf,\n    accessibility: desktopResults.lighthouseResult?.categories?.accessibility?.score * 100 || 0,\n    bestPractices: desktopResults.lighthouseResult?.categories?.['best-practices']?.score * 100 || 0,\n    seo: desktopResults.lighthouseResult?.categories?.seo?.score * 100 || 0\n  }\n};\n\nreturn [{ json: { performanceData, issues } }];"
        },
        "id": "performance-analysis",
        "name": "Performance Analysis",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          700
        ]
      },
      {
        "parameters": {
          "jsCode": "// Compile full audit report\nconst technicalData = $('Technical SEO Analysis').first().json;\nconst performanceData = $('Performance Analysis').first().json;\nconst config = technicalData.config;\n\n// Combine all issues\nconst allIssues = [\n  ...technicalData.issues,\n  ...performanceData.issues\n];\n\n// Calculate scores by category\nconst categoryScores = {};\nconst categories = ['technical', 'content', 'performance', 'mobile', 'security', 'indexability', 'accessibility'];\n\ncategories.forEach(cat => {\n  const catIssues = allIssues.filter(i => i.category === cat);\n  const penalty = catIssues.reduce((sum, issue) => {\n    return sum + (config.severityWeights[issue.severity] || 0);\n  }, 0);\n  categoryScores[cat] = Math.max(0, 100 - penalty);\n});\n\n// Overall health score\nconst overallScore = Math.round(\n  Object.values(categoryScores).reduce((a, b) => a + b, 0) / categories.length\n);\n\n// Group issues by severity\nconst issuesBySeverity = {\n  critical: allIssues.filter(i => i.severity === 'critical'),\n  high: allIssues.filter(i => i.severity === 'high'),\n  medium: allIssues.filter(i => i.severity === 'medium'),\n  low: allIssues.filter(i => i.severity === 'low')\n};\n\n// Top priorities\nconst priorities = [\n  ...issuesBySeverity.critical.slice(0, 5),\n  ...issuesBySeverity.high.slice(0, 5)\n].slice(0, 10);\n\nconst auditReport = {\n  auditId: config.auditId,\n  domain: config.domain,\n  completedAt: new Date().toISOString(),\n  startedAt: config.startedAt,\n  summary: {\n    overallScore,\n    categoryScores,\n    totalIssues: allIssues.length,\n    criticalIssues: issuesBySeverity.critical.length,\n    highIssues: issuesBySeverity.high.length,\n    mediumIssues: issuesBySeverity.medium.length,\n    lowIssues: issuesBySeverity.low.length,\n    pagesAnalyzed: technicalData.crawlSummary.totalPages\n  },\n  performance: performanceData.performanceData,\n  topPriorities: priorities,\n  issuesBySeverity,\n  allIssues,\n  crawlSummary: technicalData.crawlSummary\n};\n\nreturn [{ json: auditReport }];"
        },
        "id": "compile-report",
        "name": "Compile Audit Report",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1250,
          550
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "You are an SEO Expert Analyst. Analyze the site audit results and provide actionable recommendations.\n\nFor each major issue category, provide:\n1. Impact explanation\n2. Priority ranking\n3. Step-by-step fix instructions\n4. Expected improvement after fix\n\nBe specific and technical. Reference actual page URLs and metrics.",
                "role": "system"
              },
              {
                "content": "=Analyze this SEO audit for {{ $json.domain }}:\n\n**Overall Health Score:** {{ $json.summary.overallScore }}/100\n\n**Category Scores:**\n{{ Object.entries($json.summary.categoryScores).map(([k,v]) => `- ${k}: ${v}/100`).join('\\n') }}\n\n**Issue Summary:**\n- Critical: {{ $json.summary.criticalIssues }}\n- High: {{ $json.summary.highIssues }}\n- Medium: {{ $json.summary.mediumIssues }}\n- Low: {{ $json.summary.lowIssues }}\n\n**Top 10 Priorities:**\n{{ $json.topPriorities.map((p, i) => `${i+1}. [${p.severity.toUpperCase()}] ${p.message}`).join('\\n') }}\n\n**Performance Metrics:**\n- Mobile Score: {{ $json.performance.mobile.performance }}/100\n- Desktop Score: {{ $json.performance.desktop.performance }}/100\n- LCP: {{ $json.performance.mobile.lcp }}ms\n- CLS: {{ $json.performance.mobile.cls }}\n\nProvide a prioritized action plan with specific recommendations.",
                "role": "user"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.4,
            "maxTokens": 2500
          }
        },
        "id": "ai-recommendations",
        "name": "AI Recommendations",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          1500,
          450
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-credential",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Finalize audit with AI recommendations\nconst report = $('Compile Audit Report').first().json;\nconst aiRecommendations = $('AI Recommendations').first().json;\n\nconst finalReport = {\n  ...report,\n  recommendations: aiRecommendations,\n  exportFormats: {\n    pdf: `{{ $vars.REPORT_BASE_URL }}/audit/${report.auditId}/pdf`,\n    csv: `{{ $vars.REPORT_BASE_URL }}/audit/${report.auditId}/csv`,\n    json: `{{ $vars.REPORT_BASE_URL }}/audit/${report.auditId}/json`\n  }\n};\n\nreturn [{ json: finalReport }];"
        },
        "id": "finalize-report",
        "name": "Finalize Report",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1750,
          450
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.AUDIT_DB_URL }}/reports",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "save-report",
        "name": "Save to Database",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2000,
          350
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "audit-db-api",
            "name": "Audit DB API"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.SEO_SLACK_CHANNEL }}",
          "text": "=ðŸ” *Site Audit Complete - {{ $json.domain }}*\n\nðŸ“Š *Health Score:* {{ $json.summary.overallScore }}/100\n\n*Category Breakdown:*\n{{ Object.entries($json.summary.categoryScores).map(([k,v]) => `â€¢ ${k.charAt(0).toUpperCase() + k.slice(1)}: ${v}/100`).join('\\n') }}\n\nâš ï¸ *Issues Found:*\nâ€¢ Critical: {{ $json.summary.criticalIssues }}\nâ€¢ High: {{ $json.summary.highIssues }}\nâ€¢ Medium: {{ $json.summary.mediumIssues }}\n\nðŸš€ *Performance:*\nâ€¢ Mobile: {{ $json.performance.mobile.performance }}/100\nâ€¢ Desktop: {{ $json.performance.desktop.performance }}/100\n\nðŸ“„ <{{ $json.exportFormats.pdf }}|Download Full Report>",
          "otherOptions": {}
        },
        "id": "notify-slack",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          2000,
          550
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "respond-webhook",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          2000,
          750
        ]
      }
    ],
    "connections": {
      "Weekly Audit Schedule": {
        "main": [
          [
            {
              "node": "Initialize Audit",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Audit Trigger": {
        "main": [
          [
            {
              "node": "Initialize Audit",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Initialize Audit": {
        "main": [
          [
            {
              "node": "Crawl Website",
              "type": "main",
              "index": 0
            },
            {
              "node": "PageSpeed Mobile",
              "type": "main",
              "index": 0
            },
            {
              "node": "PageSpeed Desktop",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Crawl Website": {
        "main": [
          [
            {
              "node": "Technical SEO Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "PageSpeed Mobile": {
        "main": [
          [
            {
              "node": "Performance Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "PageSpeed Desktop": {
        "main": [
          [
            {
              "node": "Performance Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Technical SEO Analysis": {
        "main": [
          [
            {
              "node": "Compile Audit Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Performance Analysis": {
        "main": [
          [
            {
              "node": "Compile Audit Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compile Audit Report": {
        "main": [
          [
            {
              "node": "AI Recommendations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Recommendations": {
        "main": [
          [
            {
              "node": "Finalize Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Finalize Report": {
        "main": [
          [
            {
              "node": "Save to Database",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "seo",
        "name": "seo"
      },
      {
        "id": "audit",
        "name": "audit"
      },
      {
        "id": "technical",
        "name": "technical"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "name": "Grain Social Listening & Sentiment v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 4
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Every 4 Hours",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          300
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Brand_Keywords"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-keywords",
        "name": "Get Brand Keywords",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "batchSize": 1,
          "options": {}
        },
        "id": "loop-keywords",
        "name": "Process Each Keyword",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          650,
          300
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.serper.dev/search",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-KEY",
                "value": "={{ $env.SERPER_API_KEY }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"q\": \"{{ $json.keyword }}\",\n  \"gl\": \"tr\",\n  \"hl\": \"tr\",\n  \"num\": 20,\n  \"tbs\": \"qdr:d\"\n}",
          "options": {}
        },
        "id": "search-web",
        "name": "Search Web Mentions",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          850,
          200
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.serper.dev/news",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-KEY",
                "value": "={{ $env.SERPER_API_KEY }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"q\": \"{{ $json.keyword }}\",\n  \"gl\": \"tr\",\n  \"hl\": \"tr\",\n  \"num\": 10\n}",
          "options": {}
        },
        "id": "search-news",
        "name": "Search News Mentions",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          850,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://graph.facebook.com/v18.0/{{ $env.FB_PAGE_ID }}/tagged",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "fields",
                "value": "message,from,created_time,permalink_url"
              },
              {
                "name": "access_token",
                "value": "={{ $env.META_ACCESS_TOKEN }}"
              },
              {
                "name": "limit",
                "value": "50"
              }
            ]
          },
          "options": {}
        },
        "id": "get-facebook-mentions",
        "name": "Get Facebook Mentions",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          850,
          600
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "// Combine all mention sources\nconst keyword = $input.item.json;\nconst webResults = $('Search Web Mentions').item?.json?.organic || [];\nconst newsResults = $('Search News Mentions').item?.json?.news || [];\nconst fbMentions = $('Get Facebook Mentions').item?.json?.data || [];\n\nconst mentions = [];\n\n// Process web results\nwebResults.forEach(item => {\n  mentions.push({\n    source: 'web',\n    keyword: keyword.keyword,\n    brand: keyword.brand_name,\n    title: item.title,\n    snippet: item.snippet,\n    link: item.link,\n    date: item.date || new Date().toISOString(),\n    platform: new URL(item.link).hostname\n  });\n});\n\n// Process news results\nnewsResults.forEach(item => {\n  mentions.push({\n    source: 'news',\n    keyword: keyword.keyword,\n    brand: keyword.brand_name,\n    title: item.title,\n    snippet: item.snippet,\n    link: item.link,\n    date: item.date || new Date().toISOString(),\n    platform: item.source || 'news'\n  });\n});\n\n// Process Facebook mentions\nfbMentions.forEach(item => {\n  mentions.push({\n    source: 'facebook',\n    keyword: keyword.keyword,\n    brand: keyword.brand_name,\n    title: item.from?.name || 'Facebook User',\n    snippet: item.message || '',\n    link: item.permalink_url,\n    date: item.created_time,\n    platform: 'facebook'\n  });\n});\n\nreturn mentions.map(m => ({ json: m }));"
        },
        "id": "combine-mentions",
        "name": "Combine All Mentions",
        "type": "n8n-nodes-base.code",
        "position": [
          1050,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "batchSize": 5,
          "options": {}
        },
        "id": "batch-analyze",
        "name": "Batch for Analysis",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          1250,
          400
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir sosyal medya sentiment analisti olarak calismaktasin. Verilen mention'lari analiz et.\n\nHer mention icin:\n1. Sentiment belirle: positive, negative, neutral\n2. Duygu yoÄŸunluÄŸu: 1-10 (10 en gÃ¼clÃ¼)\n3. Konu kategorisi: product, service, brand, competitor, general\n4. Etkileyici mi: true/false (takipci sayisi, engagement vb.)\n5. Aksiyon gerektiriyor mu: true/false\n6. Onerilen aksiyon\n\nJSON array formatinda dondur:\n[\n  {\n    \"index\": 0,\n    \"sentiment\": \"positive/negative/neutral\",\n    \"intensity\": 7,\n    \"category\": \"product\",\n    \"is_influencer\": false,\n    \"needs_action\": false,\n    \"suggested_action\": \"\",\n    \"key_topics\": [\"topic1\", \"topic2\"]\n  }\n]"
              },
              {
                "role": "user",
                "content": "Mentions:\n{{ $json.map((m, i) => `[${i}] ${m.title}: ${m.snippet}`).join('\\n') }}"
              }
            ]
          },
          "options": {
            "temperature": 0.3
          }
        },
        "id": "analyze-sentiment",
        "name": "AI Sentiment Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1450,
          400
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse AI sentiment analysis and merge with mentions\nconst mentions = $input.item.json;\nconst aiResponse = $('AI Sentiment Analysis').item?.json?.message?.content || '[]';\n\nlet analyses;\ntry {\n  analyses = JSON.parse(aiResponse);\n} catch (e) {\n  analyses = [];\n}\n\n// Merge analysis with mentions\nconst enriched = mentions.map((mention, index) => {\n  const analysis = analyses.find(a => a.index === index) || {\n    sentiment: 'neutral',\n    intensity: 5,\n    category: 'general',\n    is_influencer: false,\n    needs_action: false,\n    suggested_action: '',\n    key_topics: []\n  };\n  \n  return {\n    json: {\n      ...mention,\n      sentiment: analysis.sentiment,\n      sentiment_intensity: analysis.intensity,\n      category: analysis.category,\n      is_influencer: analysis.is_influencer,\n      needs_action: analysis.needs_action,\n      suggested_action: analysis.suggested_action,\n      key_topics: analysis.key_topics?.join(', ') || '',\n      analyzed_at: new Date().toISOString()\n    }\n  };\n});\n\nreturn enriched;"
        },
        "id": "merge-analysis",
        "name": "Merge Sentiment Data",
        "type": "n8n-nodes-base.code",
        "position": [
          1650,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Social_Mentions"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "brand": "={{ $json.brand }}",
              "keyword": "={{ $json.keyword }}",
              "source": "={{ $json.source }}",
              "platform": "={{ $json.platform }}",
              "title": "={{ $json.title }}",
              "snippet": "={{ $json.snippet }}",
              "link": "={{ $json.link }}",
              "sentiment": "={{ $json.sentiment }}",
              "intensity": "={{ $json.sentiment_intensity }}",
              "category": "={{ $json.category }}",
              "is_influencer": "={{ $json.is_influencer }}",
              "needs_action": "={{ $json.needs_action }}",
              "suggested_action": "={{ $json.suggested_action }}",
              "key_topics": "={{ $json.key_topics }}",
              "mention_date": "={{ $json.date }}",
              "analyzed_at": "={{ $json.analyzed_at }}"
            }
          }
        },
        "id": "log-mentions",
        "name": "Log Mentions",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1850,
          400
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "negative-check",
                "leftValue": "={{ $json.sentiment }}",
                "rightValue": "negative",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "high-intensity",
                "leftValue": "={{ $json.sentiment_intensity }}",
                "rightValue": "7",
                "operator": {
                  "type": "number",
                  "operation": "gte"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-negative-alert",
        "name": "If Negative & High Intensity",
        "type": "n8n-nodes-base.if",
        "position": [
          2050,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#brand-alerts",
          "text": "=*NEGATIF MENTION ALARMI*\n\n*Marka:* {{ $json.brand }}\n*Platform:* {{ $json.platform }}\n*Kaynak:* {{ $json.source }}\n\n*Baslik:* {{ $json.title }}\n*Icerik:* {{ $json.snippet }}\n\n*Sentiment:* {{ $json.sentiment }} (Yogunluk: {{ $json.sentiment_intensity }}/10)\n*Kategori:* {{ $json.category }}\n*Influencer:* {{ $json.is_influencer }}\n\n*Onerilen Aksiyon:* {{ $json.suggested_action }}\n\n*Link:* {{ $json.link }}",
          "otherOptions": {}
        },
        "id": "slack-negative-alert",
        "name": "Negative Mention Alert",
        "type": "n8n-nodes-base.slack",
        "position": [
          2250,
          300
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "influencer-check",
                "leftValue": "={{ $json.is_influencer }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-influencer",
        "name": "If Influencer",
        "type": "n8n-nodes-base.if",
        "position": [
          2050,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#influencer-mentions",
          "text": "=*INFLUENCER MENTION*\n\n*Marka:* {{ $json.brand }}\n*Platform:* {{ $json.platform }}\n*Sentiment:* {{ $json.sentiment }}\n\n*Baslik:* {{ $json.title }}\n*Icerik:* {{ $json.snippet }}\n\n*Link:* {{ $json.link }}\n\n*Not:* Potansiyel isbirligi firsati!",
          "otherOptions": {}
        },
        "id": "slack-influencer-alert",
        "name": "Influencer Alert",
        "type": "n8n-nodes-base.slack",
        "position": [
          2250,
          600
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "days",
                "daysInterval": 1
              }
            ]
          }
        },
        "id": "daily-report-trigger",
        "name": "Daily Sentiment Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          800
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Social_Mentions"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-daily-mentions",
        "name": "Get Daily Mentions",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          800
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Aggregate daily sentiment metrics\nconst mentions = $input.all();\nconst yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\nconst dailyMentions = mentions.filter(m => {\n  const analyzedDate = new Date(m.json.analyzed_at);\n  return analyzedDate >= yesterday;\n});\n\nconst metrics = {\n  total_mentions: dailyMentions.length,\n  \n  sentiment_breakdown: {\n    positive: dailyMentions.filter(m => m.json.sentiment === 'positive').length,\n    neutral: dailyMentions.filter(m => m.json.sentiment === 'neutral').length,\n    negative: dailyMentions.filter(m => m.json.sentiment === 'negative').length\n  },\n  \n  avg_intensity: dailyMentions.length > 0 \n    ? (dailyMentions.reduce((sum, m) => sum + (parseInt(m.json.intensity) || 5), 0) / dailyMentions.length).toFixed(1)\n    : 0,\n  \n  source_breakdown: {\n    web: dailyMentions.filter(m => m.json.source === 'web').length,\n    news: dailyMentions.filter(m => m.json.source === 'news').length,\n    facebook: dailyMentions.filter(m => m.json.source === 'facebook').length,\n    instagram: dailyMentions.filter(m => m.json.source === 'instagram').length,\n    twitter: dailyMentions.filter(m => m.json.source === 'twitter').length\n  },\n  \n  influencer_mentions: dailyMentions.filter(m => m.json.is_influencer === 'true' || m.json.is_influencer === true).length,\n  action_required: dailyMentions.filter(m => m.json.needs_action === 'true' || m.json.needs_action === true).length,\n  \n  top_topics: [...new Set(dailyMentions.flatMap(m => (m.json.key_topics || '').split(', ').filter(Boolean)))].slice(0, 10),\n  \n  sentiment_score: dailyMentions.length > 0\n    ? (((dailyMentions.filter(m => m.json.sentiment === 'positive').length - dailyMentions.filter(m => m.json.sentiment === 'negative').length) / dailyMentions.length) * 100).toFixed(1)\n    : 0\n};\n\nreturn { json: metrics };"
        },
        "id": "calculate-daily-metrics",
        "name": "Calculate Daily Metrics",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          800
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#daily-reports",
          "text": "=*GUNLUK SOSYAL DINLEME RAPORU*\n\n*Toplam Mention:* {{ $json.total_mentions }}\n*Sentiment Skoru:* {{ $json.sentiment_score }}% (pozitif yonde)\n\n*Sentiment Dagilimi:*\n- Pozitif: {{ $json.sentiment_breakdown.positive }}\n- Notr: {{ $json.sentiment_breakdown.neutral }}\n- Negatif: {{ $json.sentiment_breakdown.negative }}\n\n*Ortalama Yogunluk:* {{ $json.avg_intensity }}/10\n\n*Kaynak Dagilimi:*\n- Web: {{ $json.source_breakdown.web }}\n- Haber: {{ $json.source_breakdown.news }}\n- Facebook: {{ $json.source_breakdown.facebook }}\n- Instagram: {{ $json.source_breakdown.instagram }}\n- Twitter: {{ $json.source_breakdown.twitter }}\n\n*Influencer Mention:* {{ $json.influencer_mentions }}\n*Aksiyon Gerektiren:* {{ $json.action_required }}\n\n*One Cikan Konular:*\n{{ $json.top_topics.join(', ') }}",
          "otherOptions": {}
        },
        "id": "slack-daily-report",
        "name": "Send Daily Report",
        "type": "n8n-nodes-base.slack",
        "position": [
          850,
          800
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Gunluk sosyal dinleme verilerini analiz et ve trend raporu olustur.\n\nJSON formatinda dondur:\n{\n  \"overall_sentiment\": \"positive/negative/neutral\",\n  \"trend_direction\": \"improving/stable/declining\",\n  \"key_insights\": [\"onemli bulgular\"],\n  \"emerging_topics\": [\"yukselen konular\"],\n  \"risk_areas\": [\"dikkat edilmesi gereken alanlar\"],\n  \"opportunities\": [\"firsatlar\"],\n  \"recommended_actions\": [\"onerilen aksiyonlar\"]\n}"
              },
              {
                "role": "user",
                "content": "Sentiment skoru: {{ $json.sentiment_score }}%\nToplam mention: {{ $json.total_mentions }}\nPozitif: {{ $json.sentiment_breakdown.positive }}\nNegatif: {{ $json.sentiment_breakdown.negative }}\nInfluencer mention: {{ $json.influencer_mentions }}\nAksiyon gerektiren: {{ $json.action_required }}\nOne cikan konular: {{ $json.top_topics.join(', ') }}"
              }
            ]
          },
          "options": {
            "temperature": 0.4
          }
        },
        "id": "ai-trend-analysis",
        "name": "AI Trend Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1050,
          800
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse AI trend analysis\nconst aiResponse = $input.item.json.message?.content || $input.item.json.content;\nlet analysis;\n\ntry {\n  analysis = JSON.parse(aiResponse);\n} catch (e) {\n  analysis = {\n    overall_sentiment: 'neutral',\n    trend_direction: 'stable',\n    key_insights: [],\n    emerging_topics: [],\n    risk_areas: [],\n    opportunities: [],\n    recommended_actions: []\n  };\n}\n\nreturn { json: analysis };"
        },
        "id": "parse-trend-analysis",
        "name": "Parse Trend Analysis",
        "type": "n8n-nodes-base.code",
        "position": [
          1250,
          800
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#brand-insights",
          "text": "=*AI TREND ANALIZI*\n\n*Genel Sentiment:* {{ $json.overall_sentiment }}\n*Trend Yonu:* {{ $json.trend_direction }}\n\n*Onemli Bulgular:*\n{{ $json.key_insights?.map(i => '- ' + i).join('\\n') || 'Yok' }}\n\n*Yukselen Konular:*\n{{ $json.emerging_topics?.map(t => '- ' + t).join('\\n') || 'Yok' }}\n\n*Risk Alanlari:*\n{{ $json.risk_areas?.map(r => '- ' + r).join('\\n') || 'Yok' }}\n\n*Firsatlar:*\n{{ $json.opportunities?.map(o => '- ' + o).join('\\n') || 'Yok' }}\n\n*Onerilen Aksiyonlar:*\n{{ $json.recommended_actions?.map(a => '- ' + a).join('\\n') || 'Yok' }}",
          "otherOptions": {}
        },
        "id": "slack-trend-report",
        "name": "Send Trend Analysis",
        "type": "n8n-nodes-base.slack",
        "position": [
          1450,
          800
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      }
    ],
    "connections": {
      "Every 4 Hours": {
        "main": [
          [
            {
              "node": "Get Brand Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Brand Keywords": {
        "main": [
          [
            {
              "node": "Process Each Keyword",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Each Keyword": {
        "main": [
          [
            {
              "node": "Search Web Mentions",
              "type": "main",
              "index": 0
            },
            {
              "node": "Search News Mentions",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Facebook Mentions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Search Web Mentions": {
        "main": [
          [
            {
              "node": "Combine All Mentions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Search News Mentions": {
        "main": [
          [
            {
              "node": "Combine All Mentions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Facebook Mentions": {
        "main": [
          [
            {
              "node": "Combine All Mentions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Combine All Mentions": {
        "main": [
          [
            {
              "node": "Batch for Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Batch for Analysis": {
        "main": [
          [
            {
              "node": "AI Sentiment Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Sentiment Analysis": {
        "main": [
          [
            {
              "node": "Merge Sentiment Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Sentiment Data": {
        "main": [
          [
            {
              "node": "Log Mentions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Mentions": {
        "main": [
          [
            {
              "node": "If Negative & High Intensity",
              "type": "main",
              "index": 0
            },
            {
              "node": "If Influencer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Negative & High Intensity": {
        "main": [
          [
            {
              "node": "Negative Mention Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "If Influencer": {
        "main": [
          [
            {
              "node": "Influencer Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Daily Sentiment Report": {
        "main": [
          [
            {
              "node": "Get Daily Mentions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Daily Mentions": {
        "main": [
          [
            {
              "node": "Calculate Daily Metrics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Daily Metrics": {
        "main": [
          [
            {
              "node": "Send Daily Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Trend Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Trend Analysis": {
        "main": [
          [
            {
              "node": "Parse Trend Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Trend Analysis": {
        "main": [
          [
            {
              "node": "Send Trend Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "grain-automation"
      },
      {
        "name": "social-listening"
      },
      {
        "name": "sentiment"
      }
    ],
    "meta": {
      "templateId": "grain-sls-v1",
      "version": "1.0.0",
      "description": "Monitor brand mentions across web, news, social media. AI sentiment analysis, influencer detection, daily trend reports.",
      "requiredCredentials": [
        "Google Sheets OAuth2",
        "OpenAI API",
        "Serper API",
        "Meta Access Token",
        "Slack"
      ],
      "requiredEnvVars": [
        "SERPER_API_KEY",
        "META_ACCESS_TOKEN",
        "FB_PAGE_ID"
      ]
    }
  },
  {
    "name": "Grain Unified Analytics Dashboard v1",
    "nodes": [
      {
        "parameters": {},
        "id": "webhook-dashboard",
        "name": "Dashboard API",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "unified-analytics-api"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 6 * * *"
              }
            ]
          }
        },
        "id": "daily-report",
        "name": "Daily Report Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          600
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1"
              }
            ]
          }
        },
        "id": "weekly-report",
        "name": "Weekly Report Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          200,
          800
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.posthog.com/api/projects/{{ $env.POSTHOG_PROJECT_ID }}/insights",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "date_from",
                "value": "={{ $json.dateFrom || '-7d' }}"
              },
              {
                "name": "date_to",
                "value": "={{ $json.dateTo || 'now' }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-posthog",
        "name": "Fetch PostHog Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://mixpanel.com/api/2.0/engage",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpBasicAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "project_id",
                "value": "={{ $env.MIXPANEL_PROJECT_ID }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-mixpanel",
        "name": "Fetch Mixpanel Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.amplitude.com/2/events/segmentation",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpBasicAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "start",
                "value": "={{ $json.dateFrom || '20260101' }}"
              },
              {
                "name": "end",
                "value": "={{ $json.dateTo || '20260107' }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-amplitude",
        "name": "Fetch Amplitude Data",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          700
        ]
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://api.hubspot.com/analytics/v2/reports/{{ $env.HUBSPOT_PORTAL_ID }}/campaigns",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "hubSpotApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "start",
                "value": "={{ $json.startTimestamp || Date.now() - 7*24*60*60*1000 }}"
              },
              {
                "name": "end",
                "value": "={{ $json.endTimestamp || Date.now() }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fetch-hubspot-analytics",
        "name": "Fetch HubSpot Analytics",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          450,
          900
        ]
      },
      {
        "parameters": {
          "jsCode": "// Cross-Workflow Data Aggregator\n// Consolidates data from all analytics sources\n\nconst posthogData = $('Fetch PostHog Data').first()?.json || {};\nconst mixpanelData = $('Fetch Mixpanel Data').first()?.json || {};\nconst amplitudeData = $('Fetch Amplitude Data').first()?.json || {};\nconst hubspotData = $('Fetch HubSpot Analytics').first()?.json || {};\n\n// Unified KPI structure\nconst unifiedMetrics = {\n  period: {\n    start: new Date(Date.now() - 7*24*60*60*1000).toISOString(),\n    end: new Date().toISOString(),\n    days: 7\n  },\n  \n  // Acquisition metrics\n  acquisition: {\n    visitors: posthogData.results?.[0]?.count || 0,\n    newUsers: mixpanelData.results?.filter(r => r.is_new)?.length || 0,\n    sessions: posthogData.results?.[0]?.sessions || 0,\n    bounceRate: posthogData.results?.[0]?.bounce_rate || 0,\n    avgSessionDuration: posthogData.results?.[0]?.avg_session_duration || 0,\n    sources: {\n      organic: 0,\n      paid: 0,\n      social: 0,\n      email: 0,\n      referral: 0,\n      direct: 0\n    }\n  },\n  \n  // Activation metrics\n  activation: {\n    signups: hubspotData.contacts?.new || 0,\n    activationRate: 0,\n    trialStarts: 0,\n    onboardingCompletion: 0\n  },\n  \n  // Engagement metrics  \n  engagement: {\n    dau: amplitudeData.data?.dau || 0,\n    wau: amplitudeData.data?.wau || 0,\n    mau: amplitudeData.data?.mau || 0,\n    stickinessRatio: 0, // DAU/MAU\n    featureAdoption: {},\n    avgActions: 0\n  },\n  \n  // Revenue metrics\n  revenue: {\n    mrr: hubspotData.deals?.mrr || 0,\n    arr: 0,\n    newMrr: 0,\n    churnMrr: 0,\n    expansionMrr: 0,\n    netNewMrr: 0,\n    arpu: 0,\n    ltv: 0\n  },\n  \n  // Retention metrics\n  retention: {\n    day1: 0,\n    day7: 0,\n    day30: 0,\n    churnRate: 0,\n    nps: 0\n  },\n  \n  // Funnel metrics\n  funnel: {\n    steps: [\n      { name: 'Visitors', count: 1000, rate: 100 },\n      { name: 'Signups', count: 150, rate: 15 },\n      { name: 'Activated', count: 90, rate: 60 },\n      { name: 'Paid', count: 27, rate: 30 }\n    ],\n    overallConversion: 2.7\n  },\n  \n  // Attribution data\n  attribution: {\n    firstTouch: {},\n    lastTouch: {},\n    multiTouch: {},\n    topChannels: []\n  }\n};\n\n// Calculate derived metrics\nif (unifiedMetrics.engagement.mau > 0) {\n  unifiedMetrics.engagement.stickinessRatio = \n    (unifiedMetrics.engagement.dau / unifiedMetrics.engagement.mau * 100).toFixed(2);\n}\n\nif (unifiedMetrics.revenue.mrr > 0) {\n  unifiedMetrics.revenue.arr = unifiedMetrics.revenue.mrr * 12;\n}\n\n// Week-over-week changes (placeholder - would use historical data)\nunifiedMetrics.changes = {\n  visitors: '+12%',\n  signups: '+8%',\n  mrr: '+5%',\n  churnRate: '-2%'\n};\n\nreturn [{ json: unifiedMetrics }];"
        },
        "id": "data-aggregator",
        "name": "Cross-Workflow Aggregator",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "// Multi-Touch Attribution Calculator\n// Implements various attribution models\n\nconst touchpoints = $input.first().json.touchpointData || [];\n\nfunction calculateAttribution(touchpoints, model) {\n  const attribution = {};\n  \n  touchpoints.forEach(journey => {\n    const touches = journey.touches || [];\n    const conversionValue = journey.value || 1;\n    \n    if (touches.length === 0) return;\n    \n    switch (model) {\n      case 'first_touch':\n        const first = touches[0];\n        attribution[first.channel] = (attribution[first.channel] || 0) + conversionValue;\n        break;\n        \n      case 'last_touch':\n        const last = touches[touches.length - 1];\n        attribution[last.channel] = (attribution[last.channel] || 0) + conversionValue;\n        break;\n        \n      case 'linear':\n        const perTouch = conversionValue / touches.length;\n        touches.forEach(touch => {\n          attribution[touch.channel] = (attribution[touch.channel] || 0) + perTouch;\n        });\n        break;\n        \n      case 'time_decay':\n        // More credit to recent touches\n        let totalWeight = 0;\n        touches.forEach((_, i) => totalWeight += Math.pow(2, i));\n        \n        touches.forEach((touch, i) => {\n          const weight = Math.pow(2, i) / totalWeight;\n          attribution[touch.channel] = (attribution[touch.channel] || 0) + (conversionValue * weight);\n        });\n        break;\n        \n      case 'u_shaped':\n        // 40% first, 40% last, 20% middle\n        if (touches.length === 1) {\n          attribution[touches[0].channel] = (attribution[touches[0].channel] || 0) + conversionValue;\n        } else if (touches.length === 2) {\n          attribution[touches[0].channel] = (attribution[touches[0].channel] || 0) + (conversionValue * 0.5);\n          attribution[touches[1].channel] = (attribution[touches[1].channel] || 0) + (conversionValue * 0.5);\n        } else {\n          attribution[touches[0].channel] = (attribution[touches[0].channel] || 0) + (conversionValue * 0.4);\n          attribution[touches[touches.length-1].channel] = (attribution[touches[touches.length-1].channel] || 0) + (conversionValue * 0.4);\n          \n          const middleShare = (conversionValue * 0.2) / (touches.length - 2);\n          for (let i = 1; i < touches.length - 1; i++) {\n            attribution[touches[i].channel] = (attribution[touches[i].channel] || 0) + middleShare;\n          }\n        }\n        break;\n    }\n  });\n  \n  return attribution;\n}\n\n// Sample touchpoint data (would come from real tracking)\nconst sampleJourneys = [\n  { touches: [{channel: 'organic'}, {channel: 'email'}, {channel: 'direct'}], value: 100 },\n  { touches: [{channel: 'paid'}, {channel: 'organic'}], value: 150 },\n  { touches: [{channel: 'social'}, {channel: 'email'}, {channel: 'paid'}, {channel: 'direct'}], value: 200 }\n];\n\nconst attributionResults = {\n  firstTouch: calculateAttribution(sampleJourneys, 'first_touch'),\n  lastTouch: calculateAttribution(sampleJourneys, 'last_touch'),\n  linear: calculateAttribution(sampleJourneys, 'linear'),\n  timeDecay: calculateAttribution(sampleJourneys, 'time_decay'),\n  uShaped: calculateAttribution(sampleJourneys, 'u_shaped'),\n  \n  journeyCount: sampleJourneys.length,\n  avgTouchpoints: sampleJourneys.reduce((sum, j) => sum + j.touches.length, 0) / sampleJourneys.length,\n  totalValue: sampleJourneys.reduce((sum, j) => sum + j.value, 0),\n  calculatedAt: new Date().toISOString()\n};\n\nreturn [{ json: attributionResults }];"
        },
        "id": "attribution-calculator",
        "name": "Attribution Calculator",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          700
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an Analytics AI that generates executive-ready insights from business metrics. Analyze the data and provide:\n\n1. Key performance summary (2-3 sentences)\n2. Significant trends or patterns\n3. Areas of concern requiring attention\n4. Opportunities identified\n5. Recommended actions\n\nReturn JSON:\n{\n  \"executiveSummary\": \"\",\n  \"keyHighlights\": [\n    {\"metric\": \"\", \"value\": \"\", \"trend\": \"up|down|stable\", \"significance\": \"\"}\n  ],\n  \"alerts\": [\n    {\"severity\": \"critical|warning|info\", \"area\": \"\", \"message\": \"\", \"recommendation\": \"\"}\n  ],\n  \"opportunities\": [\n    {\"area\": \"\", \"potential\": \"\", \"action\": \"\"}\n  ],\n  \"weeklyGoals\": [\n    {\"goal\": \"\", \"currentProgress\": \"\", \"target\": \"\"}\n  ],\n  \"predictiveInsights\": [\n    {\"prediction\": \"\", \"confidence\": \"\", \"timeframe\": \"\"}\n  ]\n}"
              },
              {
                "role": "user",
                "content": "=Generate insights from this analytics data:\n\nUnified Metrics:\n{{ JSON.stringify($('Cross-Workflow Aggregator').first().json, null, 2) }}\n\nAttribution Data:\n{{ JSON.stringify($('Attribution Calculator').first().json, null, 2) }}"
              }
            ]
          },
          "jsonOutput": true,
          "options": {
            "temperature": 0.3
          }
        },
        "id": "ai-insights-generator",
        "name": "AI Insights Generator",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "// Dashboard Report Builder\n// Generates formatted reports for different channels\n\nconst metrics = $('Cross-Workflow Aggregator').first().json;\nconst attribution = $('Attribution Calculator').first().json;\nconst insights = $('AI Insights Generator').first().json;\n\nconst report = {\n  generatedAt: new Date().toISOString(),\n  period: metrics.period,\n  \n  // Summary section\n  summary: {\n    executiveSummary: insights.executiveSummary,\n    keyHighlights: insights.keyHighlights\n  },\n  \n  // Metrics dashboard\n  dashboard: {\n    acquisition: {\n      visitors: { value: metrics.acquisition.visitors, change: metrics.changes.visitors },\n      newUsers: { value: metrics.acquisition.newUsers },\n      bounceRate: { value: metrics.acquisition.bounceRate + '%' }\n    },\n    activation: {\n      signups: { value: metrics.activation.signups, change: metrics.changes.signups },\n      activationRate: { value: metrics.activation.activationRate + '%' }\n    },\n    revenue: {\n      mrr: { value: '$' + metrics.revenue.mrr.toLocaleString(), change: metrics.changes.mrr },\n      arr: { value: '$' + metrics.revenue.arr.toLocaleString() }\n    },\n    retention: {\n      churnRate: { value: metrics.retention.churnRate + '%', change: metrics.changes.churnRate }\n    }\n  },\n  \n  // Funnel analysis\n  funnel: metrics.funnel,\n  \n  // Attribution breakdown\n  attribution: {\n    recommended: 'linear', // AI could recommend best model\n    models: attribution\n  },\n  \n  // Alerts and recommendations\n  alerts: insights.alerts,\n  opportunities: insights.opportunities,\n  recommendations: insights.weeklyGoals,\n  \n  // Predictions\n  predictions: insights.predictiveInsights\n};\n\nreturn [{ json: report }];"
        },
        "id": "report-builder",
        "name": "Dashboard Report Builder",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1250,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#analytics",
          "text": "=ðŸ“Š *Daily Analytics Dashboard*\n_{{ new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) }}_\n\n*Executive Summary:*\n{{ $json.summary.executiveSummary }}\n\n*Key Metrics:*\nâ€¢ Visitors: {{ $json.dashboard.acquisition.visitors.value }} ({{ $json.dashboard.acquisition.visitors.change }})\nâ€¢ Signups: {{ $json.dashboard.activation.signups.value }} ({{ $json.dashboard.activation.signups.change }})\nâ€¢ MRR: {{ $json.dashboard.revenue.mrr.value }} ({{ $json.dashboard.revenue.mrr.change }})\nâ€¢ Churn Rate: {{ $json.dashboard.retention.churnRate.value }} ({{ $json.dashboard.retention.churnRate.change }})\n\n*Funnel Performance:*\n{{ $json.funnel.steps.map(s => `â€¢ ${s.name}: ${s.count} (${s.rate}%)`).join('\\n') }}\n\n*ðŸš¨ Alerts:*\n{{ $json.alerts?.slice(0, 3).map(a => `[${a.severity.toUpperCase()}] ${a.message}`).join('\\n') || 'No critical alerts' }}\n\n*ðŸ’¡ Opportunities:*\n{{ $json.opportunities?.slice(0, 2).map((o, i) => `${i+1}. ${o.area}: ${o.action}`).join('\\n') || 'See full report' }}",
          "otherOptions": {}
        },
        "id": "slack-daily-report",
        "name": "Slack Daily Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1500,
          400
        ]
      },
      {
        "parameters": {
          "to": "={{ $env.EXEC_EMAIL_LIST }}",
          "subject": "=Weekly Analytics Report - {{ new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) }}",
          "emailType": "html",
          "html": "=<html>\n<body style=\"font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto;\">\n  <h1 style=\"color: #333;\">ðŸ“Š Weekly Analytics Report</h1>\n  <p style=\"color: #666;\">{{ $json.period.start }} - {{ $json.period.end }}</p>\n  \n  <h2>Executive Summary</h2>\n  <p>{{ $json.summary.executiveSummary }}</p>\n  \n  <h2>Key Metrics</h2>\n  <table style=\"width: 100%; border-collapse: collapse;\">\n    <tr style=\"background: #f5f5f5;\">\n      <th style=\"padding: 10px; text-align: left;\">Metric</th>\n      <th style=\"padding: 10px; text-align: right;\">Value</th>\n      <th style=\"padding: 10px; text-align: right;\">Change</th>\n    </tr>\n    <tr>\n      <td style=\"padding: 10px;\">Visitors</td>\n      <td style=\"padding: 10px; text-align: right;\">{{ $json.dashboard.acquisition.visitors.value }}</td>\n      <td style=\"padding: 10px; text-align: right; color: green;\">{{ $json.dashboard.acquisition.visitors.change }}</td>\n    </tr>\n    <tr style=\"background: #fafafa;\">\n      <td style=\"padding: 10px;\">Signups</td>\n      <td style=\"padding: 10px; text-align: right;\">{{ $json.dashboard.activation.signups.value }}</td>\n      <td style=\"padding: 10px; text-align: right; color: green;\">{{ $json.dashboard.activation.signups.change }}</td>\n    </tr>\n    <tr>\n      <td style=\"padding: 10px;\">MRR</td>\n      <td style=\"padding: 10px; text-align: right;\">{{ $json.dashboard.revenue.mrr.value }}</td>\n      <td style=\"padding: 10px; text-align: right; color: green;\">{{ $json.dashboard.revenue.mrr.change }}</td>\n    </tr>\n  </table>\n  \n  <h2>Alerts</h2>\n  <ul>\n  {{ $json.alerts?.map(a => `<li><strong>[${a.severity}]</strong> ${a.message}</li>`).join('') || '<li>No alerts this week</li>' }}\n  </ul>\n  \n  <h2>Recommendations</h2>\n  <ol>\n  {{ $json.recommendations?.map(r => `<li>${r.goal}</li>`).join('') || '<li>Continue current trajectory</li>' }}\n  </ol>\n  \n  <hr>\n  <p style=\"color: #999; font-size: 12px;\">Generated by Grain Unified Analytics Dashboard</p>\n</body>\n</html>",
          "options": {}
        },
        "id": "email-weekly-report",
        "name": "Email Weekly Report",
        "type": "n8n-nodes-base.sendEmail",
        "typeVersion": 2.1,
        "position": [
          1500,
          600
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.ANALYTICS_DASHBOARD_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Daily Metrics",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "date": "={{ $json.generatedAt }}",
              "visitors": "={{ $json.dashboard.acquisition.visitors.value }}",
              "signups": "={{ $json.dashboard.activation.signups.value }}",
              "mrr": "={{ $('Cross-Workflow Aggregator').first().json.revenue.mrr }}",
              "arr": "={{ $('Cross-Workflow Aggregator').first().json.revenue.arr }}",
              "churn_rate": "={{ $('Cross-Workflow Aggregator').first().json.retention.churnRate }}",
              "dau": "={{ $('Cross-Workflow Aggregator').first().json.engagement.dau }}",
              "funnel_conversion": "={{ $json.funnel.overallConversion }}"
            }
          }
        },
        "id": "log-to-sheets",
        "name": "Log to Google Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1500,
          800
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "has-critical-alerts",
                "leftValue": "={{ $json.alerts?.filter(a => a.severity === 'critical').length }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ]
          }
        },
        "id": "check-alerts",
        "name": "Has Critical Alerts?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.1,
        "position": [
          1500,
          1000
        ]
      },
      {
        "parameters": {
          "channel": "#alerts",
          "text": "=ðŸš¨ *CRITICAL ANALYTICS ALERT*\n\n{{ $json.alerts.filter(a => a.severity === 'critical').map(a => {\n  return `*${a.area}*\\n${a.message}\\n_Recommendation: ${a.recommendation}_`;\n}).join('\\n\\n---\\n\\n') }}",
          "otherOptions": {}
        },
        "id": "slack-critical-alert",
        "name": "Slack Critical Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1750,
          950
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ JSON.stringify($json) }}"
        },
        "id": "webhook-response",
        "name": "API Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          1750,
          500
        ]
      }
    ],
    "connections": {
      "Dashboard API": {
        "main": [
          [
            {
              "node": "Fetch PostHog Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Mixpanel Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Amplitude Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch HubSpot Analytics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Report Trigger": {
        "main": [
          [
            {
              "node": "Fetch PostHog Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Mixpanel Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Amplitude Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch HubSpot Analytics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Weekly Report Trigger": {
        "main": [
          [
            {
              "node": "Fetch PostHog Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Mixpanel Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Amplitude Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch HubSpot Analytics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch PostHog Data": {
        "main": [
          [
            {
              "node": "Cross-Workflow Aggregator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Mixpanel Data": {
        "main": [
          [
            {
              "node": "Cross-Workflow Aggregator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Amplitude Data": {
        "main": [
          [
            {
              "node": "Cross-Workflow Aggregator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch HubSpot Analytics": {
        "main": [
          [
            {
              "node": "Cross-Workflow Aggregator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cross-Workflow Aggregator": {
        "main": [
          [
            {
              "node": "Attribution Calculator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Attribution Calculator": {
        "main": [
          [
            {
              "node": "AI Insights Generator",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Insights Generator": {
        "main": [
          [
            {
              "node": "Dashboard Report Builder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Dashboard Report Builder": {
        "main": [
          [
            {
              "node": "Slack Daily Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Email Weekly Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log to Google Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Has Critical Alerts?",
              "type": "main",
              "index": 0
            },
            {
              "node": "API Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Has Critical Alerts?": {
        "main": [
          [
            {
              "node": "Slack Critical Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "grain-saas-unified-analytics"
    },
    "pinData": {},
    "versionId": "1.0.0",
    "triggerCount": 3,
    "tags": [
      {
        "name": "Analytics",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Dashboard",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Attribution",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "AI",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      },
      {
        "name": "Grain",
        "createdAt": "2026-01-07T00:00:00.000Z",
        "updatedAt": "2026-01-07T00:00:00.000Z"
      }
    ]
  },
  {
    "name": "Grain Video Performance Tracker v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 12
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Every 12 Hours",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          300
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Video_Tracking"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-videos",
        "name": "Get Video List",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "active-tracking",
                "leftValue": "={{ $json.tracking_active }}",
                "rightValue": "TRUE",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-active",
        "name": "Filter Active Videos",
        "type": "n8n-nodes-base.filter",
        "position": [
          650,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "batchSize": 1,
          "options": {}
        },
        "id": "loop-videos",
        "name": "Process Each Video",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          850,
          300
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "rules": {
            "rules": [
              {
                "outputKey": "youtube",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.platform }}",
                      "rightValue": "youtube",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "tiktok",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.platform }}",
                      "rightValue": "tiktok",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              },
              {
                "outputKey": "instagram",
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.platform }}",
                      "rightValue": "instagram",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                }
              }
            ]
          },
          "options": {}
        },
        "id": "route-platform",
        "name": "Route by Platform",
        "type": "n8n-nodes-base.switch",
        "position": [
          1050,
          300
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://www.googleapis.com/youtube/v3/videos",
          "authentication": "genericCredentialType",
          "genericAuthType": "oAuth2Api",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "id",
                "value": "={{ $json.video_id }}"
              },
              {
                "name": "part",
                "value": "statistics,snippet"
              }
            ]
          },
          "options": {}
        },
        "id": "youtube-stats",
        "name": "Get YouTube Stats",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1250,
          100
        ],
        "typeVersion": 4.2,
        "credentials": {
          "oAuth2Api": {
            "id": "",
            "name": "YouTube OAuth2"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse YouTube API response\nconst item = $input.item.json.items?.[0];\n\nif (!item) {\n  return { json: { error: 'Video not found' } };\n}\n\nconst stats = item.statistics;\nconst snippet = item.snippet;\n\nreturn {\n  json: {\n    ...$input.item.json,\n    platform: 'youtube',\n    views: parseInt(stats.viewCount) || 0,\n    likes: parseInt(stats.likeCount) || 0,\n    comments: parseInt(stats.commentCount) || 0,\n    title: snippet.title,\n    published_at: snippet.publishedAt,\n    fetched_at: new Date().toISOString()\n  }\n};"
        },
        "id": "parse-youtube",
        "name": "Parse YouTube Data",
        "type": "n8n-nodes-base.code",
        "position": [
          1450,
          100
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://graph.facebook.com/v18.0/{{ $json.video_id }}/insights",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "metric",
                "value": "plays,reach,likes,comments,shares"
              },
              {
                "name": "access_token",
                "value": "={{ $env.META_ACCESS_TOKEN }}"
              }
            ]
          },
          "options": {}
        },
        "id": "instagram-stats",
        "name": "Get Instagram Reels Stats",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1250,
          300
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "// Parse Instagram insights response\nconst data = $input.item.json.data || [];\n\nconst metrics = {};\ndata.forEach(item => {\n  metrics[item.name] = item.values?.[0]?.value || 0;\n});\n\nreturn {\n  json: {\n    ...$input.item.json,\n    platform: 'instagram',\n    views: metrics.plays || 0,\n    reach: metrics.reach || 0,\n    likes: metrics.likes || 0,\n    comments: metrics.comments || 0,\n    shares: metrics.shares || 0,\n    fetched_at: new Date().toISOString()\n  }\n};"
        },
        "id": "parse-instagram",
        "name": "Parse Instagram Data",
        "type": "n8n-nodes-base.code",
        "position": [
          1450,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://open.tiktokapis.com/v2/video/query/",
          "authentication": "genericCredentialType",
          "genericAuthType": "oAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"filters\": {\n    \"video_ids\": [\"{{ $json.video_id }}\"]\n  },\n  \"fields\": [\"id\", \"title\", \"view_count\", \"like_count\", \"comment_count\", \"share_count\"]\n}",
          "options": {}
        },
        "id": "tiktok-stats",
        "name": "Get TikTok Stats",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1250,
          500
        ],
        "typeVersion": 4.2,
        "credentials": {
          "oAuth2Api": {
            "id": "",
            "name": "TikTok OAuth2"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse TikTok API response\nconst video = $input.item.json.data?.videos?.[0];\n\nif (!video) {\n  return { json: { error: 'TikTok video not found' } };\n}\n\nreturn {\n  json: {\n    ...$input.item.json,\n    platform: 'tiktok',\n    views: video.view_count || 0,\n    likes: video.like_count || 0,\n    comments: video.comment_count || 0,\n    shares: video.share_count || 0,\n    title: video.title,\n    fetched_at: new Date().toISOString()\n  }\n};"
        },
        "id": "parse-tiktok",
        "name": "Parse TikTok Data",
        "type": "n8n-nodes-base.code",
        "position": [
          1450,
          500
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "mode": "combine",
          "mergeByFields": {
            "values": [
              {
                "field1": "video_id",
                "field2": "video_id"
              }
            ]
          },
          "options": {}
        },
        "id": "merge-stats",
        "name": "Merge All Stats",
        "type": "n8n-nodes-base.merge",
        "position": [
          1650,
          300
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "jsCode": "// Calculate performance metrics and trends\nconst current = $input.item.json;\n\n// Get previous data from workflow static data or default\nconst previous = $input.item.json.previous_views || 0;\nconst previousLikes = $input.item.json.previous_likes || 0;\n\n// Calculate growth\nconst viewGrowth = previous > 0 ? ((current.views - previous) / previous * 100).toFixed(2) : 0;\nconst engagementRate = current.views > 0 ? ((current.likes + current.comments) / current.views * 100).toFixed(2) : 0;\n\n// Determine performance level\nlet performanceLevel = 'LOW';\nif (engagementRate > 10) performanceLevel = 'VIRAL';\nelse if (engagementRate > 5) performanceLevel = 'HIGH';\nelse if (engagementRate > 2) performanceLevel = 'MEDIUM';\n\n// Calculate velocity (views per hour since publish)\nconst publishDate = new Date(current.published_at);\nconst hoursSincePublish = Math.max(1, (Date.now() - publishDate.getTime()) / (1000 * 60 * 60));\nconst viewsPerHour = (current.views / hoursSincePublish).toFixed(2);\n\nreturn {\n  json: {\n    ...current,\n    view_growth_percent: viewGrowth,\n    engagement_rate: engagementRate,\n    performance_level: performanceLevel,\n    views_per_hour: viewsPerHour,\n    hours_since_publish: hoursSincePublish.toFixed(1)\n  }\n};"
        },
        "id": "calculate-metrics",
        "name": "Calculate Performance Metrics",
        "type": "n8n-nodes-base.code",
        "position": [
          1850,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen bir video performans analistisin. Verilen metriklere gore video performansini analiz et ve onerilerde bulun.\n\nJSON formatinda dondur:\n{\n  \"performance_summary\": \"1-2 cumle ozet\",\n  \"strengths\": [\"guclu yonler\"],\n  \"improvements\": [\"gelistirilecek alanlar\"],\n  \"recommended_actions\": [\"yapilmasi gerekenler\"],\n  \"content_suggestions\": \"benzer basarili icerik onerileri\",\n  \"best_posting_time\": \"onerilen paylasim zamani\"\n}"
              },
              {
                "role": "user",
                "content": "Video Metrikleri:\nPlatform: {{ $json.platform }}\nBaslik: {{ $json.title }}\nGoruntulenme: {{ $json.views }}\nBegeni: {{ $json.likes }}\nYorum: {{ $json.comments }}\nEngagement Rate: {{ $json.engagement_rate }}%\nPerformans Seviyesi: {{ $json.performance_level }}\nSaat basi goruntulenme: {{ $json.views_per_hour }}\nYayindan bu yana (saat): {{ $json.hours_since_publish }}"
              }
            ]
          },
          "options": {
            "temperature": 0.5
          }
        },
        "id": "ai-analysis",
        "name": "AI Performance Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2050,
          300
        ],
        "typeVersion": 1.4,
        "credentials": {
          "openAiApi": {
            "id": "",
            "name": "OpenAI"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Parse AI analysis\nconst aiResponse = $input.item.json.message?.content || $input.item.json.content;\nlet analysis;\n\ntry {\n  analysis = JSON.parse(aiResponse);\n} catch (e) {\n  analysis = {\n    performance_summary: 'Analiz yapilamadi',\n    strengths: [],\n    improvements: [],\n    recommended_actions: [],\n    content_suggestions: '',\n    best_posting_time: ''\n  };\n}\n\nreturn {\n  json: {\n    ...$input.item.json,\n    ai_summary: analysis.performance_summary,\n    ai_strengths: analysis.strengths?.join(', ') || '',\n    ai_improvements: analysis.improvements?.join(', ') || '',\n    ai_actions: analysis.recommended_actions?.join(', ') || '',\n    ai_content_suggestions: analysis.content_suggestions,\n    ai_best_time: analysis.best_posting_time\n  }\n};"
        },
        "id": "parse-analysis",
        "name": "Parse AI Analysis",
        "type": "n8n-nodes-base.code",
        "position": [
          2250,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Performance_History"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "video_id": "={{ $json.video_id }}",
              "platform": "={{ $json.platform }}",
              "title": "={{ $json.title }}",
              "views": "={{ $json.views }}",
              "likes": "={{ $json.likes }}",
              "comments": "={{ $json.comments }}",
              "shares": "={{ $json.shares || 0 }}",
              "engagement_rate": "={{ $json.engagement_rate }}",
              "performance_level": "={{ $json.performance_level }}",
              "views_per_hour": "={{ $json.views_per_hour }}",
              "ai_summary": "={{ $json.ai_summary }}",
              "fetched_at": "={{ $json.fetched_at }}"
            }
          }
        },
        "id": "log-performance",
        "name": "Log Performance History",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2450,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Video_Tracking"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "last_views": "={{ $json.views }}",
              "last_likes": "={{ $json.likes }}",
              "last_engagement": "={{ $json.engagement_rate }}",
              "performance_level": "={{ $json.performance_level }}",
              "last_check": "={{ $json.fetched_at }}",
              "ai_summary": "={{ $json.ai_summary }}"
            }
          },
          "options": {}
        },
        "id": "update-tracking",
        "name": "Update Video Tracking",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2650,
          300
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "viral-check",
                "leftValue": "={{ $json.performance_level }}",
                "rightValue": "VIRAL",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "if-viral",
        "name": "If Viral",
        "type": "n8n-nodes-base.if",
        "position": [
          2850,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#content-wins",
          "text": "=*VIRAL ICERIK ALARMII*\n\n*Platform:* {{ $json.platform }}\n*Baslik:* {{ $json.title }}\n\n*Metrikler:*\n- Goruntulenme: {{ $json.views }}\n- Begeni: {{ $json.likes }}\n- Yorum: {{ $json.comments }}\n- Engagement: {{ $json.engagement_rate }}%\n- Saat basi izlenme: {{ $json.views_per_hour }}\n\n*AI Analizi:* {{ $json.ai_summary }}\n\n*Oneriler:* {{ $json.ai_actions }}",
          "otherOptions": {}
        },
        "id": "slack-viral-alert",
        "name": "Slack Viral Alert",
        "type": "n8n-nodes-base.slack",
        "position": [
          3050,
          200
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "weeks",
                "weeksInterval": 1
              }
            ]
          }
        },
        "id": "weekly-report-trigger",
        "name": "Weekly Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          250,
          600
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Performance_History"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-weekly-data",
        "name": "Get Weekly Performance Data",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          600
        ],
        "typeVersion": 4.2,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Aggregate weekly performance\nconst data = $input.all();\nconst oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n\nconst weeklyData = data.filter(item => {\n  const fetchDate = new Date(item.json.fetched_at);\n  return fetchDate >= oneWeekAgo;\n});\n\nconst summary = {\n  total_videos: new Set(weeklyData.map(d => d.json.video_id)).size,\n  total_views: weeklyData.reduce((sum, d) => sum + (parseInt(d.json.views) || 0), 0),\n  total_likes: weeklyData.reduce((sum, d) => sum + (parseInt(d.json.likes) || 0), 0),\n  total_comments: weeklyData.reduce((sum, d) => sum + (parseInt(d.json.comments) || 0), 0),\n  avg_engagement: (weeklyData.reduce((sum, d) => sum + (parseFloat(d.json.engagement_rate) || 0), 0) / weeklyData.length).toFixed(2),\n  viral_count: weeklyData.filter(d => d.json.performance_level === 'VIRAL').length,\n  high_count: weeklyData.filter(d => d.json.performance_level === 'HIGH').length,\n  top_video: weeklyData.sort((a, b) => (b.json.views || 0) - (a.json.views || 0))[0]?.json\n};\n\nreturn { json: summary };"
        },
        "id": "aggregate-weekly",
        "name": "Aggregate Weekly Stats",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#weekly-reports",
          "text": "=*HAFTALIK VIDEO PERFORMANS RAPORU*\n\n*Genel Bakis:*\n- Toplam Video: {{ $json.total_videos }}\n- Toplam Izlenme: {{ $json.total_views }}\n- Toplam Begeni: {{ $json.total_likes }}\n- Toplam Yorum: {{ $json.total_comments }}\n- Ort. Engagement: {{ $json.avg_engagement }}%\n\n*Performans Dagilimi:*\n- VIRAL: {{ $json.viral_count }}\n- HIGH: {{ $json.high_count }}\n\n*En Iyi Video:*\n{{ $json.top_video?.title }} ({{ $json.top_video?.views }} izlenme)",
          "otherOptions": {}
        },
        "id": "slack-weekly-report",
        "name": "Send Weekly Report",
        "type": "n8n-nodes-base.slack",
        "position": [
          850,
          600
        ],
        "typeVersion": 2.1,
        "credentials": {
          "slackApi": {
            "id": "",
            "name": "Slack"
          }
        }
      }
    ],
    "connections": {
      "Every 12 Hours": {
        "main": [
          [
            {
              "node": "Get Video List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Video List": {
        "main": [
          [
            {
              "node": "Filter Active Videos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Active Videos": {
        "main": [
          [
            {
              "node": "Process Each Video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Each Video": {
        "main": [
          [
            {
              "node": "Route by Platform",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Platform": {
        "main": [
          [
            {
              "node": "Get YouTube Stats",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get TikTok Stats",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Instagram Reels Stats",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get YouTube Stats": {
        "main": [
          [
            {
              "node": "Parse YouTube Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse YouTube Data": {
        "main": [
          [
            {
              "node": "Merge All Stats",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Instagram Reels Stats": {
        "main": [
          [
            {
              "node": "Parse Instagram Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Instagram Data": {
        "main": [
          [
            {
              "node": "Merge All Stats",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Get TikTok Stats": {
        "main": [
          [
            {
              "node": "Parse TikTok Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse TikTok Data": {
        "main": [
          [
            {
              "node": "Merge All Stats",
              "type": "main",
              "index": 2
            }
          ]
        ]
      },
      "Merge All Stats": {
        "main": [
          [
            {
              "node": "Calculate Performance Metrics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Performance Metrics": {
        "main": [
          [
            {
              "node": "AI Performance Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Performance Analysis": {
        "main": [
          [
            {
              "node": "Parse AI Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse AI Analysis": {
        "main": [
          [
            {
              "node": "Log Performance History",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Performance History": {
        "main": [
          [
            {
              "node": "Update Video Tracking",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Video Tracking": {
        "main": [
          [
            {
              "node": "If Viral",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Viral": {
        "main": [
          [
            {
              "node": "Slack Viral Alert",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Weekly Report": {
        "main": [
          [
            {
              "node": "Get Weekly Performance Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Weekly Performance Data": {
        "main": [
          [
            {
              "node": "Aggregate Weekly Stats",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Weekly Stats": {
        "main": [
          [
            {
              "node": "Send Weekly Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "grain-automation"
      },
      {
        "name": "video-analytics"
      },
      {
        "name": "performance"
      }
    ],
    "meta": {
      "templateId": "grain-vpt-v1",
      "version": "1.0.0",
      "description": "Track video performance across YouTube, TikTok, Instagram. AI analysis, viral alerts, weekly reports.",
      "requiredCredentials": [
        "Google Sheets OAuth2",
        "OpenAI API",
        "YouTube OAuth2",
        "TikTok OAuth2",
        "Meta Access Token",
        "Slack"
      ],
      "requiredEnvVars": [
        "META_ACCESS_TOKEN"
      ]
    }
  },
  {
    "name": "Grain Webinar & Event Automation v1",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "webinar-registration",
          "options": {}
        },
        "id": "registration-webhook",
        "name": "Registration Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "webinar-registration"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 1
              }
            ]
          }
        },
        "id": "hourly-check",
        "name": "Hourly Event Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          250,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "// Parse registration data\nconst registration = $input.first().json.body;\n\nconst registrant = {\n  registrationId: `REG-${Date.now().toString(36).toUpperCase()}`,\n  eventId: registration.eventId || registration.webinarId,\n  eventName: registration.eventName,\n  eventDate: registration.eventDate,\n  eventTime: registration.eventTime,\n  timezone: registration.timezone || 'UTC',\n  firstName: registration.firstName,\n  lastName: registration.lastName,\n  email: registration.email,\n  company: registration.company,\n  jobTitle: registration.jobTitle,\n  phone: registration.phone,\n  source: registration.source || 'website',\n  utmParams: registration.utmParams || {},\n  customFields: registration.customFields || {},\n  registeredAt: new Date().toISOString(),\n  status: 'registered'\n};\n\nreturn [{ json: registrant }];"
        },
        "id": "parse-registration",
        "name": "Parse Registration",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.CRM_API_URL }}/contacts/upsert",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"email\": \"{{ $json.email }}\",\n  \"first_name\": \"{{ $json.firstName }}\",\n  \"last_name\": \"{{ $json.lastName }}\",\n  \"company\": \"{{ $json.company }}\",\n  \"job_title\": \"{{ $json.jobTitle }}\",\n  \"phone\": \"{{ $json.phone }}\",\n  \"source\": \"webinar_registration\",\n  \"tags\": [\"webinar_registrant\", \"{{ $json.eventId }}\"]\n}",
          "options": {}
        },
        "id": "upsert-contact",
        "name": "Upsert CRM Contact",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          200
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "crm-api-key",
            "name": "CRM API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.WEBINAR_API_URL }}/registrations",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json) }}",
          "options": {}
        },
        "id": "create-registration",
        "name": "Create Webinar Registration",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "webinar-api-key",
            "name": "Webinar API Key"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "=You're registered for {{ $json.eventName }}!",
          "message": "=Hi {{ $json.firstName }},\n\nThank you for registering for {{ $json.eventName }}!\n\nðŸ“… **Date:** {{ $json.eventDate }}\nðŸ• **Time:** {{ $json.eventTime }} ({{ $json.timezone }})\n\n**Add to Calendar:**\n[Google Calendar Link] | [Outlook Link] | [iCal]\n\n**Your unique join link will be sent 1 hour before the event.**\n\nWhat to expect:\nâ€¢ Expert insights and actionable strategies\nâ€¢ Live Q&A session\nâ€¢ Exclusive resources for attendees\n\nCan't make it live? No worries - we'll send you the recording!\n\nSee you there!\n\nBest regards,\nThe {{ $vars.COMPANY_NAME }} Team",
          "options": {
            "replyTo": "={{ $vars.EVENTS_EMAIL }}"
          }
        },
        "id": "send-confirmation",
        "name": "Send Confirmation Email",
        "type": "n8n-nodes-base.emailSend",
        "typeVersion": 2.1,
        "position": [
          1000,
          300
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-credential",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.EVENTS_SLACK_CHANNEL }}",
          "text": "=ðŸŽ‰ *New Webinar Registration*\n\n*Event:* {{ $json.eventName }}\n*Registrant:* {{ $json.firstName }} {{ $json.lastName }}\n*Email:* {{ $json.email }}\n*Company:* {{ $json.company || 'N/A' }}\n*Title:* {{ $json.jobTitle || 'N/A' }}\n*Source:* {{ $json.source }}",
          "otherOptions": {}
        },
        "id": "notify-registration",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1000,
          500
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $vars.WEBINAR_API_URL }}/events/upcoming",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-upcoming",
        "name": "Fetch Upcoming Events",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "webinar-api-key",
            "name": "Webinar API Key"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Identify events needing reminders\nconst events = $input.first().json.events || [];\nconst now = new Date();\n\nconst reminders = [];\n\nevents.forEach(event => {\n  const eventDate = new Date(event.start_time);\n  const hoursUntil = (eventDate - now) / (1000 * 60 * 60);\n  \n  // 24-hour reminder\n  if (hoursUntil > 23 && hoursUntil <= 24) {\n    reminders.push({\n      type: '24h',\n      event,\n      registrants: event.registrants,\n      hoursUntil: Math.round(hoursUntil)\n    });\n  }\n  \n  // 1-hour reminder with join link\n  if (hoursUntil > 0.5 && hoursUntil <= 1) {\n    reminders.push({\n      type: '1h',\n      event,\n      registrants: event.registrants,\n      hoursUntil: Math.round(hoursUntil * 60) / 60,\n      includeJoinLink: true\n    });\n  }\n  \n  // Post-event follow-up (1 hour after)\n  if (hoursUntil < 0 && hoursUntil >= -1) {\n    reminders.push({\n      type: 'follow_up',\n      event,\n      registrants: event.registrants,\n      attendees: event.attendees || []\n    });\n  }\n});\n\nreturn reminders.map(r => ({ json: r }));"
        },
        "id": "check-reminders",
        "name": "Check Reminder Triggers",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          600
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "24h-reminder",
                "leftValue": "={{ $json.type }}",
                "rightValue": "24h",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "route-24h",
        "name": "24h Reminder?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.EMAIL_API_URL }}/campaigns/send",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"template_id\": \"{{ $vars.REMINDER_24H_TEMPLATE }}\",\n  \"recipients\": {{ JSON.stringify($json.registrants.map(r => ({ email: r.email, name: r.firstName }))) }},\n  \"variables\": {\n    \"event_name\": \"{{ $json.event.name }}\",\n    \"event_date\": \"{{ $json.event.start_time }}\",\n    \"event_description\": \"{{ $json.event.description }}\"\n  }\n}",
          "options": {}
        },
        "id": "send-24h-reminder",
        "name": "Send 24h Reminder",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "email-api-key",
            "name": "Email API Key"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "1h-reminder",
                "leftValue": "={{ $json.type }}",
                "rightValue": "1h",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "route-1h",
        "name": "1h Reminder?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          800
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.EMAIL_API_URL }}/campaigns/send",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"template_id\": \"{{ $vars.REMINDER_1H_TEMPLATE }}\",\n  \"recipients\": {{ JSON.stringify($json.registrants.map(r => ({ email: r.email, name: r.firstName, join_link: r.unique_join_link }))) }},\n  \"variables\": {\n    \"event_name\": \"{{ $json.event.name }}\",\n    \"join_url\": \"{{ $json.event.join_url }}\"\n  }\n}",
          "options": {}
        },
        "id": "send-1h-reminder",
        "name": "Send 1h Reminder + Link",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          800
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "email-api-key",
            "name": "Email API Key"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "follow-up",
                "leftValue": "={{ $json.type }}",
                "rightValue": "follow_up",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "route-followup",
        "name": "Follow-up?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          1000
        ]
      },
      {
        "parameters": {
          "jsCode": "// Segment attendees vs no-shows\nconst data = $input.first().json;\nconst registrants = data.registrants || [];\nconst attendees = data.attendees || [];\nconst attendeeEmails = new Set(attendees.map(a => a.email?.toLowerCase()));\n\nconst attended = registrants.filter(r => attendeeEmails.has(r.email?.toLowerCase()));\nconst noShows = registrants.filter(r => !attendeeEmails.has(r.email?.toLowerCase()));\n\nreturn [{\n  json: {\n    event: data.event,\n    attended,\n    noShows,\n    attendanceRate: registrants.length > 0 \n      ? Math.round((attended.length / registrants.length) * 100) \n      : 0\n  }\n}];"
        },
        "id": "segment-attendees",
        "name": "Segment Attendees",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1250,
          1000
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.EMAIL_API_URL }}/campaigns/send",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"template_id\": \"{{ $vars.FOLLOWUP_ATTENDED_TEMPLATE }}\",\n  \"recipients\": {{ JSON.stringify($json.attended.map(r => ({ email: r.email, name: r.firstName }))) }},\n  \"variables\": {\n    \"event_name\": \"{{ $json.event.name }}\",\n    \"recording_url\": \"{{ $json.event.recording_url }}\",\n    \"resources_url\": \"{{ $json.event.resources_url }}\"\n  }\n}",
          "options": {}
        },
        "id": "send-attended-followup",
        "name": "Send Attendee Follow-up",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          900
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "email-api-key",
            "name": "Email API Key"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $vars.EMAIL_API_URL }}/campaigns/send",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"template_id\": \"{{ $vars.FOLLOWUP_NOSHOW_TEMPLATE }}\",\n  \"recipients\": {{ JSON.stringify($json.noShows.map(r => ({ email: r.email, name: r.firstName }))) }},\n  \"variables\": {\n    \"event_name\": \"{{ $json.event.name }}\",\n    \"recording_url\": \"{{ $json.event.recording_url }}\"\n  }\n}",
          "options": {}
        },
        "id": "send-noshow-followup",
        "name": "Send No-Show Follow-up",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          1100
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "email-api-key",
            "name": "Email API Key"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $vars.EVENTS_SLACK_CHANNEL }}",
          "text": "=ðŸ“Š *Webinar Completed - {{ $json.event.name }}*\n\n*Attendance:*\nâ€¢ Registered: {{ $json.attended.length + $json.noShows.length }}\nâ€¢ Attended: {{ $json.attended.length }}\nâ€¢ No-shows: {{ $json.noShows.length }}\nâ€¢ Attendance Rate: {{ $json.attendanceRate }}%\n\n_Follow-up emails sent to both attendees and no-shows_",
          "otherOptions": {}
        },
        "id": "notify-complete",
        "name": "Notify Event Complete",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.2,
        "position": [
          1750,
          1000
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-credential",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "={{ $vars.EVENTS_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Registrations",
            "mode": "list",
            "cachedResultName": "Registrations"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Registration ID": "={{ $('Parse Registration').first().json.registrationId }}",
              "Event": "={{ $('Parse Registration').first().json.eventName }}",
              "Name": "={{ $('Parse Registration').first().json.firstName }} {{ $('Parse Registration').first().json.lastName }}",
              "Email": "={{ $('Parse Registration').first().json.email }}",
              "Company": "={{ $('Parse Registration').first().json.company }}",
              "Source": "={{ $('Parse Registration').first().json.source }}",
              "Registered At": "={{ $('Parse Registration').first().json.registeredAt }}"
            }
          },
          "options": {}
        },
        "id": "log-registration",
        "name": "Log Registration",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.5,
        "position": [
          1250,
          300
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-credential",
            "name": "Google Sheets OAuth2"
          }
        }
      }
    ],
    "connections": {
      "Registration Webhook": {
        "main": [
          [
            {
              "node": "Parse Registration",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Registration": {
        "main": [
          [
            {
              "node": "Upsert CRM Contact",
              "type": "main",
              "index": 0
            },
            {
              "node": "Create Webinar Registration",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Webinar Registration": {
        "main": [
          [
            {
              "node": "Send Confirmation Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Registration",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Hourly Event Check": {
        "main": [
          [
            {
              "node": "Fetch Upcoming Events",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Upcoming Events": {
        "main": [
          [
            {
              "node": "Check Reminder Triggers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Reminder Triggers": {
        "main": [
          [
            {
              "node": "24h Reminder?",
              "type": "main",
              "index": 0
            },
            {
              "node": "1h Reminder?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Follow-up?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "24h Reminder?": {
        "main": [
          [
            {
              "node": "Send 24h Reminder",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "1h Reminder?": {
        "main": [
          [
            {
              "node": "Send 1h Reminder + Link",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Follow-up?": {
        "main": [
          [
            {
              "node": "Segment Attendees",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Segment Attendees": {
        "main": [
          [
            {
              "node": "Send Attendee Follow-up",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send No-Show Follow-up",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Attendee Follow-up": {
        "main": [
          [
            {
              "node": "Notify Event Complete",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send No-Show Follow-up": {
        "main": [
          [
            {
              "node": "Notify Event Complete",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "id": "events",
        "name": "events"
      },
      {
        "id": "webinar",
        "name": "webinar"
      },
      {
        "id": "marketing",
        "name": "marketing"
      },
      {
        "id": "automation",
        "name": "automation"
      }
    ],
    "triggerCount": 2,
    "updatedAt": "2026-01-07T00:00:00.000Z",
    "versionId": "1"
  },
  {
    "count": 72,
    "lastUpdated": "2026-01-07",
    "categories": {
      "hospitality": [
        "Grain_Dynamic_Pricing_Engine_v1.json",
        "Grain_Booking_Channel_Sync_v1.json",
        "Grain_Housekeeping_Operations_v1.json",
        "Grain_Guest_Communication_Journey_v1.json",
        "Grain_Review_Management_AI_v1.json"
      ],
      "agency": [
        "Grain_Campaign_Performance_Monitor_v1.json",
        "Grain_Client_Onboarding_Automation_v1.json",
        "Grain_Client_Reporting_Dashboard_v1.json"
      ],
      "marketing": [
        "Grain_Email_Marketing_Automation_v1.json",
        "Grain_Omnichannel_Marketing_Hub_v1.json",
        "Grain_Influencer_Marketing_Hub_v1.json",
        "Grain_SEO_Content_Pipeline_v1.json",
        "Grain_Multi_Platform_Publisher_v1.json",
        "Grain_Multi_Platform_Publisher_v2.json"
      ],
      "ai_content": [
        "Grain_Multi_Agent_Content_System_v1.json",
        "Grain_AI_Copywriting_Studio_v1.json",
        "Grain_AI_Visual_Content_Generator_v1.json",
        "Grain_Agentic_AI_Orchestrator_v1.json",
        "Grain_Prompt_Engineering_Studio_v1.json"
      ],
      "analytics": [
        "Grain_Unified_Analytics_Dashboard_v1.json",
        "Grain_AB_Testing_Engine_v1.json",
        "Grain_Video_Performance_Tracker_v1.json",
        "Grain_Content_Performance_Analyzer_v1.json"
      ],
      "customer_success": [
        "Grain_Churn_Prediction_Prevention_v1.json",
        "Grain_Customer_Support_Automation_v1.json",
        "Grain_Personalization_Engine_v1.json"
      ],
      "growth": [
        "Grain_Referral_Program_Automation_v1.json",
        "Grain_Webinar_Event_Automation_v1.json",
        "Grain_Lead_Conversion_Funnel_v1.json",
        "Grain_Landing_Page_CRO_Hub_v1.json"
      ],
      "operations": [
        "Grain_RevOps_Hub_v1.json",
        "Grain_Invoice_Billing_Automation_v1.json",
        "Grain_Intelligent_CDP_v1.json"
      ],
      "intelligence": [
        "Grain_Competitive_Intelligence_v1.json",
        "Grain_Social_Listening_Sentiment_v1.json"
      ],
      "seo": [
        "Grain_SEO_Site_Audit_v1.json",
        "Grain_Keyword_Research_Pipeline_v1.json",
        "Grain_Rank_Tracking_v1.json",
        "Grain_Backlink_Monitor_v1.json",
        "Grain_Local_Citation_Builder_v1.json"
      ],
      "local_seo": [
        "Grain_Local_SEO_Automation_Hub_v1.json",
        "Grain_Local_Citation_Builder_v1.json"
      ],
      "restaurant": [
        "Grain_Restaurant_Marketing_Hub_v1.json",
        "Grain_Restaurant_Loyalty_Program_v1.json",
        "Grain_Guest_Feedback_Review_v1.json"
      ]
    },
    "files": [
      {
        "filename": "Grain_Dynamic_Pricing_Engine_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Dynamic_Pricing_Engine_v1.json",
        "category": "hospitality",
        "description": "AI-driven real-time pricing based on demand signals, competitor rates, events, and seasonality",
        "roi": "15-20% RevPAR increase"
      },
      {
        "filename": "Grain_Booking_Channel_Sync_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Booking_Channel_Sync_v1.json",
        "category": "hospitality",
        "description": "Real-time synchronization across OTAs (Booking.com, Expedia, Airbnb, VRBO)",
        "roi": "40% ADR increase, zero overbookings"
      },
      {
        "filename": "Grain_Housekeeping_Operations_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Housekeeping_Operations_v1.json",
        "category": "hospitality",
        "description": "AI-optimized room assignment and real-time status updates",
        "roi": "30% faster turnover"
      },
      {
        "filename": "Grain_Guest_Communication_Journey_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Guest_Communication_Journey_v1.json",
        "category": "hospitality",
        "description": "Automated guest lifecycle messaging with AI-driven upselling",
        "roi": "166x ROI potential"
      },
      {
        "filename": "Grain_Review_Management_AI_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Review_Management_AI_v1.json",
        "category": "hospitality",
        "description": "Multi-platform review aggregation with AI response generation",
        "roi": "5-9% revenue per star rating increase"
      },
      {
        "filename": "Grain_Campaign_Performance_Monitor_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Campaign_Performance_Monitor_v1.json",
        "category": "agency",
        "description": "Real-time monitoring of Google Ads, Meta Ads, LinkedIn with AI analysis",
        "roi": "20% ROAS improvement"
      },
      {
        "filename": "Grain_Client_Onboarding_Automation_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Client_Onboarding_Automation_v1.json",
        "category": "agency",
        "description": "Automated client setup with service-specific task generation",
        "roi": "80% faster onboarding"
      },
      {
        "filename": "Grain_Client_Reporting_Dashboard_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Client_Reporting_Dashboard_v1.json",
        "category": "agency",
        "description": "White-label PDF reports with AI insights generation",
        "roi": "5+ hours saved per client monthly"
      },
      {
        "filename": "Grain_Multi_Agent_Content_System_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Multi_Agent_Content_System_v1.json",
        "category": "ai_content",
        "description": "Research, SEO, Writer, Editor, QA agents working in sequence",
        "roi": "10x content output"
      },
      {
        "filename": "Grain_AI_Copywriting_Studio_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_AI_Copywriting_Studio_v1.json",
        "category": "ai_content",
        "description": "Generate ad copy, email subjects, social posts with A/B testing",
        "roi": "5x faster copy production"
      },
      {
        "filename": "Grain_Omnichannel_Marketing_Hub_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Omnichannel_Marketing_Hub_v1.json",
        "category": "marketing",
        "description": "Coordinated campaigns across Email, SMS, Push, Social",
        "roi": "287% higher purchase rate"
      },
      {
        "filename": "Grain_Influencer_Marketing_Hub_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Influencer_Marketing_Hub_v1.json",
        "category": "marketing",
        "description": "Influencer discovery, scoring, outreach, and campaign management",
        "roi": "50% lower influencer CAC"
      },
      {
        "filename": "Grain_SEO_Content_Pipeline_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_SEO_Content_Pipeline_v1.json",
        "category": "marketing",
        "description": "Keyword research, content gap analysis, and brief generation",
        "roi": "40% organic traffic increase"
      },
      {
        "filename": "Grain_Churn_Prediction_Prevention_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Churn_Prediction_Prevention_v1.json",
        "category": "customer_success",
        "description": "AI-powered churn scoring with automated retention workflows",
        "roi": "25% churn reduction"
      },
      {
        "filename": "Grain_Personalization_Engine_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Personalization_Engine_v1.json",
        "category": "customer_success",
        "description": "Real-time personalization based on behavior and predictions",
        "roi": "35% conversion lift"
      },
      {
        "filename": "Grain_Webinar_Event_Automation_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Webinar_Event_Automation_v1.json",
        "category": "growth",
        "description": "Full webinar lifecycle from registration to follow-up",
        "roi": "50% higher attendance rate"
      },
      {
        "filename": "Grain_Referral_Program_Automation_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Referral_Program_Automation_v1.json",
        "category": "growth",
        "description": "Automated referral tracking, rewards, and win-back campaigns",
        "roi": "30% lower CAC"
      },
      {
        "filename": "Grain_Email_Marketing_Automation_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Email_Marketing_Automation_v1.json",
        "category": "marketing",
        "description": "AI-powered email content generation with A/B testing"
      },
      {
        "filename": "Grain_Intelligent_CDP_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Intelligent_CDP_v1.json",
        "category": "operations",
        "description": "Customer data platform with identity resolution"
      },
      {
        "filename": "Grain_Agentic_AI_Orchestrator_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Agentic_AI_Orchestrator_v1.json",
        "category": "ai_content",
        "description": "Multi-agent AI system with human-in-the-loop"
      },
      {
        "filename": "Grain_AB_Testing_Engine_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_AB_Testing_Engine_v1.json",
        "category": "analytics",
        "description": "Statistical A/B testing with AI variant generation"
      },
      {
        "filename": "Grain_Landing_Page_CRO_Hub_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Landing_Page_CRO_Hub_v1.json",
        "category": "growth",
        "description": "Landing page optimization with AI analysis"
      },
      {
        "filename": "Grain_Unified_Analytics_Dashboard_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Unified_Analytics_Dashboard_v1.json",
        "category": "analytics",
        "description": "Cross-workflow KPI aggregation with attribution modeling"
      },
      {
        "filename": "Grain_Invoice_Billing_Automation_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Invoice_Billing_Automation_v1.json",
        "category": "operations",
        "description": "Stripe billing automation with overdue reminders"
      },
      {
        "filename": "Grain_RevOps_Hub_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_RevOps_Hub_v1.json",
        "category": "operations",
        "description": "Revenue operations with AI pipeline analysis"
      },
      {
        "filename": "Grain_AI_Visual_Content_Generator_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_AI_Visual_Content_Generator_v1.json",
        "category": "ai_content",
        "description": "AI image and video generation workflows"
      },
      {
        "filename": "Grain_Prompt_Engineering_Studio_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Prompt_Engineering_Studio_v1.json",
        "category": "ai_content",
        "description": "Prompt optimization and testing framework"
      },
      {
        "filename": "Grain_Multi_Platform_Publisher_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Multi_Platform_Publisher_v1.json",
        "category": "marketing",
        "description": "Cross-platform content publishing"
      },
      {
        "filename": "Grain_Multi_Platform_Publisher_v2.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Multi_Platform_Publisher_v2.json",
        "category": "marketing",
        "description": "Enhanced multi-platform publishing with scheduling"
      },
      {
        "filename": "Grain_Lead_Conversion_Funnel_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Lead_Conversion_Funnel_v1.json",
        "category": "growth",
        "description": "Lead nurturing and conversion automation"
      },
      {
        "filename": "Grain_Video_Performance_Tracker_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Video_Performance_Tracker_v1.json",
        "category": "analytics",
        "description": "Video analytics across platforms"
      },
      {
        "filename": "Grain_Competitive_Intelligence_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Competitive_Intelligence_v1.json",
        "category": "intelligence",
        "description": "Competitor monitoring and analysis"
      },
      {
        "filename": "Grain_Customer_Support_Automation_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Customer_Support_Automation_v1.json",
        "category": "customer_success",
        "description": "AI-powered support ticket routing and responses"
      },
      {
        "filename": "Grain_Social_Listening_Sentiment_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Social_Listening_Sentiment_v1.json",
        "category": "intelligence",
        "description": "Social media monitoring with sentiment analysis"
      },
      {
        "filename": "Grain_SEO_Site_Audit_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_SEO_Site_Audit_v1.json",
        "category": "seo",
        "description": "Comprehensive SEO site audit with 50+ technical checks (SEMrush-style)",
        "roi": "20% organic traffic increase"
      },
      {
        "filename": "Grain_Keyword_Research_Pipeline_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Keyword_Research_Pipeline_v1.json",
        "category": "seo",
        "description": "AI-powered keyword research with clustering and gap analysis (Ahrefs-style)",
        "roi": "3x keyword opportunities discovered"
      },
      {
        "filename": "Grain_Rank_Tracking_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Rank_Tracking_v1.json",
        "category": "seo",
        "description": "Daily SERP position tracking with alerts and trend analysis",
        "roi": "Real-time ranking visibility"
      },
      {
        "filename": "Grain_Backlink_Monitor_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Backlink_Monitor_v1.json",
        "category": "seo",
        "description": "Backlink profile monitoring with new/lost alerts and outreach automation",
        "roi": "50% faster link recovery"
      },
      {
        "filename": "Grain_Local_Citation_Builder_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Local_Citation_Builder_v1.json",
        "category": "local_seo",
        "description": "NAP consistency audit and automated citation submission",
        "roi": "40% local ranking improvement"
      },
      {
        "filename": "Grain_Local_SEO_Automation_Hub_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Local_SEO_Automation_Hub_v1.json",
        "category": "local_seo",
        "description": "Google Business Profile management with multi-platform review monitoring",
        "roi": "25% more local visibility"
      },
      {
        "filename": "Grain_Content_Performance_Analyzer_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Content_Performance_Analyzer_v1.json",
        "category": "analytics",
        "description": "Content scoring with traffic, SEO, engagement, and social metrics",
        "roi": "2x content effectiveness"
      },
      {
        "filename": "Grain_Restaurant_Marketing_Hub_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Restaurant_Marketing_Hub_v1.json",
        "category": "restaurant",
        "description": "Guest CDP with lifecycle campaigns (welcome, win-back, birthday)",
        "roi": "30% repeat visit increase"
      },
      {
        "filename": "Grain_Restaurant_Loyalty_Program_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Restaurant_Loyalty_Program_v1.json",
        "category": "restaurant",
        "description": "Points-based loyalty with tier upgrades and reward redemption",
        "roi": "25% customer retention boost"
      },
      {
        "filename": "Grain_Guest_Feedback_Review_v1.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Grain_Guest_Feedback_Review_v1.json",
        "category": "restaurant",
        "description": "NPS surveys with AI review response generation",
        "roi": "50% more positive reviews"
      },
      {
        "filename": "0 - MARKETING TEAM.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/0%20-%20MARKETING%20TEAM.json",
        "category": "legacy"
      },
      {
        "filename": "AI-Powered Short-Form Video Generator with OpenAI, Flux, Kling, and ElevenLabs and upload to all social networks.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/AI-Powered%20Short-Form%20Video%20Generator%20with%20OpenAI%2C%20Flux%2C%20Kling%2C%20and%20ElevenLabs%20and%20upload%20to%20all%20social%20networks.json",
        "category": "legacy"
      },
      {
        "filename": "AI-Powered WhatsApp Chatbot for Text, Voice, Images & PDFs.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/AI-Powered%20WhatsApp%20Chatbot%20for%20Text%2C%20Voice%2C%20Images%20%26%20PDFs.json",
        "category": "legacy"
      },
      {
        "filename": "APOLLO_SCRAPER.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/APOLLO_SCRAPER.json",
        "category": "legacy"
      },
      {
        "filename": "LinkedIn Comments to Leads Extractor.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/LinkedIn%20Comments%20to%20Leads%20Extractor.json",
        "category": "legacy"
      },
      {
        "filename": "Online Marketing Weekly Report.json",
        "raw_url": "https://raw.githubusercontent.com/No3214/saas/main/n8n-templates/Online%20Marketing%20Weekly%20Report.json",
        "category": "legacy"
      }
    ]
  },
  {
    "name": "Instagram DM otomasyonu V2",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -100,
          -80
        ],
        "id": "36e2b588-9662-49c4-ae91-914db20c6853",
        "name": "Webhook",
        "webhookId": "4fc55431-2c46-4a35-8e97-a334d4d68c9a"
      },
      {
        "parameters": {
          "respondWith": "allIncomingItems",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          520,
          -80
        ],
        "id": "51634882-8465-46b1-bcfe-9a7a604a73cb",
        "name": "Respond to Webhook"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.body.userInput }}",
          "options": {
            "systemMessage": "Buraya kendinizi veya sirketinizi tanitan bir yazi yazin."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.8,
        "position": [
          140,
          -80
        ],
        "id": "0e3afebc-757a-43df-958d-fe3a4cd0bdb2",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          0,
          140
        ],
        "id": "c49cbf98-a7c4-46e5-92b1-a3e65185a0ee",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "sifaiotKPshkqdCi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Webhook').item.json.body.contactId }}",
          "contextWindowLength": 10
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          160,
          140
        ],
        "id": "18f69b04-4f96-4230-b653-a93f82a56da4",
        "name": "Simple Memory"
      }
    ],
    "pinData": {},
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "ad8150bf-b83d-475b-ad93-dfaabe81042b",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "a70a0b6d837a52eddab3f5d152c26cd8b8d05813e4f6e6bc4039667124542103"
    },
    "id": "pSIYLeleNzu7KVkr",
    "tags": []
  },
  {
    "name": "LinkedIn Comments to Leads Extractor",
    "nodes": [
      {
        "parameters": {},
        "id": "025ab8f2-7db3-48ee-a048-29104352682f",
        "name": "Trigger manually",
        "type": "n8n-nodes-base.manualTrigger",
        "position": [
          -5376,
          -720
        ],
        "typeVersion": 1,
        "disabled": true
      },
      {
        "parameters": {
          "formTitle": "Linkedin Posts Comments Leads Scraper",
          "formDescription": "=<div style=\"font-family: Arial, sans-serif; line-height: 1.8; color: #333; word-wrap: break-word; overflow-wrap: break-word;\">\n\n<p style=\"margin-bottom: 20px;\"><strong style=\"color: #0077b5;\">ðŸ”¸ Step 1: Add Posts URLs</strong></p>\n<p style=\"margin-bottom: 20px;\">The workflow accepts various LinkedIn post identifier formats:</p>\n\n<p style=\"margin-bottom: 18px;\"><strong>ðŸ“Š Numeric post IDs:</strong><br>\n<span style=\"font-family: monospace; background: #f5f5f5; padding: 4px 6px; word-break: break-all; margin-top: 8px; display: inline-block;\">7334385757769416704</span></p>\n\n<p style=\"margin-bottom: 18px;\"><strong>ðŸ”— Activity URLs:</strong><br>\n<span style=\"font-family: monospace; background: #f5f5f5; padding: 4px 6px; word-break: break-all; display: block; margin-top: 8px;\">https://www.linkedin.com/feed/update/urn:li:activity:273437/</span></p>\n\n<p style=\"margin-bottom: 25px;\"><strong>ðŸŒ Full post URLs:</strong><br>\n<span style=\"font-family: monospace; background: #f5f5f5; padding: 4px 6px; word-break: break-all; display: block; margin-top: 8px;\">https://www.linkedin.com/posts/username_title-activity-7334385757769416704-dMnz</span></p>\n\n<hr style=\"margin: 30px 0; border: 1px solid #ddd;\">-------------------\n\n<p style=\"margin-bottom: 20px;\"><strong style=\"color: #28a745;\">âœ… Step 2: Results</strong></p>\n<p style=\"margin-bottom: 20px;\">Once finished, you'll be redirected to Google Sheets where you can find your result with the name:</p>\n<p style=\"background: #f0f8ff; padding: 15px; border-left: 4px solid #0077b5; margin: 20px 0;\">\n<strong>\"LinkedIn-Posts-Comments-Leads-{{ $now.format('yyyy-MM-dd') }}\"</strong>\n</p>\n\n<hr style=\"margin: 30px 0; border: 1px solid #ddd;\">-------------------\n\n\n<p style=\"color: #666; font-size: 14px; margin-top: 25px;\"><em>ðŸ’¡ Tip: Make sure your LinkedIn URLs are publicly accessible for the best results.</em></p>\n\n</div>",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Post IDs/URLs",
                "fieldType": "textarea",
                "placeholder": "e.g. 7334385757769416704, https://www.linkedin.com/feed/update/urn:li:activity:7334385757769416704/",
                "requiredField": true
              },
              {
                "fieldLabel": "How many comments you want to scrape?",
                "fieldType": "number",
                "placeholder": "Default: 100"
              }
            ]
          },
          "responseMode": "lastNode",
          "options": {
            "appendAttribution": false,
            "buttonLabel": "Submit",
            "respondWithOptions": {
              "values": {
                "respondWith": "redirect",
                "redirectUrl": "=https://docs.google.com/spreadsheets/u/0/"
              }
            },
            "ignoreBots": true
          }
        },
        "id": "2aac389d-b8f8-4f4e-b96d-d26ee683bdf8",
        "name": "On form submission",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          -5312,
          -320
        ],
        "webhookId": "a81d04b5-169a-4368-b925-91fb0660b6b2",
        "typeVersion": 2.2
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "20febbcc-0a59-4a89-8932-9bbb34b0e9f9",
                "name": "APIFY_TOKEN",
                "type": "string",
                "value": ""
              },
              {
                "id": "291758a3-c73f-4db5-a2b3-5f88664a8b53",
                "name": "limit",
                "type": "number",
                "value": "={{ $json.limit }}"
              },
              {
                "id": "921b72d5-3688-4324-9d36-50668548344e",
                "name": "postIds",
                "type": "array",
                "value": "={{ $json.postIds }}"
              }
            ]
          },
          "includeOtherFields": true,
          "options": {}
        },
        "id": "d6c6e9d2-d0ef-4a8b-8b22-14678cf74f0c",
        "name": "Set APIFY Token",
        "type": "n8n-nodes-base.set",
        "position": [
          -4800,
          -608
        ],
        "notesInFlow": true,
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "916bb8f7-34c5-4f2f-b13d-f60d228abc1f",
                "name": "postIds",
                "type": "array",
                "value": "={{ $json['Post IDs/URLs'].replaceAll('\\n','').replaceAll('\\r', '').split(',').filter(item => $ifEmpty(item, false))  }}"
              },
              {
                "id": "7ff3d2f4-ab8a-444f-9747-f95166a950bd",
                "name": "limit",
                "type": "number",
                "value": "={{ $json['How many comments you want to scrape?'] || 100 }}"
              }
            ]
          },
          "options": {}
        },
        "id": "3e4c8dfd-fb4c-4a0b-a5e7-75d0cb872bff",
        "name": "Set fields from the form",
        "type": "n8n-nodes-base.set",
        "position": [
          -4992,
          -320
        ],
        "notesInFlow": true,
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "af09ad86-b3dd-45b7-b17d-cb810e4b48d6",
                "name": "postIds",
                "type": "array",
                "value": "['https://www.linkedin.com/feed/update/urn:li:activity:7334385757769416704/', 'https://www.linkedin.com/feed/update/urn:li:activity:7318557377971023872/']"
              },
              {
                "id": "b2f9412e-4c81-454f-ad84-a1d5f6547a26",
                "name": "limit",
                "type": "number",
                "value": 100
              }
            ]
          },
          "options": {}
        },
        "id": "d5df45fd-aa4d-4fa9-9d64-70b5b6874c8e",
        "name": "Set manual fields",
        "type": "n8n-nodes-base.set",
        "position": [
          -5136,
          -720
        ],
        "notesInFlow": true,
        "typeVersion": 3.4,
        "disabled": true
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "combinator": "and",
            "conditions": [
              {
                "id": "19224073-c84d-456f-b694-318df4223d2a",
                "operator": {
                  "type": "number",
                  "operation": "gt"
                },
                "leftValue": "={{ $json.summary.totalComments }}",
                "rightValue": 100
              },
              {
                "id": "8156447e-75dd-4cad-8fc8-17366667d165",
                "operator": {
                  "type": "number",
                  "operation": "gt"
                },
                "leftValue": "={{ $('Set APIFY Token').first().json.limit }}",
                "rightValue": 100
              }
            ]
          },
          "options": {}
        },
        "id": "c002d26f-fcff-4415-8e13-2d844f898ca9",
        "name": "More runs needed?",
        "type": "n8n-nodes-base.if",
        "position": [
          -4000,
          -608
        ],
        "notesInFlow": true,
        "typeVersion": 2.2,
        "notes": "Per run it's only 100 comments"
      },
      {
        "parameters": {
          "jsCode": "const limitPages = Math.ceil($('Set APIFY Token').first().json.limit / 100)\nconst totalComments = $('Run Apify Comments Scraper').last().json.summary.totalComments \nconst availablePages = Math.ceil(totalComments / 100)\n\nconst totalRuns = availablePages <= limitPages ? availablePages : limitPages\n\nlet currentPage = 2\n\n\nreturn {\n  json: {\n    items:\n      Array.from({ length: totalRuns }, (_, i) => {\n        return { currentPage: currentPage + i }\n      })\n  }\n};"
        },
        "id": "419a7256-b750-4c34-bbc8-88adc496c17e",
        "name": "Set pagination",
        "type": "n8n-nodes-base.code",
        "position": [
          -3776,
          -752
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "fieldToSplitOut": "items",
          "options": {}
        },
        "id": "7646bf27-d7f3-4f2a-a4a0-a8153ce30b54",
        "name": "Split Out",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          -3552,
          -752
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "items",
          "options": {}
        },
        "id": "7716e5bc-3522-4220-942d-f8c8971063e8",
        "name": "Aggregate",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          -4208,
          -608
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "b4280f11-a50b-4065-8742-9f994c6ee84d",
                "name": "items",
                "type": "array",
                "value": "={{ $json.items.concat($('Aggregate').item.json.items) }}"
              }
            ]
          },
          "options": {}
        },
        "id": "ad9072fa-6e6c-43ee-9c56-30921f2b59b1",
        "name": "Gather All Comments",
        "type": "n8n-nodes-base.set",
        "position": [
          -2896,
          -960
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "jsCode": "// Get all input items\nconst items = $input.first().json.items;\n\n// Use reduce to filter unique profile_url values\nconst uniqueProfiles = items.reduce((acc, item) => {\n  // Check if this profile_url is already in the accumulator\n  console.log(item)\n  if (item.author && !acc.some(i => i.profile_url === item.author.profile_url)) {\n    acc.push(item.author);\n  }\n  return acc;\n}, []);\n\nreturn uniqueProfiles"
        },
        "id": "2366d6b2-d4ae-45ab-9724-fe2ecfcc6de5",
        "name": "Create Unique List of Leads",
        "type": "n8n-nodes-base.code",
        "position": [
          -2432,
          -592
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ 'https://api.apify.com/v2/acts/apimaestro~linkedin-post-comments-replies-engagements-scraper-no-cookies/run-sync-get-dataset-items?token=' +$json.APIFY_TOKEN}}",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "postIds",
                "value": "={{ $json.postIds }}"
              },
              {
                "name": "page_number",
                "value": "={{ 1 }}"
              },
              {
                "name": "sortOrder",
                "value": "most recent"
              },
              {
                "name": "limit",
                "value": "={{ $json.limit }}"
              }
            ]
          },
          "options": {}
        },
        "id": "5dda792a-f05d-4baf-a008-ee7576dbfc89",
        "name": "Run Apify Comments Scraper",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -4432,
          -608
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ 'https://api.apify.com/v2/acts/apimaestro~linkedin-post-comments-replies-engagements-scraper-no-cookies/run-sync-get-dataset-items?token=' + $('Set APIFY Token').first().json.APIFY_TOKEN}}",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "postIds",
                "value": "={{ $('Set APIFY Token').first().json.postIds }}"
              },
              {
                "name": "page_number",
                "value": "={{ $json.currentPage }}"
              },
              {
                "name": "sortOrder",
                "value": "most recent"
              },
              {
                "name": "limit",
                "value": "={{ $('Set APIFY Token').first().json.limit }}"
              }
            ]
          },
          "options": {}
        },
        "id": "79e603aa-a478-420d-881a-05990f790e4a",
        "name": "Run Apify Comments Scraper Loop",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -3120,
          -736
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ 'https://api.apify.com/v2/acts/apimaestro~linkedin-profile-batch-scraper-no-cookies-required/run-sync-get-dataset-items?token=' + $('Set APIFY Token').first().json.APIFY_TOKEN}}",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "usernames",
                "value": "={{ $json.batches }}"
              }
            ]
          },
          "options": {}
        },
        "id": "83c89772-847b-4538-8eb7-97efc9781390",
        "name": "Run Apify Profile Enrichment",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          -1392,
          -576
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "fieldToSplitOut": "batches",
          "include": "allOtherFields",
          "options": {}
        },
        "id": "620e9e29-61c4-46e7-be5e-1ca56d23587e",
        "name": "Split Out Batches",
        "type": "n8n-nodes-base.splitOut",
        "position": [
          -1968,
          -592
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "589da149-2326-4b50-b064-067a7b704b87",
        "name": "Loop Over Comments",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          -3328,
          -752
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "9d4d4025-de8c-4165-b61b-f4ccd3e4cae1",
        "name": "Loop Over Profiles",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          -1680,
          -592
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "jsCode": "const uniqueProfiles = $input.all().map(item => item.json.profile_url)\n\n// Split the uniqueProfiles in batches of 500 for the Apify\nconst chunkSize = 500;\nconst batches = [];\n\nfor (let i = 0; i < uniqueProfiles.length; i += chunkSize) {\n  batches.push(uniqueProfiles.slice(i, i + chunkSize));\n}\n\n\nreturn { batches };"
        },
        "id": "177bd0e3-f6f3-446b-a263-f9dfc7dd3f75",
        "name": "Split in batches",
        "type": "n8n-nodes-base.code",
        "position": [
          -2208,
          -592
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "items",
          "options": {}
        },
        "id": "595be651-6dda-47fd-a039-536ec3b88463",
        "name": "Aggregate Comments",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          -2832,
          -736
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "items",
          "options": {}
        },
        "id": "2585fd3d-7ade-40d1-a5de-81bc132aaf0c",
        "name": "Aggregate Profiles",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          -1168,
          -576
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "items"
              }
            ]
          },
          "options": {
            "mergeLists": true
          }
        },
        "id": "980addf5-c540-448d-865f-60c7e2d7f05e",
        "name": "Aggregate All Profiles",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          -1392,
          -752
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "items"
              }
            ]
          },
          "options": {
            "mergeLists": true
          }
        },
        "id": "e1f7b243-ac57-4ab1-8958-e8f471bac9b4",
        "name": "Aggregate All Comments",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          -3120,
          -960
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "options": {
            "headerRow": true
          }
        },
        "id": "eb63c6a5-1a58-4596-a30d-bf6f595e1182",
        "name": "Convert to File",
        "type": "n8n-nodes-base.convertToFile",
        "position": [
          -512,
          -928
        ],
        "executeOnce": true,
        "typeVersion": 1.1,
        "disabled": true
      },
      {
        "parameters": {
          "jsCode": "function flatten(obj, prefix = '', res = {}) {\n  for (const key in obj) {\n    const value = obj[key];\n    const prefixedKey = prefix ? `${prefix}_${key}` : key;\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      flatten(value, prefixedKey, res);\n    } else {\n      res[prefixedKey] = value;\n    }\n  }\n  return res;\n}\n\nreturn $input.first().json.items.map(item => ({\n  json: flatten(item)\n}));"
        },
        "id": "78d234b5-be16-4d3b-8731-0d7759b52b0e",
        "name": "Prepare the list for export",
        "type": "n8n-nodes-base.code",
        "position": [
          -1168,
          -752
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "resource": "spreadsheet",
          "title": "=LinkedIn-Posts-Comments-Leads-{{ $now.format('yyyy-MM-dd+T') }}",
          "sheetsUi": {
            "sheetValues": [
              {
                "title": "Leads"
              }
            ]
          },
          "options": {}
        },
        "id": "23adba7c-a7af-4a23-96b2-17223d8422fd",
        "name": "Create Google Sheet",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -688,
          -432
        ],
        "executeOnce": true,
        "typeVersion": 4.5,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "0QPhHWj1ZyZeQ8yP",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $('Create Google Sheet').first().json.spreadsheetId }}"
          },
          "sheetName": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $('Create Google Sheet').first().json.sheets[0].properties.sheetId }}"
          },
          "columns": {
            "value": {},
            "schema": [
              {
                "id": "profileUrl",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "profileUrl",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_fullname",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_fullname",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_first_name",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_first_name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_last_name",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_last_name",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_headline",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_headline",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_public_identifier",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_public_identifier",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_profile_picture_url",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_profile_picture_url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_about",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_about",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_location_country",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_location_country",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_location_city",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_location_city",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_location_full",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_location_full",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_location_country_code",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_location_country_code",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_creator_hashtags",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_creator_hashtags",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_is_creator",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_is_creator",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_is_influencer",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_is_influencer",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_is_premium",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_is_premium",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_created_timestamp",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_created_timestamp",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_show_follower_count",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_show_follower_count",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_background_picture_url",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_background_picture_url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_urn",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_urn",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_follower_count",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_follower_count",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_connection_count",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_connection_count",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_current_company",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_current_company",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_current_company_urn",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_current_company_urn",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "basic_info_current_company_url",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "basic_info_current_company_url",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "experience",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "experience",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "education",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "education",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              },
              {
                "id": "certifications",
                "type": "string",
                "display": true,
                "required": false,
                "displayName": "certifications",
                "defaultMatch": false,
                "canBeUsedToMatch": true
              }
            ],
            "mappingMode": "autoMapInputData",
            "matchingColumns": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {
            "cellFormat": "USER_ENTERED",
            "useAppend": true
          }
        },
        "id": "a94397c6-bab3-4771-a372-6d2aa34007e3",
        "name": "Add Leads",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          -272,
          -432
        ],
        "executeOnce": false,
        "typeVersion": 4.5,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "0QPhHWj1ZyZeQ8yP",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "\nreturn $('Prepare the list for export').all();"
        },
        "id": "f9b314da-bc04-4a08-9001-b82230fc8b2e",
        "name": "Set the list for sheets",
        "type": "n8n-nodes-base.code",
        "position": [
          -480,
          -432
        ],
        "typeVersion": 2
      },
      {
        "parameters": {},
        "id": "2114c197-36cf-4e67-ae94-5e78ff19221f",
        "name": "Done",
        "type": "n8n-nodes-base.noOp",
        "position": [
          448,
          -720
        ],
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Add Leads": {
        "main": [
          [
            {
              "node": "Done",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate": {
        "main": [
          [
            {
              "node": "More runs needed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Loop Over Comments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set pagination": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set APIFY Token": {
        "main": [
          [
            {
              "node": "Run Apify Comments Scraper",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split in batches": {
        "main": [
          [
            {
              "node": "Split Out Batches",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Trigger manually": {
        "main": [
          [
            {
              "node": "Set manual fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "More runs needed?": {
        "main": [
          [
            {
              "node": "Set pagination",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Create Unique List of Leads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out Batches": {
        "main": [
          [
            {
              "node": "Loop Over Profiles",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Comments": {
        "main": [
          [
            {
              "node": "Loop Over Comments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Profiles": {
        "main": [
          [
            {
              "node": "Loop Over Profiles",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Comments": {
        "main": [
          [
            {
              "node": "Aggregate All Comments",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Run Apify Comments Scraper Loop",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Profiles": {
        "main": [
          [
            {
              "node": "Aggregate All Profiles",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Run Apify Profile Enrichment",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "On form submission": {
        "main": [
          [
            {
              "node": "Set fields from the form",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Google Sheet": {
        "main": [
          [
            {
              "node": "Set the list for sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gather All Comments": {
        "main": [
          [
            {
              "node": "Create Unique List of Leads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate All Comments": {
        "main": [
          [
            {
              "node": "Gather All Comments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate All Profiles": {
        "main": [
          [
            {
              "node": "Prepare the list for export",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set the list for sheets": {
        "main": [
          [
            {
              "node": "Add Leads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set fields from the form": {
        "main": [
          [
            {
              "node": "Set APIFY Token",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Run Apify Comments Scraper": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Unique List of Leads": {
        "main": [
          [
            {
              "node": "Split in batches",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare the list for export": {
        "main": [
          [
            {
              "node": "Create Google Sheet",
              "type": "main",
              "index": 0
            },
            {
              "node": "Convert to File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Run Apify Profile Enrichment": {
        "main": [
          [
            {
              "node": "Aggregate Profiles",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Run Apify Comments Scraper Loop": {
        "main": [
          [
            {
              "node": "Aggregate Comments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "800c72af-56d4-475e-8dd6-d6009e717d00",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "1cf89b43369a41d5cb2ef8f98e40e28eb1e7b9933446d35a3569ea05d3f4880b"
    },
    "id": "Zh6oEb6SHHpnPBLr",
    "tags": []
  },
  {
    "name": "Online Marketing Weekly Report",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "weeks",
                "triggerAtDay": [
                  1
                ],
                "triggerAtHour": 7
              }
            ]
          }
        },
        "id": "8e4c08a7-8934-44b3-8862-3cf4b888a1e5",
        "name": "Schedule Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          592,
          224
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "options": {}
        },
        "id": "d7002105-6faf-45d4-be7d-cca00d9e9b3a",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          800,
          560
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "name": "Google_Ads",
          "description": "Call this tool to get the output of the Google Ads Workflow",
          "workflowId": {
            "__rl": true,
            "mode": "list",
            "value": "nRGs7Ogv7eU1mJQl",
            "cachedResultName": "Google Ads Report: Weekly Subflow ROAS"
          }
        },
        "id": "0f77869a-579e-4558-9516-0abbd6710ea7",
        "name": "Google_Ads",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          1776,
          560
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {
          "name": "Meta_Ads",
          "description": "Call this tool to get the output of the Meta Ads Workflow",
          "workflowId": {
            "__rl": true,
            "mode": "list",
            "value": "9sC80Rt1eqgrfphk",
            "cachedResultName": "Meta Ads Report: Weekly Subflow ROAS"
          }
        },
        "id": "de0daa88-7cab-4a3b-85d1-d5c742444bca",
        "name": "Meta_Ads",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          1872,
          560
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {
          "name": "EP_Data",
          "description": "Call this tool to get the output of the SER Data Workflow",
          "workflowId": {
            "__rl": true,
            "mode": "list",
            "value": "ploQFf5BtgCC6ryu",
            "cachedResultName": "GA Report: EP Subflow Weekly"
          }
        },
        "id": "c62be93d-a7f3-44d4-9d62-456a2107b253",
        "name": "Analytics_Domain_1",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          992,
          560
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {
          "name": "SBW_Data",
          "description": "Call this tool to get the output of the SBW Data Workflow",
          "workflowId": {
            "__rl": true,
            "mode": "list",
            "value": "ECmFUVocSLqB3afJ",
            "cachedResultName": "GA Report: SBW Subflow Weekly"
          }
        },
        "id": "a9321f87-f4af-4add-9aef-7892a74a5237",
        "name": "Analytics_Domain_3",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          1312,
          560
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {
          "name": "SER_Data",
          "description": "Call this tool to get the output of the SER Data Workflow",
          "workflowId": {
            "__rl": true,
            "mode": "list",
            "value": "EWAE7Qx70cHZuXte",
            "cachedResultName": "GA Report: SER Subflow Weekly"
          }
        },
        "id": "8634c3eb-e309-4c66-9164-b5d5152dc4bd",
        "name": "Analytics_Domain_2",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          1152,
          560
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {
          "name": "SZO_Data",
          "description": "Call this tool to get the output of the SZO Data Workflow",
          "workflowId": {
            "__rl": true,
            "mode": "list",
            "value": "eyPh3eaqrBLAcLKF",
            "cachedResultName": "GA Report: SZO Subflow Weekly"
          }
        },
        "id": "59f28cee-f9d4-4f8a-bfc4-bc984753f6fe",
        "name": "Analytics_Domain_4",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          1472,
          560
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {
          "name": "UCH_Data",
          "description": "Call this tool to get the output of the UCH Data Workflow",
          "workflowId": {
            "__rl": true,
            "mode": "list",
            "value": "ErIeoUuyF4fqMbhL",
            "cachedResultName": "GA Report: UCH Subflow Weekly"
          }
        },
        "id": "641c07ba-abc6-4881-a2b2-f77e10884a94",
        "name": "Analytics_Domain_5",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "position": [
          1632,
          560
        ],
        "typeVersion": 1.3
      },
      {
        "parameters": {},
        "id": "1ea48c32-c806-4330-93ae-48258b2da490",
        "name": "Execute Workflow Trigger",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "position": [
          592,
          912
        ],
        "typeVersion": 1
      },
      {
        "parameters": {},
        "id": "a8498b75-4f64-4828-8d9b-ddb8fec6431e",
        "name": "Calculator",
        "type": "@n8n/n8n-nodes-langchain.toolCalculator",
        "position": [
          2560,
          1120
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## Sub-Workflow: Google Analytics Data",
          "height": 460,
          "width": 2340,
          "color": 6
        },
        "id": "d40d0d33-f05c-42b5-8d4f-73c886adcf07",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          512,
          800
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## Sub-Workflow: Meta Ads Data",
          "height": 460,
          "width": 2340,
          "color": 5
        },
        "id": "062f511c-9f3e-4f55-9448-53928b2ade65",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          512,
          1888
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## Main Workflow: Weekly Report Assistant",
          "height": 540,
          "width": 2340
        },
        "id": "66b957b5-e49d-4283-b88b-389a1a93ef4b",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          512,
          160
        ],
        "typeVersion": 1
      },
      {
        "parameters": {},
        "id": "16501ee1-f23f-485d-9bce-e28bf7fa477c",
        "name": "Calculator1",
        "type": "@n8n/n8n-nodes-langchain.toolCalculator",
        "position": [
          2608,
          1648
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "## Sub-Workflow: Google Ads Data",
          "height": 500,
          "width": 2340,
          "color": 4
        },
        "id": "b3758f6d-c90a-4c1c-ac3e-76fe7afba665",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          512,
          1328
        ],
        "typeVersion": 1
      },
      {
        "parameters": {},
        "id": "9ea0da9f-dab3-4229-adfb-c9d151547465",
        "name": "Calculator3",
        "type": "@n8n/n8n-nodes-langchain.toolCalculator",
        "position": [
          2640,
          2208
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "propertyId": {
            "__rl": true,
            "mode": "list",
            "value": "345060083",
            "cachedResultUrl": "https://analytics.google.com/analytics/web/#/p345060083/",
            "cachedResultName": "https://www.ep-reisen.de Â â€“ GA4"
          },
          "metricsGA4": {
            "metricValues": [
              {
                "listName": "screenPageViews"
              },
              {},
              {
                "listName": "sessions"
              },
              {
                "listName": "sessionsPerUser"
              },
              {
                "listName": "other",
                "name": "averageSessionDuration"
              },
              {
                "listName": "other",
                "name": "ecommercePurchases"
              },
              {
                "listName": "other",
                "name": "averagePurchaseRevenue"
              },
              {
                "listName": "other",
                "name": "purchaseRevenue"
              }
            ]
          },
          "dimensionsGA4": {
            "dimensionValues": [
              {}
            ]
          },
          "additionalFields": {}
        },
        "id": "e3d4fc15-42fa-46d0-9b9c-a34508b8035f",
        "name": "Call Google Analytics data: Last 7 days",
        "type": "n8n-nodes-base.googleAnalytics",
        "position": [
          848,
          912
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "propertyId": {
            "__rl": true,
            "mode": "list",
            "value": "345060083",
            "cachedResultUrl": "https://analytics.google.com/analytics/web/#/p345060083/",
            "cachedResultName": "https://www.ep-reisen.de Â â€“ GA4"
          },
          "dateRange": "custom",
          "startDate": "={{ $json.startDate }}",
          "endDate": "={{ $json.endDate }}",
          "metricsGA4": {
            "metricValues": [
              {
                "listName": "screenPageViews"
              },
              {},
              {
                "listName": "sessions"
              },
              {
                "listName": "sessionsPerUser"
              },
              {
                "listName": "other",
                "name": "averageSessionDuration"
              },
              {
                "listName": "other",
                "name": "ecommercePurchases"
              },
              {
                "listName": "other",
                "name": "averagePurchaseRevenue"
              },
              {
                "listName": "other",
                "name": "purchaseRevenue"
              }
            ]
          },
          "dimensionsGA4": {
            "dimensionValues": [
              {}
            ]
          },
          "additionalFields": {}
        },
        "id": "af0a276b-d671-4789-9cf9-47b2db4a94df",
        "name": "Call Google Analytics data: Last 7 days (previous year)",
        "type": "n8n-nodes-base.googleAnalytics",
        "position": [
          1776,
          912
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "// Aktuelles Datum\nconst today = new Date();\n\n// Berechnung des Enddatums (letzter Tag vor dem aktuellen Datum im Vorjahr)\nconst end = new Date(today.getFullYear() - 1, today.getMonth(), today.getDate() - 1);\n\n// Berechnung des Startdatums (7 Tage vor dem Enddatum)\nconst start = new Date(end);\nstart.setDate(end.getDate() - 6);\n\n// Formatierung zu YYYYMMDD\nfunction formatDate(date) {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}${month}${day}`;\n}\n\n// Ausgabe\nconst startDate = formatDate(start);\nconst endDate = formatDate(end);\n\nreturn {\n    startDate,\n    endDate\n};"
        },
        "id": "4614de81-c6fc-42e9-a136-fae828d989ad",
        "name": "Calculation same period previous year",
        "type": "n8n-nodes-base.code",
        "position": [
          1552,
          1424
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "const inputData = items[0].json.results;\nconst totals = {\n   impressions: 0,\n   clicks: 0,\n   conversions: 0,\n   costMicros: 0,\n   conversionsValue: 0\n};\n\ninputData.forEach(campaign => {\n   totals.impressions += parseInt(campaign.metrics.impressions) || 0;\n   totals.clicks += parseInt(campaign.metrics.clicks) || 0;\n   totals.conversions += parseFloat(campaign.metrics.conversions) || 0;\n   totals.costMicros += parseInt(campaign.metrics.costMicros) || 0;\n   totals.conversionsValue += parseFloat(campaign.metrics.conversionsValue) || 0;\n});\n\nconst results = {\n   impressions: totals.impressions,\n   clicks: totals.clicks,\n   conversions: totals.conversions,\n   cost_micros: totals.costMicros,\n   ctr: totals.clicks / totals.impressions,\n   cost_per_conversion: totals.costMicros / totals.conversions,\n   cpm: (totals.costMicros / (totals.impressions / 1000)),\n   roas: totals.conversionsValue / (totals.costMicros / 1000000)\n};\nreturn results;"
        },
        "id": "d8ffafad-82df-4d94-b630-d3d96af39fb1",
        "name": "Format data input (previous year)",
        "type": "n8n-nodes-base.code",
        "position": [
          1936,
          1424
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "const inputData = items[0].json.results;\nconst totals = {\n    impressions: 0,\n    clicks: 0,\n    conversions: 0,\n    costMicros: 0,\n    conversionsValue: 0\n};\n\ninputData.forEach(campaign => {\n    totals.impressions += parseInt(campaign.metrics.impressions) || 0;\n    totals.clicks += parseInt(campaign.metrics.clicks) || 0; \n    totals.conversions += parseFloat(campaign.metrics.conversions) || 0;\n    totals.costMicros += parseInt(campaign.metrics.costMicros) || 0;\n    totals.conversionsValue += parseFloat(campaign.metrics.conversionsValue) || 0;\n});\n\nconst results = {\n    impressions: totals.impressions,\n    clicks: totals.clicks,\n    conversions: totals.conversions, \n    cost_micros: totals.costMicros,\n    ctr: totals.clicks / totals.impressions,\n    cost_per_conversion: totals.costMicros / totals.conversions,\n    cpm: (totals.costMicros / (totals.impressions / 1000)),\n    roas: totals.conversionsValue / (totals.costMicros / 1000000)\n};\n\nreturn results;"
        },
        "id": "8c23151f-8103-42c5-85d0-2e045fce8530",
        "name": "Format data input (current year)",
        "type": "n8n-nodes-base.code",
        "position": [
          976,
          1424
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9c2f8b9a-e964-49a0-8837-efb0dfd7bcae",
                "name": "Impressions",
                "type": "number",
                "value": "={{ $json.impressions }}"
              },
              {
                "id": "8b524518-1268-4971-b5c9-ae7da09d94f9",
                "name": "CPM",
                "type": "number",
                "value": "={{ $json.cpm }}"
              },
              {
                "id": "ca7279b9-c643-425f-aa99-cb17146e9994",
                "name": "Clicks",
                "type": "number",
                "value": "={{ $json.clicks }}"
              },
              {
                "id": "591288f7-e8cf-445e-872a-5b83f997b825",
                "name": "CTR",
                "type": "number",
                "value": "={{ $json.ctr }}"
              },
              {
                "id": "dc1a43da-3f3a-4dca-bbde-904222d7f693",
                "name": "Conversions",
                "type": "number",
                "value": "={{ $json.conversions }}"
              },
              {
                "id": "eac0b53e-c452-40b8-92bc-8af8ea349984",
                "name": "=Cost per Conversion",
                "type": "number",
                "value": "={{ $json.cost_per_conversion }}"
              },
              {
                "id": "4b5d569a-26c9-4a2f-be48-6814860d33c1",
                "name": "ROAS",
                "type": "number",
                "value": "={{ $json.roas }}"
              },
              {
                "id": "b96439be-189d-4ebe-b49e-d5c31fefe9f0",
                "name": "Spend",
                "type": "number",
                "value": "={{ $json.cost_micros }}"
              }
            ]
          },
          "options": {}
        },
        "id": "7ac0a00a-311d-4438-a8dd-e3a1945589e7",
        "name": "Assign data from input (current year)",
        "type": "n8n-nodes-base.set",
        "position": [
          1152,
          1424
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "fieldsToSummarize": {
            "values": [
              {
                "aggregation": "sum",
                "field": "Impressions"
              },
              {
                "aggregation": "average",
                "field": "CPM"
              },
              {
                "aggregation": "sum",
                "field": "Clicks"
              },
              {
                "aggregation": "average",
                "field": "CTR"
              },
              {
                "aggregation": "sum",
                "field": "Conversions"
              },
              {
                "aggregation": "average",
                "field": "Cost per Conversion"
              },
              {
                "aggregation": "sum",
                "field": "Spend"
              },
              {
                "aggregation": "average",
                "field": "ROAS"
              }
            ]
          },
          "options": {}
        },
        "id": "a3d049da-e12e-4027-8657-6fead10d8571",
        "name": "Summarize input (current year)",
        "type": "n8n-nodes-base.summarize",
        "position": [
          1360,
          1424
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9c2f8b9a-e964-49a0-8837-efb0dfd7bcae",
                "name": "Impressions",
                "type": "number",
                "value": "={{ $json.impressions }}"
              },
              {
                "id": "8b524518-1268-4971-b5c9-ae7da09d94f9",
                "name": "CPM",
                "type": "number",
                "value": "={{ $json.cpm }}"
              },
              {
                "id": "ca7279b9-c643-425f-aa99-cb17146e9994",
                "name": "Clicks",
                "type": "number",
                "value": "={{ $json.clicks }}"
              },
              {
                "id": "591288f7-e8cf-445e-872a-5b83f997b825",
                "name": "CTR",
                "type": "number",
                "value": "={{ $json.ctr }}"
              },
              {
                "id": "dc1a43da-3f3a-4dca-bbde-904222d7f693",
                "name": "Conversions",
                "type": "number",
                "value": "={{ $json.conversions }}"
              },
              {
                "id": "eac0b53e-c452-40b8-92bc-8af8ea349984",
                "name": "=Cost per conversion",
                "type": "number",
                "value": "={{ $json.cost_per_conversion }}"
              },
              {
                "id": "76bda144-0cb4-4614-a658-ddb31726ecb9",
                "name": "ROAS",
                "type": "number",
                "value": "={{ $json.roas }}"
              },
              {
                "id": "b96439be-189d-4ebe-b49e-d5c31fefe9f0",
                "name": "Spend",
                "type": "number",
                "value": "={{ $json.cost_micros }}"
              }
            ]
          },
          "options": {}
        },
        "id": "1542bb8e-c82b-4e27-9232-1016d6c6b088",
        "name": "Assign input (previous year)",
        "type": "n8n-nodes-base.set",
        "position": [
          2096,
          1424
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "fieldsToSummarize": {
            "values": [
              {
                "aggregation": "sum",
                "field": "Impressions"
              },
              {
                "aggregation": "average",
                "field": "CPM"
              },
              {
                "aggregation": "sum",
                "field": "Clicks"
              },
              {
                "aggregation": "average",
                "field": "CTR"
              },
              {
                "aggregation": "sum",
                "field": "Conversions"
              },
              {
                "aggregation": "average",
                "field": "Cost per conversion"
              },
              {
                "aggregation": "sum",
                "field": "Spend"
              },
              {
                "aggregation": "average",
                "field": "ROAS"
              }
            ]
          },
          "options": {}
        },
        "id": "2d510373-037c-439f-b199-c8dbb4badbce",
        "name": "Summarize input (previous year)",
        "type": "n8n-nodes-base.summarize",
        "position": [
          2272,
          1424
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "jsCode": "// Aktuelles Datum\nconst today = new Date();\n\n// Berechnung des Enddatums (letzter Tag vor dem aktuellen Datum)\nconst end = new Date(today);\nend.setDate(today.getDate() - 1);\n\n// Berechnung des Startdatums (7 Tage vor dem Enddatum)\nconst start = new Date(end);\nstart.setDate(end.getDate() - 6);\n\n// Formatierung zu YYYYMMDD\nfunction formatDate(date) {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}${month}${day}`;\n}\n\n// Ausgabe\nconst startDate = formatDate(start);\nconst endDate = formatDate(end);\n\nreturn { startDate, endDate };"
        },
        "id": "1873366d-3e54-4119-a57a-6164dc74959c",
        "name": "Calculate date format for Google Ads request (last 7 days)",
        "type": "n8n-nodes-base.code",
        "position": [
          576,
          1424
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://googleads.googleapis.com/v17/customers/3300525230/googleAds:search",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleAdsOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "developer-token",
                "value": "fzQ2U5IcU4ZH0vBDn4Slww"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "query",
                "value": "=SELECT\n   campaign.name,\n   metrics.impressions,\n   metrics.average_cpm,\n   metrics.clicks, \n   metrics.ctr,\n   metrics.conversions,\n   metrics.cost_per_conversion,\n   metrics.cost_micros,\n   metrics.conversions_value\nFROM campaign\nWHERE segments.date >= '{{ $json.startDate }}' AND segments.date <= '{{ $json.endDate }}'"
              }
            ]
          },
          "options": {}
        },
        "id": "7c9c59f0-09a2-4e85-902a-7e414161cc66",
        "name": "Call Google Ads Data: Last 7 days",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          800,
          1424
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://googleads.googleapis.com/v17/customers/3300525230/googleAds:search",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleAdsOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "developer-token",
                "value": "fzQ2U5IcU4ZH0vBDn4Slww"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "query",
                "value": "=SELECT\n   campaign.name,\n   metrics.impressions,\n   metrics.average_cpm, \n   metrics.clicks,\n   metrics.ctr,\n   metrics.conversions,\n   metrics.cost_per_conversion,\n   metrics.cost_micros,\n   metrics.conversions_value\nFROM campaign\nWHERE segments.date >= '{{ $json.startDate }}' AND segments.date <= '{{ $json.endDate }}'"
              }
            ]
          },
          "options": {}
        },
        "id": "0c1cd5d4-4a1f-4137-8c6e-1e0a61080968",
        "name": "Call Google Ads Data: Last 7 days (previous year)",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1760,
          1424
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "graphApiVersion": "v20.0",
          "node": "act_54337533",
          "edge": "insights",
          "options": {
            "queryParametersJson": "={\n \"fields\": \"impressions,cpm,inline_link_clicks,inline_link_click_ctr,conversions,cost_per_conversion,spend,action_values,purchase_roas\",\n \"time_range\": {\n   \"since\": \"{{ $json.currentPeriod.since }}\",\n   \"until\": \"{{ $json.currentPeriod.until }}\"\n }\n}"
          }
        },
        "id": "c119a73b-b985-4498-86ed-916071b28660",
        "name": "Call Meta Ads Data: Last 7 days",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          800,
          1984
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "graphApiVersion": "v20.0",
          "node": "act_54337533",
          "edge": "insights",
          "options": {
            "queryParametersJson": "={\n \"fields\": \"impressions,cpm,inline_link_clicks,inline_link_click_ctr,conversions,cost_per_conversion,spend,action_values,purchase_roas\",\n \"time_range\": {\n   \"since\": \"{{$node['Calculate date format for meta ads request s'].json.lastYear.since}}\",\n   \"until\": \"{{$node['Calculate date format for meta ads request s'].json.lastYear.until}}\"\n }\n}"
          }
        },
        "id": "b4db2830-3b5e-4793-a99c-0ccb909051fb",
        "name": "Call Meta Ads Data: Last 7 days (previous year)",
        "type": "n8n-nodes-base.facebookGraphApi",
        "position": [
          1536,
          1984
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "fieldsToSummarize": {
            "values": [
              {
                "aggregation": "sum",
                "field": "Impressions"
              },
              {
                "aggregation": "average",
                "field": "CPM"
              },
              {
                "aggregation": "sum",
                "field": "Clicks"
              },
              {
                "aggregation": "average",
                "field": "CTR"
              },
              {
                "aggregation": "sum",
                "field": "Conversions"
              },
              {
                "aggregation": "average",
                "field": "Cost per conversion"
              },
              {
                "aggregation": "sum",
                "field": "Spend"
              },
              {
                "aggregation": "average",
                "field": "ROAS"
              }
            ]
          },
          "options": {}
        },
        "id": "bfcbcf2e-079a-4c89-aeef-6d5cb2807fa8",
        "name": "Summarize Meta input (current year)",
        "type": "n8n-nodes-base.summarize",
        "position": [
          1248,
          1984
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9c2f8b9a-e964-49a0-8837-efb0dfd7bcae",
                "name": "Impressions",
                "type": "number",
                "value": "={{ $json.data[0].impressions }}"
              },
              {
                "id": "8b524518-1268-4971-b5c9-ae7da09d94f9",
                "name": "CPM",
                "type": "number",
                "value": "={{ $json.data[0].cpm }}"
              },
              {
                "id": "ca7279b9-c643-425f-aa99-cb17146e9994",
                "name": "Clicks",
                "type": "number",
                "value": "={{ $json.data[0].inline_link_clicks }}"
              },
              {
                "id": "591288f7-e8cf-445e-872a-5b83f997b825",
                "name": "CTR",
                "type": "number",
                "value": "={{ $json.data[0].inline_link_click_ctr }}"
              },
              {
                "id": "dc1a43da-3f3a-4dca-bbde-904222d7f693",
                "name": "Conversions",
                "type": "number",
                "value": "={{ $json.data[0].conversions[0].value }}"
              },
              {
                "id": "eac0b53e-c452-40b8-92bc-8af8ea349984",
                "name": "=Cost per conversion",
                "type": "number",
                "value": "={{ $json.data[0].cost_per_conversion[0].value }}"
              },
              {
                "id": "c6cac2d8-b8f8-4b2a-9bcc-1c325db78799",
                "name": "ROAS",
                "type": "number",
                "value": "={{ $json.data[0].purchase_roas[0].value }}"
              },
              {
                "id": "b96439be-189d-4ebe-b49e-d5c31fefe9f0",
                "name": "Spend",
                "type": "number",
                "value": "={{ $json.data[0].spend }}"
              }
            ]
          },
          "options": {}
        },
        "id": "fca507b9-312f-4f1e-95f3-d63e57851d81",
        "name": "Assign Meta data from input (current year)",
        "type": "n8n-nodes-base.set",
        "position": [
          1040,
          1984
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9c2f8b9a-e964-49a0-8837-efb0dfd7bcae",
                "name": "Impressions",
                "type": "number",
                "value": "={{ $json.data[0].impressions }}"
              },
              {
                "id": "8b524518-1268-4971-b5c9-ae7da09d94f9",
                "name": "CPM",
                "type": "number",
                "value": "={{ $json.data[0].cpm }}"
              },
              {
                "id": "ca7279b9-c643-425f-aa99-cb17146e9994",
                "name": "Clicks",
                "type": "number",
                "value": "={{ $json.data[0].inline_link_clicks }}"
              },
              {
                "id": "591288f7-e8cf-445e-872a-5b83f997b825",
                "name": "CTR",
                "type": "number",
                "value": "={{ $json.data[0].inline_link_click_ctr }}"
              },
              {
                "id": "dc1a43da-3f3a-4dca-bbde-904222d7f693",
                "name": "Conversions",
                "type": "number",
                "value": "={{ $json.data[0].conversions[0].value }}"
              },
              {
                "id": "eac0b53e-c452-40b8-92bc-8af8ea349984",
                "name": "=Cost per conversion",
                "type": "number",
                "value": "={{ $json.data[0].cost_per_conversion[0].value }}"
              },
              {
                "id": "b866032c-07ac-440b-a81a-d9787926b9d6",
                "name": "ROAS",
                "type": "number",
                "value": "={{ $json.data[0].purchase_roas[0].value }}"
              },
              {
                "id": "b96439be-189d-4ebe-b49e-d5c31fefe9f0",
                "name": "Spend",
                "type": "number",
                "value": "={{ $json.data[0].spend }}"
              }
            ]
          },
          "options": {}
        },
        "id": "3d857e3d-67f6-4ebf-9caa-b7c6405354f9",
        "name": "Assign Meta data input (previous year)",
        "type": "n8n-nodes-base.set",
        "position": [
          1840,
          1984
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "fieldsToSummarize": {
            "values": [
              {
                "aggregation": "sum",
                "field": "Impressions"
              },
              {
                "aggregation": "average",
                "field": "CPM"
              },
              {
                "aggregation": "sum",
                "field": "Clicks"
              },
              {
                "aggregation": "average",
                "field": "CTR"
              },
              {
                "aggregation": "sum",
                "field": "Conversions"
              },
              {
                "aggregation": "average",
                "field": "Cost per conversion"
              },
              {
                "aggregation": "sum",
                "field": "Spend"
              },
              {
                "aggregation": "average",
                "field": "ROAS"
              }
            ]
          },
          "options": {}
        },
        "id": "3c69dc26-a57a-4e18-ae33-9229ff9f6e5b",
        "name": "Summarize Meta data input (previous year)",
        "type": "n8n-nodes-base.summarize",
        "position": [
          2128,
          1984
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "jsCode": "const currentData = $('Summarize Meta input (current year)').first().json;\nconst previousData = $('Summarize Meta data input (previous year)').first().json;\n\nfunction parseNumber(value) {\n    if (typeof value === 'string') {\n        return parseFloat(value.replace(/\\./g, '').replace(',', '.'));\n    }\n    return value || 0;\n}\n\nfunction formatNumber(number, decimals = 0) {\n    if (number === 0) return \"0\";\n    return parseNumber(number).toLocaleString('de-DE', {\n        minimumFractionDigits: decimals,\n        maximumFractionDigits: decimals\n    });\n}\n\nfunction calculateCPM(cpm) {\n    return parseNumber(cpm);\n}\n\nreturn [{\n    current_impressions: formatNumber(currentData.sum_Impressions),\n    current_cpm: formatNumber(calculateCPM(currentData.average_CPM), 2),\n    current_clicks: formatNumber(currentData.sum_Clicks),\n    current_ctr: formatNumber(parseNumber(currentData.average_CTR), 2),\n    current_conversions: formatNumber(currentData.sum_Conversions, 2),\n    current_cost_per_conversion: formatNumber(currentData.average_Cost_per_conversion, 2),\n    current_cost: formatNumber(currentData.sum_Spend, 2),\n    current_roas: formatNumber(parseNumber(currentData.average_ROAS), 2),\n    \n    previous_impressions: formatNumber(previousData.sum_Impressions),\n    previous_cpm: formatNumber(calculateCPM(previousData.average_CPM), 2),\n    previous_clicks: formatNumber(previousData.sum_Clicks),\n    previous_ctr: formatNumber(parseNumber(previousData.average_CTR), 2),\n    previous_conversions: formatNumber(previousData.sum_Conversions, 2),\n    previous_cost_per_conversion: formatNumber(previousData.average_Cost_per_conversion || 0, 2),\n    previous_cost: formatNumber(previousData.sum_Spend, 2),\n    previous_roas: formatNumber(parseNumber(previousData.average_ROAS), 2)\n}];"
        },
        "id": "b97ce9b4-12cc-4df0-ae1a-99d477e6edba",
        "name": "Format all Meta data for LLM",
        "type": "n8n-nodes-base.code",
        "position": [
          2336,
          1984
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "=Please analyze the following data and output the results in table form:\n\n| Metric | Last 7 Days | Previous Year | Percentage Change |\n|--------|-------------|---------------|-------------------|\n| Total Impressions | {{$json.current_impressions}} | {{$json.previous_impressions}} | Percentage Change |\n| CPM | {{$json.current_cpm}} | {{$json.previous_cpm}} | Percentage Change |\n| Total Clicks | {{$json.current_clicks}} | {{$json.previous_clicks}} | Percentage Change |\n| CTR | {{$json.current_ctr}} | {{$json.previous_ctr}} | Percentage Change |\n| Conversions | {{$json.current_conversions}} | {{$json.previous_conversions}} | Percentage Change |\n| Cost per Conversion | {{$json.current_cost_per_conversion}} | {{$json.previous_cost_per_conversion}} | Percentage Change |\n| ROAS | {{ $json.current_roas }} | {{ $json.previous_roas }} | Percentage Change |\n| Costs | {{$json.current_cost}} | {{$json.previous_cost}} | Percentage Change |\n\nNumber format:\n- Period (.) for thousands (e.g. 4.000)\n- Comma (,) for decimal numbers (e.g. 3,4)\n- Display CPM, Cost per Conversion, ROAS and Costs in â‚¬\n- CTR in percent\n\nPlease write a brief summary of the analyzed data above the table (in max 3 sentences!)\n\nIMPORTANT:\nWrite nothing except the summary and the table below it!\nNO INTRODUCTION, NO CONCLUSION!"
              }
            ]
          },
          "options": {}
        },
        "id": "87000b27-1c0f-45d0-9a15-30035454454d",
        "name": "Processing for Google Ads report",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2576,
          1424
        ],
        "typeVersion": 1.7
      },
      {
        "parameters": {
          "jsCode": "const currentData = $('Summarize input (current year)').first().json;\nconst previousData = $('Summarize input (previous year)').first().json;\n\nfunction formatNumber(number, decimals = 0) {\n   if (number === 0) return \"0\";\n   return number.toLocaleString('de-DE', {\n       minimumFractionDigits: decimals,\n       maximumFractionDigits: decimals\n   });\n}\n\nfunction calculateCPM(costMicros, impressions) {\n   if (impressions === 0) return 0;\n   return (costMicros / 1000000 / impressions) * 1000;\n}\n\nreturn [{\n   current_impressions: formatNumber(currentData.sum_Impressions),\n   current_cpm: formatNumber(calculateCPM(currentData.sum_Spend, currentData.sum_Impressions), 2),\n   current_clicks: formatNumber(currentData.sum_Clicks),\n   current_ctr: formatNumber(currentData.average_CTR * 100, 2),\n   current_conversions: formatNumber(currentData.sum_Conversions, 2),\n   current_cost_per_conversion: formatNumber(currentData.average_Cost_per_Conversion / 1000000, 2),\n   current_cost: formatNumber(currentData.sum_Spend / 1000000, 2),\n   current_roas: formatNumber(currentData.average_ROAS, 2),\n   \n   previous_impressions: formatNumber(previousData.sum_Impressions),\n   previous_cpm: formatNumber(calculateCPM(previousData.sum_Spend, previousData.sum_Impressions), 2),\n   previous_clicks: formatNumber(previousData.sum_Clicks),\n   previous_ctr: formatNumber(previousData.average_CTR * 100, 2),\n   previous_conversions: formatNumber(previousData.sum_Conversions, 2),\n   previous_cost_per_conversion: formatNumber(previousData.average_Cost_per_conversion / 1000000, 2),\n   previous_cost: formatNumber(previousData.sum_Spend / 1000000, 2),\n   previous_roas: formatNumber(previousData.average_ROAS, 2)\n}];"
        },
        "id": "98e57595-6587-4aec-9662-ce78c07b6d56",
        "name": "Format all Google data for LLM",
        "type": "n8n-nodes-base.code",
        "position": [
          2432,
          1424
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9c2f8b9a-e964-49a0-8837-efb0dfd7bcae",
                "name": "Page views",
                "type": "number",
                "value": "={{ $json.screenPageViews }}"
              },
              {
                "id": "8b524518-1268-4971-b5c9-ae7da09d94f9",
                "name": "Users",
                "type": "number",
                "value": "={{ $json.totalUsers }}"
              },
              {
                "id": "ca7279b9-c643-425f-aa99-cb17146e9994",
                "name": "Sessions",
                "type": "number",
                "value": "={{ $json.sessions }}"
              },
              {
                "id": "591288f7-e8cf-445e-872a-5b83f997b825",
                "name": "Sessions per user",
                "type": "number",
                "value": "={{ $json.sessionsPerUser }}"
              },
              {
                "id": "dc1a43da-3f3a-4dca-bbde-904222d7f693",
                "name": "Session duration",
                "type": "number",
                "value": "={{ $json.averageSessionDuration }}"
              },
              {
                "id": "eac0b53e-c452-40b8-92bc-8af8ea349984",
                "name": "=Conversions",
                "type": "number",
                "value": "={{ $json.ecommercePurchases }}"
              },
              {
                "id": "b96439be-189d-4ebe-b49e-d5c31fefe9f0",
                "name": "Value per Conversion",
                "type": "number",
                "value": "={{ $json.averagePurchaseRevenue }}"
              },
              {
                "id": "94835d43-2fc8-49c0-97f0-6f0f8699337a",
                "name": "Revenue",
                "type": "number",
                "value": "={{ $json.purchaseRevenue }}"
              },
              {
                "id": "d70f8138-3b84-4b88-a98f-eb929e1cc29a",
                "name": "date",
                "type": "string",
                "value": "={{ $json.date }}"
              }
            ]
          },
          "options": {}
        },
        "id": "52d66a22-7f9f-4d3f-b26b-996bddd201c2",
        "name": "Assign Google Analytics data input (current year)",
        "type": "n8n-nodes-base.set",
        "position": [
          1088,
          912
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "fieldsToSummarize": {
            "values": [
              {
                "aggregation": "sum",
                "field": "Page views"
              },
              {
                "aggregation": "sum",
                "field": "Users"
              },
              {
                "aggregation": "sum",
                "field": "Sessions"
              },
              {
                "aggregation": "average",
                "field": "Sessions per user"
              },
              {
                "aggregation": "average",
                "field": "Session duration"
              },
              {
                "aggregation": "sum",
                "field": "Conversions"
              },
              {
                "aggregation": "average",
                "field": "Value per Conversion"
              },
              {
                "aggregation": "sum",
                "field": "Revenue"
              },
              {
                "field": "date"
              }
            ]
          },
          "options": {}
        },
        "id": "0b56b0f0-844d-41c5-93c4-fb902cef8b0c",
        "name": "Summarize Google Analytics input (current year)",
        "type": "n8n-nodes-base.summarize",
        "position": [
          1312,
          912
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "jsCode": "// Aktuelles Datum\nconst now = new Date();\n\n// Gestern als Ende-Datum\nconst yesterday = new Date(now);\nyesterday.setDate(now.getDate() - 1);\n\n// Start-Datum (7 Tage vor gestern)\nconst weekStart = new Date(yesterday);\nweekStart.setDate(yesterday.getDate() - 6);\n\n// Vorjahreszeitraum\nconst lastYearStart = new Date(weekStart);\nlastYearStart.setFullYear(weekStart.getFullYear() - 1);\n\nconst lastYearEnd = new Date(yesterday);\nlastYearEnd.setFullYear(yesterday.getFullYear() - 1);\n\n// Formatierung YYYY-MM-DD\nfunction formatDate(date) {\n    return date.toISOString().split('T')[0];\n}\n\n// Ausgabe\nitems[0] = {\n  json: {\n    currentPeriod: {\n      since: formatDate(weekStart),\n      until: formatDate(yesterday)\n    },\n    lastYear: {\n      since: formatDate(lastYearStart),\n      until: formatDate(lastYearEnd)\n    }\n  }\n};\n\nreturn items;"
        },
        "id": "a9ae2ccc-4340-4fab-8036-4897b37e77f4",
        "name": "Calculate date format for meta ads request s",
        "type": "n8n-nodes-base.code",
        "position": [
          576,
          1984
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "return {\n  // Berechnung des Startdatums: Vorjahr, gleiche Woche, 7 Tage zurÃ¼ck\n  startDate: (() => {\n    const date = new Date();\n    date.setFullYear(date.getFullYear() - 1); // ZurÃ¼ck ins Vorjahr\n    date.setDate(date.getDate() - 7); // 7 Tage zurÃ¼ck\n    return date.toISOString().split('T')[0];\n  })(),\n  \n  // Berechnung des Enddatums: Vorjahr, heutiges Datum\n  endDate: (() => {\n    const date = new Date();\n    date.setFullYear(date.getFullYear() - 1); // ZurÃ¼ck ins Vorjahr\n    return date.toISOString().split('T')[0];\n  })(),\n};\n"
        },
        "id": "a7541a6a-ddec-4499-aa49-93fb1bc0f233",
        "name": "Calculation same period previous year1",
        "type": "n8n-nodes-base.code",
        "position": [
          1552,
          912
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9c2f8b9a-e964-49a0-8837-efb0dfd7bcae",
                "name": "Page views",
                "type": "number",
                "value": "={{ $json.screenPageViews }}"
              },
              {
                "id": "8b524518-1268-4971-b5c9-ae7da09d94f9",
                "name": "Users",
                "type": "number",
                "value": "={{ $json.totalUsers }}"
              },
              {
                "id": "ca7279b9-c643-425f-aa99-cb17146e9994",
                "name": "Sessions",
                "type": "number",
                "value": "={{ $json.sessions }}"
              },
              {
                "id": "591288f7-e8cf-445e-872a-5b83f997b825",
                "name": "Sessions per user",
                "type": "number",
                "value": "={{ $json.sessionsPerUser }}"
              },
              {
                "id": "dc1a43da-3f3a-4dca-bbde-904222d7f693",
                "name": "Session duration",
                "type": "number",
                "value": "={{ $json.averageSessionDuration }}"
              },
              {
                "id": "eac0b53e-c452-40b8-92bc-8af8ea349984",
                "name": "=Conversions",
                "type": "number",
                "value": "={{ $json.ecommercePurchases }}"
              },
              {
                "id": "b96439be-189d-4ebe-b49e-d5c31fefe9f0",
                "name": "Value per conversion",
                "type": "number",
                "value": "={{ $json.averagePurchaseRevenue }}"
              },
              {
                "id": "94835d43-2fc8-49c0-97f0-6f0f8699337a",
                "name": "Revenue",
                "type": "number",
                "value": "={{ $json.purchaseRevenue }}"
              },
              {
                "id": "dd8255c6-65b1-41ce-b596-70c09108d6e2",
                "name": "=date",
                "type": "string",
                "value": "={{ $json.date }}"
              }
            ]
          },
          "options": {}
        },
        "id": "11589ea4-10e8-4471-bcd7-74ccf2a21142",
        "name": "Assign Google Analytics data input (previous year)",
        "type": "n8n-nodes-base.set",
        "position": [
          2000,
          912
        ],
        "typeVersion": 3.4
      },
      {
        "parameters": {
          "fieldsToSummarize": {
            "values": [
              {
                "aggregation": "sum",
                "field": "Page views"
              },
              {
                "aggregation": "sum",
                "field": "Users"
              },
              {
                "aggregation": "sum",
                "field": "Sessions"
              },
              {
                "aggregation": "average",
                "field": "Sessions per user"
              },
              {
                "aggregation": "average",
                "field": "Session duration"
              },
              {
                "aggregation": "sum",
                "field": "Conversions"
              },
              {
                "aggregation": "average",
                "field": "Value per conversion"
              },
              {
                "aggregation": "sum",
                "field": "Revenue"
              },
              {
                "field": "date"
              }
            ]
          },
          "options": {}
        },
        "id": "a2b71bcb-d775-4caf-a6a3-c7a1c19dc320",
        "name": "Summarize Google Analytics input (previous year)",
        "type": "n8n-nodes-base.summarize",
        "position": [
          2208,
          912
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "fromEmail": "friedemann.schuetz@posteo.de",
          "toEmail": "friedemann.schuetz@ep-reisen.de",
          "subject": "Weekly Report: Online Marketing Report",
          "html": "={{ $json.output }}",
          "options": {}
        },
        "id": "90ee5316-7ee0-4809-b3f0-f164fdef561f",
        "name": "Send mail report",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          2736,
          224
        ],
        "typeVersion": 2.1,
        "webhookId": "abab47ce-aeab-4155-a403-93d20b89612e"
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "=Please analyze the following data and output the results in table form:\n\n| Metric | Last 7 Days | Previous Year | Percentage Change |\n|--------|-------------|---------------|-------------------|\n| Total Impressions | {{$json.current_impressions}} | {{$json.previous_impressions}} | Percentage Change |\n| CPM | {{$json.current_cpm}} | {{$json.previous_cpm}} | Percentage Change |\n| Total Clicks | {{$json.current_clicks}} | {{$json.previous_clicks}} | Percentage Change |\n| CTR | {{$json.current_ctr}} | {{$json.previous_ctr}} | Percentage Change |\n| Conversions | {{$json.current_conversions}} | {{$json.previous_conversions}} | Percentage Change |\n| Cost per Conversion | {{$json.current_cost_per_conversion}} | {{$json.previous_cost_per_conversion}} | Percentage Change |\n| ROAS | {{ $json.current_roas }} | {{ $json.previous_roas }} | Percentage Change |\n| Costs | {{$json.current_cost}} | {{$json.previous_cost}} | Percentage Change |\n\nNumber format:\n- Period (.) for thousands (e.g. 4.000)\n- Comma (,) for decimal numbers (e.g. 3,4)\n- Display CPM, Cost per Conversion, ROAS and Costs in â‚¬\n- CTR in percent\n\nPlease write a brief summary of the analyzed data above the table (in max 3 sentences!)\n\nIMPORTANT:\nWrite nothing except the summary and the table below it!\nNO INTRODUCTION, NO CONCLUSION!"
              }
            ]
          },
          "options": {}
        },
        "id": "cb40d37f-81e7-40fe-9e4a-05b18efcd4cb",
        "name": "Processing for Meta Ads Report",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2576,
          1984
        ],
        "typeVersion": 1.7
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o",
            "cachedResultName": "GPT-4O"
          },
          "messages": {
            "values": [
              {
                "content": "=Please analyze the following data and output the results in table form:\n| Metric                        | Last 7 Days | Previous Year | Percentage Change |\n|-------------------------------|-------------|---------------|-------------------|\n| Total Page Views              | {{ $('Summarize Google Analytics input (current year)').item.json.sum_Page_views }} | {{ $json.sum_Page_views }} | Percentage Change |\n| Total Users                   | {{ $('Summarize Google Analytics input (current year)').item.json.sum_Users }} | {{ $json.sum_Users }} | Percentage Change |\n| Total Sessions                | {{ $('Summarize Google Analytics input (current year)').item.json.sum_Sessions }} | {{ $json.sum_Sessions }} | Percentage Change |\n| Average Sessions per User     | {{ $('Summarize Google Analytics input (current year)').item.json.average_Sessions_per_user }} | {{ $json.average_Sessions_per_user }} | Percentage Change |\n| Average Session Duration      | {{ $('Summarize Google Analytics input (current year)').item.json.average_Session_duration }} | {{ $json.average_Session_duration }} | Percentage Change |\n| Total Purchases               | {{ $('Summarize Google Analytics input (current year)').item.json.sum_Conversions }} | {{ $json.sum_Conversions }} | Percentage Change |\n| Average Revenue per Purchase  | {{ $('Summarize Google Analytics input (current year)').item.json.average_Value_per_Conversion }} | {{ $json.average_Value_per_conversion }} | Percentage Change |\n| Total Revenue                 | {{ $('Summarize Google Analytics input (current year)').item.json.sum_Revenue }} | {{ $('Summarize Google Analytics input (previous year)').item.json.sum_Revenue }} | Percentage Change |\n\nNumber format:\n- Period (.) for thousands (e.g. 4.000)\n- Comma (,) for decimal numbers (e.g. 3,4)\n- Convert Average Session Duration to minutes instead of seconds\n- Average Revenue per Purchase and Total Revenue in â‚¬\n\nPlease write a brief summary of the analyzed data above the table (in max 3 sentences!)\n\nIMPORTANT:\nWrite nothing except the summary and the table below it!\nNO INTRODUCTION, NO CONCLUSION!"
              }
            ]
          },
          "options": {}
        },
        "id": "ce99b31e-b87b-4be8-9bf0-fd3d83c0f75a",
        "name": "Processing for Google Analytics Report",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2576,
          912
        ],
        "typeVersion": 1.7
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini",
            "cachedResultName": "GPT-4O-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "=Convert the following text from HTML to plain text:\n\n{{ $json.output }}\n\nPlease format the table so that each evaluation (Domain 1, Domain 2, Domain 3, Domain 4, Domain 5, Google Ads, Meta Ads) is its own paragraph! Also, please display only the summary (without the table), but incorporate the numbers into the running text!\n\nExample:\n\nDomain 1:\nxx,xxx page views (+x.xx%)\nxx,xxx users (-x.xx%)\n\nDomain 2:\nxx,xxx page views (+x.xx%)\nxx,xxx users (-x.xx%)\n\n<userStyle>Normal</userStyle>"
              }
            ]
          },
          "options": {}
        },
        "id": "25f40334-17ea-4e6d-a2e8-b195b6ddffc7",
        "name": "Processing for Telegram Report",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          2176,
          448
        ],
        "typeVersion": 1.7
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=# Expert in Data Processing and Email Generation in N8N\nYOU ARE AN EXPERT IN DATA PROCESSING AND EMAIL GENERATION IN N8N. YOUR TASK IS TO CREATE AN ENGLISH-LANGUAGE HTML EMAIL THAT COMPREHENSIVELY SUMMARIZES GOOGLE ANALYTICS AND GOOGLE ADS DATA FROM VARIOUS WORKFLOWS. YOU MUST FORMAT THE CAPTURED DATA ACCORDING TO THE SPECIFIED SPECIFICATIONS AND DESIGN THE EMAIL FOR OPTIMAL READABILITY.\n\n## Instructions\n\n### 1. Collect Summary\n- First, retrieve the summary and table for `Analytics_Domain_1` from the `Analytics_Domain_1` workflow.\n- Second, retrieve the summary and table for `Analytics_Domain_2` from the `Analytics_Domain_2` workflow.\n- Third, retrieve the summary and table for `Analytics_Domain_3` from the `Analytics_Domain_3` workflow.\n- Fourth, retrieve the summary and table for `Analytics_Domain_4` from the `Analytics_Domain_4` workflow.\n- Fifth, retrieve the summary and table for `Analytics_Domain_5` from the `Analytics_Domain_5` workflow.\n- Sixth, retrieve the summary and table for `Google_Ads` from the `Google_Ads` workflow.\n- Seventh, retrieve the summary and table for `Meta_Ads` from the `Meta_Ads` workflow.\n\n### 2. Email Structure\n- Begin the email with the following introduction:  \n  \"Hi Freddy,  \n  Here is your weekly Online Marketing Report for the last 7 days from Domain 1, Domain 2, Domain 3, Domain 4, Domain 5, as well as Google Ads and Meta Ads!\"\n\n- Create a separate section for each dataset:  \n  - **Domain 1**: Contains the summary and table from `Analytics_Domain_1`\n  - **Domain 2**: Contains the summary and table from `Analytics_Domain_2`\n  - **Domain 3**: Contains the summary and table from `Analytics_Domain_3`\n  - **Domain 4**: Contains the summary and table from `Analytics_Domain_4`\n  - **Domain 5**: Contains the summary and table from `Analytics_Domain_5`\n  - **Google Ads**: Contains the summary and table from `Google Ads`\n  - **Meta Ads**: Contains the summary and table from `Meta Ads`\n\n- Present the sections clearly and readably as HTML.\n\n### 3. Design and Formatting\n- Use simple HTML structures with clear section titles (e.g., `<h2>` for titles).\n- Present the summary as a paragraph (e.g., `<p>`).\n- The table should be cleanly formatted (e.g., with `<table>`, `<tr>`, `<td>`).\n- Keep the presentation clear and easy to read.\n\n### 4. No Conclusion, No Signature\n\n### HTML Output Structure\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            line-height: 1.6;\n        }\n        h2 {\n            color: #333;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 10px 0;\n        }\n        table, th, td {\n            border: 1px solid #ddd;\n        }\n        th, td {\n            padding: 8px;\n            text-align: left;\n        }\n        th {\n            background-color: #f4f4f4;\n        }\n    </style>\n</head>\n<body>\n    <p>Hi,</p>\n    <p>Here is your weekly Online Marketing Report for the last 7 days from Domain 1, Domain 2, Domain 3, Domain 4, Domain 5, as well as Google Ads and Meta Ads!</p>\n    \n    <h2>Domain 1</h2>\n    <p>[Summary from Analytics_Domain_1 will be inserted here]</p>\n    <table>\n        [Table content from Analytics_Domain_1 will be inserted here]\n    </table>\n    \n    <h2>Domain 2</h2>\n    <p>[Summary from Analytics_Domain_2 will be inserted here]</p>\n    <table>\n        [Table content from Analytics_Domain_2 will be inserted here]\n    </table>\n</body>\n</html>\n```\n\n### 5. Output\n- Format the entire HTML content as a string for email transmission.\n\n### What Not to Do\n- No unwanted closings or signatures\n- No unstructured, hard-to-read data formatting\n- No missing sections or titles\n- No copying of data without HTML formatting",
          "options": {}
        },
        "id": "f6f18e9e-dd02-4094-9704-552d3e169a80",
        "name": "Weekly Report Agent",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          1280,
          224
        ],
        "typeVersion": 1.7
      },
      {
        "parameters": {
          "chatId": "1810565648",
          "text": "={{ $json.message.content }}",
          "additionalFields": {}
        },
        "id": "474c7709-da42-46b4-b359-b5d9da3173ab",
        "name": "Send Telegram report",
        "type": "n8n-nodes-base.telegram",
        "position": [
          2736,
          448
        ],
        "typeVersion": 1.2,
        "webhookId": "f1e45e22-5ba5-4418-a44b-61fd77151bf2"
      },
      {
        "parameters": {
          "content": "Welcome to Online Marketing Weekly Report Workflow!\n\nThis workflow has the following sequence:\n\n1. time trigger (e.g. every Monday at 7 a.m.)\n2. retrieval of Online Marketing data from the last 7 days (via sub workflows)\n3. assignment and summary of the data\n4. retrieval of Online Marketing data from the same time period of the previous year\n5. allocation and summary of the data\n6. preparation in tabular form and brief analysis by AI.\n7. sending the report as an email\n8. preparation in short form by AI for Telegram (optional)\n9. sending as Telegram message.\n\nThe following accesses are required for the workflow:\n- Google Analytics (via Google Analytics API): [Documentation](https://docs.n8n.io/integrations/builtin/credentials/google/)\n- Google Ads (via HTTP Request -&gt; Google Ads API):[Documentation](https://docs.n8n.io/integrations/builtin/credentials/google/)\n- Meta Ads (via Facebook Graph API): [Documentation](https://docs.n8n.io/integrations/builtin/credentials/facebookgraph/)\n- AI API access (e.g. via OpenAI, Anthropic, Google or Ollama)\n- SMTP access data (for sending the mail)\n- Telegram access data (optional for sending as Telegram message): [Documentation](https://docs.n8n.io/integrations/builtin/credentials/telegram/)\n\nYou can contact me via LinkedIn, if you have any questions: https://www.linkedin.com/in/friedemann-schuetz",
          "height": 2180,
          "width": 440
        },
        "id": "bb33528b-721f-48ea-b963-71646a50596b",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          48,
          160
        ],
        "typeVersion": 1
      }
    ],
    "pinData": {},
    "connections": {
      "Meta_Ads": {
        "ai_tool": [
          [
            {
              "node": "Weekly Report Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Calculator": {
        "ai_tool": [
          [
            {
              "node": "Processing for Google Analytics Report",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Google_Ads": {
        "ai_tool": [
          [
            {
              "node": "Weekly Report Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Calculator1": {
        "ai_tool": [
          [
            {
              "node": "Processing for Google Ads report",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Calculator3": {
        "ai_tool": [
          [
            {
              "node": "Processing for Meta Ads Report",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Weekly Report Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Weekly Report Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Analytics_Domain_1": {
        "ai_tool": [
          [
            {
              "node": "Weekly Report Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Analytics_Domain_2": {
        "ai_tool": [
          [
            {
              "node": "Weekly Report Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Analytics_Domain_3": {
        "ai_tool": [
          [
            {
              "node": "Weekly Report Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Analytics_Domain_4": {
        "ai_tool": [
          [
            {
              "node": "Weekly Report Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Analytics_Domain_5": {
        "ai_tool": [
          [
            {
              "node": "Weekly Report Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Weekly Report Agent": {
        "main": [
          [
            {
              "node": "Processing for Telegram Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send mail report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute Workflow Trigger": {
        "main": [
          [
            {
              "node": "Call Google Analytics data: Last 7 days",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Assign input (previous year)": {
        "main": [
          [
            {
              "node": "Summarize input (previous year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format all Meta data for LLM": {
        "main": [
          [
            {
              "node": "Processing for Meta Ads Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format all Google data for LLM": {
        "main": [
          [
            {
              "node": "Processing for Google Ads report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Processing for Telegram Report": {
        "main": [
          [
            {
              "node": "Send Telegram report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summarize input (current year)": {
        "main": [
          [
            {
              "node": "Calculation same period previous year",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call Meta Ads Data: Last 7 days": {
        "main": [
          [
            {
              "node": "Assign Meta data from input (current year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summarize input (previous year)": {
        "main": [
          [
            {
              "node": "Format all Google data for LLM",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format data input (current year)": {
        "main": [
          [
            {
              "node": "Assign data from input (current year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call Google Ads Data: Last 7 days": {
        "main": [
          [
            {
              "node": "Format data input (current year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format data input (previous year)": {
        "main": [
          [
            {
              "node": "Assign input (previous year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summarize Meta input (current year)": {
        "main": [
          [
            {
              "node": "Call Meta Ads Data: Last 7 days (previous year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Assign data from input (current year)": {
        "main": [
          [
            {
              "node": "Summarize input (current year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculation same period previous year": {
        "main": [
          [
            {
              "node": "Call Google Ads Data: Last 7 days (previous year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Assign Meta data input (previous year)": {
        "main": [
          [
            {
              "node": "Summarize Meta data input (previous year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculation same period previous year1": {
        "main": [
          [
            {
              "node": "Call Google Analytics data: Last 7 days (previous year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call Google Analytics data: Last 7 days": {
        "main": [
          [
            {
              "node": "Assign Google Analytics data input (current year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summarize Meta data input (previous year)": {
        "main": [
          [
            {
              "node": "Format all Meta data for LLM",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Assign Meta data from input (current year)": {
        "main": [
          [
            {
              "node": "Summarize Meta input (current year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate date format for meta ads request s": {
        "main": [
          [
            {
              "node": "Call Meta Ads Data: Last 7 days",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call Meta Ads Data: Last 7 days (previous year)": {
        "main": [
          [
            {
              "node": "Assign Meta data input (previous year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summarize Google Analytics input (current year)": {
        "main": [
          [
            {
              "node": "Calculation same period previous year1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summarize Google Analytics input (previous year)": {
        "main": [
          [
            {
              "node": "Processing for Google Analytics Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Assign Google Analytics data input (current year)": {
        "main": [
          [
            {
              "node": "Summarize Google Analytics input (current year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call Google Ads Data: Last 7 days (previous year)": {
        "main": [
          [
            {
              "node": "Format data input (previous year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Assign Google Analytics data input (previous year)": {
        "main": [
          [
            {
              "node": "Summarize Google Analytics input (previous year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call Google Analytics data: Last 7 days (previous year)": {
        "main": [
          [
            {
              "node": "Assign Google Analytics data input (previous year)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate date format for Google Ads request (last 7 days)": {
        "main": [
          [
            {
              "node": "Call Google Ads Data: Last 7 days",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "active": false,
    "settings": {
      "executionOrder": "v1"
    },
    "versionId": "a626e1ab-b3f3-481d-a8e0-101e1c7ef452",
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "f2f7de7862d0ee6a4f18562bc70ca627316d8f13263a729541e12754b4ea41b0"
    },
    "id": "0ZHzXJ1MOaU2oiLN",
    "tags": []
  },
  {
    "name": "Placeholder n8n workflow 1",
    "nodes": [
      {
        "id": "1",
        "name": "Start",
        "type": "n8n-nodes-base.start",
        "position": [
          250,
          300
        ]
      }
    ],
    "connections": {}
  },
  {
    "name": "Placeholder n8n workflow 2",
    "nodes": [
      {
        "id": "1",
        "name": "HTTP Request",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          300,
          300
        ],
        "parameters": {
          "url": "https://example.com",
          "options": {}
        }
      }
    ],
    "connections": {}
  },
  {
    "name": "Placeholder n8n workflow 3",
    "nodes": [
      {
        "id": "1",
        "name": "Set",
        "type": "n8n-nodes-base.set",
        "position": [
          200,
          200
        ],
        "parameters": {
          "values": [
            {
              "key": "example",
              "value": "hello"
            }
          ]
        }
      }
    ],
    "connections": {}
  },
  {
    "name": "Grain Local Business Listing Manager v1",
    "nodes": [
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 1
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Hourly Review Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          220,
          300
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "listing-manager",
          "responseMode": "responseNode",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Manual Trigger",
        "type": "n8n-nodes-base.webhook",
        "position": [
          220,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "// Ä°ÅŸletme Profil KonfigÃ¼rasyonu\nconst businessConfig = {\n  business_id: $env.BUSINESS_ID || 'BIZ_001',\n  business_name: $env.BUSINESS_NAME || 'Ä°ÅŸletme AdÄ±',\n  business_name_local: $env.BUSINESS_NAME_LOCAL || 'Ä°ÅŸletme AdÄ± (Yerel)',\n  \n  contact: {\n    primary_phone: $env.BUSINESS_PHONE || '+90 212 XXX XX XX',\n    whatsapp: $env.BUSINESS_WHATSAPP || '+90 532 XXX XX XX',\n    email: $env.BUSINESS_EMAIL || 'info@isletme.com',\n    website: $env.BUSINESS_WEBSITE || 'https://www.isletme.com'\n  },\n  \n  location: {\n    address: $env.BUSINESS_ADDRESS || 'Ã–rnek Caddesi No: 123',\n    city: $env.BUSINESS_CITY || 'Ä°stanbul',\n    district: $env.BUSINESS_DISTRICT || 'KadÄ±kÃ¶y',\n    postal_code: $env.BUSINESS_POSTAL || '34710',\n    coordinates: {\n      lat: parseFloat($env.BUSINESS_LAT) || 40.9876,\n      lng: parseFloat($env.BUSINESS_LNG) || 29.0234\n    }\n  },\n  \n  category: {\n    primary: $env.BUSINESS_CATEGORY || 'restaurant',\n    google_category_id: $env.GOOGLE_CATEGORY_ID || 'gcid:restaurant'\n  },\n  \n  platforms: {\n    google_business_profile: {\n      enabled: true,\n      place_id: $env.GOOGLE_PLACE_ID || '',\n      api_enabled: !!$env.GOOGLE_BUSINESS_API_KEY\n    },\n    tripadvisor: {\n      enabled: true,\n      location_id: $env.TRIPADVISOR_LOCATION_ID || '',\n      api_enabled: !!$env.TRIPADVISOR_API_KEY\n    },\n    yelp: {\n      enabled: true,\n      business_id: $env.YELP_BUSINESS_ID || '',\n      api_enabled: !!$env.YELP_API_KEY\n    },\n    facebook: {\n      enabled: true,\n      page_id: $env.FACEBOOK_PAGE_ID || '',\n      api_enabled: !!$env.FACEBOOK_ACCESS_TOKEN\n    },\n    yemeksepeti: {\n      enabled: $env.YEMEKSEPETI_ENABLED === 'true',\n      restaurant_id: $env.YEMEKSEPETI_ID || ''\n    },\n    foursquare: {\n      enabled: true,\n      venue_id: $env.FOURSQUARE_VENUE_ID || ''\n    },\n    apple_maps: {\n      enabled: true,\n      maps_id: $env.APPLE_MAPS_ID || ''\n    },\n    bing_places: {\n      enabled: true,\n      business_id: $env.BING_BUSINESS_ID || ''\n    },\n    yandex_maps: {\n      enabled: true,\n      org_id: $env.YANDEX_ORG_ID || ''\n    }\n  },\n  \n  review_settings: {\n    auto_respond_positive: true,\n    auto_respond_neutral: true,\n    auto_respond_negative: false,\n    min_rating_for_auto: 4,\n    response_language: 'tr',\n    notify_on_negative: true,\n    negative_threshold: 3\n  },\n  \n  ai_settings: {\n    model: 'gpt-4o',\n    tone: 'professional_friendly',\n    include_emoji: true,\n    signature: $env.RESPONSE_SIGNATURE || 'Ä°ÅŸletme Ekibi',\n    owner_signature: $env.OWNER_SIGNATURE || 'Ä°ÅŸletme Sahibi'\n  }\n};\n\nreturn [{ json: { config: businessConfig, trigger_type: 'scheduled' } }];"
        },
        "id": "load-config",
        "name": "Ä°ÅŸletme KonfigÃ¼rasyonu",
        "type": "n8n-nodes-base.code",
        "position": [
          440,
          400
        ]
      },
      {
        "parameters": {
          "url": "https://mybusiness.googleapis.com/v4/accounts/{{ $env.GOOGLE_ACCOUNT_ID }}/locations/{{ $env.GOOGLE_LOCATION_ID }}/reviews",
          "authentication": "oAuth2Api",
          "options": {
            "response": {
              "response": {
                "responseFormat": "json"
              }
            }
          }
        },
        "id": "fetch-google-reviews",
        "name": "Google Reviews Ã‡ek",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          660,
          200
        ],
        "credentials": {
          "googleBusinessProfileOAuth2Api": {
            "id": "google-business-creds",
            "name": "Google Business Profile"
          }
        },
        "continueOnFail": true
      },
      {
        "parameters": {
          "url": "https://api.tripadvisor.com/api/partner/2.0/location/{{ $env.TRIPADVISOR_LOCATION_ID }}/reviews",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {
            "response": {
              "response": {
                "responseFormat": "json"
              }
            }
          }
        },
        "id": "fetch-tripadvisor-reviews",
        "name": "TripAdvisor Reviews Ã‡ek",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          660,
          350
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "tripadvisor-creds",
            "name": "TripAdvisor API"
          }
        },
        "continueOnFail": true
      },
      {
        "parameters": {
          "url": "https://api.yelp.com/v3/businesses/{{ $env.YELP_BUSINESS_ID }}/reviews",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-yelp-reviews",
        "name": "Yelp Reviews Ã‡ek",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          660,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "yelp-creds",
            "name": "Yelp API"
          }
        },
        "continueOnFail": true
      },
      {
        "parameters": {
          "url": "https://graph.facebook.com/v18.0/{{ $env.FACEBOOK_PAGE_ID }}/ratings",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "id": "fetch-facebook-reviews",
        "name": "Facebook Reviews Ã‡ek",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          660,
          650
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "facebook-creds",
            "name": "Facebook API"
          }
        },
        "continueOnFail": true
      },
      {
        "parameters": {
          "jsCode": "// TÃ¼m platformlardan gelen yorumlarÄ± birleÅŸtir ve normalize et\nconst config = $('Ä°ÅŸletme KonfigÃ¼rasyonu').first().json.config;\n\nconst googleReviews = $('Google Reviews Ã‡ek').first().json?.reviews || [];\nconst tripAdvisorReviews = $('TripAdvisor Reviews Ã‡ek').first().json?.data || [];\nconst yelpReviews = $('Yelp Reviews Ã‡ek').first().json?.reviews || [];\nconst facebookReviews = $('Facebook Reviews Ã‡ek').first().json?.data || [];\n\n// Normalize fonksiyonu\nfunction normalizeReview(review, platform) {\n  const normalized = {\n    id: '',\n    platform: platform,\n    author_name: '',\n    author_avatar: '',\n    rating: 0,\n    text: '',\n    date: '',\n    language: 'tr',\n    has_response: false,\n    response_text: '',\n    sentiment: 'neutral'\n  };\n  \n  switch(platform) {\n    case 'google':\n      normalized.id = `google_${review.reviewId || review.name}`;\n      normalized.author_name = review.reviewer?.displayName || 'Anonim';\n      normalized.author_avatar = review.reviewer?.profilePhotoUrl || '';\n      normalized.rating = review.starRating === 'FIVE' ? 5 : \n                          review.starRating === 'FOUR' ? 4 :\n                          review.starRating === 'THREE' ? 3 :\n                          review.starRating === 'TWO' ? 2 : 1;\n      normalized.text = review.comment || '';\n      normalized.date = review.createTime || review.updateTime;\n      normalized.has_response = !!review.reviewReply;\n      normalized.response_text = review.reviewReply?.comment || '';\n      break;\n      \n    case 'tripadvisor':\n      normalized.id = `ta_${review.id}`;\n      normalized.author_name = review.user?.username || 'Traveler';\n      normalized.author_avatar = review.user?.avatar?.small || '';\n      normalized.rating = review.rating || 0;\n      normalized.text = review.text || review.title || '';\n      normalized.date = review.published_date;\n      normalized.language = review.lang || 'en';\n      normalized.has_response = !!review.owner_response;\n      normalized.response_text = review.owner_response?.text || '';\n      break;\n      \n    case 'yelp':\n      normalized.id = `yelp_${review.id}`;\n      normalized.author_name = review.user?.name || 'Yelper';\n      normalized.author_avatar = review.user?.image_url || '';\n      normalized.rating = review.rating || 0;\n      normalized.text = review.text || '';\n      normalized.date = review.time_created;\n      normalized.language = 'en';\n      break;\n      \n    case 'facebook':\n      normalized.id = `fb_${review.reviewer?.id || Date.now()}`;\n      normalized.author_name = review.reviewer?.name || 'Facebook User';\n      normalized.rating = review.rating || (review.recommendation_type === 'positive' ? 5 : 2);\n      normalized.text = review.review_text || '';\n      normalized.date = review.created_time;\n      break;\n  }\n  \n  // Sentiment analizi\n  if (normalized.rating >= 4) normalized.sentiment = 'positive';\n  else if (normalized.rating === 3) normalized.sentiment = 'neutral';\n  else normalized.sentiment = 'negative';\n  \n  return normalized;\n}\n\n// TÃ¼m yorumlarÄ± birleÅŸtir\nconst allReviews = [\n  ...googleReviews.map(r => normalizeReview(r, 'google')),\n  ...tripAdvisorReviews.map(r => normalizeReview(r, 'tripadvisor')),\n  ...yelpReviews.map(r => normalizeReview(r, 'yelp')),\n  ...facebookReviews.map(r => normalizeReview(r, 'facebook'))\n];\n\n// YanÄ±tlanmamÄ±ÅŸ yorumlarÄ± filtrele\nconst unansweredReviews = allReviews.filter(r => !r.has_response);\n\n// Ä°statistikler\nconst stats = {\n  total_reviews: allReviews.length,\n  unanswered_count: unansweredReviews.length,\n  avg_rating: allReviews.length > 0 ? \n    (allReviews.reduce((sum, r) => sum + r.rating, 0) / allReviews.length).toFixed(2) : 0,\n  sentiment_breakdown: {\n    positive: allReviews.filter(r => r.sentiment === 'positive').length,\n    neutral: allReviews.filter(r => r.sentiment === 'neutral').length,\n    negative: allReviews.filter(r => r.sentiment === 'negative').length\n  },\n  by_platform: {\n    google: googleReviews.length,\n    tripadvisor: tripAdvisorReviews.length,\n    yelp: yelpReviews.length,\n    facebook: facebookReviews.length\n  }\n};\n\nreturn [{\n  json: {\n    config,\n    all_reviews: allReviews,\n    unanswered_reviews: unansweredReviews,\n    stats,\n    timestamp: new Date().toISOString()\n  }\n}];"
        },
        "id": "merge-reviews",
        "name": "YorumlarÄ± BirleÅŸtir",
        "type": "n8n-nodes-base.code",
        "position": [
          880,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{ $json.unanswered_reviews.length }}",
                "operation": "larger",
                "value2": 0
              }
            ]
          }
        },
        "id": "check-unanswered",
        "name": "YanÄ±tlanmamÄ±ÅŸ Var mÄ±?",
        "type": "n8n-nodes-base.if",
        "position": [
          1100,
          400
        ]
      },
      {
        "parameters": {
          "batchSize": 1,
          "options": {}
        },
        "id": "split-reviews",
        "name": "YorumlarÄ± AyÄ±r",
        "type": "n8n-nodes-base.splitInBatches",
        "position": [
          1320,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "const review = $input.first().json;\nconst config = $('YorumlarÄ± BirleÅŸtir').first().json.config;\n\n// YanÄ±t gerekiyor mu kontrol et\nconst shouldAutoRespond = \n  (review.sentiment === 'positive' && config.review_settings.auto_respond_positive) ||\n  (review.sentiment === 'neutral' && config.review_settings.auto_respond_neutral);\n\nconst requiresApproval = \n  review.sentiment === 'negative' || \n  review.rating < config.review_settings.min_rating_for_auto;\n\nreturn [{\n  json: {\n    ...review,\n    config,\n    should_auto_respond: shouldAutoRespond,\n    requires_approval: requiresApproval\n  }\n}];"
        },
        "id": "process-single-review",
        "name": "Yorum Ä°ÅŸle",
        "type": "n8n-nodes-base.code",
        "position": [
          1540,
          300
        ]
      },
      {
        "parameters": {
          "resource": "chat",
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "={{ `Sen bir iÅŸletme yorum yanÄ±tlama uzmanÄ±sÄ±n. MÃ¼ÅŸteri yorumlarÄ±na profesyonel, samimi ve markanÄ±n sesine uygun yanÄ±tlar yazÄ±yorsun.\n\nÄ°ÅŸletme Bilgileri:\n- Ä°sim: ${$json.config.business_name}\n- Konum: ${$json.config.location.city}, ${$json.config.location.district}\n- Kategori: ${$json.config.category.primary}\n\nYanÄ±t KurallarÄ±:\n1. Her zaman mÃ¼ÅŸteriye ismiyle hitap et (varsa)\n2. TÃ¼rk misafirperverliÄŸini yansÄ±t\n3. Pozitif yorumlarda teÅŸekkÃ¼r et ve tekrar davet et\n4. NÃ¶tr yorumlarda geri bildirimi deÄŸerlendir ve iyileÅŸtirme sÃ¶zÃ¼ ver\n5. Negatif yorumlarda Ã¶zÃ¼r dile, asla savunmacÄ± olma, Ã§Ã¶zÃ¼m Ã¶ner\n6. ${$json.config.ai_settings.include_emoji ? 'Uygun yerlerde emoji kullan' : 'Emoji kullanma'}\n7. Ä°mza: ${$json.config.ai_settings.signature}\n8. Ton: ${$json.config.ai_settings.tone}\n9. Dil: ${$json.config.review_settings.response_language === 'tr' ? 'TÃ¼rkÃ§e' : 'Ä°ngilizce'}\n\nYasak kelimeler: indirim, Ã¼cretsiz, tazminat, yasal, dava, ÅŸikayet\n\nSadece yanÄ±t metnini yaz, baÅŸka aÃ§Ä±klama ekleme.` }}"
              },
              {
                "role": "user",
                "content": "={{ `Platform: ${$json.platform}\nMÃ¼ÅŸteri: ${$json.author_name}\nPuan: ${$json.rating}/5\nDuygu: ${$json.sentiment}\n\nYorum:\n\"${$json.text}\"\n\nBu yoruma uygun bir yanÄ±t yaz.` }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7,
            "maxTokens": 300
          }
        },
        "id": "generate-ai-response",
        "name": "AI YanÄ±t OluÅŸtur",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1760,
          300
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-creds",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "boolean": [
              {
                "value1": "={{ $node['Yorum Ä°ÅŸle'].json.requires_approval }}",
                "value2": true
              }
            ]
          }
        },
        "id": "check-approval-needed",
        "name": "Onay Gerekiyor mu?",
        "type": "n8n-nodes-base.if",
        "position": [
          1980,
          300
        ]
      },
      {
        "parameters": {
          "channel": "={{ $env.SLACK_REVIEW_CHANNEL || '#reviews' }}",
          "text": "={{ ':warning: *Negatif Yorum - Onay Bekliyor*\\n\\n*Platform:* ' + $node['Yorum Ä°ÅŸle'].json.platform + '\\n*MÃ¼ÅŸteri:* ' + $node['Yorum Ä°ÅŸle'].json.author_name + '\\n*Puan:* ' + $node['Yorum Ä°ÅŸle'].json.rating + '/5\\n\\n*Yorum:*\\n> ' + $node['Yorum Ä°ÅŸle'].json.text + '\\n\\n*Ã–nerilen YanÄ±t:*\\n' + $json.message.content + '\\n\\n_YanÄ±tÄ± onaylamak iÃ§in ðŸ‘ tepkisi verin_' }}",
          "otherOptions": {}
        },
        "id": "slack-approval",
        "name": "Slack Onay Ä°ste",
        "type": "n8n-nodes-base.slack",
        "position": [
          2200,
          200
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-creds",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const review = $node['Yorum Ä°ÅŸle'].first().json;\nconst aiResponse = $input.first().json.message.content;\nconst config = review.config;\n\nreturn [{\n  json: {\n    review_id: review.id,\n    platform: review.platform,\n    author_name: review.author_name,\n    rating: review.rating,\n    original_text: review.text,\n    response_text: aiResponse,\n    responded_at: new Date().toISOString(),\n    responded_by: 'ai_auto',\n    status: 'ready_to_post'\n  }\n}];"
        },
        "id": "prepare-auto-response",
        "name": "Otomatik YanÄ±t HazÄ±rla",
        "type": "n8n-nodes-base.code",
        "position": [
          2200,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "string": [
              {
                "value1": "={{ $json.platform }}",
                "value2": "google"
              }
            ]
          }
        },
        "id": "route-by-platform",
        "name": "Platforma GÃ¶re YÃ¶nlendir",
        "type": "n8n-nodes-base.switch",
        "position": [
          2420,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://mybusiness.googleapis.com/v4/{{ $node['Yorum Ä°ÅŸle'].json.id.replace('google_', '') }}/reply",
          "authentication": "oAuth2Api",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "comment",
                "value": "={{ $json.response_text }}"
              }
            ]
          }
        },
        "id": "post-google-response",
        "name": "Google'a YanÄ±t GÃ¶nder",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2640,
          200
        ],
        "credentials": {
          "googleBusinessProfileOAuth2Api": {
            "id": "google-business-creds",
            "name": "Google Business Profile"
          }
        },
        "continueOnFail": true
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://api.tripadvisor.com/api/partner/2.0/location/{{ $env.TRIPADVISOR_LOCATION_ID }}/reviews/{{ $node['Yorum Ä°ÅŸle'].json.id.replace('ta_', '') }}/response",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "response_text",
                "value": "={{ $json.response_text }}"
              }
            ]
          }
        },
        "id": "post-tripadvisor-response",
        "name": "TripAdvisor'a YanÄ±t GÃ¶nder",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2640,
          350
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "tripadvisor-creds",
            "name": "TripAdvisor API"
          }
        },
        "continueOnFail": true
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v18.0/{{ $node['Yorum Ä°ÅŸle'].json.id.replace('fb_', '') }}/comments",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "message",
                "value": "={{ $json.response_text }}"
              }
            ]
          }
        },
        "id": "post-facebook-response",
        "name": "Facebook'a YanÄ±t GÃ¶nder",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          2640,
          500
        ],
        "credentials": {
          "httpHeaderAuth": {
            "id": "facebook-creds",
            "name": "Facebook API"
          }
        },
        "continueOnFail": true
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $env.REVIEW_LOG_SHEET_ID }}"
          },
          "sheetName": "YanÄ±tlar",
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Tarih": "={{ $json.responded_at }}",
              "Platform": "={{ $json.platform }}",
              "MÃ¼ÅŸteri": "={{ $json.author_name }}",
              "Puan": "={{ $json.rating }}",
              "Yorum": "={{ $json.original_text }}",
              "YanÄ±t": "={{ $json.response_text }}",
              "YanÄ±tlayan": "={{ $json.responded_by }}",
              "Durum": "={{ $json.status }}"
            }
          }
        },
        "id": "log-to-sheets",
        "name": "Google Sheets Log",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2860,
          400
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-creds",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $env.SLACK_REVIEW_CHANNEL || '#reviews' }}",
          "text": "={{ ':white_check_mark: *Yorum YanÄ±tlandÄ±*\\n\\n*Platform:* ' + $json.platform + '\\n*MÃ¼ÅŸteri:* ' + $json.author_name + '\\n*Puan:* ' + $json.rating + '/5\\n\\n*YanÄ±t:*\\n' + $json.response_text }}",
          "otherOptions": {}
        },
        "id": "slack-notify-success",
        "name": "Slack Bildirim",
        "type": "n8n-nodes-base.slack",
        "position": [
          3080,
          400
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-creds",
            "name": "Slack API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const stats = $('YorumlarÄ± BirleÅŸtir').first().json.stats;\nconst config = $('YorumlarÄ± BirleÅŸtir').first().json.config;\n\nconst report = {\n  report_date: new Date().toISOString(),\n  business_name: config.business_name,\n  summary: {\n    total_reviews: stats.total_reviews,\n    average_rating: stats.avg_rating,\n    unanswered: stats.unanswered_count,\n    response_rate: stats.total_reviews > 0 ? \n      ((stats.total_reviews - stats.unanswered_count) / stats.total_reviews * 100).toFixed(1) + '%' : 'N/A'\n  },\n  sentiment: stats.sentiment_breakdown,\n  platforms: stats.by_platform,\n  health_score: calculateHealthScore(stats),\n  recommendations: generateRecommendations(stats)\n};\n\nfunction calculateHealthScore(stats) {\n  let score = 0;\n  \n  // Ortalama puan (max 40 puan)\n  score += (parseFloat(stats.avg_rating) / 5) * 40;\n  \n  // YanÄ±t oranÄ± (max 30 puan)\n  const responseRate = (stats.total_reviews - stats.unanswered_count) / Math.max(stats.total_reviews, 1);\n  score += responseRate * 30;\n  \n  // Pozitif oran (max 30 puan)\n  const positiveRate = stats.sentiment_breakdown.positive / Math.max(stats.total_reviews, 1);\n  score += positiveRate * 30;\n  \n  return Math.round(score);\n}\n\nfunction generateRecommendations(stats) {\n  const recs = [];\n  \n  if (stats.unanswered_count > 5) {\n    recs.push('âš ï¸ ' + stats.unanswered_count + ' yanÄ±tlanmamÄ±ÅŸ yorum var. HÄ±zlÄ± yanÄ±t mÃ¼ÅŸteri memnuniyetini artÄ±rÄ±r.');\n  }\n  \n  if (parseFloat(stats.avg_rating) < 4.0) {\n    recs.push('ðŸ“Š Ortalama puanÄ±nÄ±z 4.0\\'Ä±n altÄ±nda. Negatif yorumlarÄ± analiz edin.');\n  }\n  \n  if (stats.sentiment_breakdown.negative > stats.sentiment_breakdown.positive * 0.2) {\n    recs.push('ðŸ”´ Negatif yorum oranÄ± yÃ¼ksek. Hizmet kalitesini gÃ¶zden geÃ§irin.');\n  }\n  \n  if (recs.length === 0) {\n    recs.push('âœ… Harika gidiyorsunuz! Yorum performansÄ±nÄ±z Ã§ok iyi.');\n  }\n  \n  return recs;\n}\n\nreturn [{ json: report }];"
        },
        "id": "generate-report",
        "name": "Rapor OluÅŸtur",
        "type": "n8n-nodes-base.code",
        "position": [
          1100,
          600
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $env.REPORT_EMAIL || 'owner@isletme.com' }}",
          "subject": "=ðŸ“Š HaftalÄ±k Yorum Raporu - {{ $json.business_name }}",
          "emailType": "html",
          "message": "=<h1>ðŸ“Š Yorum YÃ¶netimi Raporu</h1>\n<p>Tarih: {{ $json.report_date }}</p>\n\n<h2>ðŸ“ˆ Ã–zet</h2>\n<ul>\n<li>Toplam Yorum: <strong>{{ $json.summary.total_reviews }}</strong></li>\n<li>Ortalama Puan: <strong>{{ $json.summary.average_rating }}/5</strong></li>\n<li>YanÄ±t OranÄ±: <strong>{{ $json.summary.response_rate }}</strong></li>\n<li>SaÄŸlÄ±k Skoru: <strong>{{ $json.health_score }}/100</strong></li>\n</ul>\n\n<h2>ðŸ˜Š Duygu Analizi</h2>\n<ul>\n<li>Pozitif: {{ $json.sentiment.positive }}</li>\n<li>NÃ¶tr: {{ $json.sentiment.neutral }}</li>\n<li>Negatif: {{ $json.sentiment.negative }}</li>\n</ul>\n\n<h2>ðŸŒ Platform DaÄŸÄ±lÄ±mÄ±</h2>\n<ul>\n<li>Google: {{ $json.platforms.google }}</li>\n<li>TripAdvisor: {{ $json.platforms.tripadvisor }}</li>\n<li>Yelp: {{ $json.platforms.yelp }}</li>\n<li>Facebook: {{ $json.platforms.facebook }}</li>\n</ul>\n\n<h2>ðŸ’¡ Ã–neriler</h2>\n<ul>\n{{ $json.recommendations.map(r => '<li>' + r + '</li>').join('') }}\n</ul>",
          "options": {}
        },
        "id": "send-report-email",
        "name": "Rapor Email GÃ¶nder",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          1320,
          600
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-creds",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "days",
                "daysInterval": 1
              }
            ]
          }
        },
        "id": "daily-sync-trigger",
        "name": "GÃ¼nlÃ¼k Senkronizasyon",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          220,
          800
        ]
      },
      {
        "parameters": {
          "jsCode": "// Listeleme Senkronizasyonu\n// TÃ¼m platformlara iÅŸletme bilgilerini senkronize et\n\nconst config = {\n  business_name: $env.BUSINESS_NAME,\n  address: $env.BUSINESS_ADDRESS,\n  city: $env.BUSINESS_CITY,\n  phone: $env.BUSINESS_PHONE,\n  website: $env.BUSINESS_WEBSITE,\n  hours: $env.BUSINESS_HOURS, // JSON format\n  categories: $env.BUSINESS_CATEGORIES,\n  description: $env.BUSINESS_DESCRIPTION\n};\n\nconst platforms = [\n  {\n    name: 'Google Business Profile',\n    id: 'google',\n    enabled: !!$env.GOOGLE_BUSINESS_API_KEY,\n    api_url: 'https://mybusiness.googleapis.com/v4'\n  },\n  {\n    name: 'Apple Maps',\n    id: 'apple',\n    enabled: !!$env.APPLE_MAPS_TOKEN,\n    api_url: 'https://maps-api.apple.com'\n  },\n  {\n    name: 'Bing Places',\n    id: 'bing',\n    enabled: !!$env.BING_PLACES_KEY,\n    api_url: 'https://www.bingapis.com/api/v7'\n  },\n  {\n    name: 'Yandex Maps',\n    id: 'yandex',\n    enabled: !!$env.YANDEX_API_KEY,\n    api_url: 'https://api.business.yandex.ru'\n  },\n  {\n    name: 'Foursquare',\n    id: 'foursquare',\n    enabled: !!$env.FOURSQUARE_API_KEY,\n    api_url: 'https://api.foursquare.com/v3'\n  },\n  {\n    name: 'TripAdvisor',\n    id: 'tripadvisor',\n    enabled: !!$env.TRIPADVISOR_API_KEY,\n    api_url: 'https://api.tripadvisor.com'\n  },\n  {\n    name: 'Yelp',\n    id: 'yelp',\n    enabled: !!$env.YELP_API_KEY,\n    api_url: 'https://api.yelp.com/v3'\n  },\n  {\n    name: 'Facebook',\n    id: 'facebook',\n    enabled: !!$env.FACEBOOK_ACCESS_TOKEN,\n    api_url: 'https://graph.facebook.com'\n  },\n  {\n    name: 'HERE Maps',\n    id: 'here',\n    enabled: !!$env.HERE_API_KEY,\n    api_url: 'https://places.ls.hereapi.com'\n  },\n  {\n    name: 'TomTom',\n    id: 'tomtom',\n    enabled: !!$env.TOMTOM_API_KEY,\n    api_url: 'https://api.tomtom.com'\n  },\n  {\n    name: 'Waze',\n    id: 'waze',\n    enabled: !!$env.WAZE_API_KEY,\n    api_url: 'https://www.waze.com/api'\n  }\n];\n\nconst enabledPlatforms = platforms.filter(p => p.enabled);\n\nreturn [{\n  json: {\n    config,\n    platforms: enabledPlatforms,\n    total_platforms: platforms.length,\n    enabled_count: enabledPlatforms.length,\n    sync_timestamp: new Date().toISOString()\n  }\n}];"
        },
        "id": "prepare-listing-sync",
        "name": "Listeleme Senkronizasyonu HazÄ±rla",
        "type": "n8n-nodes-base.code",
        "position": [
          440,
          800
        ]
      }
    ],
    "connections": {
      "Hourly Review Check": {
        "main": [
          [
            {
              "node": "Ä°ÅŸletme KonfigÃ¼rasyonu",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Trigger": {
        "main": [
          [
            {
              "node": "Ä°ÅŸletme KonfigÃ¼rasyonu",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ä°ÅŸletme KonfigÃ¼rasyonu": {
        "main": [
          [
            {
              "node": "Google Reviews Ã‡ek",
              "type": "main",
              "index": 0
            },
            {
              "node": "TripAdvisor Reviews Ã‡ek",
              "type": "main",
              "index": 0
            },
            {
              "node": "Yelp Reviews Ã‡ek",
              "type": "main",
              "index": 0
            },
            {
              "node": "Facebook Reviews Ã‡ek",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Reviews Ã‡ek": {
        "main": [
          [
            {
              "node": "YorumlarÄ± BirleÅŸtir",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "TripAdvisor Reviews Ã‡ek": {
        "main": [
          [
            {
              "node": "YorumlarÄ± BirleÅŸtir",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Yelp Reviews Ã‡ek": {
        "main": [
          [
            {
              "node": "YorumlarÄ± BirleÅŸtir",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Facebook Reviews Ã‡ek": {
        "main": [
          [
            {
              "node": "YorumlarÄ± BirleÅŸtir",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "YorumlarÄ± BirleÅŸtir": {
        "main": [
          [
            {
              "node": "YanÄ±tlanmamÄ±ÅŸ Var mÄ±?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Rapor OluÅŸtur",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "YanÄ±tlanmamÄ±ÅŸ Var mÄ±?": {
        "main": [
          [
            {
              "node": "YorumlarÄ± AyÄ±r",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "YorumlarÄ± AyÄ±r": {
        "main": [
          [
            {
              "node": "Yorum Ä°ÅŸle",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Yorum Ä°ÅŸle": {
        "main": [
          [
            {
              "node": "AI YanÄ±t OluÅŸtur",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI YanÄ±t OluÅŸtur": {
        "main": [
          [
            {
              "node": "Onay Gerekiyor mu?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Onay Gerekiyor mu?": {
        "main": [
          [
            {
              "node": "Slack Onay Ä°ste",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Otomatik YanÄ±t HazÄ±rla",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Otomatik YanÄ±t HazÄ±rla": {
        "main": [
          [
            {
              "node": "Platforma GÃ¶re YÃ¶nlendir",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Platforma GÃ¶re YÃ¶nlendir": {
        "main": [
          [
            {
              "node": "Google'a YanÄ±t GÃ¶nder",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "TripAdvisor'a YanÄ±t GÃ¶nder",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Facebook'a YanÄ±t GÃ¶nder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google'a YanÄ±t GÃ¶nder": {
        "main": [
          [
            {
              "node": "Google Sheets Log",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "TripAdvisor'a YanÄ±t GÃ¶nder": {
        "main": [
          [
            {
              "node": "Google Sheets Log",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Facebook'a YanÄ±t GÃ¶nder": {
        "main": [
          [
            {
              "node": "Google Sheets Log",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets Log": {
        "main": [
          [
            {
              "node": "Slack Bildirim",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rapor OluÅŸtur": {
        "main": [
          [
            {
              "node": "Rapor Email GÃ¶nder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GÃ¼nlÃ¼k Senkronizasyon": {
        "main": [
          [
            {
              "node": "Listeleme Senkronizasyonu HazÄ±rla",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "meta": {
      "templateId": "grain_local_business_listing_manager_v1",
      "templateCredsSetupCompleted": false,
      "version": "1.0.0",
      "description": "Semrush benzeri yerel iÅŸletme listeleme yÃ¶netimi - Ã§oklu platform senkronizasyonu, AI destekli yorum yanÄ±tlama, harita sÄ±ralamasÄ± takibi",
      "categories": [
        "local-seo",
        "review-management",
        "ai-automation"
      ],
      "features": [
        "Multi-platform review monitoring (Google, TripAdvisor, Yelp, Facebook)",
        "AI-powered review responses with GPT-4o",
        "Automatic positive review responses",
        "Slack approval for negative reviews",
        "Multi-directory listing sync (11+ platforms)",
        "Health score and analytics dashboard",
        "Google Sheets logging",
        "Weekly email reports"
      ],
      "required_credentials": [
        "Google Business Profile OAuth2",
        "TripAdvisor Partner API",
        "Yelp Fusion API",
        "Facebook Graph API",
        "OpenAI API",
        "Slack API",
        "Google Sheets OAuth2",
        "SMTP"
      ],
      "environment_variables": [
        "BUSINESS_ID",
        "BUSINESS_NAME",
        "BUSINESS_PHONE",
        "BUSINESS_EMAIL",
        "BUSINESS_WEBSITE",
        "BUSINESS_ADDRESS",
        "BUSINESS_CITY",
        "BUSINESS_DISTRICT",
        "GOOGLE_PLACE_ID",
        "GOOGLE_ACCOUNT_ID",
        "GOOGLE_LOCATION_ID",
        "TRIPADVISOR_LOCATION_ID",
        "YELP_BUSINESS_ID",
        "FACEBOOK_PAGE_ID",
        "REVIEW_LOG_SHEET_ID",
        "SLACK_REVIEW_CHANNEL",
        "REPORT_EMAIL",
        "RESPONSE_SIGNATURE"
      ]
    }
  },
  {
    "name": "Grain Contract Review Compliance v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ukjgx4vqm",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ“„ Contract Review & Compliance\nAI-powered contract analysis for risk detection, clause extraction, and compliance checks.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "contract-review",
          "options": {}
        },
        "id": "webhook-contract",
        "name": "Contract Upload",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "contract-review"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nlet contractText = input.contract_text || '';\n\n// If PDF/DOCX, extract would happen here\nif (input.file_url) {\n  contractText = `[Document from: ${input.file_url}]`;\n}\n\nreturn {\n  json: {\n    contract_id: input.contract_id || `CON-${Date.now()}`,\n    contract_text: contractText,\n    contract_type: input.contract_type || 'general',\n    review_depth: input.review_depth || 'standard'\n  }\n};"
        },
        "id": "extract-text",
        "name": "Extract Text",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a legal contract analyst. Analyze the contract and return a structured JSON report:\n\n{\n  \"risk_score\": 0-100,\n  \"risk_level\": \"LOW/MEDIUM/HIGH/CRITICAL\",\n  \"key_clauses\": [\n    {\"clause\": \"...\", \"type\": \"liability/termination/payment/ip\", \"risk\": \"low/medium/high\"}\n  ],\n  \"compliance_issues\": [],\n  \"missing_clauses\": [],\n  \"recommendations\": [],\n  \"summary\": \"2-3 sentence summary\"\n}"
              },
              {
                "role": "user",
                "content": "Contract Type: {{ $json.contract_type }}\nReview Depth: {{ $json.review_depth }}\n\nContract Text:\n{{ $json.contract_text.substring(0, 10000) }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-analyze",
        "name": "AI Analyze Contract",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.risk_level }}",
          "rules": {
            "rules": [
              {
                "value2": "CRITICAL",
                "output": 0
              },
              {
                "value2": "HIGH",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "risk-router",
        "name": "Risk Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#legal-alerts",
          "text": "=ðŸš¨ **Critical Contract Risk Detected**\n\nContract: {{ $json.contract_id }}\nRisk Score: {{ $json.risk_score }}/100\n\nâš ï¸ Issues:\n{{ $json.compliance_issues.join('\\n') }}\n\n_Immediate legal review required!_",
          "otherOptions": {}
        },
        "id": "critical-alert",
        "name": "Critical Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1250,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Contract_Reviews"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "contract_id": "={{ $json.contract_id }}",
              "risk_score": "={{ $json.risk_score }}",
              "risk_level": "={{ $json.risk_level }}",
              "summary": "={{ $json.summary }}",
              "reviewed_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-review",
        "name": "Save Review",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1250,
          500
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Contract Review Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          650
        ]
      }
    ],
    "connections": {
      "Contract Upload": {
        "main": [
          [
            {
              "node": "Extract Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Text": {
        "main": [
          [
            {
              "node": "AI Analyze Contract",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Analyze Contract": {
        "main": [
          [
            {
              "node": "Risk Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Risk Router": {
        "main": [
          [
            {
              "node": "Critical Alert",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Review",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save Review",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save Review",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain HR Onboarding Offboarding v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-2svlkssna",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "hr-onboard",
          "options": {}
        },
        "id": "webhook-onboard",
        "name": "New Hire",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "hr-onboarding"
      },
      {
        "parameters": {
          "channel": "it-requests",
          "text": "=ðŸ†• **New Hire Setup Required**\n\nName: {{ $json.name }}\nDepartment: {{ $json.department }}\nStart Date: {{ $json.start_date }}\n\nðŸ‘‰ Please provision:\nâ€¢ Email account\nâ€¢ Slack access\nâ€¢ Relevant tool licenses",
          "otherOptions": {}
        },
        "id": "it-request",
        "name": "IT Setup Request",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "HoÅŸ Geldiniz! Ä°lk GÃ¼nÃ¼nÃ¼ze HazÄ±rlÄ±k",
          "message": "Merhaba {{ $json.name }},\n\nEkibimize hoÅŸ geldiniz!\n\nBaÅŸlangÄ±Ã§ Tarihi: {{ $json.start_date }}\nYÃ¶neticiniz: {{ $json.manager }}\n\nÄ°lk gÃ¼nde yapÄ±lacaklar:\n1. IT'den hesap bilgilerinizi alÄ±n\n2. Ekip toplantÄ±sÄ±na katÄ±lÄ±n\n3. Onboarding dÃ¶kÃ¼manlarÄ±nÄ± inceleyin",
          "options": {}
        },
        "id": "welcome-email",
        "name": "Welcome Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          500,
          500
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "hr-offboard",
          "options": {}
        },
        "id": "webhook-offboard",
        "name": "Employee Exit",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          700
        ],
        "webhookId": "hr-offboarding"
      },
      {
        "parameters": {
          "channel": "it-requests",
          "text": "=ðŸšª **Employee Exit - Account Deactivation Required**\n\nName: {{ $json.name }}\nLast Day: {{ $json.last_day }}\n\nâš ï¸ Please deactivate:\nâ€¢ All accounts\nâ€¢ Revoke Slack access\nâ€¢ Remove from shared resources",
          "otherOptions": {}
        },
        "id": "deactivation-request",
        "name": "Deactivation Request",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          500,
          700
        ]
      }
    ],
    "connections": {
      "New Hire": {
        "main": [
          [
            {
              "node": "IT Setup Request",
              "type": "main",
              "index": 0
            },
            {
              "node": "Welcome Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Employee Exit": {
        "main": [
          [
            {
              "node": "Deactivation Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Recruitment AI Agent v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-j1g3zyp7s",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ§‘â€ðŸ’¼ Recruitment AI Agent\nAutomated resume screening, candidate scoring, and interview scheduling assistant.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "submit-application",
          "options": {}
        },
        "id": "webhook-app",
        "name": "New Application",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "submit-application"
      },
      {
        "parameters": {
          "jsCode": "const app = $input.item.json;\nconst resumeText = app.resume_text || '';\nconst jobDesc = app.job_description || '';\n\nreturn {\n  json: {\n    ...app,\n    resume_text_clean: resumeText.replace(/\\s+/g, ' ').trim(),\n    job_description_clean: jobDesc.replace(/\\s+/g, ' ').trim()\n  }\n};"
        },
        "id": "clean-text",
        "name": "Clean Text",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an expert HR recruiter. Analyze the resume against the job description.\n\nOutput JSON:\n{\n  \"match_score\": 0-100,\n  \"skills_match\": [\"skill1\", \"skill2\"],\n  \"missing_skills\": [\"skill3\"],\n  \"experience_summary\": \"...\",\n  \"culture_fit_indicators\": \"...\",\n  \"recommendation\": \"interview/reject/hold\",\n  \"interview_questions\": [\"q1\", \"q2\", \"q3\"]\n}"
              },
              {
                "role": "user",
                "content": "Job Description:\n{{ $json.job_description_clean }}\n\nResume:\n{{ $json.resume_text_clean }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-screen",
        "name": "AI Screen Resume",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.recommendation }}",
          "rules": {
            "rules": [
              {
                "value2": "interview",
                "output": 0
              },
              {
                "value2": "reject",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "route-candidate",
        "name": "Route Candidate",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $('New Application').first().json.email }}",
          "subject": "Interview Request: {{ $('New Application').first().json.position }}",
          "message": "=Hi {{ $('New Application').first().json.name }},\n\nWe were impressed by your profile! We'd like to invite you to an interview.\n\nPlease book a slot here: {{ $env.CALENDLY_URL }}\n\nBest,\nRecruiting Team",
          "options": {}
        },
        "id": "email-interview",
        "name": "Send Interview Invite",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1250,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/onboarding-prep",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"candidate_name\": \"{{ $('New Application').first().json.name }}\", \"email\": \"{{ $('New Application').first().json.email }}\", \"position\": \"{{ $('New Application').first().json.position }}\", \"status\": \"interview_scheduled\" }"
        },
        "id": "trigger-onboarding",
        "name": "â†’ Prep Onboarding",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $('New Application').first().json.email }}",
          "subject": "Update on your application for {{ $('New Application').first().json.position }}",
          "message": "=Hi {{ $('New Application').first().json.name }},\n\nThank you for your interest. Unfortunately, we have decided to move forward with other candidates at this time.\n\nWe will keep your resume on file.\n\nBest,\nRecruiting Team",
          "options": {}
        },
        "id": "email-reject",
        "name": "Send Rejection",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1250,
          450
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Candidates"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "name": "={{ $('New Application').first().json.name }}",
              "email": "={{ $('New Application').first().json.email }}",
              "score": "={{ $json.match_score }}",
              "recommendation": "={{ $json.recommendation }}",
              "interview_questions": "={{ $json.interview_questions.join('\\n') }}",
              "screened_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-candidate",
        "name": "Save Candidate",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1500,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#hiring-updates",
          "text": "=ðŸ‘¤ **New Candidate Screened**\n\nName: {{ $('New Application').first().json.name }}\nPosition: {{ $('New Application').first().json.position }}\nScore: {{ $json.match_score }}/100\nResult: {{ $json.recommendation }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Hiring Mgr",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1750,
          400
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Recruitment Agent Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          650
        ]
      }
    ],
    "connections": {
      "New Application": {
        "main": [
          [
            {
              "node": "Clean Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Clean Text": {
        "main": [
          [
            {
              "node": "AI Screen Resume",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Screen Resume": {
        "main": [
          [
            {
              "node": "Route Candidate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route Candidate": {
        "main": [
          [
            {
              "node": "Send Interview Invite",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Candidate",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Rejection",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Candidate",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save Candidate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Candidate": {
        "main": [
          [
            {
              "node": "Notify Hiring Mgr",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Ticket Escalation Manager v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-0lvboj0tk",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸŽ« Ticket Escalation Manager\nMonitors support tickets and auto-escalates based on SLA breaches and priority.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 15
              }
            ]
          }
        },
        "id": "check-trigger",
        "name": "Check Every 15 Min",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Support_Tickets"
          }
        },
        "id": "get-tickets",
        "name": "Get Open Tickets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const ticket = $input.item.json;\nconst createdAt = new Date(ticket.created_at);\nconst now = new Date();\nconst hoursOpen = (now - createdAt) / (1000 * 60 * 60);\n\n// SLA thresholds by priority\nconst slaHours = {\n  'critical': 2,\n  'high': 4,\n  'medium': 8,\n  'low': 24\n};\n\nconst priority = ticket.priority || 'medium';\nconst slaBreached = hoursOpen > slaHours[priority];\nconst slaPercentage = Math.round((hoursOpen / slaHours[priority]) * 100);\n\nlet escalationLevel = 'none';\nif (slaPercentage >= 150) escalationLevel = 'manager';\nelse if (slaPercentage >= 100) escalationLevel = 'senior';\nelse if (slaPercentage >= 80) escalationLevel = 'warning';\n\nreturn {\n  json: {\n    ...ticket,\n    hours_open: Math.round(hoursOpen * 10) / 10,\n    sla_hours: slaHours[priority],\n    sla_breached: slaBreached,\n    sla_percentage: slaPercentage,\n    escalation_level: escalationLevel,\n    needs_escalation: escalationLevel !== 'none'\n  }\n};"
        },
        "id": "calc-sla",
        "name": "Calculate SLA",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.needs_escalation }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "needs-escalation",
        "name": "Needs Escalation?",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.escalation_level }}",
          "rules": {
            "rules": [
              {
                "value2": "manager",
                "output": 0
              },
              {
                "value2": "senior",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "route-escalation",
        "name": "Route Escalation",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#support-managers",
          "text": "=ðŸš¨ **CRITICAL ESCALATION**\n\nðŸŽ« Ticket: {{ $json.ticket_id }}\nâ±ï¸ Open: {{ $json.hours_open }} hours (SLA: {{ $json.sla_hours }}h)\nðŸ“Š SLA: {{ $json.sla_percentage }}%\n\nSubject: {{ $json.subject }}\nCustomer: {{ $json.customer_name }}\n\n_Immediate action required!_",
          "otherOptions": {}
        },
        "id": "notify-manager",
        "name": "Notify Manager",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "channel": "#support-escalations",
          "text": "=âš ï¸ **Ticket Escalated to Senior**\n\nðŸŽ« Ticket: {{ $json.ticket_id }}\nâ±ï¸ SLA: {{ $json.sla_percentage }}%\nSubject: {{ $json.subject }}",
          "otherOptions": {}
        },
        "id": "notify-senior",
        "name": "Notify Senior",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          450
        ]
      },
      {
        "parameters": {
          "channel": "#support",
          "text": "=âš¡ **SLA Warning**\n\nTicket {{ $json.ticket_id }} at {{ $json.sla_percentage }}% of SLA",
          "otherOptions": {}
        },
        "id": "notify-warning",
        "name": "SLA Warning",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          600
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Ticket Escalation Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          650
        ]
      }
    ],
    "connections": {
      "Check Every 15 Min": {
        "main": [
          [
            {
              "node": "Get Open Tickets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Open Tickets": {
        "main": [
          [
            {
              "node": "Calculate SLA",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate SLA": {
        "main": [
          [
            {
              "node": "Needs Escalation?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Needs Escalation?": {
        "main": [
          [
            {
              "node": "Route Escalation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route Escalation": {
        "main": [
          [
            {
              "node": "Notify Manager",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Notify Senior",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "SLA Warning",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Agentic AI Orchestrator v2 Pro",
    "nodes": [
      {
        "parameters": {
          "options": {
            "title": "Grain AI Business Assistant (PRO)",
            "subtitle": "Agentic Engine with Cost Control & Advanced SEO"
          }
        },
        "id": "chat-ui-trigger",
        "name": "Chat UI",
        "type": "n8n-nodes-base.chatTrigger",
        "typeVersion": 1,
        "position": [
          200,
          200
        ]
      },
      {
        "parameters": {
          "sessionIdKey": "={{ $json.sessionId || 'default' }}"
        },
        "id": "chat-memory",
        "name": "Window Chat Memory",
        "type": "n8n-nodes-base.windowChatInMemory",
        "typeVersion": 1,
        "position": [
          400,
          100
        ]
      },
      {
        "parameters": {
          "jsCode": "// Task Router & Context Builder Pro\n// Features: Cost Tracking Integration & Semantic Caching Check\n\nconst input = $input.first().json;\n\n// Agent Registry\nconst agentRegistry = {\n  lead_enrichment: { name: 'Lead Enrichment Agent', priority: 1, requiresApproval: false },\n  content_generator: { name: 'Content Generation Agent', priority: 2, requiresApproval: true },\n  sentiment_analyzer: { name: 'Sentiment Analysis Agent', priority: 2, requiresApproval: false },\n  seo_intelligence: { name: 'SEO Intelligence Agent', priority: 1, requiresApproval: false },\n  crm_updater: { name: 'CRM Update Agent', priority: 4, requiresApproval: false }\n};\n\nconst chatMessage = input.chatInput || input.message || \"\";\nconst taskType = input.task_type || (chatMessage.toLowerCase().includes('seo') ? 'seo_audit' : (chatMessage ? 'new_lead' : 'general'));\nconst taskData = chatMessage ? { goal: chatMessage } : (input.data || input);\n\nreturn [{\n  json: {\n    taskId: `pro-${Date.now()}`,\n    taskType,\n    createdAt: new Date().toISOString(),\n    agentRegistry,\n    originalInput: taskData,\n    costTracking: { startTime: Date.now(), estimatedTokens: 0 }\n  }\n}];"
        },
        "id": "task-router",
        "name": "Pro Task Router",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are the Grain Pro SEO Agent. Analyze brand visibility and SERP trends."
              },
              {
                "role": "user",
                "content": "={{ $json.originalInput.goal }}"
              }
            ]
          }
        },
        "id": "agent-seo",
        "name": "SEO Intelligence Agent",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          700,
          200
        ]
      },
      {
        "parameters": {
          "jsCode": "// Token Usage & Cost Calculator\n// Based on gpt-4o pricing (approximate)\n\nconst results = $input.all();\nlet totalInputTokens = 0;\nlet totalOutputTokens = 0;\n\nresults.forEach(r => {\n  if (r.json.usage) {\n    totalInputTokens += r.json.usage.prompt_tokens || 0;\n    totalOutputTokens += r.json.usage.completion_tokens || 0;\n  }\n});\n\nconst inputCost = (totalInputTokens / 1000000) * 5.00;\nconst outputCost = (totalOutputTokens / 1000000) * 15.00;\n\nreturn [{\n  json: {\n    totalTokens: totalInputTokens + totalOutputTokens,\n    totalCostUsd: (inputCost + outputCost).toFixed(4),\n    timestamp: new Date().toISOString()\n  }\n}];"
        },
        "id": "cost-tracker",
        "name": "Token Cost Tracker",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1500,
          800
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "={{ $env.PRO_COST_LOG_SHEET_ID }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Cost Logs",
            "mode": "list"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "date": "={{ $json.timestamp }}",
              "tokens": "={{ $json.totalTokens }}",
              "cost": "={{ $json.totalCostUsd }}"
            }
          }
        },
        "id": "log-costs",
        "name": "Log Pro Costs",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1700,
          800
        ]
      }
    ],
    "connections": {
      "Chat UI": {
        "main": [
          [
            {
              "node": "Pro Task Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pro Task Router": {
        "main": [
          [
            {
              "node": "SEO Intelligence Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SEO Intelligence Agent": {
        "main": [
          [
            {
              "node": "Token Cost Tracker",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Token Cost Tracker": {
        "main": [
          [
            {
              "node": "Log Pro Costs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Real Estate Land Showcase v1",
    "nodes": [
      {
        "parameters": {
          "formTitle": "Arazi Konum Bilgileri",
          "formDescription": "Parsel bilgilerini girin. Sistem otomatik olarak uydu gÃ¶rÃ¼ntÃ¼leri, harita linkleri ve pazarlama metni oluÅŸturacak.",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Ä°l",
                "fieldType": "dropdown",
                "requiredField": true,
                "fieldOptions": {
                  "values": [
                    {
                      "option": "Ä°stanbul"
                    },
                    {
                      "option": "Ankara"
                    },
                    {
                      "option": "Ä°zmir"
                    },
                    {
                      "option": "Antalya"
                    },
                    {
                      "option": "Bursa"
                    },
                    {
                      "option": "AydÄ±n"
                    },
                    {
                      "option": "MuÄŸla"
                    },
                    {
                      "option": "Trabzon"
                    },
                    {
                      "option": "Konya"
                    },
                    {
                      "option": "DiÄŸer"
                    }
                  ]
                }
              },
              {
                "fieldLabel": "Ä°lÃ§e",
                "fieldType": "text",
                "requiredField": true,
                "placeholder": "Ã–rn: Didim"
              },
              {
                "fieldLabel": "Mahalle/KÃ¶y",
                "fieldType": "text",
                "requiredField": true
              },
              {
                "fieldLabel": "Ada No",
                "fieldType": "text",
                "requiredField": true,
                "placeholder": "Ã–rn: 245"
              },
              {
                "fieldLabel": "Parsel No",
                "fieldType": "text",
                "requiredField": true,
                "placeholder": "Ã–rn: 12"
              },
              {
                "fieldLabel": "Koordinat (Opsiyonel)",
                "fieldType": "text",
                "placeholder": "37.3851, 27.2606"
              },
              {
                "fieldLabel": "Arazi TÃ¼rÃ¼",
                "fieldType": "dropdown",
                "requiredField": true,
                "fieldOptions": {
                  "values": [
                    {
                      "option": "Tarla"
                    },
                    {
                      "option": "Arsa"
                    },
                    {
                      "option": "BahÃ§e"
                    },
                    {
                      "option": "Zeytinlik"
                    },
                    {
                      "option": "BaÄŸ"
                    },
                    {
                      "option": "Orman"
                    },
                    {
                      "option": "Mera"
                    },
                    {
                      "option": "DiÄŸer"
                    }
                  ]
                }
              },
              {
                "fieldLabel": "Alan (mÂ²)",
                "fieldType": "text",
                "placeholder": "Ã–rn: 5000"
              },
              {
                "fieldLabel": "Fiyat (TL)",
                "fieldType": "text",
                "placeholder": "Ã–rn: 2500000"
              },
              {
                "fieldLabel": "EmlakÃ§Ä± AdÄ±",
                "fieldType": "text",
                "requiredField": true
              },
              {
                "fieldLabel": "EmlakÃ§Ä± Telefon",
                "fieldType": "text",
                "requiredField": true
              },
              {
                "fieldLabel": "MÃ¼ÅŸteri Email",
                "fieldType": "email",
                "requiredField": true
              }
            ]
          }
        },
        "id": "form-trigger",
        "name": "Parsel Bilgi Formu",
        "type": "n8n-nodes-base.formTrigger",
        "position": [
          240,
          300
        ]
      },
      {
        "parameters": {
          "url": "=https://nominatim.openstreetmap.org/search?q={{ encodeURIComponent($json['Mahalle/KÃ¶y'] + ', ' + $json['Ä°lÃ§e'] + ', ' + $json['Ä°l'] + ', Turkey') }}&format=json&limit=1",
          "options": {
            "response": {
              "response": {
                "responseFormat": "json"
              }
            }
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "User-Agent",
                "value": "n8n-arazi-otomasyon/1.0"
              }
            ]
          }
        },
        "id": "geocode-location",
        "name": "Konum KoordinatlarÄ± Al",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          460,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "const formData = $('Parsel Bilgi Formu').first().json;\nconst geoData = $input.first().json;\n\nlet lat, lon;\n\nif (formData['Koordinat (Opsiyonel)']) {\n  const coords = formData['Koordinat (Opsiyonel)'].split(',');\n  lat = parseFloat(coords[0].trim());\n  lon = parseFloat(coords[1].trim());\n} else if (geoData && geoData[0]) {\n  lat = parseFloat(geoData[0].lat);\n  lon = parseFloat(geoData[0].lon);\n} else {\n  throw new Error('Koordinat bulunamadÄ±!');\n}\n\nconst referansNo = `ARS-${Date.now()}`;\n\nreturn [{\n  json: {\n    formData,\n    coordinates: { lat, lon },\n    parsel: {\n      il: formData['Ä°l'],\n      ilce: formData['Ä°lÃ§e'],\n      mahalle: formData['Mahalle/KÃ¶y'],\n      ada: formData['Ada No'],\n      parsel: formData['Parsel No']\n    },\n    arazi: {\n      tur: formData['Arazi TÃ¼rÃ¼'],\n      alan: formData['Alan (mÂ²)'],\n      fiyat: formData['Fiyat (TL)']\n    },\n    emlakci: {\n      ad: formData['EmlakÃ§Ä± AdÄ±'],\n      telefon: formData['EmlakÃ§Ä± Telefon']\n    },\n    musteri_email: formData['MÃ¼ÅŸteri Email'],\n    referansNo\n  }\n}];"
        },
        "id": "process-coordinates",
        "name": "KoordinatlarÄ± Ä°ÅŸle",
        "type": "n8n-nodes-base.code",
        "position": [
          680,
          300
        ]
      },
      {
        "parameters": {
          "url": "=https://api.mapbox.com/styles/v1/mapbox/satellite-v9/static/{{ $json.coordinates.lon }},{{ $json.coordinates.lat }},15,0/1280x720@2x?access_token={{ $env.MAPBOX_ACCESS_TOKEN }}",
          "options": {
            "response": {
              "response": {
                "responseFormat": "file"
              }
            }
          }
        },
        "id": "mapbox-wide",
        "name": "Uydu GÃ¶rÃ¼ntÃ¼sÃ¼ (GeniÅŸ)",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          900,
          200
        ],
        "continueOnFail": true
      },
      {
        "parameters": {
          "url": "=https://api.mapbox.com/styles/v1/mapbox/satellite-v9/static/{{ $json.coordinates.lon }},{{ $json.coordinates.lat }},17,0/1280x720@2x?access_token={{ $env.MAPBOX_ACCESS_TOKEN }}",
          "options": {
            "response": {
              "response": {
                "responseFormat": "file"
              }
            }
          }
        },
        "id": "mapbox-medium",
        "name": "Uydu GÃ¶rÃ¼ntÃ¼sÃ¼ (Orta)",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          900,
          350
        ],
        "continueOnFail": true
      },
      {
        "parameters": {
          "url": "=https://api.mapbox.com/styles/v1/mapbox/satellite-v9/static/{{ $json.coordinates.lon }},{{ $json.coordinates.lat }},19,0/1280x720@2x?access_token={{ $env.MAPBOX_ACCESS_TOKEN }}",
          "options": {
            "response": {
              "response": {
                "responseFormat": "file"
              }
            }
          }
        },
        "id": "mapbox-close",
        "name": "Uydu GÃ¶rÃ¼ntÃ¼sÃ¼ (YakÄ±n)",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          900,
          500
        ],
        "continueOnFail": true
      },
      {
        "parameters": {
          "resource": "chat",
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen profesyonel bir emlak pazarlama uzmanÄ±sÄ±n. Arazi bilgilerine gÃ¶re detaylÄ± ve ikna edici pazarlama metni hazÄ±rlÄ±yorsun. TÃ¼rkÃ§e yaz."
              },
              {
                "role": "user",
                "content": "={{ `AÅŸaÄŸÄ±daki arazi iÃ§in profesyonel bir tanÄ±tÄ±m metni hazÄ±rla:\n\nKonum: ${$json.parsel.il}, ${$json.parsel.ilce}, ${$json.parsel.mahalle}\nAda/Parsel: ${$json.parsel.ada}/${$json.parsel.parsel}\nKoordinatlar: ${$json.coordinates.lat}, ${$json.coordinates.lon}\nArazi TÃ¼rÃ¼: ${$json.arazi.tur}\nAlan: ${$json.arazi.alan} mÂ²\nFiyat: ${$json.arazi.fiyat} TL\n\nTanÄ±tÄ±m metni ÅŸunlarÄ± iÃ§ermeli:\n1. Konumun avantajlarÄ±\n2. UlaÅŸÄ±m imkanlarÄ±\n3. Ã‡evredeki Ã¶nemli noktalar\n4. YatÄ±rÄ±m potansiyeli\n5. Ã–nerilen kullanÄ±m alanlarÄ±\n\nProfesyonel ve ikna edici bir dil kullan.` }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "gpt-marketing",
        "name": "GPT Pazarlama Metni",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1120,
          300
        ],
        "credentials": {
          "openAiApi": {
            "id": "openai-creds",
            "name": "OpenAI API"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const data = $('KoordinatlarÄ± Ä°ÅŸle').first().json;\nconst marketingText = $input.first().json.message.content;\nconst lat = data.coordinates.lat;\nconst lon = data.coordinates.lon;\n\n// Harita linkleri\nconst mapUrls = {\n  googleMaps: `https://www.google.com/maps/@${lat},${lon},500m/data=!3m1!1e3`,\n  googleEarth: `https://earth.google.com/web/@${lat},${lon},500a,1000d,35y,0h,45t,0r`,\n  yandexMaps: `https://yandex.com/maps/?ll=${lon},${lat}&z=17&l=sat`,\n  bingMaps: `https://www.bing.com/maps?cp=${lat}~${lon}&lvl=17&style=a`,\n  tkgm: 'https://parselsorgu.tkgm.gov.tr'\n};\n\n// KML dosyasÄ±\nconst kmlContent = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<kml xmlns=\"http://www.opengis.net/kml/2.2\">\n  <Document>\n    <name>Arazi ${data.referansNo}</name>\n    <Placemark>\n      <name>${data.parsel.il} - ${data.parsel.ilce}</name>\n      <description>Ada: ${data.parsel.ada}, Parsel: ${data.parsel.parsel}</description>\n      <LookAt>\n        <longitude>${lon}</longitude>\n        <latitude>${lat}</latitude>\n        <altitude>0</altitude>\n        <heading>0</heading>\n        <tilt>45</tilt>\n        <range>1000</range>\n      </LookAt>\n      <Point>\n        <coordinates>${lon},${lat},0</coordinates>\n      </Point>\n    </Placemark>\n  </Document>\n</kml>`;\n\n// Google Earth Studio proje\nconst earthStudioProject = {\n  version: '1.0',\n  project: {\n    name: `Arazi_${data.referansNo}`,\n    duration: 10,\n    fps: 30,\n    resolution: { width: 1920, height: 1080 }\n  },\n  camera: {\n    keyframes: [\n      { time: 0, position: { latitude: lat, longitude: lon, altitude: 2000 }, rotation: { heading: 0, tilt: 45, roll: 0 } },\n      { time: 5, position: { latitude: lat, longitude: lon, altitude: 500 }, rotation: { heading: 180, tilt: 60, roll: 0 } },\n      { time: 10, position: { latitude: lat, longitude: lon, altitude: 300 }, rotation: { heading: 360, tilt: 75, roll: 0 } }\n    ]\n  }\n};\n\nreturn [{\n  json: {\n    ...data,\n    marketingText,\n    mapUrls,\n    kmlContent,\n    earthStudioProject\n  }\n}];"
        },
        "id": "generate-outputs",
        "name": "Ã‡Ä±ktÄ±larÄ± OluÅŸtur",
        "type": "n8n-nodes-base.code",
        "position": [
          1340,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "const data = $input.first().json;\nconst lat = data.coordinates.lat;\nconst lon = data.coordinates.lon;\n\nconst htmlReport = `<!DOCTYPE html>\n<html lang=\"tr\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Arazi Raporu - ${data.referansNo}</title>\n  <style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }\n    .header { background: rgba(0,0,0,0.3); color: white; padding: 40px; text-align: center; }\n    .container { max-width: 1200px; margin: 0 auto; padding: 30px; }\n    .card { background: white; border-radius: 15px; padding: 30px; margin: 20px 0; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }\n    .parsel-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }\n    .parsel-grid div { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }\n    .parsel-grid strong { display: block; font-size: 1.5em; margin-top: 5px; }\n    .coords { background: #2c3e50; color: #3498db; padding: 15px 20px; border-radius: 10px; font-family: monospace; margin: 20px 0; }\n    .links-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }\n    .link-btn { display: block; padding: 15px 25px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 10px; transition: transform 0.3s; }\n    .link-btn:hover { transform: translateY(-3px); }\n    .link-btn.google { background: linear-gradient(135deg, #4285F4 0%, #34A853 100%); }\n    .link-btn.yandex { background: linear-gradient(135deg, #FC3F1D 0%, #FF6B35 100%); }\n    .link-btn.tkgm { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }\n    .marketing { line-height: 1.8; }\n    .qr-section { text-align: center; margin: 30px 0; }\n    iframe { border: none; border-radius: 15px; width: 100%; height: 450px; }\n    .footer { text-align: center; padding: 30px; color: rgba(255,255,255,0.8); }\n    .emlakci { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 20px; border-radius: 10px; margin-top: 20px; }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <h1>ðŸ—ºï¸ Arazi Konum Raporu</h1>\n    <p>Referans: ${data.referansNo}</p>\n  </div>\n  \n  <div class=\"container\">\n    <div class=\"card\">\n      <h2>ðŸ“ Parsel Bilgileri</h2>\n      <div class=\"parsel-grid\">\n        <div><span>Ä°l</span><strong>${data.parsel.il}</strong></div>\n        <div><span>Ä°lÃ§e</span><strong>${data.parsel.ilce}</strong></div>\n        <div><span>Ada No</span><strong>${data.parsel.ada}</strong></div>\n        <div><span>Parsel No</span><strong>${data.parsel.parsel}</strong></div>\n      </div>\n      \n      <div class=\"parsel-grid\">\n        <div><span>Arazi TÃ¼rÃ¼</span><strong>${data.arazi.tur}</strong></div>\n        <div><span>Alan</span><strong>${data.arazi.alan} mÂ²</strong></div>\n        <div><span>Fiyat</span><strong>${Number(data.arazi.fiyat).toLocaleString('tr-TR')} â‚º</strong></div>\n        <div><span>mÂ² Fiyat</span><strong>${Math.round(Number(data.arazi.fiyat) / Number(data.arazi.alan)).toLocaleString('tr-TR')} â‚º</strong></div>\n      </div>\n      \n      <div class=\"coords\">ðŸ“ Koordinatlar: ${lat}, ${lon}</div>\n    </div>\n    \n    <div class=\"card\">\n      <h2>ðŸ—ºï¸ Harita</h2>\n      <iframe src=\"https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d3000!2d${lon}!3d${lat}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e1!3m2!1str!2str\" allowfullscreen loading=\"lazy\"></iframe>\n    </div>\n    \n    <div class=\"card\">\n      <h2>ðŸ”— Harita Linkleri</h2>\n      <div class=\"links-grid\">\n        <a href=\"${data.mapUrls.googleMaps}\" target=\"_blank\" class=\"link-btn google\">ðŸ“ Google Maps</a>\n        <a href=\"${data.mapUrls.googleEarth}\" target=\"_blank\" class=\"link-btn google\">ðŸŒ Google Earth</a>\n        <a href=\"${data.mapUrls.yandexMaps}\" target=\"_blank\" class=\"link-btn yandex\">ðŸ—ºï¸ Yandex Maps</a>\n        <a href=\"${data.mapUrls.bingMaps}\" target=\"_blank\" class=\"link-btn\">ðŸ”· Bing Maps</a>\n        <a href=\"${data.mapUrls.tkgm}\" target=\"_blank\" class=\"link-btn tkgm\">ðŸ›ï¸ TKGM Parsel Sorgu</a>\n      </div>\n    </div>\n    \n    <div class=\"card\">\n      <h2>ðŸ“‹ Arazi TanÄ±tÄ±mÄ±</h2>\n      <div class=\"marketing\">${data.marketingText.split('\\n').map(p => '<p style=\"margin-bottom:15px;\">' + p + '</p>').join('')}</div>\n      \n      <div class=\"emlakci\">\n        <h3>ðŸ‘¤ EmlakÃ§Ä± Bilgileri</h3>\n        <p><strong>${data.emlakci.ad}</strong></p>\n        <p>ðŸ“ž ${data.emlakci.telefon}</p>\n      </div>\n    </div>\n    \n    <div class=\"card qr-section\">\n      <h3>ðŸ“± QR Kod ile Haritaya EriÅŸ</h3>\n      <img src=\"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(data.mapUrls.googleMaps)}\" alt=\"QR Code\">\n    </div>\n  </div>\n  \n  <div class=\"footer\">\n    <p>Bu rapor otomatik olarak oluÅŸturulmuÅŸtur.</p>\n    <p>OluÅŸturma: ${new Date().toLocaleDateString('tr-TR')}</p>\n  </div>\n</body>\n</html>`;\n\nreturn [{\n  json: {\n    ...data,\n    htmlReport\n  }\n}];"
        },
        "id": "generate-html-report",
        "name": "HTML Rapor OluÅŸtur",
        "type": "n8n-nodes-base.code",
        "position": [
          1560,
          300
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.musteri_email }}",
          "subject": "=ðŸ—ºï¸ Arazi Konum Raporu - {{ $json.referansNo }}",
          "emailType": "html",
          "message": "={{ $json.htmlReport }}",
          "options": {}
        },
        "id": "send-email",
        "name": "Email GÃ¶nder",
        "type": "n8n-nodes-base.emailSend",
        "position": [
          1780,
          300
        ],
        "credentials": {
          "smtp": {
            "id": "smtp-creds",
            "name": "SMTP"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "={{ $env.REAL_ESTATE_SHEET_ID }}"
          },
          "sheetName": "Araziler",
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Referans": "={{ $json.referansNo }}",
              "Tarih": "={{ new Date().toISOString() }}",
              "Ä°l": "={{ $json.parsel.il }}",
              "Ä°lÃ§e": "={{ $json.parsel.ilce }}",
              "Mahalle": "={{ $json.parsel.mahalle }}",
              "Ada": "={{ $json.parsel.ada }}",
              "Parsel": "={{ $json.parsel.parsel }}",
              "TÃ¼r": "={{ $json.arazi.tur }}",
              "Alan": "={{ $json.arazi.alan }}",
              "Fiyat": "={{ $json.arazi.fiyat }}",
              "Koordinat": "={{ $json.coordinates.lat }}, {{ $json.coordinates.lon }}",
              "EmlakÃ§Ä±": "={{ $json.emlakci.ad }}",
              "Email": "={{ $json.musteri_email }}"
            }
          }
        },
        "id": "log-sheets",
        "name": "Google Sheets Log",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2000,
          300
        ],
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "google-sheets-creds",
            "name": "Google Sheets"
          }
        }
      },
      {
        "parameters": {
          "channel": "={{ $env.SLACK_REAL_ESTATE_CHANNEL || '#emlak' }}",
          "text": "=ðŸ¡ *Yeni Arazi Raporu OluÅŸturuldu*\n\n*Referans:* {{ $json.referansNo }}\n*Konum:* {{ $json.parsel.il }}, {{ $json.parsel.ilce }}\n*Ada/Parsel:* {{ $json.parsel.ada }}/{{ $json.parsel.parsel }}\n*Alan:* {{ $json.arazi.alan }} mÂ²\n*Fiyat:* {{ Number($json.arazi.fiyat).toLocaleString('tr-TR') }} â‚º\n*EmlakÃ§Ä±:* {{ $json.emlakci.ad }}\n\nðŸ“ {{ $json.mapUrls.googleMaps }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Slack Bildirim",
        "type": "n8n-nodes-base.slack",
        "position": [
          2220,
          300
        ],
        "credentials": {
          "slackApi": {
            "id": "slack-creds",
            "name": "Slack API"
          }
        }
      }
    ],
    "connections": {
      "Parsel Bilgi Formu": {
        "main": [
          [
            {
              "node": "Konum KoordinatlarÄ± Al",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Konum KoordinatlarÄ± Al": {
        "main": [
          [
            {
              "node": "KoordinatlarÄ± Ä°ÅŸle",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "KoordinatlarÄ± Ä°ÅŸle": {
        "main": [
          [
            {
              "node": "Uydu GÃ¶rÃ¼ntÃ¼sÃ¼ (GeniÅŸ)",
              "type": "main",
              "index": 0
            },
            {
              "node": "Uydu GÃ¶rÃ¼ntÃ¼sÃ¼ (Orta)",
              "type": "main",
              "index": 0
            },
            {
              "node": "Uydu GÃ¶rÃ¼ntÃ¼sÃ¼ (YakÄ±n)",
              "type": "main",
              "index": 0
            },
            {
              "node": "GPT Pazarlama Metni",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GPT Pazarlama Metni": {
        "main": [
          [
            {
              "node": "Ã‡Ä±ktÄ±larÄ± OluÅŸtur",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ã‡Ä±ktÄ±larÄ± OluÅŸtur": {
        "main": [
          [
            {
              "node": "HTML Rapor OluÅŸtur",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTML Rapor OluÅŸtur": {
        "main": [
          [
            {
              "node": "Email GÃ¶nder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Email GÃ¶nder": {
        "main": [
          [
            {
              "node": "Google Sheets Log",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Sheets Log": {
        "main": [
          [
            {
              "node": "Slack Bildirim",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "meta": {
      "templateId": "grain_real_estate_land_showcase_v1",
      "version": "1.0.0",
      "description": "EmlakÃ§Ä±lar iÃ§in arazi tanÄ±tÄ±m otomasyonu - yerinde ziyaret gerektirmeden uydu gÃ¶rÃ¼ntÃ¼sÃ¼, harita linkleri, KML ve AI pazarlama metni",
      "features": [
        "Mapbox uydu gÃ¶rÃ¼ntÃ¼leri (3 zoom seviyesi)",
        "GPT-4o pazarlama metni",
        "Google Earth KML export",
        "Multi-platform harita linkleri (Google, Yandex, Bing, TKGM)",
        "Profesyonel HTML rapor",
        "QR kod ile mobil eriÅŸim",
        "Google Sheets loglama",
        "Slack bildirimleri"
      ],
      "required_env": [
        "MAPBOX_ACCESS_TOKEN",
        "REAL_ESTATE_SHEET_ID",
        "SLACK_REAL_ESTATE_CHANNEL"
      ]
    }
  },
  {
    "name": "Grain SEO Pro - Brand Visibility SERP Monitor",
    "nodes": [
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Analyze search results to identify brand visibility in AI Overviews and standard SERPs. Detect competitor ranking for target keywords."
              }
            ]
          }
        },
        "id": "ai-serp-analyzer",
        "name": "AI SERP Analyzer",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          600,
          300
        ]
      }
    ],
    "connections": {}
  },
  {
    "name": "Grain Content Repurposing Engine v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-a6ozrl409",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-content",
        "name": "Content Input",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "repurpose-content"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nlet content = input.content || '';\nlet sourceType = input.source_type || 'text';\n\nif (input.youtube_url) {\n  sourceType = 'youtube';\n  content = input.youtube_url;\n}\n\nreturn {\n  json: {\n    content: content,\n    source_type: sourceType,\n    target_platforms: input.platforms || ['linkedin', 'twitter', 'instagram', 'blog'],\n    brand_voice: input.brand_voice || 'professional',\n    language: input.language || 'tr'\n  }\n};"
        },
        "id": "normalize-input",
        "name": "Normalize Input",
        "type": "n8n-nodes-base.code",
        "position": [
          400,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/audio/transcriptions",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "model",
                "value": "whisper-1"
              },
              {
                "name": "file",
                "value": "={{ $json.audio_file }}"
              }
            ]
          }
        },
        "id": "transcribe-audio",
        "name": "Transcribe Audio",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          600,
          300
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen iÃ§erik dÃ¶nÃ¼ÅŸtÃ¼rme uzmanÄ±sÄ±n. Verilen uzun iÃ§eriÄŸi farklÄ± platformlar iÃ§in yeniden formatla.\n\nJSON dÃ¶ndÃ¼r:\n{\n  \"linkedin\": { \"post\": \"500 karakter\", \"hashtags\": [] },\n  \"twitter_thread\": [\"tweet1\", \"tweet2\", \"tweet3\"],\n  \"instagram\": { \"caption\": \"2000 karakter\", \"hashtags\": [] },\n  \"blog_outline\": { \"title\": \"\", \"sections\": [] },\n  \"key_quotes\": []\n}"
              },
              {
                "role": "user",
                "content": "=Content to repurpose:\n{{ $json.content.substring(0, 4000) }}\n\nBrand Voice: {{ $json.brand_voice }}\nLanguage: {{ $json.language }}"
              }
            ]
          }
        },
        "id": "ai-repurpose",
        "name": "AI Repurpose",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          800,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nconst aiResponse = $('AI Repurpose').first()?.json?.message?.content;\n\nlet repurposed;\ntry {\n  repurposed = JSON.parse(aiResponse);\n} catch (e) {\n  repurposed = { error: 'Parse failed', raw: aiResponse };\n}\n\nreturn {\n  json: {\n    original_content: input.content?.substring(0, 500) + '...',\n    repurposed: repurposed,\n    platforms_generated: Object.keys(repurposed).filter(k => k !== 'error'),\n    created_at: new Date().toISOString()\n  }\n};"
        },
        "id": "parse-output",
        "name": "Parse Output",
        "type": "n8n-nodes-base.code",
        "position": [
          1000,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Repurposed_Content"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "original_preview": "={{ $json.original_content }}",
              "linkedin_post": "={{ $json.repurposed.linkedin?.post }}",
              "twitter_thread": "={{ JSON.stringify($json.repurposed.twitter_thread) }}",
              "instagram_caption": "={{ $json.repurposed.instagram?.caption }}",
              "blog_title": "={{ $json.repurposed.blog_outline?.title }}",
              "created_at": "={{ $json.created_at }}"
            }
          }
        },
        "id": "save-content",
        "name": "Save Content",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1200,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "channel": "#content-ready",
          "text": "=ðŸ“ *Ä°Ã§erik DÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼!*\n\nâœ… Platformlar: {{ $json.platforms_generated.join(', ') }}\n\n*LinkedIn:*\n{{ $json.repurposed.linkedin?.post?.substring(0, 200) }}...\n\n*Twitter Thread:*\n{{ $json.repurposed.twitter_thread?.[0] }}\n\n_TÃ¼m iÃ§erikler Sheets'te mevcut._",
          "otherOptions": {}
        },
        "id": "notify-ready",
        "name": "Notify Ready",
        "type": "n8n-nodes-base.slack",
        "position": [
          1200,
          600
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "content": "## â™»ï¸ Content Repurposing\nTransforms long-form content into LinkedIn, Twitter, Instagram, and blog formats.",
          "height": 100,
          "width": 300,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          600,
          750
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Content Repurposing Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          800,
          750
        ]
      }
    ],
    "connections": {
      "Content Input": {
        "main": [
          [
            {
              "node": "Normalize Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize Input": {
        "main": [
          [
            {
              "node": "AI Repurpose",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Repurpose": {
        "main": [
          [
            {
              "node": "Parse Output",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Output": {
        "main": [
          [
            {
              "node": "Save Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Content": {
        "main": [
          [
            {
              "node": "Notify Ready",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "content"
      },
      {
        "name": "agency"
      },
      {
        "name": "repurposing"
      }
    ]
  },
  {
    "name": "Grain Email Marketing Automation v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-otd5nklb4",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "email-trigger",
          "options": {}
        },
        "id": "webhook-new-sub",
        "name": "New Subscriber",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "email-marketing"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 24
              }
            ]
          }
        },
        "id": "daily-drip",
        "name": "Daily Drip Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "const sub = $input.item.json;\nconst daysSinceSignup = Math.floor((Date.now() - new Date(sub.signup_date).getTime()) / (1000 * 60 * 60 * 24));\nreturn {\n  json: {\n    ...sub,\n    days_since_signup: daysSinceSignup,\n    drip_stage: daysSinceSignup <= 1 ? 'welcome' : daysSinceSignup <= 3 ? 'education' : daysSinceSignup <= 7 ? 'offer' : 'nurture'\n  }\n};"
        },
        "id": "calc-drip-stage",
        "name": "Calculate Drip Stage",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Generate a personalized email subject line and body for a {{ $json.drip_stage }} stage email.\nTone: Friendly, engaging.\nGoal: {{ $json.drip_stage === 'welcome' ? 'Welcome and build trust' : $json.drip_stage === 'education' ? 'Educate on product value' : $json.drip_stage === 'offer' ? 'Present a limited-time offer' : 'Maintain engagement' }}\n\nOutput JSON: { \"subject\": \"...\", \"body\": \"...\" }"
              },
              {
                "role": "user",
                "content": "Subscriber: {{ $json.name }}\nProduct: {{ $json.product }}\nStage: {{ $json.drip_stage }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-email-gen",
        "name": "AI Generate Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "={{ $json.subject }}",
          "message": "={{ $json.body }}",
          "options": {}
        },
        "id": "send-email",
        "name": "Send Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1000,
          300
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Email_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "email": "={{ $json.email }}",
              "last_email_sent": "={{ $now.toISO() }}",
              "stage": "={{ $json.drip_stage }}"
            }
          }
        },
        "id": "log-email",
        "name": "Log to Sheet",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1200,
          300
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          600
        ]
      },
      {
        "parameters": {
          "channel": "email-alerts",
          "text": "=ðŸš¨ Email Automation Error\n\nSubscriber: {{ $json.email }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-alert",
        "name": "Alert Error",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          950,
          600
        ]
      }
    ],
    "connections": {
      "New Subscriber": {
        "main": [
          [
            {
              "node": "Calculate Drip Stage",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Drip Check": {
        "main": [
          [
            {
              "node": "Calculate Drip Stage",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Drip Stage": {
        "main": [
          [
            {
              "node": "AI Generate Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Email": {
        "main": [
          [
            {
              "node": "Send Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Email": {
        "main": [
          [
            {
              "node": "Log to Sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Alert Error",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain GBP Auto Posting v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-o86djvbau",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 10 * * 1,3,5"
              }
            ]
          }
        },
        "id": "schedule-post",
        "name": "Schedule Post",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          400
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {},
        "id": "webhook-post",
        "name": "Manual Post",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          600
        ],
        "webhookId": "gbp-post"
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "GBP_Content_Calendar"
          },
          "options": {}
        },
        "id": "get-content",
        "name": "Get Content",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          400,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.status }}",
                "rightValue": "scheduled",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "leftValue": "={{ $json.scheduled_date }}",
                "rightValue": "={{ $now.format('YYYY-MM-DD') }}",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-today",
        "name": "Filter Today",
        "type": "n8n-nodes-base.filter",
        "position": [
          600,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Google Business Profile postu yaz. Local SEO iÃ§in optimize et.\n\nKurallar:\n- Max 1500 karakter\n- CTA ekle (Rezervasyon yap, Ara, Ziyaret et)\n- Emoji kullan ama abartma\n- Konum bazlÄ± kelimeler ekle\n\nJSON: {\"summary\": \"post metni\", \"cta_type\": \"BOOK/CALL/LEARN_MORE\"}"
              },
              {
                "role": "user",
                "content": "=Business: {{ $json.business_name }}\nTopic: {{ $json.topic }}\nType: {{ $json.post_type }}\nLocation: {{ $json.location }}"
              }
            ]
          }
        },
        "id": "ai-generate",
        "name": "AI Generate",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          800,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://mybusiness.googleapis.com/v4/accounts/{{ $env.GBP_ACCOUNT_ID }}/locations/{{ $env.GBP_LOCATION_ID }}/localPosts",
          "authentication": "oAuth2",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"languageCode\": \"tr\",\n  \"summary\": \"{{ $('AI Generate').first().json.message.content.summary }}\",\n  \"callToAction\": {\n    \"actionType\": \"{{ $('AI Generate').first().json.message.content.cta_type }}\",\n    \"url\": \"{{ $json.cta_url || $env.BUSINESS_WEBSITE }}\"\n  },\n  \"topicType\": \"STANDARD\"\n}"
        },
        "id": "post-to-gbp",
        "name": "Post to GBP",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1000,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "GBP_Content_Calendar"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "status": "published",
              "published_at": "={{ $now.toISO() }}",
              "post_id": "={{ $('Post to GBP').first().json.name }}"
            }
          }
        },
        "id": "update-status",
        "name": "Update Status",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1200,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "channel": "#local-seo",
          "text": "=âœ… *GBP Post YayÄ±nlandÄ±*\n\nðŸ“ {{ $json.business_name }}\nðŸ“ {{ $json.topic }}\n\n_Google Maps'te gÃ¶rÃ¼nÃ¼r oldu._",
          "otherOptions": {}
        },
        "id": "notify",
        "name": "Notify",
        "type": "n8n-nodes-base.slack",
        "position": [
          1200,
          600
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "content": "## ðŸ“ Local SEO Automation\nPosts to Google Business Profile on Mon/Wed/Fri at 10 AM. AI generates optimized content.",
          "height": 100,
          "width": 300,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          600,
          750
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ GBP Posting Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          800,
          750
        ]
      }
    ],
    "connections": {
      "Schedule Post": {
        "main": [
          [
            {
              "node": "Get Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Post": {
        "main": [
          [
            {
              "node": "Get Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Content": {
        "main": [
          [
            {
              "node": "Filter Today",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Today": {
        "main": [
          [
            {
              "node": "AI Generate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate": {
        "main": [
          [
            {
              "node": "Post to GBP",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Post to GBP": {
        "main": [
          [
            {
              "node": "Update Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Status": {
        "main": [
          [
            {
              "node": "Notify",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "local-seo"
      },
      {
        "name": "gbp"
      },
      {
        "name": "hospitality"
      }
    ]
  },
  {
    "name": "Grain Google Search Console Hub v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-abzm7pdtr",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ“Š Google Search Console Hub\nFree SEO data directly from GSC: impressions, clicks, CTR, position tracking.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1"
              }
            ]
          }
        },
        "id": "weekly-trigger",
        "name": "Weekly Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://searchconsole.googleapis.com/webmasters/v3/sites/{{ encodeURIComponent($env.GSC_SITE_URL) }}/searchAnalytics/query",
          "authentication": "oAuth2",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"startDate\": \"{{ $now.minus({days: 28}).toFormat('yyyy-MM-dd') }}\",\n  \"endDate\": \"{{ $now.minus({days: 1}).toFormat('yyyy-MM-dd') }}\",\n  \"dimensions\": [\"query\"],\n  \"rowLimit\": 100,\n  \"dataState\": \"final\"\n}"
        },
        "id": "gsc-queries",
        "name": "Get Top Queries",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://searchconsole.googleapis.com/webmasters/v3/sites/{{ encodeURIComponent($env.GSC_SITE_URL) }}/searchAnalytics/query",
          "authentication": "oAuth2",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"startDate\": \"{{ $now.minus({days: 28}).toFormat('yyyy-MM-dd') }}\",\n  \"endDate\": \"{{ $now.minus({days: 1}).toFormat('yyyy-MM-dd') }}\",\n  \"dimensions\": [\"page\"],\n  \"rowLimit\": 50,\n  \"dataState\": \"final\"\n}"
        },
        "id": "gsc-pages",
        "name": "Get Top Pages",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "const queries = $('Get Top Queries').first().json.rows || [];\nconst pages = $('Get Top Pages').first().json.rows || [];\n\nconst topQueries = queries.slice(0, 20).map(q => ({\n  keyword: q.keys[0],\n  clicks: q.clicks,\n  impressions: q.impressions,\n  ctr: (q.ctr * 100).toFixed(2) + '%',\n  position: q.position.toFixed(1)\n}));\n\nconst lowHangingFruit = queries.filter(q => q.position >= 5 && q.position <= 20 && q.impressions > 100)\n  .slice(0, 10)\n  .map(q => ({ keyword: q.keys[0], position: q.position.toFixed(1), impressions: q.impressions }));\n\nconst topPages = pages.slice(0, 10).map(p => ({\n  url: p.keys[0],\n  clicks: p.clicks,\n  impressions: p.impressions,\n  ctr: (p.ctr * 100).toFixed(2) + '%'\n}));\n\nconst totalClicks = queries.reduce((a, b) => a + b.clicks, 0);\nconst totalImpressions = queries.reduce((a, b) => a + b.impressions, 0);\n\nreturn {\n  json: {\n    summary: { total_clicks: totalClicks, total_impressions: totalImpressions, avg_ctr: ((totalClicks / totalImpressions) * 100).toFixed(2) + '%' },\n    top_queries: topQueries,\n    low_hanging_fruit: lowHangingFruit,\n    top_pages: topPages\n  }\n};"
        },
        "id": "analyze-gsc",
        "name": "Analyze GSC Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an SEO analyst. Based on GSC data, provide:\n\n1. Top 3 quick wins (keywords to optimize)\n2. Content gaps to address\n3. Pages that need CTR improvement\n4. Weekly action items\n\nBe specific and actionable."
              },
              {
                "role": "user",
                "content": "GSC Summary:\n{{ JSON.stringify($json.summary) }}\n\nLow Hanging Fruit (Position 5-20):\n{{ JSON.stringify($json.low_hanging_fruit) }}\n\nTop Pages:\n{{ JSON.stringify($json.top_pages) }}"
              }
            ]
          }
        },
        "id": "ai-recommendations",
        "name": "AI Recommendations",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#seo-weekly",
          "text": "=ðŸ“Š **Weekly GSC Report**\n\nðŸ“ˆ Summary:\nâ€¢ Clicks: {{ $('Analyze GSC Data').first().json.summary.total_clicks }}\nâ€¢ Impressions: {{ $('Analyze GSC Data').first().json.summary.total_impressions }}\nâ€¢ Avg CTR: {{ $('Analyze GSC Data').first().json.summary.avg_ctr }}\n\nðŸŽ¯ Low Hanging Fruit (Pos 5-20):\n{{ $('Analyze GSC Data').first().json.low_hanging_fruit.slice(0, 5).map(k => 'â€¢ ' + k.keyword + ' (Pos: ' + k.position + ')').join('\\n') }}\n\nðŸ’¡ AI Recommendations:\n{{ $json.message.content }}",
          "otherOptions": {}
        },
        "id": "slack-report",
        "name": "Send Weekly Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1250,
          500
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          500,
          750
        ]
      },
      {
        "parameters": {
          "channel": "#seo-alerts",
          "text": "=ðŸš¨ GSC Hub Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          750
        ]
      }
    ],
    "connections": {
      "Weekly Report": {
        "main": [
          [
            {
              "node": "Get Top Queries",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Top Pages",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Top Queries": {
        "main": [
          [
            {
              "node": "Analyze GSC Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Top Pages": {
        "main": [
          [
            {
              "node": "Analyze GSC Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze GSC Data": {
        "main": [
          [
            {
              "node": "AI Recommendations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Recommendations": {
        "main": [
          [
            {
              "node": "Send Weekly Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Influencer Outreach v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-mhuyholvd",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "influencer-campaign",
          "options": {}
        },
        "id": "webhook-campaign",
        "name": "New Campaign",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "influencer-outreach"
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Influencer_List"
          }
        },
        "id": "get-influencers",
        "name": "Get Influencer List",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Write a personalized influencer outreach DM for {{ $json.influencer_name }}. Keep it casual, friendly, under 150 chars. Mention their niche: {{ $json.niche }}."
              },
              {
                "role": "user",
                "content": "Campaign: {{ $json.campaign_name }}\nProduct: {{ $json.product }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-dm",
        "name": "Generate DM",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Influencer_List"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "status": "outreach_sent",
              "last_contacted": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "update-status",
        "name": "Update Status",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1000,
          300
        ]
      }
    ],
    "connections": {
      "New Campaign": {
        "main": [
          [
            {
              "node": "Get Influencer List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Influencer List": {
        "main": [
          [
            {
              "node": "Generate DM",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate DM": {
        "main": [
          [
            {
              "node": "Update Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Keyword Gap Analysis v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-0j0lkaneo",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-gap",
        "name": "Gap Analysis Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "keyword-gap"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nreturn {\n  json: {\n    our_domain: input.our_domain,\n    competitors: input.competitors || [],\n    target_keywords: input.keywords || [],\n    country: input.country || 'tr'\n  }\n};"
        },
        "id": "normalize",
        "name": "Normalize",
        "type": "n8n-nodes-base.code",
        "position": [
          400,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://www.googleapis.com/webmasters/v3/sites/{{ encodeURIComponent('sc-domain:' + $json.our_domain) }}/searchAnalytics/query",
          "authentication": "oAuth2",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"startDate\": \"{{ $now.minus({days: 30}).format('YYYY-MM-DD') }}\",\n  \"endDate\": \"{{ $now.format('YYYY-MM-DD') }}\",\n  \"dimensions\": [\"query\"],\n  \"rowLimit\": 500\n}"
        },
        "id": "gsc-our-keywords",
        "name": "GSC Our Keywords",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          600,
          300
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\"q\": \"site:{{ $json.competitors[0] }}\", \"gl\": \"{{ $json.country }}\", \"num\": 100}"
        },
        "id": "competitor-keywords",
        "name": "Competitor Keywords",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          600,
          500
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "const ourKeywords = $('GSC Our Keywords').first()?.json?.rows?.map(r => r.keys[0].toLowerCase()) || [];\nconst competitorResults = $('Competitor Keywords').first()?.json?.organic || [];\n\n// Extract keywords from competitor titles/snippets\nconst competitorKeywords = new Set();\ncompetitorResults.forEach(r => {\n  const words = (r.title + ' ' + r.snippet).toLowerCase().split(/\\s+/);\n  words.filter(w => w.length > 3).forEach(w => competitorKeywords.add(w));\n});\n\n// Find gap (competitor has, we don't)\nconst ourSet = new Set(ourKeywords);\nconst gaps = [...competitorKeywords].filter(k => !ourSet.has(k)).slice(0, 50);\n\nreturn {\n  json: {\n    our_keyword_count: ourKeywords.length,\n    competitor_keyword_count: competitorKeywords.size,\n    keyword_gaps: gaps,\n    gap_count: gaps.length\n  }\n};"
        },
        "id": "find-gaps",
        "name": "Find Gaps",
        "type": "n8n-nodes-base.code",
        "position": [
          800,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "SEO uzmanÄ±sÄ±n. Keyword gap listesini analiz et ve Ã¶nceliklendir.\n\nJSON dÃ¶ndÃ¼r:\n{\n  \"high_priority\": [{\"keyword\": \"\", \"reason\": \"\", \"content_type\": \"blog/page/category\"}],\n  \"medium_priority\": [],\n  \"quick_wins\": [],\n  \"content_plan\": [{\"title\": \"\", \"target_keyword\": \"\", \"word_count\": 0}]\n}"
              },
              {
                "role": "user",
                "content": "=Keyword Gaps Found: {{ $json.gap_count }}\n\nTop Gaps:\n{{ $json.keyword_gaps.slice(0, 30).join(', ') }}"
              }
            ]
          }
        },
        "id": "ai-prioritize",
        "name": "AI Prioritize",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1000,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Keyword_Gap_Analysis"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "analyzed_at": "={{ $now.toISO() }}",
              "our_keywords": "={{ $json.our_keyword_count }}",
              "gaps_found": "={{ $json.gap_count }}",
              "top_gaps": "={{ $json.keyword_gaps.slice(0, 20).join(', ') }}"
            }
          }
        },
        "id": "save-analysis",
        "name": "Save Analysis",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1200,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "channel": "#seo-opportunities",
          "text": "=ðŸŽ¯ *Keyword Gap Analizi TamamlandÄ±*\n\nðŸ“Š Bizim Keyword: {{ $json.our_keyword_count }}\nðŸ” Bulunan AÃ§Ä±k: {{ $json.gap_count }}\n\n*En Ã–nemli FÄ±rsatlar:*\n{{ $json.keyword_gaps.slice(0, 10).map((k, i) => (i+1) + '. ' + k).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "notify",
        "name": "Notify",
        "type": "n8n-nodes-base.slack",
        "position": [
          1200,
          600
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "content": "## ðŸŽ¯ Keyword Gap Analysis\nCompares your GSC keywords vs competitor rankings to find content opportunities.",
          "height": 100,
          "width": 300,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          600,
          750
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Keyword Gap Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          800,
          750
        ]
      }
    ],
    "connections": {
      "Gap Analysis Request": {
        "main": [
          [
            {
              "node": "Normalize",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize": {
        "main": [
          [
            {
              "node": "GSC Our Keywords",
              "type": "main",
              "index": 0
            },
            {
              "node": "Competitor Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GSC Our Keywords": {
        "main": [
          [
            {
              "node": "Find Gaps",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Competitor Keywords": {
        "main": [
          [
            {
              "node": "Find Gaps",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Find Gaps": {
        "main": [
          [
            {
              "node": "AI Prioritize",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Prioritize": {
        "main": [
          [
            {
              "node": "Save Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Analysis": {
        "main": [
          [
            {
              "node": "Notify",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "seo"
      },
      {
        "name": "competitor"
      },
      {
        "name": "keywords"
      }
    ]
  },
  {
    "name": "Grain Landing Page CRO Hub v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-8kcnuod0e",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "landing-page/generate",
          "options": {}
        },
        "id": "webhook-gen-lp",
        "name": "Generate Page Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "lp-generate"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Landing Page Specialist. Generate a JSON structure for a high-converting landing page based on the product description.\nStructure: { \"hero_headline\": \"...\", \"hero_subhead\": \"...\", \"benefits\": [], \"features\": [], \"cta_primary\": \"...\", \"cta_secondary\": \"...\" }\nApply persuasion principles (Cialdini)."
              },
              {
                "role": "user",
                "content": "Product: {{ $json.body.product_name }}\nTarget Audience: {{ $json.body.audience }}\nValue Prop: {{ $json.body.value_prop }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-lp-structure",
        "name": "AI Build Page Structure",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ $json }}",
          "options": {}
        },
        "id": "return-page",
        "name": "Return JSON",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "landing-page/form-submit",
          "options": {}
        },
        "id": "webhook-form",
        "name": "Form Submission",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          500
        ],
        "webhookId": "lp-form-submit"
      },
      {
        "parameters": {
          "jsCode": "// Trigger Lead Funnel Workflow via API call or internal trigger\nreturn { json: { ...$input.item.json, source: \"landing_page\" } };"
        },
        "id": "trigger-funnel",
        "name": "Trigger Lead Funnel",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Form_Submissions"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "email": "={{ $json.body.email }}",
              "page_id": "={{ $json.body.page_id }}",
              "timestamp": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-submission",
        "name": "Save Submission",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          700,
          500
        ]
      }
    ],
    "connections": {
      "Generate Page Request": {
        "main": [
          [
            {
              "node": "AI Build Page Structure",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Build Page Structure": {
        "main": [
          [
            {
              "node": "Return JSON",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Form Submission": {
        "main": [
          [
            {
              "node": "Trigger Lead Funnel",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Submission",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Multi-Platform Publisher v2",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-wq72ddale",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 30
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Every 30 Minutes",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Content_Calendar"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "read-calendar",
        "name": "Read Content Calendar",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "status-check",
                "leftValue": "={{ $json.status }}",
                "rightValue": "approved",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "published-check",
                "leftValue": "={{ $json.published }}",
                "rightValue": "FALSE",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-posts",
        "name": "Filter Approved",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "const now = new Date();\nconst scheduledTime = new Date($input.item.json.scheduled_datetime);\n\nif (scheduledTime <= now) {\n  return $input.item;\n}\nreturn [];"
        },
        "id": "check-time",
        "name": "Check Time",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          850,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an expert social media manager. Generate optimized captions for the following platforms based on the input content. Return ONLY a JSON object with keys: instagram, facebook, twitter, linkedin, tiktok, threads, reddit, quora, pinterest.\n\nRules:\n- Instagram: engaging, emojis, 30 hashtags\n- Twitter: Max 280 chars, punchy\n- LinkedIn: Professional, business focus\n- TikTok: Viral style, trending tags\n- Reddit: Informative, no marketing fluff\n"
              },
              {
                "role": "user",
                "content": "Original Content: {{ $json.original_caption }}\nTopic: {{ $json.topic }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-caption-gen",
        "name": "AI Generate Captions",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1050,
          300
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.platforms }}",
          "rules": {
            "rules": [
              {
                "value2": "instagram",
                "output": 0
              },
              {
                "value2": "facebook",
                "output": 1
              },
              {
                "value2": "twitter",
                "output": 2
              },
              {
                "value2": "linkedin",
                "output": 3
              },
              {
                "value2": "tiktok",
                "output": 4
              }
            ]
          },
          "fallbackOutput": 5
        },
        "id": "platform-router",
        "name": "Platform Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1300,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://graph.facebook.com/v19.0/{{ $env.IG_USER_ID }}/media",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "image_url",
                "value": "={{ $json.media_url }}"
              },
              {
                "name": "caption",
                "value": "={{ $json.captions.instagram }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.IG_ACCESS_TOKEN }}"
              }
            ]
          }
        },
        "id": "post-instagram",
        "name": "Post to Instagram",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1600,
          100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://graph.facebook.com/v19.0/{{ $env.PAGE_ID }}/feed",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "message",
                "value": "={{ $json.captions.facebook }}"
              },
              {
                "name": "link",
                "value": "={{ $json.media_url }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.FB_ACCESS_TOKEN }}"
              }
            ]
          }
        },
        "id": "post-facebook",
        "name": "Post to Facebook",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1600,
          300
        ]
      },
      {
        "parameters": {
          "content": "Placeholder for Twitter/X V2 API Posting",
          "height": 100,
          "width": 300
        },
        "id": "twitter-stub",
        "name": "Sticky Note Twitter",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1600,
          500
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Content_Calendar"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "published": "TRUE",
              "published_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "update-status",
        "name": "Update Status",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          2000,
          300
        ]
      }
    ],
    "connections": {
      "Every 30 Minutes": {
        "main": [
          [
            {
              "node": "Read Content Calendar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read Content Calendar": {
        "main": [
          [
            {
              "node": "Filter Approved",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Approved": {
        "main": [
          [
            {
              "node": "Check Time",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Time": {
        "main": [
          [
            {
              "node": "AI Generate Captions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Captions": {
        "main": [
          [
            {
              "node": "Platform Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Platform Router": {
        "main": [
          [
            {
              "node": "Post to Instagram",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Post to Facebook",
              "type": "main",
              "index": 0
            }
          ],
          [],
          [],
          []
        ]
      },
      "Post to Instagram": {
        "main": [
          [
            {
              "node": "Update Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Post to Facebook": {
        "main": [
          [
            {
              "node": "Update Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain SEO Engine v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-wp9ba2wdh",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-seo",
        "name": "SEO Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "seo-engine"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1"
              }
            ]
          }
        },
        "id": "weekly-audit",
        "name": "Weekly Audit",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          600
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\"q\": \"{{ $json.keyword }}\", \"gl\": \"{{ $json.country || 'tr' }}\", \"num\": 20}"
        },
        "id": "serp-check",
        "name": "SERP Check",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          450,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "const results = $input.item.json;\nconst domain = $env.PRIMARY_DOMAIN || 'example.com';\nconst organic = results.organic || [];\n\nconst ourRank = organic.findIndex(r => r.link?.includes(domain)) + 1;\nconst competitors = organic.slice(0, 10).map((r, i) => ({\n  rank: i + 1,\n  title: r.title,\n  domain: new URL(r.link).hostname,\n  snippet: r.snippet\n}));\n\nreturn {\n  json: {\n    keyword: results.searchParameters?.q,\n    our_position: ourRank || 'Not ranking',\n    top_competitors: competitors,\n    related_searches: results.relatedSearches?.map(r => r.query) || [],\n    people_also_ask: results.peopleAlsoAsk?.map(p => p.question) || []\n  }\n};"
        },
        "id": "analyze-serp",
        "name": "Analyze SERP",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "SEO uzmanÄ±sÄ±n. SERP verilerini analiz et ve JSON dÃ¶ndÃ¼r:\n{\"seo_score\": 0-100, \"opportunities\": [], \"content_recommendations\": [], \"quick_wins\": []}"
              },
              {
                "role": "user",
                "content": "=Keyword: {{ $json.keyword }}\nPosition: {{ $json.our_position }}\nCompetitors: {{ JSON.stringify($json.top_competitors.slice(0, 5)) }}\nRelated: {{ $json.related_searches.join(', ') }}"
              }
            ]
          }
        },
        "id": "ai-seo-analysis",
        "name": "AI SEO Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          850,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "SEO_Tracking"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "keyword": "={{ $json.keyword }}",
              "position": "={{ $json.our_position }}",
              "checked_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-results",
        "name": "Save Results",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1050,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "channel": "#seo-alerts",
          "text": "=ðŸ“Š *SEO Report*\n\nKeyword: {{ $json.keyword }}\nPosition: {{ $json.our_position }}\n\n*Top Competitors:*\n{{ $json.top_competitors.slice(0, 3).map(c => c.rank + '. ' + c.domain).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "slack-report",
        "name": "Slack Report",
        "type": "n8n-nodes-base.slack",
        "position": [
          1250,
          400
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "content": "## ðŸ” SEO Engine\nWeekly SERP tracking with AI-powered recommendations. Uses Serper API for search data.",
          "height": 100,
          "width": 300,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          650,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ SEO Engine Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          850,
          650
        ]
      }
    ],
    "connections": {
      "SEO Request": {
        "main": [
          [
            {
              "node": "SERP Check",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Weekly Audit": {
        "main": [
          [
            {
              "node": "SERP Check",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SERP Check": {
        "main": [
          [
            {
              "node": "Analyze SERP",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze SERP": {
        "main": [
          [
            {
              "node": "AI SEO Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI SEO Analysis": {
        "main": [
          [
            {
              "node": "Save Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Results": {
        "main": [
          [
            {
              "node": "Slack Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "seo"
      },
      {
        "name": "marketing"
      }
    ]
  },
  {
    "name": "Grain SEO Keyword Research Free v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-b9oinovqz",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ” SEO Keyword Research (Free)\nAI-powered keyword research using Serper API + GPT-4o. No SEMrush required!",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "keyword-research",
          "options": {}
        },
        "id": "webhook-research",
        "name": "Research Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "keyword-research"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-KEY",
                "value": "={{ $env.SERPER_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"q\": \"{{ $json.keyword }}\", \"gl\": \"{{ $json.country || 'us' }}\", \"num\": 20 }"
        },
        "id": "serper-search",
        "name": "Serper SERP",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-KEY",
                "value": "={{ $env.SERPER_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"q\": \"{{ $('Research Request').first().json.keyword }}\", \"type\": \"autocomplete\" }"
        },
        "id": "serper-autocomplete",
        "name": "Related Keywords",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "const serp = $('Serper SERP').first().json;\nconst autocomplete = $('Related Keywords').first().json;\nconst keyword = $('Research Request').first().json.keyword;\n\nconst competitors = (serp.organic || []).slice(0, 10).map(r => ({\n  position: r.position,\n  title: r.title,\n  url: r.link,\n  snippet: r.snippet\n}));\n\nconst relatedKeywords = (autocomplete.suggestions || []).slice(0, 10);\nconst peopleAlsoAsk = (serp.peopleAlsoAsk || []).map(p => p.question);\n\nreturn {\n  json: {\n    keyword: keyword,\n    serp_results: competitors.length,\n    top_competitors: competitors,\n    related_keywords: relatedKeywords,\n    people_also_ask: peopleAlsoAsk,\n    search_features: {\n      has_featured_snippet: !!serp.answerBox,\n      has_knowledge_graph: !!serp.knowledgeGraph,\n      has_local_pack: !!serp.localResults\n    }\n  }\n};"
        },
        "id": "combine-data",
        "name": "Combine SERP Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an SEO expert. Analyze the SERP data and provide:\n\n1. Keyword difficulty estimate (Easy/Medium/Hard) based on competitor quality\n2. Content type recommendation (blog, product page, tool, etc.)\n3. Estimated monthly search volume range\n4. 5 long-tail keyword suggestions\n5. Content outline for ranking\n\nReturn JSON format."
              },
              {
                "role": "user",
                "content": "Keyword: {{ $json.keyword }}\n\nTop 10 SERP Results:\n{{ JSON.stringify($json.top_competitors, null, 2) }}\n\nRelated Keywords: {{ $json.related_keywords.join(', ') }}\n\nPeople Also Ask: {{ $json.people_also_ask.join(', ') }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-analyze",
        "name": "AI SEO Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Keyword_Research"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "keyword": "={{ $('Research Request').first().json.keyword }}",
              "difficulty": "={{ $json.difficulty }}",
              "volume_range": "={{ $json.volume_estimate }}",
              "content_type": "={{ $json.content_type }}",
              "longtail_keywords": "={{ $json.long_tail_keywords?.join('; ') }}",
              "researched_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-research",
        "name": "Save Research",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1250,
          500
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ $json }}",
          "options": {}
        },
        "id": "respond",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          750
        ]
      },
      {
        "parameters": {
          "channel": "#seo-alerts",
          "text": "=ðŸš¨ Keyword Research Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          750
        ]
      }
    ],
    "connections": {
      "Research Request": {
        "main": [
          [
            {
              "node": "Serper SERP",
              "type": "main",
              "index": 0
            },
            {
              "node": "Related Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Serper SERP": {
        "main": [
          [
            {
              "node": "Combine SERP Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Related Keywords": {
        "main": [
          [
            {
              "node": "Combine SERP Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Combine SERP Data": {
        "main": [
          [
            {
              "node": "AI SEO Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI SEO Analysis": {
        "main": [
          [
            {
              "node": "Save Research",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Research": {
        "main": [
          [
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain SERP Rank Tracker Free v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-8x348wqpn",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ“ˆ SERP Rank Tracker (Free)\nTrack your keyword rankings using Serper API. No Ahrefs required!",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 7 * * *"
              }
            ]
          }
        },
        "id": "daily-check",
        "name": "Daily Rank Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Keywords_to_Track"
          }
        },
        "id": "get-keywords",
        "name": "Get Keywords",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-KEY",
                "value": "={{ $env.SERPER_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"q\": \"{{ $json.keyword }}\", \"gl\": \"{{ $json.country || 'us' }}\", \"num\": 100 }"
        },
        "id": "check-serp",
        "name": "Check SERP",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const serp = $input.item.json;\nconst keyword = $('Get Keywords').first().json.keyword;\nconst targetDomain = $env.TARGET_DOMAIN;\nconst previousPosition = parseInt($('Get Keywords').first().json.last_position) || 0;\n\nconst organic = serp.organic || [];\nlet currentPosition = 0;\nlet rankingUrl = '';\n\nfor (let i = 0; i < organic.length; i++) {\n  if (organic[i].link.includes(targetDomain)) {\n    currentPosition = i + 1;\n    rankingUrl = organic[i].link;\n    break;\n  }\n}\n\nconst change = previousPosition > 0 ? previousPosition - currentPosition : 0;\nconst status = currentPosition === 0 ? 'not_ranking' : change > 0 ? 'improved' : change < 0 ? 'dropped' : 'stable';\n\nreturn {\n  json: {\n    keyword: keyword,\n    current_position: currentPosition,\n    previous_position: previousPosition,\n    change: change,\n    status: status,\n    ranking_url: rankingUrl,\n    checked_at: new Date().toISOString()\n  }\n};"
        },
        "id": "find-position",
        "name": "Find Position",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ Math.abs($json.change) }}",
                "rightValue": 3,
                "operator": {
                  "type": "number",
                  "operation": "gte"
                }
              }
            ]
          }
        },
        "id": "significant-change",
        "name": "Big Change?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#seo-rankings",
          "text": "={{ $json.change > 0 ? 'ðŸ“ˆ' : 'ðŸ“‰' }} **Rank Change Alert**\n\nKeyword: {{ $json.keyword }}\nPosition: {{ $json.previous_position }} â†’ {{ $json.current_position }} ({{ $json.change > 0 ? '+' : '' }}{{ $json.change }})\nURL: {{ $json.ranking_url }}",
          "otherOptions": {}
        },
        "id": "alert-change",
        "name": "Alert Change",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Rank_History"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "keyword": "={{ $json.keyword }}",
              "position": "={{ $json.current_position }}",
              "change": "={{ $json.change }}",
              "status": "={{ $json.status }}",
              "checked_at": "={{ $json.checked_at }}"
            }
          }
        },
        "id": "save-history",
        "name": "Save History",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          600
        ]
      },
      {
        "parameters": {
          "channel": "#seo-alerts",
          "text": "=ðŸš¨ Rank Tracker Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          600
        ]
      }
    ],
    "connections": {
      "Daily Rank Check": {
        "main": [
          [
            {
              "node": "Get Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Keywords": {
        "main": [
          [
            {
              "node": "Check SERP",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check SERP": {
        "main": [
          [
            {
              "node": "Find Position",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Find Position": {
        "main": [
          [
            {
              "node": "Big Change?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Big Change?": {
        "main": [
          [
            {
              "node": "Alert Change",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save History",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save History",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Webinar Event Automation v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-8ky5v3fq0",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "webinar-register",
          "options": {}
        },
        "id": "webhook-register",
        "name": "Registration",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "webinar-registration"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Registrations"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "email": "={{ $json.email }}",
              "name": "={{ $json.name }}",
              "event": "={{ $json.event_name }}",
              "registered_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-registration",
        "name": "Save Registration",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "KayÄ±t OnaylandÄ±: {{ $json.event_name }}",
          "message": "Merhaba {{ $json.name }},\n\n{{ $json.event_name }} etkinliÄŸine kaydÄ±nÄ±z alÄ±ndÄ±.\n\nTarih: {{ $json.event_date }}\nLink: {{ $json.join_url }}",
          "options": {}
        },
        "id": "confirm-email",
        "name": "Confirmation Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 24
              }
            ]
          }
        },
        "id": "daily-reminder-check",
        "name": "Daily Reminder Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          550
        ]
      },
      {
        "parameters": {
          "jsCode": "// Check for events happening tomorrow\nconst eventDate = new Date($json.event_date);\nconst now = new Date();\nconst hoursUntil = (eventDate - now) / (1000 * 60 * 60);\nif (hoursUntil > 20 && hoursUntil < 28) {\n  return { json: { ...$json, send_reminder: true } };\n}\nreturn [];"
        },
        "id": "calc-reminder",
        "name": "Check Tomorrow Events",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          550
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "â° YarÄ±n: {{ $json.event_name }}",
          "message": "Merhaba {{ $json.name }},\n\nYarÄ±n {{ $json.event_name }} etkinliÄŸimiz var!\n\nKatÄ±lÄ±m Linki: {{ $json.join_url }}",
          "options": {}
        },
        "id": "reminder-email",
        "name": "Reminder Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          750,
          550
        ]
      }
    ],
    "connections": {
      "Registration": {
        "main": [
          [
            {
              "node": "Save Registration",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Registration": {
        "main": [
          [
            {
              "node": "Confirmation Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Reminder Check": {
        "main": [
          [
            {
              "node": "Check Tomorrow Events",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Tomorrow Events": {
        "main": [
          [
            {
              "node": "Reminder Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain_Sub_AI_Executor",
    "nodes": [
      {
        "parameters": {
          "content": "## ðŸ§  Sub-workflow: AI Executor\nCentralized handling of AI requests to OpenAI/Anthropic/Ollama.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "provider",
                "value": "={{ $json.provider || 'openai' }}"
              },
              {
                "name": "model",
                "value": "={{ $json.model || 'gpt-4o' }}"
              },
              {
                "name": "temperature",
                "value": "={{ $json.temperature || 0.7 }}"
              }
            ]
          },
          "options": {}
        },
        "id": "ai-config",
        "name": "AI Config",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.provider }}",
          "rules": {
            "rules": [
              {
                "value2": "openai",
                "output": 0
              },
              {
                "value2": "anthropic",
                "output": 1
              },
              {
                "value2": "ollama",
                "output": 2
              }
            ]
          }
        },
        "id": "provider-switch",
        "name": "Provider Switch",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "model": "={{ $json.model }}",
          "prompt": "={{ $json.prompt }}",
          "temperature": "={{ $json.temperature }}"
        },
        "id": "openai-call",
        "name": "OpenAI Call",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "return { response: $input.first().json.text, tokens_used: $input.first().json.usage?.total_tokens || 0, provider: $json.provider, timestamp: new Date().toISOString() };"
        },
        "id": "response-normalizer",
        "name": "Response Normalizer",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      }
    ],
    "connections": {
      "AI Config": {
        "main": [
          [
            {
              "node": "Provider Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Provider Switch": {
        "main": [
          [
            {
              "node": "OpenAI Call",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Call": {
        "main": [
          [
            {
              "node": "Response Normalizer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain_Sub_Error_Handler",
    "nodes": [
      {
        "parameters": {
          "content": "## ðŸ›¡ï¸ Sub-workflow: Error Handler\nCentralized error logging and Slack/Email notifications.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rules": {
            "rules": [
              {
                "value2": "RATE_LIMIT",
                "output": 0
              },
              {
                "value2": "AUTH_ERROR",
                "output": 1
              },
              {
                "value2": "TIMEOUT",
                "output": 2
              },
              {
                "value2": "CRITICAL",
                "output": 3
              }
            ]
          }
        },
        "id": "error-classifier",
        "name": "Error Classifier",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "amount": 60,
          "unit": "seconds"
        },
        "id": "rate-limit-handler",
        "name": "Rate Limit Wait",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "channel": "={{ $env.SLACK_ALERTS_CHANNEL }}",
          "text": "=ðŸš¨ *Grain Workflow HatasÄ±*\n*Workflow:* {{ $json.workflow.name }}\n*Hata:* {{ $json.error.message }}\n*Zaman:* {{ $now.toISO() }}"
        },
        "id": "slack-alert",
        "name": "Slack Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          400
        ]
      }
    ],
    "connections": {
      "Error Classifier": {
        "main": [
          [
            {
              "node": "Rate Limit Wait",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Slack Alert",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Slack Alert",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Slack Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain_Sub_Notification_Hub",
    "nodes": [
      {
        "parameters": {
          "content": "## ðŸ“¢ Sub-workflow: Notification Hub\nMulti-channel router for Slack, Email, WhatsApp, Discord.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rules": {
            "rules": [
              {
                "value2": "slack",
                "output": 0
              },
              {
                "value2": "email",
                "output": 1
              },
              {
                "value2": "whatsapp",
                "output": 2
              },
              {
                "value2": "sms",
                "output": 3
              },
              {
                "value2": "discord",
                "output": 4
              }
            ]
          }
        },
        "id": "channel-router",
        "name": "Channel Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          250,
          400
        ]
      }
    ],
    "connections": {}
  }
]